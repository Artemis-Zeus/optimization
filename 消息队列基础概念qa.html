<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-06-10T01:07:30.2940587"><title>消息队列基础概念QA | 技术知识库</title><script type="application/json" id="virtual-toc-data">[{"id":"-qcvhq6_4","level":0,"title":"📋 知识结构","anchor":"#-qcvhq6_4"},{"id":"-qcvhq6_5","level":0,"title":"🔍 消息模型","anchor":"#-qcvhq6_5"},{"id":"-qcvhq6_6","level":0,"title":"🛡️ 可靠性保证","anchor":"#-qcvhq6_6"},{"id":"-qcvhq6_7","level":0,"title":"💡 面试技巧","anchor":"#-qcvhq6_7"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="消息队列基础概念QA | 技术知识库"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="技术知识库 Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/消息队列基础概念qa.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="消息队列基础概念QA | 技术知识库"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/消息队列基础概念qa.html#webpage",
    "url": "writerside-documentation/消息队列基础概念qa.html",
    "name": "消息队列基础概念QA | 技术知识库",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "技术知识库 Help"
}</script><!-- End Schema.org --></head><body data-id="消息队列基础概念QA" data-main-title="消息队列基础概念QA" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="消息队列面试大纲.md|消息队列面试大纲"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>技术知识库  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="消息队列基础概念QA" id="消息队列基础概念QA.md">消息队列基础概念QA</h1><p id="-qcvhq6_3">本文档深入解析消息队列的基础概念和核心原理，涵盖消息模型、可靠性保证、消息语义、架构模式等基础知识。</p><section class="chapter"><h2 id="-qcvhq6_4" data-toc="-qcvhq6_4">📋 知识结构</h2><svg aria-roledescription="mindmap" role="graphics-document document" viewBox="5 5 766.521240234375 385.8868103027344" style="max-width: 766.521240234375px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g></g><g class="mindmap-edges"><path class="edge section-edge-0 edge-depth-1" d="M 487.6893181917956,106.34285210900899 L 466.0003737090258,76.20866803117079 L444.31142922625594,46.07448395333259"></path><path class="edge section-edge-0 edge-depth-1" d="M 481.55016216213943,116.80276933258318 L 423.7887016498263,110.15681832758585 L366.02724113751316,103.51086732258852"></path><path class="edge section-edge-0 edge-depth-1" d="M 511.4062990534729,117.34925478116574 L 577.1063597064443,112.21747065811925 L642.8064203594158,107.08568653507277"></path><path class="edge section-edge-0 edge-depth-1" d="M 507.57316681506524,108.45173708221742 L 538.466401815832,80.49112029186247 L569.3596368165988,52.530503501507525"></path><path class="edge section-edge-0 edge-depth-0" d="M 390.49004356966884,184.83245591390158 L 437.11335973041184,155.6537268803426 L483.73667589115485,126.47499784678358"></path><path class="edge section-edge-1 edge-depth-1" d="M 543.5966550244293,245.6744435498391 L 566.718590558377,219.2365203494449 L589.8405260923246,192.79859714905064"></path><path class="edge section-edge-1 edge-depth-1" d="M 548.6580082858057,255.58348890540486 L 618.3324601059447,249.13679886705486 L688.0069119260837,242.69010882870484"></path><path class="edge section-edge-1 edge-depth-1" d="M 534.442301408743,271.94816036828297 L 536.0060095664388,304.4654702740063 L537.5697177241346,336.9827801797296"></path><path class="edge section-edge-1 edge-depth-1" d="M 547.1046000665026,263.74049016771585 L 596.8958170834309,288.94720794394493 L646.6870341003591,314.153925720174"></path><path class="edge section-edge-1 edge-depth-0" d="M 391.6462347351774,198.49846791386543 L 455.7483387583885,224.87779590575337 L519.8504427815997,251.25712389764135"></path><path class="edge section-edge-2 edge-depth-1" d="M 274.3757511954236,282.59429248286756 L 285.2156024655813,315.1741247116738 L296.055453735739,347.75395694048007"></path><path class="edge section-edge-2 edge-depth-1" d="M 254.64861455391963,267.860110227936 L 190.44699231835887,265.7132857438461 L126.2453700827981,263.5664612597562"></path><path class="edge section-edge-2 edge-depth-1" d="M 256.70857202791115,275.9622066663324 L 211.644695756857,302.4492304453015 L166.58081948580286,328.9362542242706"></path><path class="edge section-edge-2 edge-depth-1" d="M 284.0370241949825,272.57240622223947 L 339.8872901978415,288.90835158759535 L395.73755620070045,305.24429695295123"></path><path class="edge section-edge-2 edge-depth-0" d="M 365.47982794675545,201.38266805239022 L 323.7075531107149,230.57576478506942 L281.9352782746744,259.76886151774863"></path><path class="edge section-edge-3 edge-depth-1" d="M 204.4405666044667,136.41142714947696 L 146.92306073717464,159.04031499979718 L89.40555486988256,181.6692028501174"></path><path class="edge section-edge-3 edge-depth-1" d="M 203.57906810301893,128.60337869924564 L 141.9808172353529,118.97554216352498 L80.38256636768688,109.3477056278043"></path><path class="edge section-edge-3 edge-depth-1" d="M 208.78279818758836,119.40776520442373 L 184.1321443839384,89.89774746448606 L159.48149058028844,60.38772972454839"></path><path class="edge section-edge-3 edge-depth-1" d="M 225.419382567727,117.66396668481514 L 242.16105232654058,86.0519568173008 L258.9027220853542,54.439946949786474"></path><path class="edge section-edge-3 edge-depth-0" d="M 363.7915697485236,187.3617392939049 L 298.0870026282373,161.85493998530458 L232.38243550795102,136.34814067670428"></path></g><g class="mindmap-nodes"><g transform="translate(302.69087115197976, 173.8901176983436)" class="mindmap-node section--1 section-root"><g transform="translate(75.08399963378906, 18.9)"><circle r="75.08399963378906" class="node-bkg node-circle" id="node-0"></circle></g><g transform="translate(75.08399963378906, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">消息队列基础概念</tspan></tspan></text></g></g></g><g transform="translate(453.89716117505486, 99.61733606234156)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-1"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">消息模型</tspan></tspan></text></g></g></g><g transform="translate(483.17380639531484, 238.06547411316316)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h91.09600067138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-6"></path><line y2="37.8" x2="101.09600067138672" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(50.54800033569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">可靠性保证</tspan></tspan></text></g></g></g><g transform="translate(226.6042361375653, 249.4614118717952)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-11"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">消息语义</tspan></tspan></text></g></g></g><g transform="translate(175.3631351726101, 112.01976227226555)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-16"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">架构模式</tspan></tspan></text></g></g></g><g transform="translate(384.9863987429967, 15)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h91.125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-2"></path><line y2="37.8" x2="101.125" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(50.5625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">点对点模型</tspan></tspan></text></g></g></g><g transform="translate(292.5474296245977, 82.89630059283013)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h107.15625 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-3"></path><line y2="37.8" x2="117.15625" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(58.578125, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">发布订阅模型</tspan></tspan></text></g></g></g><g transform="translate(598.7008693645428, 87.01760525389693)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h108.12000274658203 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-4"></path><line y2="37.8" x2="118.12000274658203" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(59.060001373291016, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">消息拉取模式</tspan></tspan></text></g></g></g><g transform="translate(521.4209535833181, 23.56490452138337)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h108.12000274658203 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-5"></path><line y2="37.8" x2="118.12000274658203" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(59.060001373291016, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">消息推送模式</tspan></tspan></text></g></g></g><g transform="translate(548.6673740500523, 162.60756658572654)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h92.09600067138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-7"></path><line y2="37.8" x2="102.09600067138672" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(51.04800033569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">消息持久化</tspan></tspan></text></g></g></g><g transform="translate(644.3649884808813, 222.40812362094653)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h107.15625 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-8"></path><line y2="37.8" x2="117.15625" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(58.578125, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">消息确认机制</tspan></tspan></text></g></g></g><g transform="translate(496.23552490186944, 333.06546643484944)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-9"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">重试机制</tspan></tspan></text></g></g></g><g transform="translate(618.0151399358535, 302.0289417747267)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-10"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">死信队列</tspan></tspan></text></g></g></g><g transform="translate(242.83671915980824, 343.08683755155243)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h105.90850067138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-12"></path><line y2="37.8" x2="115.90850067138672" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(57.95425033569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">At</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Most</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Once</tspan></tspan></text></g></g></g><g transform="translate(50.635436365363375, 244.16515961589695)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h111.23662567138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-13"></path><line y2="37.8" x2="121.23662567138672" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(60.61831283569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">At</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Least</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Once</tspan></tspan></text></g></g></g><g transform="translate(96.94490574235965, 317.63704901880783)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h103.40850067138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-14"></path><line y2="37.8" x2="113.40850067138672" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(56.70425033569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Exactly</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Once</tspan></tspan></text></g></g></g><g transform="translate(359.0863446243286, 290.5552913033955)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h92.09600067138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-15"></path><line y2="37.8" x2="102.09600067138672" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(51.04800033569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">幂等性保证</tspan></tspan></text></g></g></g><g transform="translate(24.88448700364347, 168.2608677273288)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h91.125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-17"></path><line y2="37.8" x2="101.125" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(50.5625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">集中式架构</tspan></tspan></text></g></g></g><g transform="translate(15, 88.13132205478439)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h91.125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-18"></path><line y2="37.8" x2="101.125" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(50.5625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">分布式架构</tspan></tspan></text></g></g></g><g transform="translate(107.81046679717099, 29.975732656706555)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-19"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">主从复制</tspan></tspan></text></g></g></g><g transform="translate(223.36828268237537, 22.284151362336047)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-20"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">分区机制</tspan></tspan></text></g></g></g></g></svg></section><section class="chapter"><h2 id="-qcvhq6_5" data-toc="-qcvhq6_5">🔍 消息模型</h2><section class="chapter"><h3 id="q1" data-toc="q1">Q1: 什么是消息队列？消息队列有哪些核心组件和作用？</h3><p id="-qcvhq6_11"><span class="control" id="-qcvhq6_19">答案：</span></p><p id="-qcvhq6_12"><span class="control" id="-qcvhq6_20">消息队列定义：</span> 消息队列（Message Queue，MQ）是分布式系统中用于异步通信的中间件，它在消息生产者和消息消费者之间建立可靠的消息传递通道。</p><p id="-qcvhq6_13"><span class="control" id="-qcvhq6_21">核心组件架构：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1143.140625 410"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1143.140625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="消息队列核心架构" class="cluster"><rect height="394" width="1127.140625" y="8" x="8" style=""></rect><g transform="translate(507.46875, 8)" class="cluster-label"><foreignObject height="24" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消息队列核心架构</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M222.109,80L228.359,80C234.609,80,247.109,80,256.484,80C265.859,80,272.109,80,277.693,80C283.276,80,288.193,80,290.651,80L293.109,80"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M535.141,72.396L541.391,71.997C547.641,71.597,560.141,70.799,569.516,70.399C578.891,70,585.141,70,590.724,70C596.307,70,601.224,70,603.682,70L606.141,70"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_D_2" d="M516.742,107L526.059,109.5C535.375,112,554.008,117,571.297,125.917C588.587,134.833,604.533,147.667,619.96,160.082C635.387,172.497,650.294,184.495,657.748,190.493L665.202,196.492"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_E_3" d="M724.233,199L742.043,177.5C759.853,156,795.474,113,816.409,91.5C837.344,70,843.594,70,849.177,70C854.76,70,859.677,70,862.135,70L864.594,70"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_F_4" d="M789.852,226L796.725,226C803.599,226,817.346,226,829.926,226C842.507,226,853.919,226,864.665,226C875.411,226,885.491,226,890.531,226L895.57,226"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_G_5" d="M732.473,253L748.91,267.5C765.347,282,798.22,311,820.645,325.5C843.069,340,855.044,340,866.353,340C877.661,340,888.303,340,893.624,340L898.945,340"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_H_D_6" d="M509.148,226L519.73,226C530.313,226,551.477,226,565.495,226C579.514,226,586.388,226,592.595,226C598.802,226,604.342,226,607.113,226L609.883,226"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_D_7" d="M507.875,340L518.669,340C529.464,340,551.052,340,570.065,332.75C589.077,325.5,605.514,311,621.451,296.941C637.388,282.882,652.824,269.264,660.543,262.455L668.261,255.646"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(133.8046875, 80)" id="flowchart-A-4376" class="node default"><rect height="54" width="176.609375" y="-27" x="-88.3046875" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-58.3046875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="116.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Producer 生产者</p></span></div></foreignObject></g></g><g transform="translate(416.125, 80)" id="flowchart-B-4377" class="node default"><rect height="54" width="238.03125" y="-27" x="-119.015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-89.015625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="178.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Message Queue 消息队列</p></span></div></foreignObject></g></g><g transform="translate(701.8671875, 70)" id="flowchart-C-4379" class="node default"><rect height="54" width="183.453125" y="-27" x="-91.7265625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-61.7265625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="123.453125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Consumer 消费者</p></span></div></foreignObject></g></g><g transform="translate(701.8671875, 226)" id="flowchart-D-4381" class="node default"><rect height="54" width="175.96875" y="-27" x="-87.984375" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-57.984375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="115.96875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Broker 消息代理</p></span></div></foreignObject></g></g><g transform="translate(983.1171875, 70)" id="flowchart-E-4383" class="node default"><rect height="54" width="229.046875" y="-27" x="-114.5234375" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-84.5234375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="169.046875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Topic/Queue 主题/队列</p></span></div></foreignObject></g></g><g transform="translate(983.1171875, 226)" id="flowchart-F-4385" class="node default"><rect height="54" width="167.09375" y="-27" x="-83.546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-53.546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="107.09375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Storage 存储层</p></span></div></foreignObject></g></g><g transform="translate(983.1171875, 340)" id="flowchart-G-4387" class="node default"><rect height="54" width="160.34375" y="-27" x="-80.171875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-50.171875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="100.34375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Router 路由器</p></span></div></foreignObject></g></g><g transform="translate(416.125, 226)" id="flowchart-H-4388" class="node default"><rect height="54" width="186.046875" y="-27" x="-93.0234375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-63.0234375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="126.046875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Registry 注册中心</p></span></div></foreignObject></g></g><g transform="translate(416.125, 340)" id="flowchart-I-4390" class="node default"><rect height="54" width="183.5" y="-27" x="-91.75" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-61.75, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="123.5"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Monitor 监控系统</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-qcvhq6_15"><span class="control" id="-qcvhq6_22">核心组件详解：</span></p><ol class="list _decimal" id="-qcvhq6_16" type="1"><li class="list__item" id="-qcvhq6_23"><p id="-qcvhq6_27"><span class="control" id="-qcvhq6_29">Producer（生产者）</span></p><ul class="list _bullet" id="-qcvhq6_28"><li class="list__item" id="-qcvhq6_30"><p id="-qcvhq6_33">负责创建和发送消息</p></li><li class="list__item" id="-qcvhq6_31"><p id="-qcvhq6_34">可以是应用程序、服务或系统组件</p></li><li class="list__item" id="-qcvhq6_32"><p id="-qcvhq6_35">支持同步和异步发送模式</p></li></ul></li><li class="list__item" id="-qcvhq6_24"><p id="-qcvhq6_36"><span class="control" id="-qcvhq6_38">Broker（消息代理）</span></p><ul class="list _bullet" id="-qcvhq6_37"><li class="list__item" id="-qcvhq6_39"><p id="-qcvhq6_42">消息队列的核心服务器</p></li><li class="list__item" id="-qcvhq6_40"><p id="-qcvhq6_43">负责消息的接收、存储、转发</p></li><li class="list__item" id="-qcvhq6_41"><p id="-qcvhq6_44">提供消息路由和负载均衡</p></li></ul></li><li class="list__item" id="-qcvhq6_25"><p id="-qcvhq6_45"><span class="control" id="-qcvhq6_47">Consumer（消费者）</span></p><ul class="list _bullet" id="-qcvhq6_46"><li class="list__item" id="-qcvhq6_48"><p id="-qcvhq6_51">负责接收和处理消息</p></li><li class="list__item" id="-qcvhq6_49"><p id="-qcvhq6_52">支持推拉两种消费模式</p></li><li class="list__item" id="-qcvhq6_50"><p id="-qcvhq6_53">可以是单个消费者或消费者组</p></li></ul></li><li class="list__item" id="-qcvhq6_26"><p id="-qcvhq6_54"><span class="control" id="-qcvhq6_56">Topic/Queue（主题/队列）</span></p><ul class="list _bullet" id="-qcvhq6_55"><li class="list__item" id="-qcvhq6_57"><p id="-qcvhq6_60">消息的逻辑分类和存储容器</p></li><li class="list__item" id="-qcvhq6_58"><p id="-qcvhq6_61">Topic支持多订阅者，Queue支持点对点</p></li><li class="list__item" id="-qcvhq6_59"><p id="-qcvhq6_62">支持分区和副本机制</p></li></ul></li></ol><p id="-qcvhq6_17"><span class="control" id="-qcvhq6_63">主要作用：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 924.6875 322"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="924.6875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="消息队列的作用" class="cluster"><rect height="306" width="908.6875" y="8" x="8" style=""></rect><g transform="translate(406.2578125, 8)" class="cluster-label"><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消息队列的作用</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_A1_0" d="M129.086,99.5L129.086,105.75C129.086,112,129.086,124.5,129.086,133.875C129.086,143.25,129.086,149.5,129.086,155.083C129.086,160.667,129.086,165.583,129.086,168.042L129.086,170.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M351.258,99.5L351.258,105.75C351.258,112,351.258,124.5,351.258,133.875C351.258,143.25,351.258,149.5,351.258,155.083C351.258,160.667,351.258,165.583,351.258,168.042L351.258,170.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_2" d="M573.43,99.5L573.43,105.75C573.43,112,573.43,124.5,573.43,133.875C573.43,143.25,573.43,149.5,573.43,155.083C573.43,160.667,573.43,165.583,573.43,168.042L573.43,170.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_D1_3" d="M795.602,99.5L795.602,105.75C795.602,112,795.602,124.5,795.602,133.875C795.602,143.25,795.602,149.5,795.602,155.083C795.602,160.667,795.602,165.583,795.602,168.042L795.602,170.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(129.0859375, 72.5)" id="flowchart-A-4501" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>系统解耦</p></span></div></foreignObject></g></g><g transform="translate(129.0859375, 225.5)" id="flowchart-A1-4502" class="node default"><rect height="102" width="172.171875" y="-51" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>降低系统间依赖<br>提高系统灵活性<br>便于维护和扩展</p></span></div></foreignObject></g></g><g transform="translate(351.2578125, 72.5)" id="flowchart-B-4503" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>异步处理</p></span></div></foreignObject></g></g><g transform="translate(351.2578125, 225.5)" id="flowchart-B1-4504" class="node default"><rect height="102" width="172.171875" y="-51" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>提高响应速度<br>优化用户体验<br>提升系统吞吐量</p></span></div></foreignObject></g></g><g transform="translate(573.4296875, 72.5)" id="flowchart-C-4505" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>流量削峰</p></span></div></foreignObject></g></g><g transform="translate(573.4296875, 225.5)" id="flowchart-C1-4506" class="node default"><rect height="102" width="172.171875" y="-51" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>缓冲突发流量<br>保护下游系统<br>提高系统稳定性</p></span></div></foreignObject></g></g><g transform="translate(795.6015625, 72.5)" id="flowchart-D-4507" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>数据分发</p></span></div></foreignObject></g></g><g transform="translate(795.6015625, 225.5)" id="flowchart-D1-4508" class="node default"><rect height="102" width="172.171875" y="-51" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>一对多消息传递<br>事件驱动架构<br>实时数据同步</p></span></div></foreignObject></g></g></g></g></g></g></g></svg></section><section class="chapter"><h3 id="q2" data-toc="q2">Q2: 点对点模式和发布订阅模式有什么区别？各自适用于什么场景？</h3><p id="-qcvhq6_64"><span class="control" id="-qcvhq6_73">答案：</span></p><p id="-qcvhq6_65"><span class="control" id="-qcvhq6_74">点对点模式（Point-to-Point）：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 623.5234375 571"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="623.5234375" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="点对点模式" class="cluster"><rect height="555" width="607.5234375" y="8" x="8" style=""></rect><g transform="translate(271.69921875, 8)" class="cluster-label"><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>点对点模式</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M111.563,99.5L111.563,105.75C111.563,112,111.563,124.5,116.102,133.875C120.641,143.25,129.719,149.5,138.248,155.372C146.777,161.244,154.757,166.738,158.747,169.485L162.737,172.232"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A2_B_1" d="M358.48,99.5L358.48,105.75C358.48,112,358.48,124.5,350.123,134.268C341.765,144.036,325.049,151.072,308.948,157.85C292.847,164.627,277.361,171.146,269.617,174.405L261.874,177.665"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_2" d="M205.25,228.5L205.25,234.75C205.25,241,205.25,253.5,205.25,269.875C205.25,286.25,205.25,306.5,205.25,326.083C205.25,345.667,205.25,364.583,205.25,374.042L205.25,383.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(111.5625, 72.5)" id="flowchart-A-4630" class="node default"><rect height="54" width="137.125" y="-27" x="-68.5625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-38.5625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="77.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Producer A</p></span></div></foreignObject></g></g><g transform="translate(205.25, 201.5)" id="flowchart-B-4631" class="node default"><rect height="54" width="105.875" y="-27" x="-52.9375" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-22.9375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="45.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Queue</p></span></div></foreignObject></g></g><g transform="translate(358.48046875, 72.5)" id="flowchart-A2-4632" class="node default"><rect height="54" width="137.625" y="-27" x="-68.8125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-38.8125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="77.625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Producer B</p></span></div></foreignObject></g></g><g transform="translate(205.25, 414.5)" id="flowchart-C-4635" class="node default"><rect height="54" width="130.546875" y="-27" x="-65.2734375" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-35.2734375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="70.546875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Consumer</p></span></div></foreignObject></g></g><g transform="translate(450.5234375, 414.5)" id="flowchart-D-4636" class="node default"><rect height="222" width="260" y="-111" x="-130" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-100, -96)" style="" class="label"><rect></rect><foreignObject height="192" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>特点说明：<br>• 一个消息只能被一个消费者消费<br>• 消息消费后从队列中删除<br>• 支持多个生产者，但只有一个消费者组<br>• 适用于任务分发和负载均衡</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-qcvhq6_67"><span class="control" id="-qcvhq6_75">发布订阅模式（Publish-Subscribe）：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 724.65625 644"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="724.65625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="发布订阅模式" class="cluster"><rect height="628" width="708.65625" y="8" x="8" style=""></rect><g transform="translate(314.25, 8)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>发布订阅模式</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M171.75,174L178,174C184.25,174,196.75,174,206.125,174C215.5,174,221.75,174,227.333,174C232.917,174,237.833,174,240.292,174L242.75,174"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M317.833,147L328.47,134.167C339.107,121.333,360.382,95.667,378.808,82.833C397.234,70,412.813,70,427.724,70C442.635,70,456.88,70,464.003,70L471.125,70"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_D_2" d="M344.156,174L350.406,174C356.656,174,369.156,174,383.174,174C397.193,174,412.729,174,427.599,174C442.469,174,456.672,174,463.773,174L470.875,174"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_E_3" d="M317.833,201L328.47,213.833C339.107,226.667,360.382,252.333,378.766,265.167C397.15,278,412.643,278,427.47,278C442.297,278,456.457,278,463.537,278L470.617,278"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(108.625, 174)" id="flowchart-A-4818" class="node default"><rect height="54" width="126.25" y="-27" x="-63.125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-33.125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="66.25"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Publisher</p></span></div></foreignObject></g></g><g transform="translate(295.453125, 174)" id="flowchart-B-4819" class="node default"><rect height="54" width="97.40625" y="-27" x="-48.703125" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-18.703125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="37.40625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Topic</p></span></div></foreignObject></g></g><g transform="translate(549.15625, 70)" id="flowchart-C-4821" class="node default"><rect height="54" width="148.0625" y="-27" x="-74.03125" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-44.03125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="88.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Subscriber A</p></span></div></foreignObject></g></g><g transform="translate(549.15625, 174)" id="flowchart-D-4823" class="node default"><rect height="54" width="148.5625" y="-27" x="-74.28125" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-44.28125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="88.5625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Subscriber B</p></span></div></foreignObject></g></g><g transform="translate(549.15625, 278)" id="flowchart-E-4825" class="node default"><rect height="54" width="149.078125" y="-27" x="-74.5390625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-44.5390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="89.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Subscriber C</p></span></div></foreignObject></g></g><g transform="translate(549.15625, 478)" id="flowchart-F-4826" class="node default"><rect height="246" width="260" y="-123" x="-130" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-100, -108)" style="" class="label"><rect></rect><foreignObject height="216" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>特点说明：<br>• 一个消息可以被多个订阅者消费<br>• 消息持久化，订阅者独立消费<br>• 支持多个发布者和多个订阅者<br>• 适用于事件通知和数据广播</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-qcvhq6_69"><span class="control" id="-qcvhq6_76">详细对比：</span></p><div class="table-wrapper"><table class="wide" id="-qcvhq6_70"><thead><tr class="ijRowHead" id="-qcvhq6_77"><th id="-qcvhq6_84"><p>特性</p></th><th id="-qcvhq6_85"><p>点对点模式</p></th><th id="-qcvhq6_86"><p>发布订阅模式</p></th></tr></thead><tbody><tr id="-qcvhq6_78"><td id="-qcvhq6_87"><p><span class="control" id="-qcvhq6_90">消息消费</span></p></td><td id="-qcvhq6_88"><p>一个消息只能被一个消费者消费</p></td><td id="-qcvhq6_89"><p>一个消息可以被多个订阅者消费</p></td></tr><tr id="-qcvhq6_79"><td id="-qcvhq6_91"><p><span class="control" id="-qcvhq6_94">消息持久化</span></p></td><td id="-qcvhq6_92"><p>消费后删除</p></td><td id="-qcvhq6_93"><p>根据配置决定是否删除</p></td></tr><tr id="-qcvhq6_80"><td id="-qcvhq6_95"><p><span class="control" id="-qcvhq6_98">消费者数量</span></p></td><td id="-qcvhq6_96"><p>通常一个消费者组</p></td><td id="-qcvhq6_97"><p>支持多个独立订阅者</p></td></tr><tr id="-qcvhq6_81"><td id="-qcvhq6_99"><p><span class="control" id="-qcvhq6_102">消息顺序</span></p></td><td id="-qcvhq6_100"><p>容易保证</p></td><td id="-qcvhq6_101"><p>相对复杂</p></td></tr><tr id="-qcvhq6_82"><td id="-qcvhq6_103"><p><span class="control" id="-qcvhq6_106">扩展性</span></p></td><td id="-qcvhq6_104"><p>水平扩展消费者</p></td><td id="-qcvhq6_105"><p>水平扩展订阅者</p></td></tr><tr id="-qcvhq6_83"><td id="-qcvhq6_107"><p><span class="control" id="-qcvhq6_110">适用场景</span></p></td><td id="-qcvhq6_108"><p>任务分发、负载均衡</p></td><td id="-qcvhq6_109"><p>事件通知、数据广播</p></td></tr></tbody></table></div><p id="-qcvhq6_71"><span class="control" id="-qcvhq6_111">应用场景示例：</span></p><div class="code-block" data-lang="java">
// 点对点模式 - 订单处理
// 生产者发送订单处理任务
public class OrderProducer {
    public void sendOrderTask(Order order) {
        // 发送到订单处理队列
        messageQueue.send(&quot;order.processing.queue&quot;, order);
    }
}

// 消费者处理订单任务（多个消费者实例负载均衡）
public class OrderProcessor {
    @MessageListener(&quot;order.processing.queue&quot;)
    public void processOrder(Order order) {
        // 处理订单逻辑
        orderService.processOrder(order);
    }
}

// 发布订阅模式 - 用户注册事件
// 发布者发布用户注册事件
public class UserRegistrationPublisher {
    public void publishUserRegistered(UserRegisteredEvent event) {
        // 发布到用户注册主题
        messageQueue.publish(&quot;user.registered.topic&quot;, event);
    }
}

// 多个订阅者处理不同的业务逻辑
public class EmailService {
    @Subscribe(&quot;user.registered.topic&quot;)
    public void sendWelcomeEmail(UserRegisteredEvent event) {
        // 发送欢迎邮件
        emailService.sendWelcomeEmail(event.getUser());
    }
}

public class CouponService {
    @Subscribe(&quot;user.registered.topic&quot;)
    public void issueCoupon(UserRegisteredEvent event) {
        // 发放新用户优惠券
        couponService.issueNewUserCoupon(event.getUser());
    }
}

public class AnalyticsService {
    @Subscribe(&quot;user.registered.topic&quot;)
    public void recordUserRegistration(UserRegisteredEvent event) {
        // 记录用户注册数据
        analyticsService.recordEvent(event);
    }
}
</div></section></section><section class="chapter"><h2 id="-qcvhq6_6" data-toc="-qcvhq6_6">🛡️ 可靠性保证</h2><section class="chapter"><h3 id="q3" data-toc="q3">Q3: 如何保证消息的可靠性投递？有哪些可靠性保证机制？</h3><p id="-qcvhq6_114"><span class="control" id="-qcvhq6_123">答案：</span></p><p id="-qcvhq6_115"><span class="control" id="-qcvhq6_124">可靠性保证层次：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 859.5625 346"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="859.5625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="消息可靠性保证机制" class="cluster"><rect height="330" width="843.5625" y="8" x="8" style=""></rect><g transform="translate(357.671875, 8)" class="cluster-label"><foreignObject height="24" width="144.21875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消息可靠性保证机制</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_A1_0" d="M121.078,99.5L121.078,105.75C121.078,112,121.078,124.5,121.078,133.875C121.078,143.25,121.078,149.5,121.078,155.083C121.078,160.667,121.078,165.583,121.078,168.042L121.078,170.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M326.703,99.5L326.703,105.75C326.703,112,326.703,124.5,326.703,133.875C326.703,143.25,326.703,149.5,326.703,155.083C326.703,160.667,326.703,165.583,326.703,168.042L326.703,170.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_2" d="M532.328,99.5L532.328,105.75C532.328,112,532.328,124.5,532.328,133.875C532.328,143.25,532.328,149.5,532.328,155.083C532.328,160.667,532.328,165.583,532.328,168.042L532.328,170.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_D1_3" d="M738.484,99.5L738.484,105.75C738.484,112,738.484,124.5,738.484,133.875C738.484,143.25,738.484,149.5,738.484,155.083C738.484,160.667,738.484,165.583,738.484,168.042L738.484,170.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(121.078125, 72.5)" id="flowchart-A-4986" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>生产者可靠性</p></span></div></foreignObject></g></g><g transform="translate(121.078125, 237.5)" id="flowchart-A1-4987" class="node default"><rect height="126" width="156.15625" y="-63" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消息确认机制<br>重试机制<br>事务消息<br>幂等性保证</p></span></div></foreignObject></g></g><g transform="translate(326.703125, 72.5)" id="flowchart-B-4988" class="node default"><rect height="54" width="155.09375" y="-27" x="-77.546875" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-47.546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="95.09375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Broker可靠性</p></span></div></foreignObject></g></g><g transform="translate(326.703125, 237.5)" id="flowchart-B1-4989" class="node default"><rect height="126" width="140.125" y="-63" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消息持久化<br>副本机制<br>集群部署<br>故障转移</p></span></div></foreignObject></g></g><g transform="translate(532.328125, 72.5)" id="flowchart-C-4990" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消费者可靠性</p></span></div></foreignObject></g></g><g transform="translate(532.328125, 237.5)" id="flowchart-C1-4991" class="node default"><rect height="126" width="156.15625" y="-63" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消息确认<br>重复消费处理<br>死信队列<br>补偿机制</p></span></div></foreignObject></g></g><g transform="translate(738.484375, 72.5)" id="flowchart-D-4992" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>端到端可靠性</p></span></div></foreignObject></g></g><g transform="translate(738.484375, 237.5)" id="flowchart-D1-4993" class="node default"><rect height="126" width="140.125" y="-63" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>分布式事务<br>最终一致性<br>监控告警<br>数据校验</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-qcvhq6_117"><span class="control" id="-qcvhq6_125">生产者端可靠性保证：</span></p><div class="code-block" data-lang="java">
// 1. 同步发送确认
public class ReliableProducer {
    
    // 同步发送 - 等待确认
    public void sendMessageSync(String topic, Object message) {
        try {
            SendResult result = producer.send(topic, message);
            if (result.getStatus() == SendStatus.SEND_OK) {
                log.info(&quot;消息发送成功: {}&quot;, result.getMsgId());
            } else {
                log.error(&quot;消息发送失败: {}&quot;, result.getStatus());
                // 执行重试或补偿逻辑
                handleSendFailure(message);
            }
        } catch (Exception e) {
            log.error(&quot;消息发送异常&quot;, e);
            handleSendException(message, e);
        }
    }
    
    // 异步发送 - 回调确认
    public void sendMessageAsync(String topic, Object message) {
        producer.sendAsync(topic, message, new SendCallback() {
            @Override
            public void onSuccess(SendResult result) {
                log.info(&quot;消息发送成功: {}&quot;, result.getMsgId());
            }
            
            @Override
            public void onException(Throwable e) {
                log.error(&quot;消息发送失败&quot;, e);
                // 执行重试或补偿逻辑
                retryOrCompensate(message);
            }
        });
    }
    
    // 重试机制
    private void handleSendFailure(Object message) {
        RetryTemplate retryTemplate = new RetryTemplate();
        retryTemplate.setRetryPolicy(new SimpleRetryPolicy(3)); // 重试3次
        retryTemplate.setBackOffPolicy(new ExponentialBackOffPolicy()); // 指数退避
        
        retryTemplate.execute(context -&gt; {
            return producer.send(topic, message);
        });
    }
}

// 2. 事务消息
public class TransactionalProducer {
    
    @Transactional
    public void sendTransactionalMessage(Order order) {
        // 本地事务操作
        orderService.createOrder(order);
        
        // 发送事务消息
        TransactionSendResult result = producer.sendMessageInTransaction(
            &quot;order.created.topic&quot;, 
            order,
            new TransactionExecuter() {
                @Override
                public LocalTransactionState executeLocalTransaction() {
                    try {
                        // 执行本地事务
                        orderService.processOrder(order);
                        return LocalTransactionState.COMMIT_MESSAGE;
                    } catch (Exception e) {
                        return LocalTransactionState.ROLLBACK_MESSAGE;
                    }
                }
                
                @Override
                public LocalTransactionState checkLocalTransaction() {
                    // 事务状态回查
                    return orderService.checkOrderStatus(order.getId()) 
                        ? LocalTransactionState.COMMIT_MESSAGE 
                        : LocalTransactionState.ROLLBACK_MESSAGE;
                }
            }
        );
    }
}
</div><p id="-qcvhq6_119"><span class="control" id="-qcvhq6_126">Broker端可靠性保证：</span></p><div class="code-block" data-lang="yaml">
# Broker可靠性配置示例
# 消息持久化配置
message:
  persistence:
    enabled: true
    flush_interval: 1000ms
    force_sync: true
    
# 副本配置
replication:
  factor: 3              # 副本数量
  min_in_sync_replicas: 2 # 最小同步副本数
  
# 集群配置
cluster:
  nodes: 
    - broker-1:9092
    - broker-2:9092  
    - broker-3:9092
  election:
    timeout: 30s
    
# 故障转移配置
failover:
  auto_failover: true
  detection_interval: 5s
  max_failover_time: 30s
</div><p id="-qcvhq6_121"><span class="control" id="-qcvhq6_127">消费者端可靠性保证：</span></p><div class="code-block" data-lang="java">
// 消费者可靠性实现
public class ReliableConsumer {
    
    // 手动确认消费
    @MessageListener(topic = &quot;order.topic&quot;, 
                    acknowledgmentMode = AcknowledgmentMode.MANUAL)
    public void consumeOrder(Order order, Acknowledgment ack) {
        try {
            // 幂等性检查
            if (orderService.isOrderProcessed(order.getId())) {
                log.info(&quot;订单已处理，跳过: {}&quot;, order.getId());
                ack.acknowledge();
                return;
            }
            
            // 业务处理
            orderService.processOrder(order);
            
            // 手动确认
            ack.acknowledge();
            log.info(&quot;订单处理成功: {}&quot;, order.getId());
            
        } catch (BusinessException e) {
            log.error(&quot;业务处理失败: {}&quot;, order.getId(), e);
            // 业务异常不重试，直接确认
            ack.acknowledge();
            
        } catch (Exception e) {
            log.error(&quot;系统异常: {}&quot;, order.getId(), e);
            // 系统异常不确认，触发重试
            throw e;
        }
    }
    
    // 死信队列处理
    @RetryableTopic(
        attempts = &quot;3&quot;,
        backoff = @Backoff(delay = 1000, multiplier = 2),
        dltStrategy = DltStrategy.FAIL_ON_ERROR
    )
    public void consumeWithRetry(Order order) {
        // 带重试的消费逻辑
        orderService.processOrder(order);
    }
    
    @DltHandler
    public void handleDlt(Order order, Exception exception) {
        // 死信处理逻辑
        log.error(&quot;消息进入死信队列: {}&quot;, order.getId(), exception);
        deadLetterService.handleDeadLetter(order, exception);
    }
}
</div></section><section class="chapter"><h3 id="q4-at-least-once-at-most-once-exactly-once" data-toc="q4-at-least-once-at-most-once-exactly-once">Q4: At Least Once、At Most Once、Exactly Once有什么区别？如何实现？</h3><p id="-qcvhq6_128"><span class="control" id="-qcvhq6_139">答案：</span></p><p id="-qcvhq6_129"><span class="control" id="-qcvhq6_140">消息投递语义对比：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 482.125 564"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="482.125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="消息投递语义" class="cluster"><rect height="548" width="466.125" y="8" x="8" style=""></rect><g transform="translate(192.984375, 8)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消息投递语义</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_A1_0" d="M202.805,106L209.499,106C216.193,106,229.581,106,239.4,106C249.219,106,255.469,106,261.052,106C266.635,106,271.552,106,274.01,106L276.469,106"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M205.469,282L211.719,282C217.969,282,230.469,282,239.844,282C249.219,282,255.469,282,261.052,282C266.635,282,271.552,282,274.01,282L276.469,282"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_2" d="M202.063,458L208.88,458C215.698,458,229.333,458,239.276,458C249.219,458,255.469,458,261.052,458C266.635,458,271.552,458,274.01,458L276.469,458"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(125.484375, 106)" id="flowchart-A-5134" class="node default"><rect height="54" width="154.640625" y="-27" x="-77.3203125" data-et="node" data-id="abc" style="fill:#ffcdd2 !important" class="basic label-container"></rect><g transform="translate(-47.3203125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="94.640625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>At Most Once</p></span></div></foreignObject></g></g><g transform="translate(358.546875, 106)" id="flowchart-A1-5135" class="node default"><rect height="126" width="156.15625" y="-63" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>最多一次投递<br>消息可能丢失<br>消息不会重复<br>性能最高</p></span></div></foreignObject></g></g><g transform="translate(125.484375, 282)" id="flowchart-B-5136" class="node default"><rect height="54" width="159.96875" y="-27" x="-79.984375" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-49.984375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="99.96875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>At Least Once</p></span></div></foreignObject></g></g><g transform="translate(358.546875, 282)" id="flowchart-B1-5137" class="node default"><rect height="126" width="156.15625" y="-63" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>至少一次投递<br>消息不会丢失<br>消息可能重复<br>性能中等</p></span></div></foreignObject></g></g><g transform="translate(125.484375, 458)" id="flowchart-C-5138" class="node default"><rect height="54" width="153.15625" y="-27" x="-76.578125" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-46.578125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="93.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Exactly Once</p></span></div></foreignObject></g></g><g transform="translate(358.546875, 458)" id="flowchart-C1-5139" class="node default"><rect height="126" width="156.15625" y="-63" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>精确一次投递<br>消息不会丢失<br>消息不会重复<br>性能最低</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-qcvhq6_131"><span class="control" id="-qcvhq6_141">详细特性对比：</span></p><div class="table-wrapper"><table class="wide" id="-qcvhq6_132"><thead><tr class="ijRowHead" id="-qcvhq6_142"><th id="-qcvhq6_146"><p>投递语义</p></th><th id="-qcvhq6_147"><p>消息丢失</p></th><th id="-qcvhq6_148"><p>消息重复</p></th><th id="-qcvhq6_149"><p>实现复杂度</p></th><th id="-qcvhq6_150"><p>性能开销</p></th><th id="-qcvhq6_151"><p>适用场景</p></th></tr></thead><tbody><tr id="-qcvhq6_143"><td id="-qcvhq6_152"><p><span class="control" id="-qcvhq6_158">At Most Once</span></p></td><td id="-qcvhq6_153"><p>可能丢失</p></td><td id="-qcvhq6_154"><p>不会重复</p></td><td id="-qcvhq6_155"><p>低</p></td><td id="-qcvhq6_156"><p>低</p></td><td id="-qcvhq6_157"><p>日志收集、监控数据</p></td></tr><tr id="-qcvhq6_144"><td id="-qcvhq6_159"><p><span class="control" id="-qcvhq6_165">At Least Once</span></p></td><td id="-qcvhq6_160"><p>不会丢失</p></td><td id="-qcvhq6_161"><p>可能重复</p></td><td id="-qcvhq6_162"><p>中</p></td><td id="-qcvhq6_163"><p>中</p></td><td id="-qcvhq6_164"><p>订单处理、支付通知</p></td></tr><tr id="-qcvhq6_145"><td id="-qcvhq6_166"><p><span class="control" id="-qcvhq6_172">Exactly Once</span></p></td><td id="-qcvhq6_167"><p>不会丢失</p></td><td id="-qcvhq6_168"><p>不会重复</p></td><td id="-qcvhq6_169"><p>高</p></td><td id="-qcvhq6_170"><p>高</p></td><td id="-qcvhq6_171"><p>金融交易、账户变更</p></td></tr></tbody></table></div><p id="-qcvhq6_133"><span class="control" id="-qcvhq6_173">At Most Once实现：</span></p><div class="code-block" data-lang="java">
// At Most Once - 火后不理模式
public class AtMostOnceProducer {
    
    public void sendMessage(String topic, Object message) {
        try {
            // 异步发送，不等待确认
            producer.sendAsync(topic, message);
            log.info(&quot;消息已发送: {}&quot;, message);
        } catch (Exception e) {
            log.warn(&quot;消息发送失败，不重试: {}&quot;, message, e);
            // 不重试，接受消息丢失
        }
    }
}

public class AtMostOnceConsumer {
    
    @MessageListener(topic = &quot;logs.topic&quot;)
    public void consumeLog(LogMessage log) {
        try {
            // 处理日志
            logService.saveLog(log);
        } catch (Exception e) {
            log.warn(&quot;日志处理失败，跳过: {}&quot;, log.getId(), e);
            // 不重试，接受消息丢失
        }
    }
}
</div><p id="-qcvhq6_135"><span class="control" id="-qcvhq6_174">At Least Once实现：</span></p><div class="code-block" data-lang="java">
// At Least Once - 重试确保投递
public class AtLeastOnceProducer {
    
    public void sendMessage(String topic, Object message) {
        int maxRetries = 3;
        int attempt = 0;
        
        while (attempt &lt; maxRetries) {
            try {
                SendResult result = producer.send(topic, message);
                if (result.getStatus() == SendStatus.SEND_OK) {
                    log.info(&quot;消息发送成功: {}&quot;, result.getMsgId());
                    return;
                }
            } catch (Exception e) {
                attempt++;
                log.warn(&quot;消息发送失败，重试第{}次&quot;, attempt, e);
                
                if (attempt &gt;= maxRetries) {
                    log.error(&quot;消息发送最终失败: {}&quot;, message);
                    throw new MessageSendException(&quot;消息发送失败&quot;, e);
                }
                
                // 指数退避
                sleep(1000 * Math.pow(2, attempt - 1));
            }
        }
    }
}

public class AtLeastOnceConsumer {
    
    @MessageListener(topic = &quot;order.topic&quot;)
    public void consumeOrder(Order order) {
        try {
            // 幂等性检查
            if (!orderService.isOrderProcessed(order.getId())) {
                orderService.processOrder(order);
                log.info(&quot;订单处理成功: {}&quot;, order.getId());
            } else {
                log.info(&quot;订单已处理，幂等跳过: {}&quot;, order.getId());
            }
        } catch (Exception e) {
            log.error(&quot;订单处理失败: {}&quot;, order.getId(), e);
            throw e; // 触发重试
        }
    }
}
</div><p id="-qcvhq6_137"><span class="control" id="-qcvhq6_175">Exactly Once实现：</span></p><div class="code-block" data-lang="java">
// Exactly Once - 基于事务和幂等性
public class ExactlyOnceService {
    
    @Transactional
    public void transferMoney(TransferRequest request) {
        // 1. 检查幂等性
        if (transferService.isTransferProcessed(request.getTransferId())) {
            log.info(&quot;转账已处理: {}&quot;, request.getTransferId());
            return;
        }
        
        // 2. 本地事务 + 消息发送
        try {
            // 执行转账业务
            transferService.executeTransfer(request);
            
            // 发送事务消息
            TransactionSendResult result = producer.sendInTransaction(
                &quot;transfer.completed.topic&quot;, 
                new TransferCompletedEvent(request),
                new LocalTransactionExecuter() {
                    @Override
                    public LocalTransactionState execute() {
                        // 标记转账已处理（幂等性保证）
                        transferService.markTransferProcessed(request.getTransferId());
                        return LocalTransactionState.COMMIT_MESSAGE;
                    }
                    
                    @Override
                    public LocalTransactionState check() {
                        // 回查本地事务状态
                        return transferService.isTransferProcessed(request.getTransferId())
                            ? LocalTransactionState.COMMIT_MESSAGE
                            : LocalTransactionState.ROLLBACK_MESSAGE;
                    }
                }
            );
            
            log.info(&quot;转账完成: {}&quot;, request.getTransferId());
            
        } catch (Exception e) {
            log.error(&quot;转账失败: {}&quot;, request.getTransferId(), e);
            throw e;
        }
    }
}

// 基于数据库的幂等性实现
@Entity
public class MessageIdempotent {
    @Id
    private String messageId;
    private String businessId;
    private String status;
    private Date processTime;
    
    // getters and setters
}

@Service
public class IdempotentService {
    
    public boolean tryLock(String messageId, String businessId) {
        try {
            MessageIdempotent record = new MessageIdempotent();
            record.setMessageId(messageId);
            record.setBusinessId(businessId);
            record.setStatus(&quot;PROCESSING&quot;);
            record.setProcessTime(new Date());
            
            messageIdempotentRepository.save(record);
            return true;
        } catch (DataIntegrityViolationException e) {
            // 重复消息，已在处理
            return false;
        }
    }
    
    public void markCompleted(String messageId) {
        MessageIdempotent record = messageIdempotentRepository.findById(messageId);
        if (record != null) {
            record.setStatus(&quot;COMPLETED&quot;);
            messageIdempotentRepository.save(record);
        }
    }
}
</div></section></section><section class="chapter"><h2 id="-qcvhq6_7" data-toc="-qcvhq6_7">💡 面试技巧</h2><section class="chapter"><h3 id="-qcvhq6_176" data-toc="-qcvhq6_176">高频考点</h3><ol class="list _decimal" id="-qcvhq6_178" type="1"><li class="list__item" id="-qcvhq6_179"><p id="-qcvhq6_184"><span class="control" id="-qcvhq6_185">消息模型理解</span> ：点对点vs发布订阅的区别和适用场景</p></li><li class="list__item" id="-qcvhq6_180"><p id="-qcvhq6_186"><span class="control" id="-qcvhq6_187">可靠性保证</span> ：如何确保消息不丢失、不重复</p></li><li class="list__item" id="-qcvhq6_181"><p id="-qcvhq6_188"><span class="control" id="-qcvhq6_189">投递语义</span> ：三种投递语义的实现原理和权衡</p></li><li class="list__item" id="-qcvhq6_182"><p id="-qcvhq6_190"><span class="control" id="-qcvhq6_191">幂等性设计</span> ：如何保证消息消费的幂等性</p></li><li class="list__item" id="-qcvhq6_183"><p id="-qcvhq6_192"><span class="control" id="-qcvhq6_193">架构模式</span> ：集中式vs分布式架构的选择</p></li></ol></section><section class="chapter"><h3 id="-qcvhq6_177" data-toc="-qcvhq6_177">回答策略</h3><ol class="list _decimal" id="-qcvhq6_194" type="1"><li class="list__item" id="-qcvhq6_197"><p id="-qcvhq6_201"><span class="control" id="-qcvhq6_202">理论结合实践</span> ：不仅要说明原理，还要给出具体实现方案</p></li><li class="list__item" id="-qcvhq6_198"><p id="-qcvhq6_203"><span class="control" id="-qcvhq6_204">场景化说明</span> ：结合具体业务场景说明技术选择的原因</p></li><li class="list__item" id="-qcvhq6_199"><p id="-qcvhq6_205"><span class="control" id="-qcvhq6_206">权衡分析</span> ：说明不同方案的优缺点和适用条件</p></li><li class="list__item" id="-qcvhq6_200"><p id="-qcvhq6_207"><span class="control" id="-qcvhq6_208">系统性思考</span> ：从生产者、Broker、消费者全链路考虑问题</p></li></ol><p id="-qcvhq6_196"><span class="control" id="-qcvhq6_209">学习建议</span> ：消息队列基础概念是深入学习各种消息队列技术的基础，重点要理解可靠性保证机制和投递语义的实现原理。建议通过实际编程练习来加深对幂等性和事务消息的理解。</p></section></section><div class="last-modified">09 六月 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="消息队列面试大纲.html" class="navigation-links__prev">消息队列面试大纲</a><a href="kafka深入解析qa.html" class="navigation-links__next">Kafka深入解析QA</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>