<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-06-10T01:18:26.3295106"><title>Java锁机制详解QA | 技术知识库</title><script type="application/json" id="virtual-toc-data">[{"id":"-daevqg_4","level":0,"title":"📋 知识结构","anchor":"#-daevqg_4"},{"id":"synchronized","level":0,"title":"🔒 synchronized关键字","anchor":"#synchronized"},{"id":"-daevqg_6","level":0,"title":"🔐 显式锁机制","anchor":"#-daevqg_6"},{"id":"-daevqg_7","level":0,"title":"💡 面试技巧","anchor":"#-daevqg_7"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Java锁机制详解QA | 技术知识库"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="技术知识库 Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/java锁机制详解qa.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Java锁机制详解QA | 技术知识库"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/java锁机制详解qa.html#webpage",
    "url": "writerside-documentation/java锁机制详解qa.html",
    "name": "Java锁机制详解QA | 技术知识库",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "技术知识库 Help"
}</script><!-- End Schema.org --></head><body data-id="Java锁机制详解QA" data-main-title="Java锁机制详解QA" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Java并发面试大纲.md|Java并发面试大纲"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>技术知识库  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Java锁机制详解QA" id="Java锁机制详解QA.md">Java锁机制详解QA</h1><p id="-daevqg_3">锁是Java并发编程中保证线程安全的核心机制。本文档深入解析synchronized关键字、显式锁、读写锁以及各种锁优化技术。</p><section class="chapter"><h2 id="-daevqg_4" data-toc="-daevqg_4">📋 知识结构</h2><svg aria-roledescription="mindmap" role="graphics-document document" viewBox="5 5 799.4783935546875 423.72064208984375" style="max-width: 799.4783935546875px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g></g><g class="mindmap-edges"><path class="edge section-edge-0 edge-depth-1" d="M 488.8674588854067,132.5585790962213 L 550.047138551712,138.73355697393717 L611.2268182180173,144.90853485165303"></path><path class="edge section-edge-0 edge-depth-1" d="M 487.4710920601209,124.57163602616151 L 534.6483013999723,101.97096734023862 L581.8255107398237,79.37029865431572"></path><path class="edge section-edge-0 edge-depth-1" d="M 475.9751449253725,116.19050701352876 L 480.5844897922145,82.47612731906653 L485.19383465905656,48.7617476246043"></path><path class="edge section-edge-0 edge-depth-1" d="M 460.7094669385611,123.99066291502243 L 411.24404534083976,97.595813884286 L361.77862374311843,71.20096485354958"></path><path class="edge section-edge-0 edge-depth-0" d="M 418.4412511474301,218.71570570719393 L 442.1803136731522,181.22071629140368 L465.9193761988744,143.72572687561336"></path><path class="edge section-edge-1 edge-depth-1" d="M 580.1234906059573,284.3183189634683 L 639.7613421496914,265.2591052831135 L699.3991936934254,246.19989160275867"></path><path class="edge section-edge-1 edge-depth-1" d="M 580.2034584192464,293.1925400422956 L 643.0307676598718,312.03014432822874 L705.8580769004972,330.8677486141619"></path><path class="edge section-edge-1 edge-depth-1" d="M 564.9597195292986,303.8589611331486 L 563.0528419693396,336.4672610811125 L561.1459644093807,369.07556102907637"></path><path class="edge section-edge-1 edge-depth-1" d="M 561.6589610175276,274.47769168231423 L 553.617381424255,246.7378145453045 L545.5758018309823,218.99793740829472"></path><path class="edge section-edge-1 edge-depth-0" d="M 424.4855450581948,236.59356952760686 L 488.12637043906216,260.13686065499917 L551.7671958199295,283.68015178239153"></path><path class="edge section-edge-2 edge-depth-1" d="M 290.1020446090916,314.6803732375422 L 209.51166415543287,330.69764859859276 L128.92128370177414,346.71492395964333"></path><path class="edge section-edge-2 edge-depth-1" d="M 319.7063940606804,313.55216284880254 L 374.330168924444,320.1392285671842 L428.95394378820754,326.72629428556587"></path><path class="edge section-edge-2 edge-depth-1" d="M 314.7758822859193,322.9708954340576 L 340.68888729087286,352.1432349438322 L366.6018922958264,381.31557445360687"></path><path class="edge section-edge-2 edge-depth-1" d="M 297.04631508092615,324.58826701319464 L 278.15888869206367,355.78848845525863 L259.2714623032012,386.9887098973226"></path><path class="edge section-edge-2 edge-depth-0" d="M 398.4808383809805,240.47322201753104 L 357.6158129663251,271.5727526389412 L316.7507875516697,302.67228326035143"></path><path class="edge section-edge-3 edge-depth-1" d="M 272.4918082911796,202.27831527815397 L 301.9853333590332,178.0861659482025 L331.47885842688675,153.8940166182511"></path><path class="edge section-edge-3 edge-depth-1" d="M 246.24741810213067,208.55538392795694 L 193.309206283195,196.8598939098438 L140.37099446425935,185.16440389173067"></path><path class="edge section-edge-3 edge-depth-1" d="M 247.11772132477532,217.72488040740052 L 197.70282110659878,239.00814885486062 L148.28792088842224,260.2914173023207"></path><path class="edge section-edge-3 edge-depth-1" d="M 254.65663771483153,198.14969219813048 L 240.5794694163863,167.36302217225287 L226.50230111794107,136.57635214637526"></path><path class="edge section-edge-3 edge-depth-0" d="M 395.5445504114887,229.43980890084813 L 335.6557863370708,221.59022034414804 L275.76702226265286,213.74063178744794"></path></g><g class="mindmap-nodes"><g transform="translate(360.19078053194073, 212.48917794467422)" class="mindmap-node section--1 section-root"><g transform="translate(50.2265625, 18.9)"><circle r="50.2265625" class="node-bkg node-circle" id="node-0"></circle></g><g transform="translate(50.2265625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Java锁机制</tspan></tspan></text></g></g></g><g transform="translate(417.20971421548677, 112.15225463813306)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h103.4671401977539 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-1"></path><line y2="37.8" x2="113.4671401977539" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(56.73357009887695, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">synchronized</tspan></tspan></text></g></g></g><g transform="translate(531.3113976783369, 269.98454336532416)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h59.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-6"></path><line y2="37.8" x2="69.04800033569336" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(34.52400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">显式锁</tspan></tspan></text></g></g></g><g transform="translate(269.7902827328628, 292.85632733320824)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h60.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-11"></path><line y2="37.8" x2="70.04800033569336" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(35.02400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">读写锁</tspan></tspan></text></g></g></g><g transform="translate(225.87022947435412, 192.89126274362184)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h60.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-16"></path><line y2="37.8" x2="70.04800033569336" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(35.02400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">锁优化</tspan></tspan></text></g></g></g><g transform="translate(591.1269926212136, 127.51485930974127)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h60.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-2"></path><line y2="37.8" x2="70.04800033569336" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(35.02400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">对象锁</tspan></tspan></text></g></g></g><g transform="translate(568.3413174479832, 53.98968004234417)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h44.02400207519531 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-3"></path><line y2="37.8" x2="54.02400207519531" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(27.012001037597656, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">类锁</tspan></tspan></text></g></g></g><g transform="translate(428.1656938967743, 15)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h108.12000274658203 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-4"></path><line y2="37.8" x2="118.12000274658203" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(59.060001373291016, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">锁的实现原理</tspan></tspan></text></g></g></g><g transform="translate(297.49680603162244, 45.23937313043894)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h92.09600067138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-5"></path><line y2="37.8" x2="102.09600067138672" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(51.04800033569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">锁升级过程</tspan></tspan></text></g></g></g><g transform="translate(651.2815590667245, 222.7336672009028)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h114.81145477294922 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-7"></path><line y2="37.8" x2="124.81145477294922" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(62.40572738647461, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ReentrantLock</tspan></tspan></text></g></g></g><g transform="translate(645.9738868021733, 316.2757452911334)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h138.50450134277344 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-8"></path><line y2="37.8" x2="148.50450134277344" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(74.25225067138672, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">公平锁vs非公平锁</tspan></tspan></text></g></g></g><g transform="translate(499.83278609249567, 365.1499787969009)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h110.875 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-9"></path><line y2="37.8" x2="120.875" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(60.4375, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Condition接口</tspan></tspan></text></g></g></g><g transform="translate(498.36336570423066, 185.69108572528478)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-10"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">锁的中断</tspan></tspan></text></g></g></g><g transform="translate(15, 330.73896986397733)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h188.4180908203125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-12"></path><line y2="37.8" x2="198.4180908203125" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(99.20904541015625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ReentrantReadWriteLock</tspan></tspan></text></g></g></g><g transform="translate(385.26792994817845, 309.6221298011602)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h107.15625 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-13"></path><line y2="37.8" x2="117.15625" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(58.578125, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">读共享写排斥</tspan></tspan></text></g></g></g><g transform="translate(341.53949151318955, 373.63014255445626)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h60.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-14"></path><line y2="37.8" x2="70.04800033569336" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(35.02400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">锁降级</tspan></tspan></text></g></g></g><g transform="translate(193.43817542213856, 380.92064957730906)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h106.1306381225586 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-15"></path><line y2="37.8" x2="116.1306381225586" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(58.0653190612793, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">StampedLock</tspan></tspan></text></g></g></g><g transform="translate(308.0524369080189, 125.48106915278322)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h60.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-17"></path><line y2="37.8" x2="70.04800033569336" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(35.02400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">偏向锁</tspan></tspan></text></g></g></g><g transform="translate(83.18818362609352, 163.02852507606576)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-18"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">轻量级锁</tspan></tspan></text></g></g></g><g transform="translate(91.97541327290105, 247.32503496609942)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-19"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">重量级锁</tspan></tspan></text></g></g></g><g transform="translate(185.24070902272513, 104.03478160088389)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h60.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-20"></path><line y2="37.8" x2="70.04800033569336" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(35.02400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">锁消除</tspan></tspan></text></g></g></g></g></svg></section><section class="chapter"><h2 id="synchronized" data-toc="synchronized">🔒 synchronized关键字</h2><section class="chapter"><h3 id="q1-synchronized" data-toc="q1-synchronized">Q1: synchronized的作用原理是什么？有哪些使用方式？</h3><p id="-daevqg_11"><span class="control" id="-daevqg_18">答案：</span></p><p id="-daevqg_12"><span class="control" id="-daevqg_19">synchronized实现原理：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1940.46875 420"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1940.46875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="Monitor结构" class="cluster"><rect height="404" width="420.71875" y="8" x="8" style=""></rect><g transform="translate(175.0546875, 8)" class="cluster-label"><foreignObject height="24" width="86.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Monitor结构</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_E1_6" d="M142.178,183L156.75,166.167C171.321,149.333,200.465,115.667,218.162,98.833C235.859,82,242.109,82,247.693,82C253.276,82,258.193,82,260.651,82L263.109,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_E2_7" d="M192.109,210L198.359,210C204.609,210,217.109,210,226.484,210C235.859,210,242.109,210,247.693,210C253.276,210,258.193,210,260.651,210L263.109,210"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_E3_8" d="M142.178,237L156.75,253.833C171.321,270.667,200.465,304.333,218.162,321.167C235.859,338,242.109,338,247.693,338C253.276,338,258.193,338,260.651,338L263.109,338"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(118.8046875, 210)" id="flowchart-E-9814" class="node default"><rect height="54" width="146.609375" y="-27" x="-73.3046875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-43.3046875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="86.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Monitor对象</p></span></div></foreignObject></g></g><g transform="translate(329.1640625, 82)" id="flowchart-E1-9815" class="node default"><rect height="78" width="124.109375" y="-39" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Owner<br>锁持有者</p></span></div></foreignObject></g></g><g transform="translate(329.1640625, 210)" id="flowchart-E2-9817" class="node default"><rect height="78" width="124.109375" y="-39" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>EntryList<br>等待队列</p></span></div></foreignObject></g></g><g transform="translate(329.1640625, 338)" id="flowchart-E3-9819" class="node default"><rect height="78" width="124.109375" y="-39" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>WaitSet<br>等待集合</p></span></div></foreignObject></g></g></g></g><g transform="translate(470.71875, 128)" class="root"><g class="clusters"><g data-look="classic" id="synchronized实现机制" class="cluster"><rect height="148" width="1453.75" y="8" x="8" style=""></rect><g transform="translate(656.1171875, 8)" class="cluster-label"><foreignObject height="24" width="157.515625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>synchronized实现机制</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M169.922,82L176.172,82C182.422,82,194.922,82,204.297,82C213.672,82,219.922,82,225.505,82C231.089,82,236.005,82,238.464,82L240.922,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M385.047,82L391.297,82C397.547,82,410.047,82,419.422,82C428.797,82,435.047,82,440.63,82C446.214,82,451.13,82,453.589,82L456.047,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B1_C_2" d="M615.422,82L621.672,82C627.922,82,640.422,82,649.797,82C659.172,82,665.422,82,671.005,82C676.589,82,681.505,82,683.964,82L686.422,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_3" d="M810.922,82L817.172,82C823.422,82,835.922,82,845.297,82C854.672,82,860.922,82,866.505,82C872.089,82,877.005,82,879.464,82L881.922,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C1_D_4" d="M1026.047,82L1032.297,82C1038.547,82,1051.047,82,1060.422,82C1069.797,82,1076.047,82,1081.63,82C1087.214,82,1092.13,82,1094.589,82L1097.047,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_D1_5" d="M1241.172,82L1247.422,82C1253.672,82,1266.172,82,1275.547,82C1284.922,82,1291.172,82,1296.755,82C1302.339,82,1307.255,82,1309.714,82L1312.172,82"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(107.7109375, 82)" id="flowchart-A-9802" class="node default"><rect height="54" width="124.421875" y="-27" x="-62.2109375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.2109375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.421875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Java源码</p></span></div></foreignObject></g></g><g transform="translate(314.984375, 82)" id="flowchart-B-9803" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>字节码指令</p></span></div></foreignObject></g></g><g transform="translate(537.734375, 82)" id="flowchart-B1-9805" class="node default"><rect height="78" width="155.375" y="-39" x="-77.6875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-47.6875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="95.375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>monitorenter<br>monitorexit</p></span></div></foreignObject></g></g><g transform="translate(750.671875, 82)" id="flowchart-C-9807" class="node default"><rect height="54" width="120.5" y="-27" x="-60.25" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-30.25, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="60.5"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>JVM实现</p></span></div></foreignObject></g></g><g transform="translate(955.984375, 82)" id="flowchart-C1-9809" class="node default"><rect height="78" width="140.125" y="-39" x="-70.0625" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-40.0625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>对象监视器<br>Monitor</p></span></div></foreignObject></g></g><g transform="translate(1171.109375, 82)" id="flowchart-D-9811" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>操作系统层</p></span></div></foreignObject></g></g><g transform="translate(1370.2109375, 82)" id="flowchart-D1-9813" class="node default"><rect height="78" width="108.078125" y="-39" x="-54.0390625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-24.0390625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>互斥锁<br>Mutex</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-daevqg_14"><span class="control" id="-daevqg_20">synchronized使用方式：</span></p><div class="code-block" data-lang="java">
// synchronized的三种使用方式
public class SynchronizedExample {
    private Object lock = new Object();
    private static Object staticLock = new Object();
    
    // 1. 同步实例方法 - 锁住当前对象(this)
    public synchronized void synchronizedInstanceMethod() {
        System.out.println(&quot;同步实例方法: &quot; + Thread.currentThread().getName());
        // 等价于：
        // synchronized(this) { ... }
    }
    
    // 2. 同步静态方法 - 锁住Class对象
    public static synchronized void synchronizedStaticMethod() {
        System.out.println(&quot;同步静态方法: &quot; + Thread.currentThread().getName());
        // 等价于：
        // synchronized(SynchronizedExample.class) { ... }
    }
    
    // 3. 同步代码块 - 锁住指定对象
    public void synchronizedBlock() {
        synchronized (lock) {
            System.out.println(&quot;同步代码块: &quot; + Thread.currentThread().getName());
        }
    }
    
    // 演示不同锁的互斥性
    public static void main(String[] args) throws InterruptedException {
        SynchronizedExample example1 = new SynchronizedExample();
        SynchronizedExample example2 = new SynchronizedExample();
        
        // 同一对象的实例方法互斥
        Thread t1 = new Thread(() -&gt; example1.synchronizedInstanceMethod());
        Thread t2 = new Thread(() -&gt; example1.synchronizedInstanceMethod());
        
        // 不同对象的实例方法不互斥
        Thread t3 = new Thread(() -&gt; example2.synchronizedInstanceMethod());
        
        // 静态方法在类级别互斥
        Thread t4 = new Thread(() -&gt; SynchronizedExample.synchronizedStaticMethod());
        Thread t5 = new Thread(() -&gt; SynchronizedExample.synchronizedStaticMethod());
        
        t1.start(); t2.start(); t3.start(); t4.start(); t5.start();
        t1.join(); t2.join(); t3.join(); t4.join(); t5.join();
    }
}
</div><p id="-daevqg_16"><span class="control" id="-daevqg_21">Monitor工作原理：</span></p><div class="code-block" data-lang="java">
// Monitor工作机制演示
public class MonitorExample {
    private final Object monitor = new Object();
    
    public void enterMonitor() {
        System.out.println(Thread.currentThread().getName() + &quot; 尝试获取锁&quot;);
        
        synchronized (monitor) {  // monitorenter
            System.out.println(Thread.currentThread().getName() + &quot; 获得锁，开始执行&quot;);
            
            try {
                Thread.sleep(2000); // 模拟业务逻辑
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
            
            System.out.println(Thread.currentThread().getName() + &quot; 释放锁&quot;);
        } // monitorexit
    }
    
    public static void main(String[] args) {
        MonitorExample example = new MonitorExample();
        
        // 多个线程竞争同一个monitor
        for (int i = 0; i &lt; 3; i++) {
            new Thread(() -&gt; example.enterMonitor(), &quot;Thread-&quot; + i).start();
        }
    }
}
</div></section><section class="chapter"><h3 id="q2-synchronized" data-toc="q2-synchronized">Q2: synchronized锁升级的过程是怎样的？</h3><p id="-daevqg_22"><span class="control" id="-daevqg_27">答案：</span></p><p id="-daevqg_23"><span class="control" id="-daevqg_28">锁升级过程：</span></p><svg aria-roledescription="stateDiagram" role="graphics-document document" viewBox="0 0 315.8125 1625" style="max-width: 315.8125px;" class="statediagram" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g><defs><marker orient="auto" markerUnits="userSpaceOnUse" markerHeight="14" markerWidth="20" refY="7" refX="19" id="mermaid_stateDiagram-barbEnd"><path d="M 19,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge0" d="M157.906,22L157.906,28.167C157.906,34.333,157.906,46.667,157.906,55.917C157.906,65.167,157.906,71.333,157.906,77.5C157.906,83.667,157.906,89.833,157.906,92.917L157.906,96"></path><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge1" d="M157.906,136L157.906,142.167C157.906,148.333,157.906,160.667,157.906,169.917C157.906,179.167,157.906,185.333,157.906,191.5C157.906,197.667,157.906,203.833,157.906,206.917L157.906,210"></path><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge2" d="M157.906,668L157.906,674.167C157.906,680.333,157.906,692.667,157.906,701.917C157.906,711.167,157.906,717.333,157.906,723.5C157.906,729.667,157.906,735.833,157.906,738.917L157.906,742"></path><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge3" d="M157.906,1224L157.906,1230.167C157.906,1236.333,157.906,1248.667,157.906,1257.917C157.906,1267.167,157.906,1273.333,157.906,1279.5C157.906,1285.667,157.906,1291.833,157.906,1294.917L157.906,1298"></path></g><g class="edgeLabels"><g transform="translate(157.90625, 59)" class="edgeLabel"><g transform="translate(-32.0546875, -12)" class="label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>对象创建</p></span></div></foreignObject></g></g><g transform="translate(157.90625, 173)" class="edgeLabel"><g transform="translate(-40.0625, -12)" class="label"><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>第一次加锁</p></span></div></foreignObject></g></g><g transform="translate(157.90625, 705)" class="edgeLabel"><g transform="translate(-40.0625, -12)" class="label"><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>多线程竞争</p></span></div></foreignObject></g></g><g transform="translate(157.90625, 1261)" class="edgeLabel"><g transform="translate(-32.0546875, -12)" class="label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>竞争激烈</p></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(157.90625, 15)" id="state-root_start-0" class="node default"><circle height="14" width="14" r="7" class="state-start"></circle></g><g transform="translate(157.90625, 116)" id="state-无锁状态-1" class="node  statediagram-state"><rect height="40" width="80.109375" y="-20" x="-40.0546875" ry="5" data-et="node" data-id="abc" rx="5" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>无锁状态</p></span></div></foreignObject></g></g><g transform="translate(0, 202)" class="root"><g class="clusters"><g data-look="classic" data-id="偏向锁" id="偏向锁" class="statediagram-state statediagram-cluster"><g><rect data-look="classic" height="458" width="299.8125" y="8" x="8" class="outer"></rect></g><g transform="translate(133.3671875, 9)" class="cluster-label"><foreignObject height="24" width="49.078125"><div style="display: inline-block; padding-right: 1px; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">偏向锁</span></div></foreignObject></g><rect height="428" width="299.8125" y="34" x="8" class="inner"></rect></g></g><g class="edgePaths"><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge4" d="M160.121,59.5L160.121,65.75C160.121,72,160.121,84.5,160.121,93.875C160.121,103.25,160.121,109.5,160.121,115.75C160.121,122,160.121,128.25,160.121,131.375L160.121,134.5"></path><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge5" d="M160.121,174.5L160.121,180.75C160.121,187,160.121,199.5,160.121,208.875C160.121,218.25,160.121,224.5,160.121,230.75C160.121,237,160.121,243.25,160.121,246.375L160.121,249.5"></path><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge6" d="M140.248,289.5L132.051,297.75C123.853,306,107.458,322.5,99.26,334.875C91.063,347.25,91.063,355.5,91.063,363.75C91.063,372,91.063,380.25,91.063,384.375L91.063,388.5"></path><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge7" d="M179.994,289.5L188.192,297.75C196.389,306,212.784,322.5,220.982,334.875C229.18,347.25,229.18,355.5,229.18,363.75C229.18,372,229.18,380.25,229.18,384.375L229.18,388.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(91.0625, 339)" class="edgeLabel"><g transform="translate(-32.0546875, -12)" class="label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>相同线程</p></span></div></foreignObject></g></g><g transform="translate(229.1796875, 339)" class="edgeLabel"><g transform="translate(-32.0546875, -12)" class="label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>不同线程</p></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(160.12109375, 52.5)" id="state-偏向锁_start-4" class="node default"><circle height="14" width="14" r="7" class="state-start"></circle></g><g transform="translate(160.12109375, 154.5)" id="state-记录线程ID-5" class="node  statediagram-state"><rect height="40" width="94.421875" y="-20" x="-47.2109375" ry="5" data-et="node" data-id="abc" rx="5" style="" class="basic label-container"></rect><g transform="translate(-39.2109375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="78.421875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>记录线程ID</p></span></div></foreignObject></g></g><g transform="translate(160.12109375, 269.5)" id="state-检查线程ID-7" class="node  statediagram-state"><rect height="40" width="94.421875" y="-20" x="-47.2109375" ry="5" data-et="node" data-id="abc" rx="5" style="" class="basic label-container"></rect><g transform="translate(-39.2109375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="78.421875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>检查线程ID</p></span></div></foreignObject></g></g><g transform="translate(91.0625, 408.5)" id="state-直接获得锁-6" class="node  statediagram-state"><rect height="40" width="96.125" y="-20" x="-48.0625" ry="5" data-et="node" data-id="abc" rx="5" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>直接获得锁</p></span></div></foreignObject></g></g><g transform="translate(229.1796875, 408.5)" id="state-撤销偏向-7" class="node  statediagram-state"><rect height="40" width="80.109375" y="-20" x="-40.0546875" ry="5" data-et="node" data-id="abc" rx="5" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>撤销偏向</p></span></div></foreignObject></g></g></g></g><g transform="translate(4.453125, 734)" class="root"><g class="clusters"><g data-look="classic" data-id="轻量级锁" id="轻量级锁" class="statediagram-state statediagram-cluster"><g><rect data-look="classic" height="482" width="290.90625" y="8" x="8" class="outer"></rect></g><g transform="translate(120.8984375, 9)" class="cluster-label"><foreignObject height="24" width="65.109375"><div style="display: inline-block; padding-right: 1px; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">轻量级锁</span></div></foreignObject></g><rect height="452" width="290.90625" y="34" x="8" class="inner"></rect></g></g><g class="edgePaths"><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge8" d="M138.773,59.5L138.773,65.75C138.773,72,138.773,84.5,138.773,93.875C138.773,103.25,138.773,109.5,138.773,115.75C138.773,122,138.773,128.25,138.773,131.375L138.773,134.5"></path><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge9" d="M121.206,174.5L113.959,182.75C106.713,191,92.22,207.5,84.973,219.875C77.727,232.25,77.727,240.5,77.727,248.75C77.727,257,77.727,265.25,77.727,269.375L77.727,273.5"></path><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge10" d="M156.341,174.5L163.587,182.75C170.834,191,185.327,207.5,192.574,219.875C199.82,232.25,199.82,240.5,199.82,248.75C199.82,257,199.82,265.25,199.82,269.375L199.82,273.5"></path><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge11" d="M199.82,313.5L199.82,321.75C199.82,330,199.82,346.5,199.82,358.875C199.82,371.25,199.82,379.5,199.82,387.75C199.82,396,199.82,404.25,199.82,408.375L199.82,412.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(77.7265625, 224)" class="edgeLabel"><g transform="translate(-16.03125, -12)" class="label"><foreignObject height="24" width="32.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>成功</p></span></div></foreignObject></g></g><g transform="translate(199.8203125, 224)" class="edgeLabel"><g transform="translate(-16.03125, -12)" class="label"><foreignObject height="24" width="32.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>失败</p></span></div></foreignObject></g></g><g transform="translate(199.8203125, 363)" class="edgeLabel"><g transform="translate(-32.0546875, -12)" class="label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>自旋超限</p></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(138.7734375, 52.5)" id="state-轻量级锁_start-8" class="node default"><circle height="14" width="14" r="7" class="state-start"></circle></g><g transform="translate(138.7734375, 154.5)" id="state-CAS操作-10" class="node  statediagram-state"><rect height="40" width="74.828125" y="-20" x="-37.4140625" ry="5" data-et="node" data-id="abc" rx="5" style="" class="basic label-container"></rect><g transform="translate(-29.4140625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="58.828125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>CAS操作</p></span></div></foreignObject></g></g><g transform="translate(77.7265625, 293.5)" id="state-获得锁-9" class="node  statediagram-state"><rect height="40" width="64.078125" y="-20" x="-32.0390625" ry="5" data-et="node" data-id="abc" rx="5" style="" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>获得锁</p></span></div></foreignObject></g></g><g transform="translate(199.8203125, 293.5)" id="state-自旋等待-11" class="node  statediagram-state"><rect height="40" width="80.109375" y="-20" x="-40.0546875" ry="5" data-et="node" data-id="abc" rx="5" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>自旋等待</p></span></div></foreignObject></g></g><g transform="translate(199.8203125, 432.5)" id="state-膨胀为重量级锁-11" class="node  statediagram-state"><rect height="40" width="128.171875" y="-20" x="-64.0859375" ry="5" data-et="node" data-id="abc" rx="5" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>膨胀为重量级锁</p></span></div></foreignObject></g></g></g></g><g transform="translate(66.84375, 1290)" class="root"><g class="clusters"><g data-look="classic" data-id="重量级锁" id="重量级锁" class="statediagram-state statediagram-cluster"><g><rect data-look="classic" height="319" width="166.125" y="8" x="8" class="outer"></rect></g><g transform="translate(58.5078125, 9)" class="cluster-label"><foreignObject height="24" width="65.109375"><div style="display: inline-block; padding-right: 1px; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">重量级锁</span></div></foreignObject></g><rect height="289" width="166.125" y="34" x="8" class="inner"></rect></g></g><g class="edgePaths"><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge12" d="M91.063,59.5L91.063,65.75C91.063,72,91.063,84.5,91.063,93.875C91.063,103.25,91.063,109.5,91.063,115.75C91.063,122,91.063,128.25,91.063,131.375L91.063,134.5"></path><path marker-end="url(#mermaid_stateDiagram-barbEnd)" style=";fill:none" class="edge-thickness-normal edge-pattern-solid transition" id="edge13" d="M91.063,174.5L91.063,180.75C91.063,187,91.063,199.5,91.063,208.875C91.063,218.25,91.063,224.5,91.063,230.75C91.063,237,91.063,243.25,91.063,246.375L91.063,249.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(91.0625, 52.5)" id="state-重量级锁_start-12" class="node default"><circle height="14" width="14" r="7" class="state-start"></circle></g><g transform="translate(91.0625, 154.5)" id="state-阻塞等待-13" class="node  statediagram-state"><rect height="40" width="80.109375" y="-20" x="-40.0546875" ry="5" data-et="node" data-id="abc" rx="5" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>阻塞等待</p></span></div></foreignObject></g></g><g transform="translate(91.0625, 269.5)" id="state-进入监视器-13" class="node  statediagram-state"><rect height="40" width="96.125" y="-20" x="-48.0625" ry="5" data-et="node" data-id="abc" rx="5" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>进入监视器</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-daevqg_25"><span class="control" id="-daevqg_29">锁升级代码分析：</span></p><div class="code-block" data-lang="java">
// 锁升级演示
public class LockUpgradeExample {
    private Object lock = new Object();
    
    // 偏向锁场景：单线程多次获取同一锁
    public void biasedLockScenario() {
        System.out.println(&quot;=== 偏向锁场景 ===&quot;);
        for (int i = 0; i &lt; 5; i++) {
            synchronized (lock) {
                System.out.println(&quot;第&quot; + (i+1) + &quot;次获取锁 - &quot; + 
                                 Thread.currentThread().getName());
            }
        }
    }
    
    // 轻量级锁场景：少量线程交替执行
    public void lightweightLockScenario() throws InterruptedException {
        System.out.println(&quot;=== 轻量级锁场景 ===&quot;);
        
        Thread t1 = new Thread(() -&gt; {
            for (int i = 0; i &lt; 3; i++) {
                synchronized (lock) {
                    System.out.println(&quot;T1获取锁，执行第&quot; + (i+1) + &quot;次&quot;);
                    try {
                        Thread.sleep(100);
                    } catch (InterruptedException e) {
                        Thread.currentThread().interrupt();
                    }
                }
            }
        });
        
        Thread t2 = new Thread(() -&gt; {
            for (int i = 0; i &lt; 3; i++) {
                synchronized (lock) {
                    System.out.println(&quot;T2获取锁，执行第&quot; + (i+1) + &quot;次&quot;);
                    try {
                        Thread.sleep(100);
                    } catch (InterruptedException e) {
                        Thread.currentThread().interrupt();
                    }
                }
            }
        });
        
        t1.start();
        Thread.sleep(50); // 错开启动时间
        t2.start();
        
        t1.join();
        t2.join();
    }
    
    // 重量级锁场景：多线程激烈竞争
    public void heavyweightLockScenario() throws InterruptedException {
        System.out.println(&quot;=== 重量级锁场景 ===&quot;);
        
        Thread[] threads = new Thread[10];
        for (int i = 0; i &lt; 10; i++) {
            final int threadId = i;
            threads[i] = new Thread(() -&gt; {
                synchronized (lock) {
                    System.out.println(&quot;线程&quot; + threadId + &quot;获得重量级锁&quot;);
                    try {
                        Thread.sleep(500); // 长时间持有锁
                    } catch (InterruptedException e) {
                        Thread.currentThread().interrupt();
                    }
                }
            });
        }
        
        // 同时启动所有线程，造成激烈竞争
        for (Thread thread : threads) {
            thread.start();
        }
        
        for (Thread thread : threads) {
            thread.join();
        }
    }
    
    public static void main(String[] args) throws InterruptedException {
        LockUpgradeExample example = new LockUpgradeExample();
        
        example.biasedLockScenario();
        Thread.sleep(1000);
        
        example.lightweightLockScenario();
        Thread.sleep(1000);
        
        example.heavyweightLockScenario();
    }
}
</div></section></section><section class="chapter"><h2 id="-daevqg_6" data-toc="-daevqg_6">🔐 显式锁机制</h2><section class="chapter"><h3 id="q3-reentrantlock-synchronized" data-toc="q3-reentrantlock-synchronized">Q3: ReentrantLock与synchronized有什么区别？如何选择？</h3><p id="-daevqg_32"><span class="control" id="-daevqg_41">答案：</span></p><p id="-daevqg_33"><span class="control" id="-daevqg_42">ReentrantLock vs synchronized对比：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1054.203125 436"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1054.203125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 48)" class="root"><g class="clusters"><g data-look="classic" id="性能对比" class="cluster"><rect height="324" width="486.09375" y="8" x="8" style=""></rect><g transform="translate(218.9921875, 8)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>性能对比</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_2" d="M185.625,94L191.875,94C198.125,94,210.625,94,220.438,94C230.25,94,237.375,94,243.833,94C250.292,94,256.083,94,258.979,94L261.875,94"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_D1_3" d="M185.625,246L191.875,246C198.125,246,210.625,246,220,246C229.375,246,235.625,246,241.208,246C246.792,246,251.708,246,254.167,246L256.625,246"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(115.5625, 94)" id="flowchart-C-10096" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>低竞争场景</p></span></div></foreignObject></g></g><g transform="translate(358.609375, 94)" id="flowchart-C1-10097" class="node default"><rect height="102" width="185.46875" y="-51" x="-92.734375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-62.734375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="125.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>synchronized更优<br>JVM深度优化<br>锁升级机制</p></span></div></foreignObject></g></g><g transform="translate(115.5625, 246)" id="flowchart-D-10098" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>高竞争场景</p></span></div></foreignObject></g></g><g transform="translate(358.609375, 246)" id="flowchart-D1-10099" class="node default"><rect height="102" width="195.96875" y="-51" x="-97.984375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-67.984375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="135.96875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ReentrantLock更优<br>减少上下文切换<br>公平锁可选</p></span></div></foreignObject></g></g></g></g><g transform="translate(536.09375, 0)" class="root"><g class="clusters"><g data-look="classic" id="功能对比" class="cluster"><rect height="420" width="502.109375" y="8" x="8" style=""></rect><g transform="translate(227, 8)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>功能对比</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_A1_0" d="M209.406,118L215.656,118C221.906,118,234.406,118,243.781,118C253.156,118,259.406,118,264.99,118C270.573,118,275.49,118,277.948,118L280.406,118"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M204.156,318L211.281,318C218.406,318,232.656,318,244.91,318C257.163,318,267.419,318,277.009,318C286.599,318,295.522,318,299.984,318L304.445,318"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(127.453125, 118)" id="flowchart-A-10092" class="node default"><rect height="54" width="163.90625" y="-27" x="-81.953125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-51.953125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="103.90625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ReentrantLock</p></span></div></foreignObject></g></g><g transform="translate(378.5078125, 118)" id="flowchart-A1-10093" class="node default"><rect height="150" width="188.203125" y="-75" x="-94.1015625" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-64.1015625, -60)" style="" class="label"><rect></rect><foreignObject height="120" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>可中断锁获取<br>超时锁获取<br>公平锁支持<br>多个Condition<br>锁获取和释放灵活</p></span></div></foreignObject></g></g><g transform="translate(127.453125, 318)" id="flowchart-B-10094" class="node default"><rect height="54" width="153.40625" y="-27" x="-76.703125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-46.703125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="93.40625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>synchronized</p></span></div></foreignObject></g></g><g transform="translate(378.5078125, 318)" id="flowchart-B1-10095" class="node default"><rect height="150" width="140.125" y="-75" x="-70.0625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-40.0625, -60)" style="" class="label"><rect></rect><foreignObject height="120" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>简单易用<br>自动释放锁<br>JVM优化<br>性能更好<br>死锁检测</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-daevqg_35"><span class="control" id="-daevqg_43">详细对比表：</span></p><div class="table-wrapper"><table class="wide" id="-daevqg_36"><thead><tr class="ijRowHead" id="-daevqg_44"><th id="-daevqg_53"><p>特性</p></th><th id="-daevqg_54"><p>ReentrantLock</p></th><th id="-daevqg_55"><p>synchronized</p></th></tr></thead><tbody><tr id="-daevqg_45"><td id="-daevqg_56"><p><span class="control" id="-daevqg_59">使用方式</span></p></td><td id="-daevqg_57"><p>显式获取和释放</p></td><td id="-daevqg_58"><p>自动获取和释放</p></td></tr><tr id="-daevqg_46"><td id="-daevqg_60"><p><span class="control" id="-daevqg_63">可重入性</span></p></td><td id="-daevqg_61"><p>支持</p></td><td id="-daevqg_62"><p>支持</p></td></tr><tr id="-daevqg_47"><td id="-daevqg_64"><p><span class="control" id="-daevqg_67">公平性</span></p></td><td id="-daevqg_65"><p>支持公平锁和非公平锁</p></td><td id="-daevqg_66"><p>非公平锁</p></td></tr><tr id="-daevqg_48"><td id="-daevqg_68"><p><span class="control" id="-daevqg_71">可中断性</span></p></td><td id="-daevqg_69"><p>支持中断</p></td><td id="-daevqg_70"><p>不支持中断</p></td></tr><tr id="-daevqg_49"><td id="-daevqg_72"><p><span class="control" id="-daevqg_75">超时获取</span></p></td><td id="-daevqg_73"><p>支持超时</p></td><td id="-daevqg_74"><p>不支持超时</p></td></tr><tr id="-daevqg_50"><td id="-daevqg_76"><p><span class="control" id="-daevqg_79">条件变量</span></p></td><td id="-daevqg_77"><p>支持多个Condition</p></td><td id="-daevqg_78"><p>只有一个等待队列</p></td></tr><tr id="-daevqg_51"><td id="-daevqg_80"><p><span class="control" id="-daevqg_83">性能</span></p></td><td id="-daevqg_81"><p>中等</p></td><td id="-daevqg_82"><p>优秀（JVM优化）</p></td></tr><tr id="-daevqg_52"><td id="-daevqg_84"><p><span class="control" id="-daevqg_87">易用性</span></p></td><td id="-daevqg_85"><p>复杂，需要手动释放</p></td><td id="-daevqg_86"><p>简单，自动释放</p></td></tr></tbody></table></div><p id="-daevqg_37"><span class="control" id="-daevqg_88">ReentrantLock基本使用：</span></p><div class="code-block" data-lang="java">
// ReentrantLock基本使用
public class ReentrantLockExample {
    private final ReentrantLock lock = new ReentrantLock();
    private int count = 0;
    
    // 基本加锁解锁
    public void increment() {
        lock.lock();  // 获取锁
        try {
            count++;
            System.out.println(&quot;Count: &quot; + count + &quot; by &quot; + 
                             Thread.currentThread().getName());
        } finally {
            lock.unlock();  // 必须在finally中释放锁
        }
    }
    
    // 可中断的锁获取
    public void interruptibleIncrement() throws InterruptedException {
        lock.lockInterruptibly();  // 可以被中断的锁获取
        try {
            count++;
            Thread.sleep(1000); // 模拟长时间操作
        } finally {
            lock.unlock();
        }
    }
    
    // 尝试获取锁（非阻塞）
    public boolean tryIncrement() {
        if (lock.tryLock()) {  // 尝试获取锁，不阻塞
            try {
                count++;
                return true;
            } finally {
                lock.unlock();
            }
        }
        return false;  // 获取锁失败
    }
    
    // 超时获取锁
    public boolean timeoutIncrement(long timeout, TimeUnit unit) 
            throws InterruptedException {
        if (lock.tryLock(timeout, unit)) {  // 超时获取锁
            try {
                count++;
                return true;
            } finally {
                lock.unlock();
            }
        }
        return false;  // 超时失败
    }
    
    public static void main(String[] args) throws InterruptedException {
        ReentrantLockExample example = new ReentrantLockExample();
        
        // 测试可中断锁
        Thread t1 = new Thread(() -&gt; {
            try {
                example.interruptibleIncrement();
            } catch (InterruptedException e) {
                System.out.println(&quot;线程被中断&quot;);
            }
        });
        
        t1.start();
        Thread.sleep(500);
        t1.interrupt();  // 中断线程
        t1.join();
        
        // 测试tryLock
        Thread t2 = new Thread(() -&gt; {
            if (example.tryIncrement()) {
                System.out.println(&quot;成功获取锁&quot;);
            } else {
                System.out.println(&quot;获取锁失败&quot;);
            }
        });
        
        t2.start();
        t2.join();
    }
}
</div><p id="-daevqg_39"><span class="control" id="-daevqg_89">公平锁与非公平锁：</span></p><div class="code-block" data-lang="java">
// 公平锁与非公平锁对比
public class FairVsUnfairLock {
    // 公平锁：按照等待时间顺序获取锁
    private final ReentrantLock fairLock = new ReentrantLock(true);
    // 非公平锁：允许插队，性能更好
    private final ReentrantLock unfairLock = new ReentrantLock(false);
    
    public void fairLockTest() {
        for (int i = 0; i &lt; 5; i++) {
            final int threadId = i;
            new Thread(() -&gt; {
                for (int j = 0; j &lt; 3; j++) {
                    fairLock.lock();
                    try {
                        System.out.println(&quot;公平锁 - 线程&quot; + threadId + 
                                         &quot; 获得锁，执行第&quot; + (j+1) + &quot;次&quot;);
                        Thread.sleep(100);
                    } catch (InterruptedException e) {
                        Thread.currentThread().interrupt();
                    } finally {
                        fairLock.unlock();
                    }
                }
            }).start();
        }
    }
    
    public void unfairLockTest() {
        for (int i = 0; i &lt; 5; i++) {
            final int threadId = i;
            new Thread(() -&gt; {
                for (int j = 0; j &lt; 3; j++) {
                    unfairLock.lock();
                    try {
                        System.out.println(&quot;非公平锁 - 线程&quot; + threadId + 
                                         &quot; 获得锁，执行第&quot; + (j+1) + &quot;次&quot;);
                        Thread.sleep(100);
                    } catch (InterruptedException e) {
                        Thread.currentThread().interrupt();
                    } finally {
                        unfairLock.unlock();
                    }
                }
            }).start();
        }
    }
}
</div></section><section class="chapter"><h3 id="q4-reentrantreadwritelock" data-toc="q4-reentrantreadwritelock">Q4: 什么是读写锁？如何使用ReentrantReadWriteLock？</h3><p id="-daevqg_90"><span class="control" id="-daevqg_97">答案：</span></p><p id="-daevqg_91"><span class="control" id="-daevqg_98">读写锁原理：</span></p><p id="-daevqg_93"><span class="control" id="-daevqg_99">ReentrantReadWriteLock使用：</span></p><div class="code-block" data-lang="java">
// 读写锁使用示例
public class ReadWriteLockExample {
    private final ReentrantReadWriteLock rwLock = new ReentrantReadWriteLock();
    private final ReentrantReadWriteLock.ReadLock readLock = rwLock.readLock();
    private final ReentrantReadWriteLock.WriteLock writeLock = rwLock.writeLock();
    
    private Map&lt;String, String&gt; cache = new HashMap&lt;&gt;();
    
    // 读操作：使用读锁
    public String read(String key) {
        readLock.lock();
        try {
            System.out.println(Thread.currentThread().getName() + &quot; 开始读取 &quot; + key);
            Thread.sleep(1000); // 模拟读取时间
            String value = cache.get(key);
            System.out.println(Thread.currentThread().getName() + &quot; 读取完成: &quot; + 
                             key + &quot; = &quot; + value);
            return value;
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            return null;
        } finally {
            readLock.unlock();
        }
    }
    
    // 写操作：使用写锁
    public void write(String key, String value) {
        writeLock.lock();
        try {
            System.out.println(Thread.currentThread().getName() + &quot; 开始写入 &quot; + 
                             key + &quot; = &quot; + value);
            Thread.sleep(2000); // 模拟写入时间
            cache.put(key, value);
            System.out.println(Thread.currentThread().getName() + &quot; 写入完成&quot;);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        } finally {
            writeLock.unlock();
        }
    }
    
    // 锁降级：从写锁降级为读锁
    public void lockDowngrade(String key, String newValue) {
        writeLock.lock();
        try {
            // 更新数据
            cache.put(key, newValue);
            System.out.println(&quot;更新数据: &quot; + key + &quot; = &quot; + newValue);
            
            // 获取读锁（锁降级）
            readLock.lock();
        } finally {
            writeLock.unlock(); // 释放写锁
        }
        
        try {
            // 现在持有读锁，可以安全读取
            String value = cache.get(key);
            System.out.println(&quot;锁降级后读取: &quot; + value);
        } finally {
            readLock.unlock();
        }
    }
    
    public static void main(String[] args) throws InterruptedException {
        ReadWriteLockExample example = new ReadWriteLockExample();
        
        // 初始化数据
        example.write(&quot;key1&quot;, &quot;value1&quot;);
        example.write(&quot;key2&quot;, &quot;value2&quot;);
        
        // 启动多个读线程
        for (int i = 0; i &lt; 3; i++) {
            final int readerId = i;
            new Thread(() -&gt; {
                example.read(&quot;key1&quot;);
            }, &quot;Reader-&quot; + readerId).start();
        }
        
        Thread.sleep(500);
        
        // 启动写线程
        new Thread(() -&gt; {
            example.write(&quot;key1&quot;, &quot;new_value1&quot;);
        }, &quot;Writer&quot;).start();
        
        Thread.sleep(500);
        
        // 再启动读线程
        new Thread(() -&gt; {
            example.read(&quot;key1&quot;);
        }, &quot;Reader-Final&quot;).start();
    }
}
</div><p id="-daevqg_95"><span class="control" id="-daevqg_100">StampedLock（Java 8+）：</span></p><div class="code-block" data-lang="java">
// StampedLock - 更高性能的读写锁
public class StampedLockExample {
    private final StampedLock stampedLock = new StampedLock();
    private double x, y;
    
    // 写操作
    public void write(double newX, double newY) {
        long stamp = stampedLock.writeLock();  // 获取写锁
        try {
            x = newX;
            y = newY;
            System.out.println(&quot;写入: x=&quot; + x + &quot;, y=&quot; + y);
        } finally {
            stampedLock.unlockWrite(stamp);   // 释放写锁
        }
    }
    
    // 乐观读
    public double distanceFromOrigin() {
        long stamp = stampedLock.tryOptimisticRead();  // 尝试乐观读
        double curX = x, curY = y;                     // 读取数据
        
        if (!stampedLock.validate(stamp)) {            // 检查数据是否被修改
            stamp = stampedLock.readLock();            // 升级为悲观读锁
            try {
                curX = x;
                curY = y;
            } finally {
                stampedLock.unlockRead(stamp);
            }
        }
        return Math.sqrt(curX * curX + curY * curY);
    }
    
    // 悲观读
    public double[] getCurrentPoint() {
        long stamp = stampedLock.readLock();
        try {
            return new double[]{x, y};
        } finally {
            stampedLock.unlockRead(stamp);
        }
    }
    
    // 读锁升级为写锁
    public void moveIfAtOrigin(double newX, double newY) {
        long stamp = stampedLock.readLock();
        try {
            while (x == 0.0 &amp;&amp; y == 0.0) {
                // 尝试将读锁升级为写锁
                long writeStamp = stampedLock.tryConvertToWriteLock(stamp);
                if (writeStamp != 0L) {
                    stamp = writeStamp;
                    x = newX;
                    y = newY;
                    System.out.println(&quot;从原点移动到: x=&quot; + x + &quot;, y=&quot; + y);
                    break;
                } else {
                    // 升级失败，释放读锁，获取写锁
                    stampedLock.unlockRead(stamp);
                    stamp = stampedLock.writeLock();
                }
            }
        } finally {
            stampedLock.unlock(stamp);
        }
    }
}
</div></section></section><section class="chapter"><h2 id="-daevqg_7" data-toc="-daevqg_7">💡 面试技巧</h2><section class="chapter"><h3 id="-daevqg_101" data-toc="-daevqg_101">高频考点</h3><ol class="list _decimal" id="-daevqg_103" type="1"><li class="list__item" id="-daevqg_104"><p id="-daevqg_109"><span class="control" id="-daevqg_110">synchronized原理</span> ：Monitor机制、锁升级过程、字节码实现</p></li><li class="list__item" id="-daevqg_105"><p id="-daevqg_111"><span class="control" id="-daevqg_112">显式锁特性</span> ：ReentrantLock的高级功能、公平锁概念</p></li><li class="list__item" id="-daevqg_106"><p id="-daevqg_113"><span class="control" id="-daevqg_114">读写锁应用</span> ：适用场景、性能优势、锁降级机制</p></li><li class="list__item" id="-daevqg_107"><p id="-daevqg_115"><span class="control" id="-daevqg_116">锁的选择</span> ：不同场景下锁的选择原则和性能考量</p></li><li class="list__item" id="-daevqg_108"><p id="-daevqg_117"><span class="control" id="-daevqg_118">锁优化技术</span> ：JVM锁优化策略、偏向锁、轻量级锁</p></li></ol></section><section class="chapter"><h3 id="-daevqg_102" data-toc="-daevqg_102">回答策略</h3><ol class="list _decimal" id="-daevqg_119" type="1"><li class="list__item" id="-daevqg_122"><p id="-daevqg_126"><span class="control" id="-daevqg_127">原理深入</span> ：从字节码到操作系统层面解释锁的实现</p></li><li class="list__item" id="-daevqg_123"><p id="-daevqg_128"><span class="control" id="-daevqg_129">性能分析</span> ：对比不同锁在不同场景下的性能表现</p></li><li class="list__item" id="-daevqg_124"><p id="-daevqg_130"><span class="control" id="-daevqg_131">实践经验</span> ：结合具体项目场景说明锁的选择和使用</p></li><li class="list__item" id="-daevqg_125"><p id="-daevqg_132"><span class="control" id="-daevqg_133">问题排查</span> ：说明常见的锁相关问题和解决方案</p></li></ol><p id="-daevqg_121"><span class="control" id="-daevqg_134">学习建议</span> ：锁机制是并发编程的核心，需要深入理解不同锁的实现原理和适用场景。建议通过实际编程体验不同锁的行为差异，重点掌握锁的性能特点和选择原则。</p></section></section><div class="last-modified">09 六月 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="java内存模型与可见性qa.html" class="navigation-links__prev">Java内存模型与可见性QA</a><a href="java并发工具类qa.html" class="navigation-links__next">Java并发工具类QA</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>