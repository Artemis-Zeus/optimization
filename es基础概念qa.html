<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-06-10T01:18:24.455266"><title>ES基础概念QA | 技术知识库</title><script type="application/json" id="virtual-toc-data">[{"id":"e6t8tv_4","level":0,"title":"📋 知识结构","anchor":"#e6t8tv_4"},{"id":"e6t8tv_5","level":0,"title":"🔍 核心术语详解","anchor":"#e6t8tv_5"},{"id":"e6t8tv_6","level":0,"title":"🏗️ 架构设计","anchor":"#e6t8tv_6"},{"id":"e6t8tv_7","level":0,"title":"🔄 数据模型","anchor":"#e6t8tv_7"},{"id":"e6t8tv_8","level":0,"title":"💡 面试技巧","anchor":"#e6t8tv_8"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="ES基础概念QA | 技术知识库"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="技术知识库 Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/es基础概念qa.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="ES基础概念QA | 技术知识库"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/es基础概念qa.html#webpage",
    "url": "writerside-documentation/es基础概念qa.html",
    "name": "ES基础概念QA | 技术知识库",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "技术知识库 Help"
}</script><!-- End Schema.org --></head><body data-id="ES基础概念QA" data-main-title="ES基础概念QA" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="ES面试大纲.md|Elasticsearch面试大纲"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>技术知识库  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="ES基础概念QA" id="ES基础概念QA.md">ES基础概念QA</h1><p id="e6t8tv_3">本文档深入解析Elasticsearch的基础概念和核心原理，涵盖核心术语、架构设计、分布式原理、数据模型等基础知识。</p><section class="chapter"><h2 id="e6t8tv_4" data-toc="e6t8tv_4">📋 知识结构</h2><svg aria-roledescription="mindmap" role="graphics-document document" viewBox="5 5 777.9725341796875 450.86871337890625" style="max-width: 777.9725341796875px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g></g><g class="mindmap-edges"><path class="edge section-edge-0 edge-depth-1" d="M 562.3328106425091,202.6372829140148 L 570.8933997518178,173.3077911567857 L579.4539888611265,143.97829939955653"></path><path class="edge section-edge-0 edge-depth-1" d="M 547.3927123650691,227.51072894011327 L 522.4187613237686,251.87283834683024 L497.44481028246815,276.23494775354726"></path><path class="edge section-edge-0 edge-depth-1" d="M 572.1812026900566,211.78628555928026 L 632.2906609397934,189.32654516460298 L692.4001191895302,166.86680476992564"></path><path class="edge section-edge-0 edge-depth-1" d="M 568.5025800754223,227.8720659496067 L 596.6937453008585,257.32171429109076 L624.8849105262947,286.77136263257484"></path><path class="edge section-edge-0 edge-depth-1" d="M 572.977011935179,219.1735287001637 L 637.7661369996094,228.49920146249028 L702.5552620640399,237.82487422481685"></path><path class="edge section-edge-0 edge-depth-0" d="M 399.0749897088071,230.69803218596059 L 471.1300212761206,224.5090784881941 L543.185052843434,218.3201247904276"></path><path class="edge section-edge-1 edge-depth-1" d="M 205.0038973318911,273.20087712643294 L 142.7675960377843,277.22161218841785 L80.5312947436775,281.24234725040276"></path><path class="edge section-edge-1 edge-depth-1" d="M 207.05587702275318,264.60782720197204 L 163.06731410402938,238.6372751249513 L119.07875118530556,212.6667230479305"></path><path class="edge section-edge-1 edge-depth-1" d="M 223.34445826812123,257.61770021720116 L 229.63720727529045,230.33952651286464 L235.92995628245967,203.0613528085281"></path><path class="edge section-edge-1 edge-depth-1" d="M 208.6560087376368,282.0792675106726 L 176.4044591271977,310.1379018128771 L144.1529095167586,338.1965361150816"></path><path class="edge section-edge-1 edge-depth-0" d="M 369.56158952574873,235.55393263979474 L 302.0513541621595,252.10775725027577 L234.54111879857027,268.6615818607568"></path><path class="edge section-edge-2 edge-depth-1" d="M 372.25382752528867,340.9936762645951 L 319.3861285927186,350.7007562740596 L266.5184296601485,360.4078362835241"></path><path class="edge section-edge-2 edge-depth-1" d="M 377.9585784958691,350.2481780319791 L 355.1139634440813,380.45154465022216 L332.2693483922935,410.65491126846524"></path><path class="edge section-edge-2 edge-depth-1" d="M 394.74177688210756,351.13689159315004 L 413.6928384548531,382.626758255038 L432.6439000275986,414.11662491692584"></path><path class="edge section-edge-2 edge-depth-1" d="M 401.6635633609138,341.4771313815969 L 458.73228420725053,353.90738907730685 L515.8010050535872,366.3376467730168"></path><path class="edge section-edge-2 edge-depth-0" d="M 384.5358552306458,246.97619527227874 L 385.5686077720251,285.13324223005134 L386.60136031340437,323.290289187824"></path><path class="edge section-edge-3 edge-depth-1" d="M 357.1807230914523,124.54668847874905 L 411.16702787999634,104.30952269184914 L465.1533326685404,84.07235690494923"></path><path class="edge section-edge-3 edge-depth-1" d="M 331.8900924409249,119.88458926955431 L 299.0728681245014,90.91331524740954 L266.2556438080779,61.942041225264774"></path><path class="edge section-edge-3 edge-depth-1" d="M 346.8581887742996,115.28116773388803 L 355.4224755058377,81.85589203922709 L363.98676223737584,48.43061634456615"></path><path class="edge section-edge-3 edge-depth-1" d="M 328.20325977590676,128.38372949768254 L 270.16732344428385,122.83328605753766 L212.13138711266095,117.28284261739279"></path><path class="edge section-edge-3 edge-depth-0" d="M 378.5442501295436,218.06050773668323 L 363.6325716464151,180.89673526590474 L348.7208931632866,143.73296279512618"></path></g><g class="mindmap-nodes"><g transform="translate(333.4371985607621, 213.08168645335525)" class="mindmap-node section--1 section-root"><g transform="translate(50.69281768798828, 18.9)"><circle r="50.69281768798828" class="node-bkg node-circle" id="node-0"></circle></g><g transform="translate(50.69281768798828, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ES基础概念</tspan></tspan></text></g></g></g><g transform="translate(515.094027005395, 198.13647052303293)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-1"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">核心术语</tspan></tspan></text></g></g></g><g transform="translate(176.9366927774729, 253.3338280471963)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-7"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">架构设计</tspan></tspan></text></g></g></g><g transform="translate(343.97119999720405, 319.3847980067475)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-12"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">存储原理</tspan></tspan></text></g></g></g><g transform="translate(300.5804395440798, 110.91178407845416)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-17"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">数据模型</tspan></tspan></text></g></g></g><g transform="translate(537.1668020392563, 110.6791117905384)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h82.97994232177734 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-2"></path><line y2="37.8" x2="92.97994232177734" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(46.48997116088867, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">索引Index</tspan></tspan></text></g></g></g><g transform="translate(423.6932370056677, 267.8092061706276)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h116.02851867675781 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-3"></path><line y2="37.8" x2="126.02851867675781" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(63.014259338378906, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">文档Document</tspan></tspan></text></g></g></g><g transform="translate(659.8480431652074, 142.71661980617296)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h83.20650482177734 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-4"></path><line y2="37.8" x2="93.20650482177734" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(46.60325241088867, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">分片Shard</tspan></tspan></text></g></g></g><g transform="translate(582.9075535621423, 278.70695805914863)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h94.69982147216797 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-5"></path><line y2="37.8" x2="104.69982147216797" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(52.349910736083984, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">副本Replica</tspan></tspan></text></g></g></g><g transform="translate(661.8319351957282, 221.06193240194762)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h101.140625 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-6"></path><line y2="37.8" x2="111.140625" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(55.5703125, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">映射Mapping</tspan></tspan></text></g></g></g><g transform="translate(15, 263.3093963296394)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h91.125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-8"></path><line y2="37.8" x2="101.125" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(50.5625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">分布式架构</tspan></tspan></text></g></g></g><g transform="translate(63.607248632490155, 186.14072220270623)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-9"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">节点角色</tspan></tspan></text></g></g></g><g transform="translate(196.7470349750123, 169.54522497853293)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-10"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">集群结构</tspan></tspan></text></g></g></g><g transform="translate(90.28153867882679, 329.1419755785579)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-11"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">数据流向</tspan></tspan></text></g></g></g><g transform="translate(209.21037039013743, 344.21671454137174)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-13"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">倒排索引</tspan></tspan></text></g></g></g><g transform="translate(280.1847282947672, 403.7182912936969)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-14"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">分段存储</tspan></tspan></text></g></g></g><g transform="translate(397.8424783163107, 408.06871850332845)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-15"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">写入流程</tspan></tspan></text></g></g></g><g transform="translate(487.4213698211056, 350.62998014786626)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-16"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">搜索流程</tspan></tspan></text></g></g></g><g transform="translate(436.64424121591287, 59.90726130524411)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-18"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">文档模型</tspan></tspan></text></g></g></g><g transform="translate(212.95592170492296, 33.11484641636491)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-19"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">嵌套结构</tspan></tspan></text></g></g></g><g transform="translate(325.65513646759564, 15)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-20"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">关联关系</tspan></tspan></text></g></g></g><g transform="translate(154.6448323444879, 96.95478803662115)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-21"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">版本控制</tspan></tspan></text></g></g></g></g></svg></section><section class="chapter"><h2 id="e6t8tv_5" data-toc="e6t8tv_5">🔍 核心术语详解</h2><section class="chapter"><h3 id="q1-elasticsearch-index-document-field" data-toc="q1-elasticsearch-index-document-field">Q1: Elasticsearch中的Index、Document、Field分别是什么？它们之间的关系如何？</h3><p id="e6t8tv_13"><span class="control" id="e6t8tv_20">答案：</span></p><p id="e6t8tv_14"><span class="control" id="e6t8tv_21">核心概念关系图：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1547.859375 268"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1547.859375" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="Elasticsearch数据层次结构" class="cluster"><rect height="252" width="1531.859375" y="8" x="8" style=""></rect><g transform="translate(678.953125, 8)" class="cluster-label"><foreignObject height="24" width="189.953125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Elasticsearch数据层次结构</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M215.93,70L225.941,70C235.953,70,255.977,70,273.121,70C290.266,70,304.531,70,318.13,70C331.729,70,344.661,70,351.128,70L357.594,70"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M495.031,70L509.297,70C523.563,70,552.094,70,574.656,70C597.219,70,613.813,70,629.74,70C645.667,70,660.927,70,668.557,70L676.188,70"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_2" d="M816.063,70L832.656,70C849.25,70,882.438,70,905.938,70C929.438,70,943.25,70,956.396,70C969.542,70,982.021,70,988.26,70L994.5,70"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_E_3" d="M1167.75,70L1181.563,70C1195.375,70,1223,70,1243.35,70C1263.699,70,1276.773,70,1289.181,70C1301.589,70,1313.329,70,1319.2,70L1325.07,70"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A1_B1_4" d="M238.5,186L244.75,186C251,186,263.5,186,272.875,186C282.25,186,288.5,186,294.083,186C299.667,186,304.583,186,307.042,186L309.5,186"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B1_C1_5" d="M543.125,186L549.375,186C555.625,186,568.125,186,577.5,186C586.875,186,593.125,186,598.708,186C604.292,186,609.208,186,611.667,186L614.125,186"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C1_D1_6" d="M878.125,186L884.375,186C890.625,186,903.125,186,912.5,186C921.875,186,928.125,186,933.708,186C939.292,186,944.208,186,946.667,186L949.125,186"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D1_E1_7" d="M1213.125,186L1219.375,186C1225.625,186,1238.125,186,1247.5,186C1256.875,186,1263.125,186,1268.708,186C1274.292,186,1279.208,186,1281.667,186L1284.125,186"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(142, 70)" id="flowchart-A-8462" class="node default"><rect height="54" width="147.859375" y="-27" x="-73.9296875" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-43.9296875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="87.859375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>集群 Cluster</p></span></div></foreignObject></g></g><g transform="translate(428.3125, 70)" id="flowchart-B-8463" class="node default"><rect height="54" width="133.4375" y="-27" x="-66.71875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-36.71875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="73.4375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>节点 Node</p></span></div></foreignObject></g></g><g transform="translate(748.125, 70)" id="flowchart-C-8465" class="node default"><rect height="54" width="135.875" y="-27" x="-67.9375" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-37.9375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="75.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>索引 Index</p></span></div></foreignObject></g></g><g transform="translate(1083.125, 70)" id="flowchart-D-8467" class="node default"><rect height="54" width="169.25" y="-27" x="-84.625" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-54.625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="109.25"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>文档 Document</p></span></div></foreignObject></g></g><g transform="translate(1395.2421875, 70)" id="flowchart-E-8469" class="node default"><rect height="54" width="132.34375" y="-27" x="-66.171875" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-36.171875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="72.34375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>字段 Field</p></span></div></foreignObject></g></g><g transform="translate(142, 186)" id="flowchart-A1-8470" class="node default"><rect height="54" width="193" y="-27" x="-96.5" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-66.5, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="133"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>production-cluster</p></span></div></foreignObject></g></g><g transform="translate(428.3125, 186)" id="flowchart-B1-8471" class="node default"><rect height="54" width="229.625" y="-27" x="-114.8125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-84.8125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="169.625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>node-1, node-2, node-3</p></span></div></foreignObject></g></g><g transform="translate(748.125, 186)" id="flowchart-C1-8473" class="node default"><rect height="78" width="260" y="-39" x="-130" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-100, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>user_index, order_index, log_index</p></span></div></foreignObject></g></g><g transform="translate(1083.125, 186)" id="flowchart-D1-8475" class="node default"><rect height="78" width="260" y="-39" x="-130" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-100, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>user_doc_1, user_doc_2, ...</p></span></div></foreignObject></g></g><g transform="translate(1395.2421875, 186)" id="flowchart-E1-8477" class="node default"><rect height="54" width="214.234375" y="-27" x="-107.1171875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-77.1171875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="154.234375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>name, age, email, ...</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="e6t8tv_16"><span class="control" id="e6t8tv_22">详细定义和特点：</span></p><ol class="list _decimal" id="e6t8tv_17" type="1"><li class="list__item" id="e6t8tv_23"><p id="e6t8tv_26"><span class="control" id="e6t8tv_28">Index（索引）</span></p><ul class="list _bullet" id="e6t8tv_27"><li class="list__item" id="e6t8tv_29"><p id="e6t8tv_32"><span class="control" id="e6t8tv_33">定义</span> ：文档的逻辑集合，类似于关系数据库中的&quot;数据库&quot;</p></li><li class="list__item" id="e6t8tv_30"><p id="e6t8tv_34"><span class="control" id="e6t8tv_36">特点</span>：</p><ul class="list _bullet" id="e6t8tv_35"><li class="list__item" id="e6t8tv_37"><p id="e6t8tv_40">每个索引有唯一的名称（必须小写）</p></li><li class="list__item" id="e6t8tv_38"><p id="e6t8tv_41">包含相同或相似结构的文档</p></li><li class="list__item" id="e6t8tv_39"><p id="e6t8tv_42">有自己的映射(mapping)和设置(settings)</p></li></ul></li><li class="list__item" id="e6t8tv_31"><p id="e6t8tv_43"><span class="control" id="e6t8tv_44">物理实现</span> ：由多个分片(shard)组成，分布在集群节点上</p></li></ul></li><li class="list__item" id="e6t8tv_24"><p id="e6t8tv_45"><span class="control" id="e6t8tv_47">Document（文档）</span></p><ul class="list _bullet" id="e6t8tv_46"><li class="list__item" id="e6t8tv_48"><p id="e6t8tv_51"><span class="control" id="e6t8tv_52">定义</span> ：ES中的基本数据单元，以JSON格式存储</p></li><li class="list__item" id="e6t8tv_49"><p id="e6t8tv_53"><span class="control" id="e6t8tv_55">特点</span>：</p><ul class="list _bullet" id="e6t8tv_54"><li class="list__item" id="e6t8tv_56"><p id="e6t8tv_59">具有唯一ID（自动生成或手动指定）</p></li><li class="list__item" id="e6t8tv_57"><p id="e6t8tv_60">包含一个或多个字段</p></li><li class="list__item" id="e6t8tv_58"><p id="e6t8tv_61">有版本号，支持乐观锁控制</p></li></ul></li><li class="list__item" id="e6t8tv_50"><p id="e6t8tv_62"><span class="control" id="e6t8tv_63">存储位置</span> ：根据路由算法分配到特定分片</p></li></ul></li><li class="list__item" id="e6t8tv_25"><p id="e6t8tv_64"><span class="control" id="e6t8tv_66">Field（字段）</span></p><ul class="list _bullet" id="e6t8tv_65"><li class="list__item" id="e6t8tv_67"><p id="e6t8tv_69"><span class="control" id="e6t8tv_70">定义</span> ：文档中的数据属性，键值对形式</p></li><li class="list__item" id="e6t8tv_68"><p id="e6t8tv_71"><span class="control" id="e6t8tv_73">特点</span>：</p><ul class="list _bullet" id="e6t8tv_72"><li class="list__item" id="e6t8tv_74"><p id="e6t8tv_77">支持多种数据类型（text、keyword、date、number等）</p></li><li class="list__item" id="e6t8tv_75"><p id="e6t8tv_78">可以有多个值（数组）</p></li><li class="list__item" id="e6t8tv_76"><p id="e6t8tv_79">支持嵌套和对象结构</p></li></ul></li></ul></li></ol><p id="e6t8tv_18"><span class="control" id="e6t8tv_80">实际示例：</span></p><div class="code-block" data-lang="json">
// 索引：user_index
{
  &quot;settings&quot;: {
    &quot;number_of_shards&quot;: 3,
    &quot;number_of_replicas&quot;: 1
  },
  &quot;mappings&quot;: {
    &quot;properties&quot;: {
      &quot;name&quot;: {&quot;type&quot;: &quot;text&quot;},
      &quot;age&quot;: {&quot;type&quot;: &quot;integer&quot;},
      &quot;email&quot;: {&quot;type&quot;: &quot;keyword&quot;},
      &quot;address&quot;: {
        &quot;type&quot;: &quot;object&quot;,
        &quot;properties&quot;: {
          &quot;city&quot;: {&quot;type&quot;: &quot;keyword&quot;},
          &quot;country&quot;: {&quot;type&quot;: &quot;keyword&quot;}
        }
      }
    }
  }
}

// 文档：user_doc_1
{
  &quot;_index&quot;: &quot;user_index&quot;,
  &quot;_id&quot;: &quot;1&quot;,
  &quot;_version&quot;: 1,
  &quot;_source&quot;: {
    &quot;name&quot;: &quot;张三&quot;,
    &quot;age&quot;: 25,
    &quot;email&quot;: &quot;zhangsan@example.com&quot;,
    &quot;address&quot;: {
      &quot;city&quot;: &quot;北京&quot;,
      &quot;country&quot;: &quot;中国&quot;
    },
    &quot;tags&quot;: [&quot;开发者&quot;, &quot;Java&quot;, &quot;Elasticsearch&quot;]
  }
}
</div></section><section class="chapter"><h3 id="q2-shard-replica" data-toc="q2-shard-replica">Q2: 什么是分片(Shard)和副本(Replica)？它们是如何工作的？</h3><p id="e6t8tv_81"><span class="control" id="e6t8tv_90">答案：</span></p><p id="e6t8tv_82"><span class="control" id="e6t8tv_91">分片和副本架构图：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1877.0625 274"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1877.0625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"><g data-look="classic" id="ES集群分片分布" class="cluster"><rect height="154" width="1861.0625" y="112" x="8" style=""></rect><g transform="translate(882.296875, 112)" class="cluster-label"><foreignObject height="24" width="112.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ES集群分片分布</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph2" class="cluster"><rect height="104" width="593.6875" y="137" x="28" style=""></rect><g transform="translate(299.9453125, 137)" class="cluster-label"><foreignObject height="24" width="49.796875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Node 3</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph1" class="cluster"><rect height="104" width="593.6875" y="137" x="641.6875" style=""></rect><g transform="translate(913.6328125, 137)" class="cluster-label"><foreignObject height="24" width="49.796875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Node 2</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph0" class="cluster"><rect height="104" width="593.6875" y="137" x="1255.375" style=""></rect><g transform="translate(1527.3203125, 137)" class="cluster-label"><foreignObject height="24" width="49.796875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Node 1</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_A_0" d="M863.102,45.276L945.171,52.23C1027.24,59.184,1191.378,73.092,1273.447,84.213C1355.516,95.333,1355.516,103.667,1355.516,112C1355.516,120.333,1355.516,128.667,1355.516,134.917C1355.516,141.167,1355.516,145.333,1355.516,148.833C1355.516,152.333,1355.516,155.167,1355.516,156.583L1355.516,158"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_D_1" d="M741.828,62L741.828,66.167C741.828,70.333,741.828,78.667,741.828,87C741.828,95.333,741.828,103.667,741.828,112C741.828,120.333,741.828,128.667,741.828,134.917C741.828,141.167,741.828,145.333,741.828,148.833C741.828,152.333,741.828,155.167,741.828,156.583L741.828,158"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_G_2" d="M620.555,45.276L538.486,52.23C456.417,59.184,292.279,73.092,210.21,84.213C128.141,95.333,128.141,103.667,128.141,112C128.141,120.333,128.141,128.667,128.141,134.917C128.141,141.167,128.141,145.333,128.141,148.833C128.141,152.333,128.141,155.167,128.141,156.583L128.141,158"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(1355.515625, 189)" id="flowchart-A-8629" class="node default"><rect height="54" width="130.28125" y="-27" x="-65.140625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-35.140625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="70.28125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>主分片 P0</p></span></div></foreignObject></g></g><g transform="translate(1544.0078125, 189)" id="flowchart-B-8630" class="node default"><rect height="54" width="146.703125" y="-27" x="-73.3515625" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-43.3515625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="86.703125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>副本分片 R1</p></span></div></foreignObject></g></g><g transform="translate(1740.7109375, 189)" id="flowchart-C-8631" class="node default"><rect height="54" width="146.703125" y="-27" x="-73.3515625" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-43.3515625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="86.703125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>副本分片 R2</p></span></div></foreignObject></g></g><g transform="translate(741.828125, 189)" id="flowchart-D-8632" class="node default"><rect height="54" width="130.28125" y="-27" x="-65.140625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-35.140625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="70.28125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>主分片 P1</p></span></div></foreignObject></g></g><g transform="translate(930.3203125, 189)" id="flowchart-E-8633" class="node default"><rect height="54" width="146.703125" y="-27" x="-73.3515625" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-43.3515625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="86.703125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>副本分片 R0</p></span></div></foreignObject></g></g><g transform="translate(1127.0234375, 189)" id="flowchart-F-8634" class="node default"><rect height="54" width="146.703125" y="-27" x="-73.3515625" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-43.3515625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="86.703125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>副本分片 R2</p></span></div></foreignObject></g></g><g transform="translate(128.140625, 189)" id="flowchart-G-8635" class="node default"><rect height="54" width="130.28125" y="-27" x="-65.140625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-35.140625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="70.28125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>主分片 P2</p></span></div></foreignObject></g></g><g transform="translate(316.6328125, 189)" id="flowchart-H-8636" class="node default"><rect height="54" width="146.703125" y="-27" x="-73.3515625" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-43.3515625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="86.703125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>副本分片 R0</p></span></div></foreignObject></g></g><g transform="translate(513.3359375, 189)" id="flowchart-I-8637" class="node default"><rect height="54" width="146.703125" y="-27" x="-73.3515625" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-43.3515625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="86.703125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>副本分片 R1</p></span></div></foreignObject></g></g><g transform="translate(741.828125, 35)" id="flowchart-J-8638" class="node default"><rect height="54" width="242.546875" y="-27" x="-121.2734375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-91.2734375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="182.546875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>索引: 3个主分片, 2个副本</p></span></div></foreignObject></g></g></g></g></g></svg><p id="e6t8tv_84"><span class="control" id="e6t8tv_92">分片(Shard)详解：</span></p><ol class="list _decimal" id="e6t8tv_85" type="1"><li class="list__item" id="e6t8tv_93"><p id="e6t8tv_95"><span class="control" id="e6t8tv_97">主分片(Primary Shard)</span></p><ul class="list _bullet" id="e6t8tv_96"><li class="list__item" id="e6t8tv_98"><p id="e6t8tv_101"><span class="control" id="e6t8tv_102">作用</span> ：数据的主要存储单元，每个文档只属于一个主分片</p></li><li class="list__item" id="e6t8tv_99"><p id="e6t8tv_103"><span class="control" id="e6t8tv_104">数量</span> ：创建索引时确定，后续无法修改</p></li><li class="list__item" id="e6t8tv_100"><p id="e6t8tv_105"><span class="control" id="e6t8tv_107">职责</span>：</p><ul class="list _bullet" id="e6t8tv_106"><li class="list__item" id="e6t8tv_108"><p id="e6t8tv_111">处理所有写入操作（创建、更新、删除）</p></li><li class="list__item" id="e6t8tv_109"><p id="e6t8tv_112">参与读取操作</p></li><li class="list__item" id="e6t8tv_110"><p id="e6t8tv_113">数据的权威来源</p></li></ul></li></ul></li><li class="list__item" id="e6t8tv_94"><p id="e6t8tv_114"><span class="control" id="e6t8tv_116">副本分片(Replica Shard)</span></p><ul class="list _bullet" id="e6t8tv_115"><li class="list__item" id="e6t8tv_117"><p id="e6t8tv_120"><span class="control" id="e6t8tv_121">作用</span> ：主分片的完整拷贝，提供冗余和读取能力</p></li><li class="list__item" id="e6t8tv_118"><p id="e6t8tv_122"><span class="control" id="e6t8tv_123">数量</span> ：可以动态调整</p></li><li class="list__item" id="e6t8tv_119"><p id="e6t8tv_124"><span class="control" id="e6t8tv_126">职责</span>：</p><ul class="list _bullet" id="e6t8tv_125"><li class="list__item" id="e6t8tv_127"><p id="e6t8tv_130">提供数据冗余，防止数据丢失</p></li><li class="list__item" id="e6t8tv_128"><p id="e6t8tv_131">分担读取负载</p></li><li class="list__item" id="e6t8tv_129"><p id="e6t8tv_132">主分片故障时可以被提升为主分片</p></li></ul></li></ul></li></ol><p id="e6t8tv_86"><span class="control" id="e6t8tv_133">分片路由算法：</span></p><div class="code-block" data-lang="java">
// 文档路由到分片的算法
shard = hash(routing_value) % number_of_primary_shards

// 默认情况下，routing_value是文档ID
// 也可以自定义routing参数
PUT /index/_doc/1?routing=user123
{
  &quot;user_id&quot;: &quot;user123&quot;,
  &quot;message&quot;: &quot;Hello World&quot;
}
</div><p id="e6t8tv_88"><span class="control" id="e6t8tv_134">分片工作流程：</span></p><svg aria-roledescription="sequence" role="graphics-document document" viewBox="-50 -10 850 1079" style="max-width: 850px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g><rect class="actor actor-bottom" ry="3" rx="3" name="Replica" height="65" width="150" stroke="#666" fill="#eaeaea" y="993" x="600"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1025.5" x="675"><tspan dy="0" x="675">副本分片</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Primary" height="65" width="150" stroke="#666" fill="#eaeaea" y="993" x="400"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1025.5" x="475"><tspan dy="0" x="475">主分片</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Coord" height="65" width="150" stroke="#666" fill="#eaeaea" y="993" x="200"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1025.5" x="275"><tspan dy="0" x="275">协调节点</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Client" height="65" width="150" stroke="#666" fill="#eaeaea" y="993" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1025.5" x="75"><tspan dy="0" x="75">客户端</tspan></text></g><g><line name="Replica" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="993" x2="675" y1="5" x1="675" id="actor283"></line><g id="root-283"><rect class="actor actor-top" ry="3" rx="3" name="Replica" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="600"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="675"><tspan dy="0" x="675">副本分片</tspan></text></g></g><g><line name="Primary" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="993" x2="475" y1="5" x1="475" id="actor282"></line><g id="root-282"><rect class="actor actor-top" ry="3" rx="3" name="Primary" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="400"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="475"><tspan dy="0" x="475">主分片</tspan></text></g></g><g><line name="Coord" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="993" x2="275" y1="5" x1="275" id="actor281"></line><g id="root-281"><rect class="actor actor-top" ry="3" rx="3" name="Coord" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="200"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="275"><tspan dy="0" x="275">协调节点</tspan></text></g></g><g><line name="Client" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="993" x2="75" y1="5" x1="75" id="actor280"></line><g id="root-280"><rect class="actor actor-top" ry="3" rx="3" name="Client" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="75"><tspan dy="0" x="75">客户端</tspan></text></g></g><g></g><defs><symbol height="24" width="24" id="computer"><path d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z" transform="scale(.5)"></path></symbol></defs><defs><symbol clip-rule="evenodd" fill-rule="evenodd" id="database"><path d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z" transform="scale(.5)"></path></symbol></defs><defs><symbol height="24" width="24" id="clock"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z" transform="scale(.5)"></path></symbol></defs><defs><marker orient="auto-start-reverse" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="7.9" id="arrowhead"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker refY="4.5" refX="4" orient="auto" markerHeight="8" markerWidth="15" id="crosshead"><path style="stroke-dasharray: 0, 0;" d="M 1,2 L 6,7 M 6,2 L 1,7" stroke-width="1pt" stroke="#000000" fill="none"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="15.5" id="filled-head"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="40" markerWidth="60" refY="15" refX="15" id="sequencenumber"><circle r="6" cy="15" cx="15"></circle></marker></defs><g><rect class="note" height="39" width="650" stroke="#666" fill="#EDF2AE" y="75" x="50"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="80" x="375"><tspan x="375">写入操作流程</tspan></text></g><g><rect class="note" height="39" width="650" stroke="#666" fill="#EDF2AE" y="568" x="50"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="573" x="375"><tspan x="375">读取操作流程</tspan></text></g><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="129" x="174">发送写入请求</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="162" x2="271" y1="162" x1="76"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="177" x="276">计算分片路由</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 276,210 C 336,200 336,240 276,230"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="255" x="374">转发到主分片</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="288" x2="471" y1="288" x1="276"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="303" x="476">写入数据</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 476,336 C 536,326 536,366 476,356"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="381" x="574">同步到副本分片</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="414" x2="671" y1="414" x1="476"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="429" x="577">确认写入成功</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="462" x2="479" y1="462" x1="674"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="477" x="377">返回写入结果</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="510" x2="279" y1="510" x1="474"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="525" x="177">返回响应</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="558" x2="79" y1="558" x1="274"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="622" x="174">发送查询请求</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="655" x2="271" y1="655" x1="76"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="670" x="374">查询主分片</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="703" x2="471" y1="703" x1="276"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="718" x="474">查询副本分片</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="751" x2="671" y1="751" x1="276"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="766" x="377">返回查询结果</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="799" x2="279" y1="799" x1="474"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="814" x="477">返回查询结果</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="847" x2="279" y1="847" x1="674"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="862" x="276">合并结果</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 276,895 C 336,885 336,925 276,915"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="940" x="177">返回最终结果</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="973" x2="79" y1="973" x1="274"></line></svg></section><section class="chapter"><h3 id="q3-es" data-toc="q3-es">Q3: 什么是倒排索引？ES是如何实现快速搜索的？</h3><p id="e6t8tv_135"><span class="control" id="e6t8tv_144">答案：</span></p><p id="e6t8tv_136"><span class="control" id="e6t8tv_145">倒排索引原理：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 656 418"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="656" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="subGraph0" class="cluster"><rect height="402" width="640" y="8" x="8" style=""></rect><g transform="translate(251.875, 8)" class="cluster-label"><foreignObject height="24" width="152.25"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>正向索引 vs 倒排索引</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M173,99.5L173,105.75C173,112,173,124.5,173,134.875C173,145.25,173,153.5,173,161.083C173,168.667,173,175.583,173,179.042L173,182.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_1" d="M483,99.5L483,105.75C483,112,483,124.5,483,133.875C483,143.25,483,149.5,483,155.083C483,160.667,483,165.583,483,168.042L483,170.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(173, 72.5)" id="flowchart-A-8835" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#ffcdd2 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>正向索引</p></span></div></foreignObject></g></g><g transform="translate(173, 273.5)" id="flowchart-B-8836" class="node default"><rect height="174" width="260" y="-87" x="-130" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-100, -72)" style="" class="label"><rect></rect><foreignObject height="144" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>文档1 → [elasticsearch, search, engine]<br>文档2 → [lucene, search, library]<br>文档3 → [elasticsearch, distributed]</p></span></div></foreignObject></g></g><g transform="translate(483, 72.5)" id="flowchart-C-8837" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>倒排索引</p></span></div></foreignObject></g></g><g transform="translate(483, 273.5)" id="flowchart-D-8838" class="node default"><rect height="198" width="260" y="-99" x="-130" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-100, -84)" style="" class="label"><rect></rect><foreignObject height="168" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>elasticsearch → [文档1, 文档3]<br>search → [文档1, 文档2]<br>engine → [文档1]<br>lucene → [文档2]<br>library → [文档2]<br>distributed → [文档3]</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="e6t8tv_138"><span class="control" id="e6t8tv_146">倒排索引结构详解：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1482.28125 492"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1482.28125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="倒排索引完整结构" class="cluster"><rect height="476" width="1466.28125" y="8" x="8" style=""></rect><g transform="translate(677.0390625, 8)" class="cluster-label"><foreignObject height="24" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>倒排索引完整结构</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M256.156,246L262.406,246C268.656,246,281.156,246,290.531,246C299.906,246,306.156,246,311.74,246C317.323,246,322.24,246,324.698,246L327.156,246"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M485.125,246L491.375,246C497.625,246,510.125,246,519.5,246C528.875,246,535.125,246,540.708,246C546.292,246,551.208,246,553.667,246L556.125,246"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_2" d="M692.877,219L712.078,200.167C731.278,181.333,769.678,143.667,792.003,124.833C814.328,106,820.578,106,826.161,106C831.745,106,836.661,106,839.12,106L841.578,106"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_3" d="M1047.023,246L1062.4,246C1077.776,246,1108.529,246,1127.03,246C1145.531,246,1151.781,246,1157.365,246C1162.948,246,1167.865,246,1170.323,246L1172.781,246"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_H_4" d="M1047.281,398L1062.615,398C1077.948,398,1108.615,398,1127.073,398C1145.531,398,1151.781,398,1157.365,398C1162.948,398,1167.865,398,1170.323,398L1172.781,398"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_E_5" d="M770.578,246L776.828,246C783.078,246,795.578,246,809.516,246C823.454,246,838.831,246,853.54,246C868.25,246,882.293,246,889.314,246L896.336,246"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_G_6" d="M690.704,273L710.267,293.833C729.829,314.667,768.954,356.333,796.182,377.167C823.411,398,838.745,398,853.411,398C868.078,398,882.078,398,889.078,398L896.078,398"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(150.828125, 246)" id="flowchart-A-8975" class="node default"><rect height="54" width="210.65625" y="-27" x="-105.328125" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-75.328125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="150.65625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>词典 Term Dictionary</p></span></div></foreignObject></g></g><g transform="translate(408.140625, 246)" id="flowchart-B-8976" class="node default"><rect height="126" width="153.96875" y="-63" x="-76.984375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-46.984375, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="93.96875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>elasticsearch<br>search<br>engine<br>lucene</p></span></div></foreignObject></g></g><g transform="translate(665.3515625, 246)" id="flowchart-C-8978" class="node default"><rect height="54" width="210.453125" y="-27" x="-105.2265625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-75.2265625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="150.453125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>倒排列表 Posting List</p></span></div></foreignObject></g></g><g transform="translate(973.6796875, 106)" id="flowchart-D-8980" class="node default"><rect height="126" width="256.203125" y="-63" x="-128.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-98.1015625, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="196.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>elasticsearch: <br>[文档1:位置1, 文档3:位置1]<br>search:<br>[文档1:位置2, 文档2:位置2]</p></span></div></foreignObject></g></g><g transform="translate(973.6796875, 246)" id="flowchart-E-8981" class="node default"><rect height="54" width="146.6875" y="-27" x="-73.34375" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-43.34375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="86.6875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>词频信息 TF</p></span></div></foreignObject></g></g><g transform="translate(1306.78125, 246)" id="flowchart-F-8982" class="node default"><rect height="102" width="260" y="-51" x="-130" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-100, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>elasticsearch在文档1中出现1次<br>search在文档1中出现1次</p></span></div></foreignObject></g></g><g transform="translate(973.6796875, 398)" id="flowchart-G-8983" class="node default"><rect height="54" width="147.203125" y="-27" x="-73.6015625" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-43.6015625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="87.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>文档频率 DF</p></span></div></foreignObject></g></g><g transform="translate(1306.78125, 398)" id="flowchart-H-8984" class="node default"><rect height="102" width="260" y="-51" x="-130" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-100, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>elasticsearch出现在2个文档中<br>search出现在2个文档中</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="e6t8tv_140"><span class="control" id="e6t8tv_147">ES搜索工作原理：</span></p><ol class="list _decimal" id="e6t8tv_141" type="1"><li class="list__item" id="e6t8tv_148"><p id="e6t8tv_151"><span class="control" id="e6t8tv_153">分析阶段（Analysis）</span></p><div class="code-block" data-lang="json">
// 原始文本
&quot;Elasticsearch is a powerful search engine&quot;

// 分析过程
{
  &quot;tokens&quot;: [
    {&quot;token&quot;: &quot;elasticsearch&quot;, &quot;position&quot;: 0},
    {&quot;token&quot;: &quot;is&quot;, &quot;position&quot;: 1},
    {&quot;token&quot;: &quot;a&quot;, &quot;position&quot;: 2},
    {&quot;token&quot;: &quot;powerful&quot;, &quot;position&quot;: 3},
    {&quot;token&quot;: &quot;search&quot;, &quot;position&quot;: 4},
    {&quot;token&quot;: &quot;engine&quot;, &quot;position&quot;: 5}
  ]
}
</div></li><li class="list__item" id="e6t8tv_149"><p id="e6t8tv_154"><span class="control" id="e6t8tv_156">查询阶段（Query）</span></p></li><li class="list__item" id="e6t8tv_150"><p id="e6t8tv_157"><span class="control" id="e6t8tv_159">相关性评分（TF-IDF算法）</span></p><div class="code-block" data-lang="bash">
# TF-IDF计算公式
score = TF(term) × IDF(term) × fieldNorm

# TF: 词频 = 词在文档中出现次数 / 文档总词数
# IDF: 逆文档频率 = log(总文档数 / 包含该词的文档数)
# fieldNorm: 字段长度归一化
</div></li></ol><p id="e6t8tv_142"><span class="control" id="e6t8tv_160">倒排索引优势：</span></p></section></section><section class="chapter"><h2 id="e6t8tv_6" data-toc="e6t8tv_6">🏗️ 架构设计</h2><section class="chapter"><h3 id="q4-es" data-toc="q4-es">Q4: ES集群中有哪些节点角色？它们各自的职责是什么？</h3><p id="e6t8tv_163"><span class="control" id="e6t8tv_170">答案：</span></p><p id="e6t8tv_164"><span class="control" id="e6t8tv_171">ES节点角色分类：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 589.265625 948"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="589.265625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="ES节点角色体系" class="cluster"><rect height="932" width="573.265625" y="8" x="8" style=""></rect><g transform="translate(238.3984375, 8)" class="cluster-label"><foreignObject height="24" width="112.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ES节点角色体系</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_A1_0" d="M276.484,94L287.57,94C298.656,94,320.828,94,335.335,94C349.842,94,356.685,94,362.861,94C369.036,94,374.546,94,377.3,94L380.055,94"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M277.195,246L288.163,246C299.13,246,321.065,246,335.158,246C349.25,246,355.5,246,361.083,246C366.667,246,371.583,246,374.042,246L376.5,246"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_2" d="M305.5,398L311.75,398C318,398,330.5,398,341.507,398C352.513,398,362.026,398,370.872,398C379.719,398,387.898,398,391.988,398L396.078,398"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_D1_3" d="M282.125,550L292.271,550C302.417,550,322.708,550,336.943,550C351.178,550,359.357,550,366.868,550C374.38,550,381.225,550,384.648,550L388.07,550"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_E1_4" d="M286.141,702L295.617,702C305.094,702,324.047,702,336.945,702C349.842,702,356.685,702,362.861,702C369.036,702,374.546,702,377.3,702L380.055,702"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_F_F1_5" d="M296.461,854L304.217,854C311.974,854,327.487,854,340,854C352.513,854,362.026,854,370.872,854C379.719,854,387.898,854,391.988,854L396.078,854"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(175.5, 94)" id="flowchart-A-9325" class="node default"><rect height="54" width="201.96875" y="-27" x="-100.984375" data-et="node" data-id="abc" style="fill:#ffcdd2 !important" class="basic label-container"></rect><g transform="translate(-70.984375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="141.96875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>主节点 Master Node</p></span></div></foreignObject></g></g><g transform="translate(462.1328125, 94)" id="flowchart-A1-9326" class="node default"><rect height="102" width="156.15625" y="-51" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>集群状态管理<br>分片分配决策<br>索引创建删除</p></span></div></foreignObject></g></g><g transform="translate(175.5, 246)" id="flowchart-B-9327" class="node default"><rect height="54" width="203.390625" y="-27" x="-101.6953125" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-71.6953125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="143.390625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>数据节点 Data Node</p></span></div></foreignObject></g></g><g transform="translate(462.1328125, 246)" id="flowchart-B1-9328" class="node default"><rect height="102" width="163.265625" y="-51" x="-81.6328125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-51.6328125, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="103.265625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>存储分片数据<br>执行CRUD操作<br>搜索和聚合</p></span></div></foreignObject></g></g><g transform="translate(175.5, 398)" id="flowchart-C-9329" class="node default"><rect height="78" width="260" y="-39" x="-130" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-100, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>协调节点 Coordinating Node</p></span></div></foreignObject></g></g><g transform="translate(462.1328125, 398)" id="flowchart-C1-9330" class="node default"><rect height="102" width="124.109375" y="-51" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>请求路由<br>结果聚合<br>负载均衡</p></span></div></foreignObject></g></g><g transform="translate(175.5, 550)" id="flowchart-D-9331" class="node default"><rect height="54" width="213.25" y="-27" x="-106.625" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-76.625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="153.25"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>摄取节点 Ingest Node</p></span></div></foreignObject></g></g><g transform="translate(462.1328125, 550)" id="flowchart-D1-9332" class="node default"><rect height="102" width="140.125" y="-51" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>数据预处理<br>管道处理<br>文档转换</p></span></div></foreignObject></g></g><g transform="translate(175.5, 702)" id="flowchart-E-9333" class="node default"><rect height="54" width="221.28125" y="-27" x="-110.640625" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-80.640625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="161.28125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>机器学习节点 ML Node</p></span></div></foreignObject></g></g><g transform="translate(462.1328125, 702)" id="flowchart-E1-9334" class="node default"><rect height="102" width="156.15625" y="-51" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>机器学习任务<br>异常检测<br>数据分析</p></span></div></foreignObject></g></g><g transform="translate(175.5, 854)" id="flowchart-F-9335" class="node default"><rect height="54" width="241.921875" y="-27" x="-120.9609375" data-et="node" data-id="abc" style="fill:#fce4ec !important" class="basic label-container"></rect><g transform="translate(-90.9609375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="181.921875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>转换节点 Transform Node</p></span></div></foreignObject></g></g><g transform="translate(462.1328125, 854)" id="flowchart-F1-9336" class="node default"><rect height="102" width="124.109375" y="-51" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>数据转换<br>连续处理<br>汇总任务</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="e6t8tv_166"><span class="control" id="e6t8tv_172">节点角色配置：</span></p><div class="code-block" data-lang="yaml">
# 主节点配置
node.name: master-node-1
node.roles: [master]
cluster.name: production-cluster
discovery.seed_hosts: [&quot;10.0.0.1&quot;, &quot;10.0.0.2&quot;, &quot;10.0.0.3&quot;]
cluster.initial_master_nodes: [&quot;master-node-1&quot;, &quot;master-node-2&quot;, &quot;master-node-3&quot;]

# 数据节点配置
node.name: data-node-1
node.roles: [data, data_content, data_hot, data_warm, data_cold]
cluster.name: production-cluster

# 协调节点配置
node.name: coordinating-node-1
node.roles: []  # 空角色表示只做协调
cluster.name: production-cluster

# 摄取节点配置
node.name: ingest-node-1
node.roles: [ingest]
cluster.name: production-cluster

# 混合节点配置（小型集群）
node.name: mixed-node-1
node.roles: [master, data, ingest]
cluster.name: small-cluster
</div><p id="e6t8tv_168"><span class="control" id="e6t8tv_173">企业级集群架构：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1587 970"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1587" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"><g data-look="classic" id="生产环境集群架构" class="cluster"><rect height="850" width="1571" y="112" x="8" style=""></rect><g transform="translate(729.3984375, 112)" class="cluster-label"><foreignObject height="24" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>生产环境集群架构</p></span></div></foreignObject></g></g><g data-look="classic" id="冷数据节点层" class="cluster"><rect height="598" width="215.171875" y="339" x="28" style=""></rect><g transform="translate(87.5078125, 339)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>冷数据节点层</p></span></div></foreignObject></g></g><g data-look="classic" id="温数据节点层" class="cluster"><rect height="598" width="428.0625" y="339" x="524.6875" style=""></rect><g transform="translate(690.640625, 339)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>温数据节点层</p></span></div></foreignObject></g></g><g data-look="classic" id="热数据节点层" class="cluster"><rect height="598" width="586.25" y="339" x="972.75" style=""></rect><g transform="translate(1217.796875, 339)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>热数据节点层</p></span></div></foreignObject></g></g><g data-look="classic" id="协调节点层" class="cluster"><rect height="152" width="1379.0390625" y="137" x="95.5859375" style=""></rect><g transform="translate(745.04296875, 137)" class="cluster-label"><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>协调节点层</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Client_C1_0" d="M1002.695,43.497L1046.559,50.748C1090.422,57.998,1178.148,72.499,1222.012,83.916C1265.875,95.333,1265.875,103.667,1265.875,112C1265.875,120.333,1265.875,128.667,1265.875,134.917C1265.875,141.167,1265.875,145.333,1265.875,148.833C1265.875,152.333,1265.875,155.167,1265.875,156.583L1265.875,158"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Client_C2_1" d="M899.883,43.497L856.02,50.748C812.156,57.998,724.43,72.499,680.566,83.916C636.703,95.333,636.703,103.667,636.703,112C636.703,120.333,636.703,128.667,636.703,134.917C636.703,141.167,636.703,145.333,636.703,148.833C636.703,152.333,636.703,155.167,636.703,156.583L636.703,158"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C1_H1_2" d="M1197.039,240.717L1177.053,248.764C1157.068,256.811,1117.096,272.906,1097.111,285.119C1077.125,297.333,1077.125,305.667,1077.125,314C1077.125,322.333,1077.125,330.667,1077.125,354.5C1077.125,378.333,1077.125,417.667,1077.125,456.333C1077.125,495,1077.125,533,1077.125,552L1077.125,571"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C1_H2_3" d="M1265.875,264L1265.875,268.167C1265.875,272.333,1265.875,280.667,1265.875,289C1265.875,297.333,1265.875,305.667,1265.875,314C1265.875,322.333,1265.875,330.667,1265.875,354.5C1265.875,378.333,1265.875,417.667,1265.875,456.333C1265.875,495,1265.875,533,1265.875,552L1265.875,571"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C1_H3_4" d="M1334.711,240.717L1354.697,248.764C1374.682,256.811,1414.654,272.906,1434.639,285.119C1454.625,297.333,1454.625,305.667,1454.625,314C1454.625,322.333,1454.625,330.667,1454.625,354.5C1454.625,378.333,1454.625,417.667,1454.625,456.333C1454.625,495,1454.625,533,1454.625,552L1454.625,571"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C2_W1_5" d="M636.703,264L636.703,268.167C636.703,272.333,636.703,280.667,636.703,289C636.703,297.333,636.703,305.667,636.703,314C636.703,322.333,636.703,330.667,636.703,354.5C636.703,378.333,636.703,417.667,636.703,456.333C636.703,495,636.703,533,636.703,552L636.703,571"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C2_W2_6" d="M705.539,238.641L728.072,247.034C750.604,255.427,795.669,272.214,818.202,284.773C840.734,297.333,840.734,305.667,840.734,314C840.734,322.333,840.734,330.667,840.734,354.5C840.734,378.333,840.734,417.667,840.734,456.333C840.734,495,840.734,533,840.734,552L840.734,571"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C2_COLD1_7" d="M567.867,223.44L495.82,234.366C423.773,245.293,279.68,267.147,207.633,282.24C135.586,297.333,135.586,305.667,135.586,314C135.586,322.333,135.586,330.667,135.586,354.5C135.586,378.333,135.586,417.667,135.586,456.333C135.586,495,135.586,533,135.586,552L135.586,571"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(270.171875, 356)" class="root"><g class="clusters"><g data-look="classic" id="Master专用节点层" class="cluster"><rect height="548" width="211.515625" y="8" x="8" style=""></rect><g transform="translate(49.859375, 8)" class="cluster-label"><foreignObject height="24" width="127.796875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Master专用节点层</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(113.7578125, 106)" id="flowchart-M1-9460" class="node default"><rect height="126" width="136.515625" y="-63" x="-68.2578125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-38.2578125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="76.515625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Master-1<br>CPU: 4核<br>RAM: 8GB<br>Disk: 50GB</p></span></div></foreignObject></g></g><g transform="translate(113.7578125, 282)" id="flowchart-M2-9461" class="node default"><rect height="126" width="136.515625" y="-63" x="-68.2578125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-38.2578125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="76.515625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Master-2<br>CPU: 4核<br>RAM: 8GB<br>Disk: 50GB</p></span></div></foreignObject></g></g><g transform="translate(113.7578125, 458)" id="flowchart-M3-9462" class="node default"><rect height="126" width="136.515625" y="-63" x="-68.2578125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-38.2578125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="76.515625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Master-3<br>CPU: 4核<br>RAM: 8GB<br>Disk: 50GB</p></span></div></foreignObject></g></g></g></g><g transform="translate(1265.875, 213)" id="flowchart-C1-9463" class="node default"><rect height="102" width="137.671875" y="-51" x="-68.8359375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-38.8359375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="77.671875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Coord-1<br>CPU: 8核<br>RAM: 16GB</p></span></div></foreignObject></g></g><g transform="translate(636.703125, 213)" id="flowchart-C2-9464" class="node default"><rect height="102" width="137.671875" y="-51" x="-68.8359375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-38.8359375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="77.671875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Coord-2<br>CPU: 8核<br>RAM: 16GB</p></span></div></foreignObject></g></g><g transform="translate(1077.125, 638)" id="flowchart-H1-9465" class="node default"><rect height="126" width="138.75" y="-63" x="-69.375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-39.375, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="78.75"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Hot-Data-1<br>CPU: 16核<br>RAM: 64GB<br>SSD: 2TB</p></span></div></foreignObject></g></g><g transform="translate(1265.875, 638)" id="flowchart-H2-9466" class="node default"><rect height="126" width="138.75" y="-63" x="-69.375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-39.375, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="78.75"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Hot-Data-2<br>CPU: 16核<br>RAM: 64GB<br>SSD: 2TB</p></span></div></foreignObject></g></g><g transform="translate(1454.625, 638)" id="flowchart-H3-9467" class="node default"><rect height="126" width="138.75" y="-63" x="-69.375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-39.375, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="78.75"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Hot-Data-3<br>CPU: 16核<br>RAM: 64GB<br>SSD: 2TB</p></span></div></foreignObject></g></g><g transform="translate(636.703125, 638)" id="flowchart-W1-9468" class="node default"><rect height="126" width="154.03125" y="-63" x="-77.015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-47.015625, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="94.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Warm-Data-1<br>CPU: 8核<br>RAM: 32GB<br>SATA: 4TB</p></span></div></foreignObject></g></g><g transform="translate(840.734375, 638)" id="flowchart-W2-9469" class="node default"><rect height="126" width="154.03125" y="-63" x="-77.015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-47.015625, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="94.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Warm-Data-2<br>CPU: 8核<br>RAM: 32GB<br>SATA: 4TB</p></span></div></foreignObject></g></g><g transform="translate(135.5859375, 638)" id="flowchart-COLD1-9470" class="node default"><rect height="126" width="145.171875" y="-63" x="-72.5859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-42.5859375, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="85.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Cold-Data-1<br>CPU: 4核<br>RAM: 16GB<br>SATA: 8TB</p></span></div></foreignObject></g></g><g transform="translate(951.2890625, 35)" id="flowchart-Client-9471" class="node default"><rect height="54" width="102.8125" y="-27" x="-51.40625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-21.40625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="42.8125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Client</p></span></div></foreignObject></g></g></g></g></g></svg></section><section class="chapter"><h3 id="q5-es" data-toc="q5-es">Q5: ES的写入流程是怎样的？如何保证数据一致性？</h3><p id="e6t8tv_174"><span class="control" id="e6t8tv_181">答案：</span></p><p id="e6t8tv_175"><span class="control" id="e6t8tv_182">ES写入流程详解：</span></p><svg aria-roledescription="sequence" role="graphics-document document" viewBox="-50 -10 1051 1563" style="max-width: 1051px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g><rect class="actor actor-bottom" ry="3" rx="3" name="FS" height="65" width="150" stroke="#666" fill="#eaeaea" y="1477" x="800"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1509.5" x="875"><tspan dy="0" x="875">文件系统</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Replica" height="65" width="150" stroke="#666" fill="#eaeaea" y="1477" x="600"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1509.5" x="675"><tspan dy="0" x="675">副本分片节点</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Primary" height="65" width="150" stroke="#666" fill="#eaeaea" y="1477" x="400"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1509.5" x="475"><tspan dy="0" x="475">主分片节点</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Coord" height="65" width="150" stroke="#666" fill="#eaeaea" y="1477" x="200"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1509.5" x="275"><tspan dy="0" x="275">协调节点</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Client" height="65" width="150" stroke="#666" fill="#eaeaea" y="1477" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1509.5" x="75"><tspan dy="0" x="75">客户端</tspan></text></g><g><line name="FS" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1477" x2="875" y1="5" x1="875" id="actor305"></line><g id="root-305"><rect class="actor actor-top" ry="3" rx="3" name="FS" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="800"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="875"><tspan dy="0" x="875">文件系统</tspan></text></g></g><g><line name="Replica" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1477" x2="675" y1="5" x1="675" id="actor304"></line><g id="root-304"><rect class="actor actor-top" ry="3" rx="3" name="Replica" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="600"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="675"><tspan dy="0" x="675">副本分片节点</tspan></text></g></g><g><line name="Primary" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1477" x2="475" y1="5" x1="475" id="actor303"></line><g id="root-303"><rect class="actor actor-top" ry="3" rx="3" name="Primary" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="400"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="475"><tspan dy="0" x="475">主分片节点</tspan></text></g></g><g><line name="Coord" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1477" x2="275" y1="5" x1="275" id="actor302"></line><g id="root-302"><rect class="actor actor-top" ry="3" rx="3" name="Coord" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="200"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="275"><tspan dy="0" x="275">协调节点</tspan></text></g></g><g><line name="Client" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1477" x2="75" y1="5" x1="75" id="actor301"></line><g id="root-301"><rect class="actor actor-top" ry="3" rx="3" name="Client" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="75"><tspan dy="0" x="75">客户端</tspan></text></g></g><g></g><defs><symbol height="24" width="24" id="computer"><path d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z" transform="scale(.5)"></path></symbol></defs><defs><symbol clip-rule="evenodd" fill-rule="evenodd" id="database"><path d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z" transform="scale(.5)"></path></symbol></defs><defs><symbol height="24" width="24" id="clock"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z" transform="scale(.5)"></path></symbol></defs><defs><marker orient="auto-start-reverse" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="7.9" id="arrowhead"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker refY="4.5" refX="4" orient="auto" markerHeight="8" markerWidth="15" id="crosshead"><path style="stroke-dasharray: 0, 0;" d="M 1,2 L 6,7 M 6,2 L 1,7" stroke-width="1pt" stroke="#000000" fill="none"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="15.5" id="filled-head"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="40" markerWidth="60" refY="15" refX="15" id="sequencenumber"><circle r="6" cy="15" cx="15"></circle></marker></defs><g><rect class="note" height="39" width="850" stroke="#666" fill="#EDF2AE" y="75" x="50"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="80" x="475"><tspan x="475">ES写入流程</tspan></text></g><g><line class="loopLine" y2="580" x2="886" y1="580" x1="391"></line><line class="loopLine" y2="1108" x2="886" y1="580" x1="886"></line><line class="loopLine" y2="1108" x2="886" y1="1108" x1="391"></line><line class="loopLine" y2="1108" x2="391" y1="580" x1="391"></line><line style="stroke-dasharray: 3, 3;" class="loopLine" y2="834" x2="886" y1="834" x1="391"></line><polygon class="labelBox" points="391,580 441,580 441,593 432.6,600 391,600"></polygon><text style="font-size: 16px; font-weight: 400;" class="labelText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="593" x="416">par</text><text style="font-size: 16px; font-weight: 400;" class="loopText" text-anchor="middle" y="598" x="663.5"><tspan x="663.5">[副本写入]</tspan></text><text style="font-size: 16px; font-weight: 400;" class="loopText" text-anchor="middle" y="852" x="638.5">[主分片刷新]</text></g><g><rect class="note" height="39" width="450" stroke="#666" fill="#EDF2AE" y="1214" x="450"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1219" x="675"><tspan x="675">后台异步操作</tspan></text></g><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="129" x="174">1. 发送索引请求</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="162" x2="271" y1="162" x1="76"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="177" x="276">2. 解析请求，确定路由</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 276,210 C 336,200 336,240 276,230"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="255" x="374">3. 转发到主分片</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="288" x2="471" y1="288" x1="276"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="303" x="476">4. 验证请求</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 476,336 C 536,326 536,366 476,356"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="381" x="476">5. 写入内存缓冲区</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 476,414 C 536,404 536,444 476,434"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="459" x="476">6. 写入translog</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 476,492 C 536,482 536,522 476,512"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="537" x="574">7. 并行复制到副本</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="570" x2="671" y1="570" x1="476"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="630" x="676">8a. 写入内存缓冲区</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 676,663 C 736,653 736,693 676,683"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="708" x="676">9a. 写入translog</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 676,741 C 736,731 736,771 676,761"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="786" x="577">10a. 确认写入成功</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="819" x2="479" y1="819" x1="674"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="879" x="476">8b. 定期refresh</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 476,912 C 536,902 536,942 476,932"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="957" x="674">9b. 内存数据写入文件系统缓存</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="990" x2="871" y1="990" x1="476"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1005" x="476">10b. 更新搜索可见性</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 476,1038 C 536,1028 536,1068 476,1058"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1123" x="377">11. 返回写入结果</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="1156" x2="279" y1="1156" x1="474"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1171" x="177">12. 返回响应</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="1204" x2="79" y1="1204" x1="274"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1268" x="674">13. flush操作（定期）</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="1301" x2="871" y1="1301" x1="476"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1316" x="876">14. fsync到磁盘</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 876,1349 C 936,1339 936,1379 876,1369"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1394" x="476">15. 清理translog</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 476,1427 C 536,1417 536,1457 476,1447"></path></svg><p id="e6t8tv_177"><span class="control" id="e6t8tv_183">数据一致性保证机制：</span></p><ol class="list _decimal" id="e6t8tv_178" type="1"><li class="list__item" id="e6t8tv_184"><p id="e6t8tv_187"><span class="control" id="e6t8tv_189">写入一致性等级</span></p><div class="code-block" data-lang="bash">
# 写入一致性配置
PUT /my_index/_doc/1?wait_for_active_shards=2
{
  &quot;title&quot;: &quot;Elasticsearch Document&quot;,
  &quot;content&quot;: &quot;This is a test document&quot;
}

# 可选值：
# 1: 只需要主分片确认（默认）
# all: 需要所有分片（主+副本）确认
# 数字: 需要指定数量的分片确认
</div></li><li class="list__item" id="e6t8tv_185"><p id="e6t8tv_190"><span class="control" id="e6t8tv_192">版本控制机制</span></p><div class="code-block" data-lang="bash">
# 乐观锁控制
PUT /my_index/_doc/1?version=1&amp;version_type=external
{
  &quot;title&quot;: &quot;Updated Document&quot;
}

# 内部版本控制
PUT /my_index/_doc/1?if_seq_no=5&amp;if_primary_term=1
{
  &quot;title&quot;: &quot;Updated with sequence number&quot;
}
</div></li><li class="list__item" id="e6t8tv_186"><p id="e6t8tv_193"><span class="control" id="e6t8tv_195">Translog事务日志</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 903.796875 174"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="903.796875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M115.256,114L122.232,118.167C129.207,122.333,143.158,130.667,152.217,134.833C161.276,139,165.443,139,168.943,139C172.443,139,175.276,139,176.693,139L178.109,139"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_C_1" d="M115.256,60L122.232,55.833C129.207,51.667,143.158,43.333,153.101,39.167C163.044,35,168.979,35,174.247,35C179.516,35,184.117,35,186.418,35L188.719,35"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_2" d="M311.625,35L317.56,35C323.495,35,335.365,35,343.615,35C351.865,35,356.495,35,360.458,35C364.422,35,367.719,35,369.367,35L371.016,35"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_E_3" d="M322.234,139L326.401,139C330.568,139,338.901,139,345.151,139C351.401,139,355.568,139,359.068,139C362.568,139,365.401,139,366.818,139L368.234,139"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_4" d="M517.922,139L522.089,139C526.255,139,534.589,139,540.839,139C547.089,139,551.255,139,554.755,139C558.255,139,561.089,139,562.505,139L563.922,139"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_F_G_5" d="M737.719,139L741.885,139C746.052,139,754.385,139,760.635,139C766.885,139,771.052,139,774.552,139C778.052,139,780.885,139,782.302,139L783.719,139"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(70.0546875, 87)" id="flowchart-A-9762" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>写入请求</p></span></div></foreignObject></g></g><g transform="translate(252.171875, 139)" id="flowchart-B-9763" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>内存缓冲区</p></span></div></foreignObject></g></g><g transform="translate(252.171875, 35)" id="flowchart-C-9765" class="node default"><rect height="54" width="118.90625" y="-27" x="-59.453125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-29.453125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="58.90625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Translog</p></span></div></foreignObject></g></g><g transform="translate(445.078125, 35)" id="flowchart-D-9767" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>磁盘持久化</p></span></div></foreignObject></g></g><g transform="translate(445.078125, 139)" id="flowchart-E-9769" class="node default"><rect height="54" width="145.6875" y="-27" x="-72.84375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-42.84375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="85.6875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>定期Refresh</p></span></div></foreignObject></g></g><g transform="translate(652.8203125, 139)" id="flowchart-F-9771" class="node default"><rect height="54" width="169.796875" y="-27" x="-84.8984375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-54.8984375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="109.796875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>段文件Segment</p></span></div></foreignObject></g></g><g transform="translate(841.7578125, 139)" id="flowchart-G-9773" class="node default"><rect height="54" width="108.078125" y="-27" x="-54.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>可搜索</p></span></div></foreignObject></g></g></g></g></g></svg></li></ol><p id="e6t8tv_179"><span class="control" id="e6t8tv_196">数据恢复机制：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 616.5 382"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="616.5" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M94.086,62L94.086,66.167C94.086,70.333,94.086,78.667,94.086,84.917C94.086,91.167,94.086,95.333,94.086,98.833C94.086,102.333,94.086,105.167,94.086,106.583L94.086,108"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M94.086,166L94.086,170.167C94.086,174.333,94.086,182.667,94.086,188.917C94.086,195.167,94.086,199.333,94.086,202.833C94.086,206.333,94.086,209.167,94.086,210.583L94.086,212"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_2" d="M94.086,270L94.086,274.167C94.086,278.333,94.086,286.667,94.086,292.917C94.086,299.167,94.086,303.333,94.086,306.833C94.086,310.333,94.086,313.167,94.086,314.583L94.086,316"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_3" d="M308.25,62L308.25,66.167C308.25,70.333,308.25,78.667,308.25,84.917C308.25,91.167,308.25,95.333,308.25,98.833C308.25,102.333,308.25,105.167,308.25,106.583L308.25,108"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_F_G_4" d="M308.25,166L308.25,170.167C308.25,174.333,308.25,182.667,308.25,188.917C308.25,195.167,308.25,199.333,308.25,202.833C308.25,206.333,308.25,209.167,308.25,210.583L308.25,212"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_H_5" d="M308.25,270L308.25,274.167C308.25,278.333,308.25,286.667,308.25,292.917C308.25,299.167,308.25,303.333,308.25,306.833C308.25,310.333,308.25,313.167,308.25,314.583L308.25,316"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_J_6" d="M522.414,62L522.414,66.167C522.414,70.333,522.414,78.667,522.414,84.917C522.414,91.167,522.414,95.333,522.414,98.833C522.414,102.333,522.414,105.167,522.414,106.583L522.414,108"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_K_7" d="M522.414,166L522.414,170.167C522.414,174.333,522.414,182.667,522.414,188.917C522.414,195.167,522.414,199.333,522.414,202.833C522.414,206.333,522.414,209.167,522.414,210.583L522.414,212"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_K_L_8" d="M522.414,270L522.414,274.167C522.414,278.333,522.414,286.667,522.414,292.917C522.414,299.167,522.414,303.333,522.414,306.833C522.414,310.333,522.414,313.167,522.414,314.583L522.414,316"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(94.0859375, 35)" id="flowchart-A-9905" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>节点重启</p></span></div></foreignObject></g></g><g transform="translate(94.0859375, 139)" id="flowchart-B-9906" class="node default"><rect height="54" width="150.953125" y="-27" x="-75.4765625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-45.4765625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="90.953125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>读取Translog</p></span></div></foreignObject></g></g><g transform="translate(94.0859375, 243)" id="flowchart-C-9908" class="node default"><rect height="54" width="172.171875" y="-27" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>重放未提交操作</p></span></div></foreignObject></g></g><g transform="translate(94.0859375, 347)" id="flowchart-D-9910" class="node default"><rect height="54" width="172.171875" y="-27" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>恢复到最新状态</p></span></div></foreignObject></g></g><g transform="translate(308.25, 35)" id="flowchart-E-9911" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>主分片丢失</p></span></div></foreignObject></g></g><g transform="translate(308.25, 139)" id="flowchart-F-9912" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>选择副本分片</p></span></div></foreignObject></g></g><g transform="translate(308.25, 243)" id="flowchart-G-9914" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>提升为主分片</p></span></div></foreignObject></g></g><g transform="translate(308.25, 347)" id="flowchart-H-9916" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>继续提供服务</p></span></div></foreignObject></g></g><g transform="translate(522.4140625, 35)" id="flowchart-I-9917" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>数据损坏</p></span></div></foreignObject></g></g><g transform="translate(522.4140625, 139)" id="flowchart-J-9918" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>从副本分片</p></span></div></foreignObject></g></g><g transform="translate(522.4140625, 243)" id="flowchart-K-9920" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>重新同步数据</p></span></div></foreignObject></g></g><g transform="translate(522.4140625, 347)" id="flowchart-L-9922" class="node default"><rect height="54" width="172.171875" y="-27" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>恢复数据完整性</p></span></div></foreignObject></g></g></g></g></g></svg></section></section><section class="chapter"><h2 id="e6t8tv_7" data-toc="e6t8tv_7">🔄 数据模型</h2><section class="chapter"><h3 id="q6-es" data-toc="q6-es">Q6: ES的文档模型有什么特点？如何处理关联关系？</h3><p id="e6t8tv_198"><span class="control" id="e6t8tv_205">答案：</span></p><p id="e6t8tv_199"><span class="control" id="e6t8tv_206">ES文档模型特点：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 549.25 644"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="549.25" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="ES文档模型特性" class="cluster"><rect height="628" width="533.25" y="8" x="8" style=""></rect><g transform="translate(218.390625, 8)" class="cluster-label"><foreignObject height="24" width="112.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ES文档模型特性</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_A1_0" d="M207.258,94L213.715,94C220.172,94,233.086,94,244.671,94C256.257,94,266.513,94,276.103,94C285.693,94,294.616,94,299.077,94L303.539,94"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M208.5,246L214.75,246C221,246,233.5,246,242.875,246C252.25,246,258.5,246,264.083,246C269.667,246,274.583,246,277.042,246L279.5,246"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_2" d="M189.055,398L198.546,398C208.036,398,227.018,398,240.302,398C253.586,398,261.172,398,268.091,398C275.01,398,281.263,398,284.389,398L287.516,398"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_D1_3" d="M189.055,550L198.546,550C208.036,550,227.018,550,240.969,550C254.921,550,263.841,550,272.095,550C280.349,550,287.936,550,291.73,550L295.523,550"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(127, 94)" id="flowchart-A-10056" class="node default"><rect height="54" width="160.515625" y="-27" x="-80.2578125" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-50.2578125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="100.515625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>JSON文档结构</p></span></div></foreignObject></g></g><g transform="translate(393.625, 94)" id="flowchart-A1-10057" class="node default"><rect height="102" width="172.171875" y="-51" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>灵活的数据结构<br>支持嵌套对象<br>动态类型推断</p></span></div></foreignObject></g></g><g transform="translate(127, 246)" id="flowchart-B-10058" class="node default"><rect height="54" width="163" y="-27" x="-81.5" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-51.5, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="103"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>无Schema限制</p></span></div></foreignObject></g></g><g transform="translate(393.625, 246)" id="flowchart-B1-10059" class="node default"><rect height="102" width="220.25" y="-51" x="-110.125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-80.125, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="160.25"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>字段可动态添加<br>不同文档可有不同字段<br>映射可自动生成</p></span></div></foreignObject></g></g><g transform="translate(127, 398)" id="flowchart-C-10060" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>平铺存储</p></span></div></foreignObject></g></g><g transform="translate(393.625, 398)" id="flowchart-C1-10061" class="node default"><rect height="102" width="204.21875" y="-51" x="-102.109375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-72.109375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="144.21875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>所有字段在同一层级<br>便于索引和搜索<br>避免JOIN操作</p></span></div></foreignObject></g></g><g transform="translate(127, 550)" id="flowchart-D-10062" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>版本控制</p></span></div></foreignObject></g></g><g transform="translate(393.625, 550)" id="flowchart-D1-10063" class="node default"><rect height="102" width="188.203125" y="-51" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>每个文档有版本号<br>支持乐观锁<br>并发更新控制</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="e6t8tv_201"><span class="control" id="e6t8tv_207">处理关联关系的方法：</span></p><ol class="list _decimal" id="e6t8tv_202" type="1"><li class="list__item" id="e6t8tv_208"><p id="e6t8tv_212"><span class="control" id="e6t8tv_214">嵌套对象(Nested Objects)</span></p><div class="code-block" data-lang="json">
// 用户和订单的嵌套关系
{
  &quot;user_id&quot;: &quot;123&quot;,
  &quot;name&quot;: &quot;张三&quot;,
  &quot;orders&quot;: [
    {
      &quot;order_id&quot;: &quot;order_001&quot;,
      &quot;amount&quot;: 299.99,
      &quot;status&quot;: &quot;completed&quot;,
      &quot;items&quot;: [
        {&quot;product&quot;: &quot;手机&quot;, &quot;quantity&quot;: 1},
        {&quot;product&quot;: &quot;保护套&quot;, &quot;quantity&quot;: 1}
      ]
    },
    {
      &quot;order_id&quot;: &quot;order_002&quot;, 
      &quot;amount&quot;: 159.99,
      &quot;status&quot;: &quot;pending&quot;
    }
  ]
}

// 嵌套查询
GET /users/_search
{
  &quot;query&quot;: {
    &quot;nested&quot;: {
      &quot;path&quot;: &quot;orders&quot;,
      &quot;query&quot;: {
        &quot;bool&quot;: {
          &quot;must&quot;: [
            {&quot;term&quot;: {&quot;orders.status&quot;: &quot;completed&quot;}},
            {&quot;range&quot;: {&quot;orders.amount&quot;: {&quot;gte&quot;: 200}}}
          ]
        }
      }
    }
  }
}
</div></li><li class="list__item" id="e6t8tv_209"><p id="e6t8tv_215"><span class="control" id="e6t8tv_217">父子关系(Parent-Child)</span></p><div class="code-block" data-lang="json">
// 定义父子关系映射
PUT /my_index
{
  &quot;mappings&quot;: {
    &quot;properties&quot;: {
      &quot;join_field&quot;: {
        &quot;type&quot;: &quot;join&quot;,
        &quot;relations&quot;: {
          &quot;user&quot;: &quot;order&quot;
        }
      }
    }
  }
}

// 插入父文档
PUT /my_index/_doc/user_123
{
  &quot;name&quot;: &quot;张三&quot;,
  &quot;email&quot;: &quot;zhangsan@example.com&quot;,
  &quot;join_field&quot;: &quot;user&quot;
}

// 插入子文档
PUT /my_index/_doc/order_001?routing=user_123
{
  &quot;order_id&quot;: &quot;order_001&quot;,
  &quot;amount&quot;: 299.99,
  &quot;join_field&quot;: {
    &quot;name&quot;: &quot;order&quot;,
    &quot;parent&quot;: &quot;user_123&quot;
  }
}

// 父子查询
GET /my_index/_search
{
  &quot;query&quot;: {
    &quot;has_child&quot;: {
      &quot;type&quot;: &quot;order&quot;,
      &quot;query&quot;: {
        &quot;range&quot;: {
          &quot;amount&quot;: {&quot;gte&quot;: 200}
        }
      }
    }
  }
}
</div></li><li class="list__item" id="e6t8tv_210"><p id="e6t8tv_218"><span class="control" id="e6t8tv_220">数据反规范化(Denormalization)</span></p><div class="code-block" data-lang="json">
// 将关联数据冗余存储
{
  &quot;order_id&quot;: &quot;order_001&quot;,
  &quot;amount&quot;: 299.99,
  &quot;user&quot;: {
    &quot;user_id&quot;: &quot;123&quot;,
    &quot;name&quot;: &quot;张三&quot;,
    &quot;email&quot;: &quot;zhangsan@example.com&quot;
  },
  &quot;product&quot;: {
    &quot;product_id&quot;: &quot;prod_456&quot;,
    &quot;name&quot;: &quot;智能手机&quot;,
    &quot;category&quot;: &quot;电子产品&quot;
  }
}
</div></li><li class="list__item" id="e6t8tv_211"><p id="e6t8tv_221"><span class="control" id="e6t8tv_223">应用层Join</span></p><div class="code-block" data-lang="json">
// 第一步：查询用户
GET /users/_search
{
  &quot;query&quot;: {&quot;term&quot;: {&quot;name&quot;: &quot;张三&quot;}}
}

// 第二步：根据用户ID查询订单
GET /orders/_search
{
  &quot;query&quot;: {&quot;term&quot;: {&quot;user_id&quot;: &quot;123&quot;}}
}
</div></li></ol><p id="e6t8tv_203"><span class="control" id="e6t8tv_224">关联关系方法对比：</span></p><div class="table-wrapper"><table class="wide" id="e6t8tv_204"><thead><tr class="ijRowHead" id="e6t8tv_225"><th id="e6t8tv_230"><p>方法</p></th><th id="e6t8tv_231"><p>优点</p></th><th id="e6t8tv_232"><p>缺点</p></th><th id="e6t8tv_233"><p>适用场景</p></th></tr></thead><tbody><tr id="e6t8tv_226"><td id="e6t8tv_234"><p><span class="control" id="e6t8tv_238">嵌套对象</span></p></td><td id="e6t8tv_235"><p>查询性能好，数据一致性强</p></td><td id="e6t8tv_236"><p>更新复杂，文档大小限制</p></td><td id="e6t8tv_237"><p>一对多关系，子对象不独立查询</p></td></tr><tr id="e6t8tv_227"><td id="e6t8tv_239"><p><span class="control" id="e6t8tv_243">父子关系</span></p></td><td id="e6t8tv_240"><p>独立更新，灵活性高</p></td><td id="e6t8tv_241"><p>查询性能较差，复杂度高</p></td><td id="e6t8tv_242"><p>一对多关系，子对象需独立管理</p></td></tr><tr id="e6t8tv_228"><td id="e6t8tv_244"><p><span class="control" id="e6t8tv_248">数据反规范化</span></p></td><td id="e6t8tv_245"><p>查询简单，性能最好</p></td><td id="e6t8tv_246"><p>数据冗余，一致性维护难</p></td><td id="e6t8tv_247"><p>读多写少，关联数据变化不频繁</p></td></tr><tr id="e6t8tv_229"><td id="e6t8tv_249"><p><span class="control" id="e6t8tv_253">应用层Join</span></p></td><td id="e6t8tv_250"><p>灵活性最高，逻辑清晰</p></td><td id="e6t8tv_251"><p>网络开销大，事务性差</p></td><td id="e6t8tv_252"><p>复杂关联关系，对一致性要求不高</p></td></tr></tbody></table></div></section></section><section class="chapter"><h2 id="e6t8tv_8" data-toc="e6t8tv_8">💡 面试技巧</h2><section class="chapter"><h3 id="e6t8tv_254" data-toc="e6t8tv_254">高频考点</h3><ol class="list _decimal" id="e6t8tv_256" type="1"><li class="list__item" id="e6t8tv_257"><p id="e6t8tv_262"><span class="control" id="e6t8tv_263">核心概念理解</span> ：Index、Document、Shard、Replica的关系和作用</p></li><li class="list__item" id="e6t8tv_258"><p id="e6t8tv_264"><span class="control" id="e6t8tv_265">倒排索引原理</span> ：ES快速搜索的核心技术原理</p></li><li class="list__item" id="e6t8tv_259"><p id="e6t8tv_266"><span class="control" id="e6t8tv_267">节点角色分工</span> ：各种节点角色的职责和适用场景</p></li><li class="list__item" id="e6t8tv_260"><p id="e6t8tv_268"><span class="control" id="e6t8tv_269">写入流程机制</span> ：数据写入的完整流程和一致性保证</p></li><li class="list__item" id="e6t8tv_261"><p id="e6t8tv_270"><span class="control" id="e6t8tv_271">关联关系处理</span> ：不同关联关系处理方法的选择</p></li></ol></section><section class="chapter"><h3 id="e6t8tv_255" data-toc="e6t8tv_255">回答策略</h3><ol class="list _decimal" id="e6t8tv_272" type="1"><li class="list__item" id="e6t8tv_275"><p id="e6t8tv_279"><span class="control" id="e6t8tv_280">概念对比</span> ：通过与关系数据库对比说明ES概念</p></li><li class="list__item" id="e6t8tv_276"><p id="e6t8tv_281"><span class="control" id="e6t8tv_282">图解说明</span> ：用架构图清楚展示ES的分布式特性</p></li><li class="list__item" id="e6t8tv_277"><p id="e6t8tv_283"><span class="control" id="e6t8tv_284">实际场景</span> ：结合具体业务场景说明技术选择</p></li><li class="list__item" id="e6t8tv_278"><p id="e6t8tv_285"><span class="control" id="e6t8tv_286">性能考虑</span> ：说明不同方案的性能特点和适用场景</p></li></ol><p id="e6t8tv_274"><span class="control" id="e6t8tv_287">学习建议</span> ：ES基础概念是深入学习ES的基础，建议通过实际搭建ES集群、创建索引、插入文档来加深理解，特别要重视分布式特性和倒排索引原理的掌握。</p></section></section><div class="last-modified">09 六月 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="es面试大纲.html" class="navigation-links__prev">Elasticsearch面试大纲</a><a href="es索引管理qa.html" class="navigation-links__next">ES索引管理QA</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>