<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-06-10T01:18:22.6791533"><title>ESæ€§èƒ½ä¼˜åŒ–QA | æŠ€æœ¯çŸ¥è¯†åº“</title><script type="application/json" id="virtual-toc-data">[{"id":"-8j71d4_4","level":0,"title":"ğŸ“‹ çŸ¥è¯†ç»“æ„","anchor":"#-8j71d4_4"},{"id":"-8j71d4_5","level":0,"title":"ğŸš€ ç´¢å¼•ä¼˜åŒ–","anchor":"#-8j71d4_5"},{"id":"-8j71d4_6","level":0,"title":"ğŸ” æŸ¥è¯¢ä¼˜åŒ–","anchor":"#-8j71d4_6"},{"id":"-8j71d4_7","level":0,"title":"ğŸ–¥ï¸ ç¡¬ä»¶è°ƒä¼˜","anchor":"#-8j71d4_7"},{"id":"-8j71d4_8","level":0,"title":"ğŸ’¡ é¢è¯•æŠ€å·§","anchor":"#-8j71d4_8"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="ESæ€§èƒ½ä¼˜åŒ–QA | æŠ€æœ¯çŸ¥è¯†åº“"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="æŠ€æœ¯çŸ¥è¯†åº“ Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/esæ€§èƒ½ä¼˜åŒ–qa.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="ESæ€§èƒ½ä¼˜åŒ–QA | æŠ€æœ¯çŸ¥è¯†åº“"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/esæ€§èƒ½ä¼˜åŒ–qa.html#webpage",
    "url": "writerside-documentation/esæ€§èƒ½ä¼˜åŒ–qa.html",
    "name": "ESæ€§èƒ½ä¼˜åŒ–QA | æŠ€æœ¯çŸ¥è¯†åº“",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "æŠ€æœ¯çŸ¥è¯†åº“ Help"
}</script><!-- End Schema.org --></head><body data-id="ESæ€§èƒ½ä¼˜åŒ–QA" data-main-title="ESæ€§èƒ½ä¼˜åŒ–QA" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="ESé¢è¯•å¤§çº².md|Elasticsearché¢è¯•å¤§çº²"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>æŠ€æœ¯çŸ¥è¯†åº“  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="ESæ€§èƒ½ä¼˜åŒ–QA" id="ESæ€§èƒ½ä¼˜åŒ–QA.md">ESæ€§èƒ½ä¼˜åŒ–QA</h1><p id="-8j71d4_3">æœ¬æ–‡æ¡£æ·±å…¥è§£æElasticsearchçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œæ¶µç›–ç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–ã€ç¡¬ä»¶è°ƒä¼˜ã€ç›‘æ§è¿ç»´ç­‰æ€§èƒ½æå‡çš„æ ¸å¿ƒæŠ€èƒ½ã€‚</p><section class="chapter"><h2 id="-8j71d4_4" data-toc="-8j71d4_4">ğŸ“‹ çŸ¥è¯†ç»“æ„</h2><svg aria-roledescription="mindmap" role="graphics-document document" viewBox="5 5 748.4818115234375 451.661376953125" style="max-width: 748.4818115234375px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g></g><g class="mindmap-edges"><path class="edge section-edge-0 edge-depth-1" d="M 535.3842905568109,217.40779916349422 L 567.0148537578943,189.87469501691393 L598.6454169589778,162.34159087033365"></path><path class="edge section-edge-0 edge-depth-1" d="M 516.3917971375402,214.37051173881244 L 500.1792718227482,187.1630690210591 L483.96674650795626,159.95562630330576"></path><path class="edge section-edge-0 edge-depth-1" d="M 536.7711718013487,235.23656881652903 L 578.3534967963933,261.3637979613258 L619.9358217914379,287.4910271061226"></path><path class="edge section-edge-0 edge-depth-1" d="M 539.0530386866436,226.538592151848 L 604.4960165372279,223.40401929870583 L669.9389943878122,220.26944644556366"></path><path class="edge section-edge-0 edge-depth-0" d="M 374.2272010011304,232.15632536003469 L 441.6527152948763,229.95141079642607 L509.0782295886222,227.74649623281746"></path><path class="edge section-edge-1 edge-depth-1" d="M 361.69916604196317,343.3162029053202 L 326.40599746621274,369.4918475472151 L291.1128288904623,395.66749218911"></path><path class="edge section-edge-1 edge-depth-1" d="M 388.5071555818122,331.70780947061405 L 440.3595027337716,322.31812724922304 L492.211849885731,312.928445027832"></path><path class="edge section-edge-1 edge-depth-1" d="M 377.24914986101754,348.96610048999685 L 384.95746449887463,381.0709876801616 L392.6657791367317,413.1758748703263"></path><path class="edge section-edge-1 edge-depth-1" d="M 387.5792460145799,340.1836029095404 L 444.94270344068013,364.2494279575159 L502.3061608667804,388.31525300549134"></path><path class="edge section-edge-1 edge-depth-0" d="M 361.35346811614585,247.4962658465576 L 366.49121049976713,283.5136002557988 L371.6289528833884,319.5309346650399"></path><path class="edge section-edge-2 edge-depth-1" d="M 187.92124367374188,283.67461524633546 L 130.06497224970997,295.962889398211 L72.20870082567805,308.2511635500866"></path><path class="edge section-edge-2 edge-depth-1" d="M 200.24087236222385,265.7439490762115 L 195.7730008951345,237.6154859932226 L191.30512942804512,209.48702291023363"></path><path class="edge section-edge-2 edge-depth-1" d="M 195.8190093920826,293.94106831061623 L 180.59278356206664,324.0181137390131 L165.3665577320507,354.0951591674099"></path><path class="edge section-edge-2 edge-depth-1" d="M 188.61366743358465,275.12207453613223 L 132.8616463381241,253.4431850510457 L77.10962524266355,231.76429556595912"></path><path class="edge section-edge-2 edge-depth-0" d="M 344.8911969539497,237.03397056692876 L 280.9145800898852,256.6024099719894 L216.93796322582068,276.17084937705005"></path><path class="edge section-edge-3 edge-depth-1" d="M 321.47513483067786,121.24852028239644 L 285.8585842924142,92.01891385115388 L250.24203375415055,62.789307419911324"></path><path class="edge section-edge-3 edge-depth-1" d="M 346.6453918520272,124.38338384795667 L 402.21795629677547,98.26132403929532 L457.7905207415237,72.13926423063397"></path><path class="edge section-edge-3 edge-depth-1" d="M 318.12238051727724,129.5156809763438 L 262.08455439131734,124.83442822610365 L206.04672826535744,120.15317547586352"></path><path class="edge section-edge-3 edge-depth-1" d="M 336.28636945628347,116.11321504515732 L 343.70158424773035,82.33219603848127 L351.11679903917724,48.55117703180521"></path><path class="edge section-edge-3 edge-depth-0" d="M 355.5040640368507,218.11804428072418 L 346.1527645759121,181.70548883478384 L336.8014651149735,145.2929333888435"></path></g><g class="mindmap-nodes"><g transform="translate(308.54239729045787, 213.74658559260513)" class="mindmap-node section--1 section-root"><g transform="translate(50.69281768798828, 18.9)"><circle r="50.69281768798828" class="node-bkg node-circle" id="node-0"></circle></g><g transform="translate(50.69281768798828, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ESæ€§èƒ½ä¼˜åŒ–</tspan></tspan></text></g></g></g><g transform="translate(481.0342163132108, 208.356236000247)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-1"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ç´¢å¼•ä¼˜åŒ–</tspan></tspan></text></g></g></g><g transform="translate(330.7112067229924, 315.4806149189924)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-6"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">æŸ¥è¯¢ä¼˜åŒ–</tspan></tspan></text></g></g></g><g transform="translate(160.03925770132423, 261.6582343513737)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-11"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ç¡¬ä»¶è°ƒä¼˜</tspan></tspan></text></g></g></g><g transform="translate(291.01562667337805, 111.86439207696253)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-16"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ç›‘æ§è¿ç»´</tspan></tspan></text></g></g></g><g transform="translate(567.9048044044822, 133.59315403358084)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-2"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">å†™å…¥æ€§èƒ½</tspan></tspan></text></g></g></g><g transform="translate(433.2523287360942, 128.16990204187118)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-3"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">åˆ†ç‰‡è®¾è®¡</tspan></tspan></text></g></g></g><g transform="translate(590.1007786833844, 276.57135992240467)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-4"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">æ˜ å°„ä¼˜åŒ–</tspan></tspan></text></g></g></g><g transform="translate(626.3618160898583, 200.65180259716465)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h107.12000274658203 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-5"></path><line y2="37.8" x2="117.12000274658203" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(58.560001373291016, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ç”Ÿå‘½å‘¨æœŸç®¡ç†</tspan></tspan></text></g></g></g><g transform="translate(236.51010141133736, 385.7030801754379)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-7"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">æŸ¥è¯¢ç»“æ„</tspan></tspan></text></g></g></g><g transform="translate(464.43580014835936, 291.35563957945374)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-8"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ç¼“å­˜ç­–ç•¥</tspan></tspan></text></g></g></g><g transform="translate(353.13172367856544, 408.8613604413308)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-9"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">åˆ†é¡µä¼˜åŒ–</tspan></tspan></text></g></g></g><g transform="translate(473.10220156217645, 375.2182409960394)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-10"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">èšåˆä¼˜åŒ–</tspan></tspan></text></g></g></g><g transform="translate(15, 292.46754444504836)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-12"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">å†…å­˜é…ç½®</tspan></tspan></text></g></g></g><g transform="translate(145.91605729084904, 175.7727376350714)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-13"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ç£ç›˜ä¼˜åŒ–</tspan></tspan></text></g></g></g><g transform="translate(116.05562262471335, 348.5779931266525)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-14"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ç½‘ç»œä¼˜åŒ–</tspan></tspan></text></g></g></g><g transform="translate(22.147753389230616, 207.42813575071762)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h71.96318817138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-15"></path><line y2="37.8" x2="81.96318817138672" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(40.98159408569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">CPUé…ç½®</tspan></tspan></text></g></g></g><g transform="translate(195.61085511335466, 34.37343562534522)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-17"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">æ€§èƒ½æŒ‡æ ‡</tspan></tspan></text></g></g></g><g transform="translate(428.3295991220772, 46.8582560016281)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-18"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ç“¶é¢ˆåˆ†æ</tspan></tspan></text></g></g></g><g transform="translate(148.54410710925663, 100.00446437524477)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-19"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">å®¹é‡è§„åˆ’</tspan></tspan></text></g></g></g><g transform="translate(311.77816682208265, 15)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-20"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">è°ƒä¼˜å·¥å…·</tspan></tspan></text></g></g></g></g></svg></section><section class="chapter"><h2 id="-8j71d4_5" data-toc="-8j71d4_5">ğŸš€ ç´¢å¼•ä¼˜åŒ–</h2><section class="chapter"><h3 id="q1-es" data-toc="q1-es">Q1: å¦‚ä½•ä¼˜åŒ–ESçš„å†™å…¥æ€§èƒ½ï¼Ÿæœ‰å“ªäº›å…³é”®é…ç½®å‚æ•°ï¼Ÿ</h3><p id="-8j71d4_12"><span class="control" id="-8j71d4_22">ç­”æ¡ˆï¼š</span></p><p id="-8j71d4_13"><span class="control" id="-8j71d4_23">ESå†™å…¥æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 497.453125 740"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="497.453125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="ESå†™å…¥æ€§èƒ½ä¼˜åŒ–" class="cluster"><rect height="724" width="481.453125" y="8" x="8" style=""></rect><g transform="translate(192.4921875, 8)" class="cluster-label"><foreignObject height="24" width="112.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ESå†™å…¥æ€§èƒ½ä¼˜åŒ–</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_A1_0" d="M201.656,106L207.906,106C214.156,106,226.656,106,236.829,106C247.001,106,254.846,106,262.025,106C269.203,106,275.715,106,278.971,106L282.227,106"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M201.656,282L207.906,282C214.156,282,226.656,282,236.031,282C245.406,282,251.656,282,257.24,282C262.823,282,267.74,282,270.198,282L272.656,282"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_2" d="M185.633,458L194.553,458C203.474,458,221.315,458,233.491,458C245.667,458,252.177,458,258.021,458C263.865,458,269.042,458,271.63,458L274.219,458"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_D1_3" d="M185.633,634L194.553,634C203.474,634,221.315,634,235.493,634C249.672,634,260.188,634,270.036,634C279.885,634,289.068,634,293.659,634L298.25,634"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(123.578125, 106)" id="flowchart-A-7063" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ‰¹é‡å†™å…¥ä¼˜åŒ–</p></span></div></foreignObject></g></g><g transform="translate(364.3046875, 106)" id="flowchart-A1-7064" class="node default"><rect height="126" width="156.15625" y="-63" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>bulk APIä½¿ç”¨<br>åˆç†æ‰¹æ¬¡å¤§å°<br>å¹¶å‘æ§åˆ¶<br>é”™è¯¯å¤„ç†</p></span></div></foreignObject></g></g><g transform="translate(123.578125, 282)" id="flowchart-B-7065" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ç´¢å¼•é…ç½®ä¼˜åŒ–</p></span></div></foreignObject></g></g><g transform="translate(364.3046875, 282)" id="flowchart-B1-7066" class="node default"><rect height="126" width="175.296875" y="-63" x="-87.6484375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-57.6484375, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="115.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>refreshé—´éš”è°ƒæ•´<br>å‰¯æœ¬æ•°é‡æ§åˆ¶<br>åˆå¹¶ç­–ç•¥ä¼˜åŒ–<br>translogé…ç½®</p></span></div></foreignObject></g></g><g transform="translate(123.578125, 458)" id="flowchart-C-7067" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ˜ å°„ä¼˜åŒ–</p></span></div></foreignObject></g></g><g transform="translate(364.3046875, 458)" id="flowchart-C1-7068" class="node default"><rect height="126" width="172.171875" y="-63" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ç¦ç”¨ä¸å¿…è¦å­—æ®µ<br>ä¼˜åŒ–å­—æ®µç±»å‹<br>å…³é—­åŠ¨æ€æ˜ å°„<br>åˆç†è®¾ç½®åˆ†æå™¨</p></span></div></foreignObject></g></g><g transform="translate(123.578125, 634)" id="flowchart-D-7069" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ç¡¬ä»¶ä¼˜åŒ–</p></span></div></foreignObject></g></g><g transform="translate(364.3046875, 634)" id="flowchart-D1-7070" class="node default"><rect height="126" width="124.109375" y="-63" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>SSDç£ç›˜<br>è¶³å¤Ÿå†…å­˜<br>å¤šæ ¸CPU<br>ç½‘ç»œå¸¦å®½</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-8j71d4_15"><span class="control" id="-8j71d4_24">æ‰¹é‡å†™å…¥ä¼˜åŒ–ï¼š</span></p><div class="code-block" data-lang="json">
// ä¼˜åŒ–çš„bulkè¯·æ±‚
POST /_bulk
{ &quot;index&quot;: { &quot;_index&quot;: &quot;logs&quot;, &quot;_id&quot;: &quot;1&quot; } }
{ &quot;timestamp&quot;: &quot;2023-12-01T10:00:00Z&quot;, &quot;level&quot;: &quot;INFO&quot;, &quot;message&quot;: &quot;Application started&quot; }
{ &quot;index&quot;: { &quot;_index&quot;: &quot;logs&quot;, &quot;_id&quot;: &quot;2&quot; } }
{ &quot;timestamp&quot;: &quot;2023-12-01T10:01:00Z&quot;, &quot;level&quot;: &quot;ERROR&quot;, &quot;message&quot;: &quot;Database connection failed&quot; }

// æ‰¹é‡å¤§å°ä¼˜åŒ–å»ºè®®
{
  &quot;bulk_size&quot;: {
    &quot;documents&quot;: &quot;1000-5000 docs&quot;,
    &quot;size&quot;: &quot;5-15MB&quot;,
    &quot;reasoning&quot;: &quot;å¹³è¡¡å†…å­˜ä½¿ç”¨å’Œç½‘ç»œå¼€é”€&quot;
  },
  &quot;concurrent_requests&quot;: {
    &quot;number&quot;: &quot;CPUæ ¸å¿ƒæ•°&quot;,
    &quot;max&quot;: &quot;2 * CPUæ ¸å¿ƒæ•°&quot;
  }
}
</div><p id="-8j71d4_17"><span class="control" id="-8j71d4_25">ç´¢å¼•å†™å…¥é…ç½®ä¼˜åŒ–ï¼š</span></p><div class="code-block" data-lang="yaml">
# elasticsearch.yml - å†™å…¥æ€§èƒ½é…ç½®
# çº¿ç¨‹æ± é…ç½®
thread_pool:
  write:
    size: 8                    # å†™å…¥çº¿ç¨‹æ•°
    queue_size: 1000          # é˜Ÿåˆ—å¤§å°
  
# ç´¢å¼•è®¾ç½®ä¼˜åŒ–
indices:
  memory:
    index_buffer_size: 30%    # ç´¢å¼•ç¼“å†²åŒºå¤§å°
    min_index_buffer_size: 96mb
    max_index_buffer_size: 512mb
</div><div class="code-block" data-lang="json">
// ç´¢å¼•çº§åˆ«å†™å…¥ä¼˜åŒ–
PUT /high_write_index
{
  &quot;settings&quot;: {
    // åˆ·æ–°ç­–ç•¥ä¼˜åŒ–
    &quot;refresh_interval&quot;: &quot;30s&quot;,        // é™ä½åˆ·æ–°é¢‘ç‡
    &quot;number_of_replicas&quot;: 0,          // å†™å…¥æ—¶å…ˆè®¾ç½®ä¸º0
    
    // åˆå¹¶ç­–ç•¥ä¼˜åŒ–
    &quot;merge.policy.max_merge_at_once&quot;: 30,
    &quot;merge.policy.segments_per_tier&quot;: 30,
    &quot;merge.scheduler.max_thread_count&quot;: 1,
    
    // Translogä¼˜åŒ–
    &quot;translog.durability&quot;: &quot;async&quot;,   // å¼‚æ­¥æŒä¹…åŒ–
    &quot;translog.sync_interval&quot;: &quot;5s&quot;,   // åŒæ­¥é—´éš”
    &quot;translog.flush_threshold_size&quot;: &quot;1gb&quot;,
    
    // ç´¢å¼•ç¼“å†²åŒº
    &quot;indices.memory.index_buffer_size&quot;: &quot;30%&quot;
  }
}

// å†™å…¥å®Œæˆåè°ƒæ•´é…ç½®
PUT /high_write_index/_settings
{
  &quot;refresh_interval&quot;: &quot;1s&quot;,
  &quot;number_of_replicas&quot;: 1
}
</div><p id="-8j71d4_20"><span class="control" id="-8j71d4_26">å†™å…¥æ¨¡å¼ä¼˜åŒ–ï¼š</span></p><div class="code-block" data-lang="java">
// Javaå®¢æˆ·ç«¯å†™å…¥ä¼˜åŒ–ç¤ºä¾‹
public class ElasticsearchBulkWriter {
    private final ElasticsearchClient client;
    private final BulkProcessor bulkProcessor;
    
    public ElasticsearchBulkWriter() {
        this.bulkProcessor = BulkProcessor.builder(
            (request, bulkListener) -&gt; 
                client.bulk(request, RequestOptions.DEFAULT, bulkListener)
        )
        .setBulkActions(1000)                    // æ‰¹æ¬¡å¤§å°
        .setBulkSize(new ByteSizeValue(15, ByteSizeUnit.MB))  // æ‰¹æ¬¡å­—èŠ‚å¤§å°
        .setFlushInterval(TimeValue.timeValueSeconds(5))      // åˆ·æ–°é—´éš”
        .setConcurrentRequests(0)                // åŒæ­¥æ‰§è¡Œ
        .setBackoffPolicy(BackoffPolicy.exponentialBackoff(
            TimeValue.timeValueMillis(100), 3)) // é‡è¯•ç­–ç•¥
        .build();
    }
    
    public void addDocument(String index, String id, Object document) {
        IndexRequest request = new IndexRequest(index)
            .id(id)
            .source(convertToJson(document), XContentType.JSON);
        bulkProcessor.add(request);
    }
}
</div></section><section class="chapter"><h3 id="q2-es" data-toc="q2-es">Q2: å¦‚ä½•ä¼˜åŒ–ESç´¢å¼•çš„å­˜å‚¨å’Œåˆ†ç‰‡ç­–ç•¥ï¼Ÿ</h3><p id="-8j71d4_27"><span class="control" id="-8j71d4_36">ç­”æ¡ˆï¼š</span></p><p id="-8j71d4_28"><span class="control" id="-8j71d4_37">åˆ†ç‰‡è®¾è®¡ç­–ç•¥ï¼š</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1549.328125 531.125" height="531.125" class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1549.328125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="åˆ†ç‰‡è®¾è®¡å†³ç­–æ ‘" class="cluster"><rect height="515.125" width="1533.328125" y="8" x="8" style=""></rect><g transform="translate(718.578125, 8)" class="cluster-label"><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>åˆ†ç‰‡è®¾è®¡å†³ç­–æ ‘</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M274.906,99.5L274.906,105.75C274.906,112,274.906,124.5,274.948,133.917C274.99,143.333,275.073,149.667,275.147,155.333C275.222,161,275.288,166,275.321,168.5L275.354,171"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M236.872,270.591L214.268,287.18C191.665,303.769,146.457,336.947,123.854,358.661C101.25,380.375,101.25,390.625,101.25,400.208C101.25,409.792,101.25,418.708,101.25,423.167L101.25,427.625"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_D_2" d="M275.406,309.125L275.323,319.292C275.24,329.458,275.073,349.792,274.99,365.083C274.906,380.375,274.906,390.625,274.906,400.208C274.906,409.792,274.906,418.708,274.906,423.167L274.906,427.625"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_E_3" d="M316.347,268.185L343.022,285.175C369.697,302.165,423.048,336.145,449.723,358.26C476.398,380.375,476.398,390.625,476.398,400.208C476.398,409.792,476.398,418.708,476.398,423.167L476.398,427.625"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_F_G_4" d="M817.668,99.5L817.668,105.75C817.668,112,817.668,124.5,817.668,137.214C817.668,149.927,817.668,162.854,817.668,175.115C817.668,187.375,817.668,198.969,817.668,204.766L817.668,210.563"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_H_5" d="M792.656,268.563L776.975,285.49C761.294,302.417,729.932,336.271,714.251,358.323C698.57,380.375,698.57,390.625,698.57,400.208C698.57,409.792,698.57,418.708,698.57,423.167L698.57,427.625"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_I_6" d="M839.315,268.563L852.886,285.49C866.457,302.417,893.6,336.271,907.171,358.323C920.742,380.375,920.742,390.625,920.742,400.208C920.742,409.792,920.742,418.708,920.742,423.167L920.742,427.625"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_K_7" d="M1281.578,99.5L1281.578,105.75C1281.578,112,1281.578,124.5,1281.62,134.584C1281.661,144.668,1281.745,152.336,1281.821,159.337C1281.897,166.339,1281.966,172.673,1282,175.841L1282.035,179.008"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_K_L_8" d="M1248.754,267.793L1226.475,284.849C1204.196,301.904,1159.637,336.014,1137.357,358.195C1115.078,380.375,1115.078,390.625,1115.078,400.208C1115.078,409.792,1115.078,418.708,1115.078,423.167L1115.078,427.625"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_K_M_9" d="M1282.078,301.117L1281.995,312.618C1281.911,324.12,1281.745,347.122,1281.661,363.749C1281.578,380.375,1281.578,390.625,1281.578,400.208C1281.578,409.792,1281.578,418.708,1281.578,423.167L1281.578,427.625"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_K_N_10" d="M1315.402,267.793L1337.515,284.849C1359.627,301.904,1403.853,336.014,1425.965,358.195C1448.078,380.375,1448.078,390.625,1448.078,400.208C1448.078,409.792,1448.078,418.708,1448.078,423.167L1448.078,427.625"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(101.25, 370.125)" class="edgeLabel"><g transform="translate(-20.8046875, -12)" class="label"><foreignObject height="24" width="41.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>&lt; 1GB</p></span></div></foreignObject></g></g><g transform="translate(274.90625, 370.125)" class="edgeLabel"><g transform="translate(-35.5, -12)" class="label"><foreignObject height="24" width="71"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>1GB-50GB</p></span></div></foreignObject></g></g><g transform="translate(476.3984375, 370.125)" class="edgeLabel"><g transform="translate(-100, -24)" class="label"><foreignObject height="48" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">Unsupported markdown: blockquote</span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(1115.078125, 370.125)" class="edgeLabel"><g transform="translate(-24.0390625, -12)" class="label"><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>é«˜å¯ç”¨</p></span></div></foreignObject></g></g><g transform="translate(1281.578125, 370.125)" class="edgeLabel"><g transform="translate(-16.03125, -12)" class="label"><foreignObject height="24" width="32.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>å‡è¡¡</p></span></div></foreignObject></g></g><g transform="translate(1448.078125, 370.125)" class="edgeLabel"><g transform="translate(-24.0390625, -12)" class="label"><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>é«˜æ€§èƒ½</p></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(274.90625, 72.5)" id="flowchart-A-7295" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ç¡®å®šæ•°æ®è§„æ¨¡</p></span></div></foreignObject></g></g><g transform="translate(274.90625, 241.5625)" id="flowchart-B-7296" class="node default"><polygon transform="translate(-67.0625,67.0625)" class="label-container" points="67.0625,0 134.125,-67.0625 67.0625,-134.125 0,-67.0625"></polygon><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>é¢„æœŸæ•°æ®é‡</p></span></div></foreignObject></g></g><g transform="translate(101.25, 458.625)" id="flowchart-C-7298" class="node default"><rect height="54" width="116.5" y="-27" x="-58.25" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-28.25, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="56.5"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>1ä¸ªåˆ†ç‰‡</p></span></div></foreignObject></g></g><g transform="translate(274.90625, 458.625)" id="flowchart-D-7300" class="node default"><rect height="54" width="130.8125" y="-27" x="-65.40625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-35.40625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="70.8125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>2-5ä¸ªåˆ†ç‰‡</p></span></div></foreignObject></g></g><g transform="translate(476.3984375, 458.625)" id="flowchart-E-7302" class="node default"><rect height="54" width="172.171875" y="-27" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ ¹æ®èŠ‚ç‚¹æ•°è®¾è®¡</p></span></div></foreignObject></g></g><g transform="translate(817.66796875, 72.5)" id="flowchart-F-7303" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>åˆ†ç‰‡å¤§å°åŸåˆ™</p></span></div></foreignObject></g></g><g transform="translate(817.66796875, 241.5625)" id="flowchart-G-7304" class="node default"><rect height="54" width="151.53125" y="-27" x="-75.765625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-45.765625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="91.53125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>20-40GBæœ€ä½³</p></span></div></foreignObject></g></g><g transform="translate(698.5703125, 458.625)" id="flowchart-H-7306" class="node default"><rect height="54" width="172.171875" y="-27" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>é¿å…è¿‡å¤šå°åˆ†ç‰‡</p></span></div></foreignObject></g></g><g transform="translate(920.7421875, 458.625)" id="flowchart-I-7308" class="node default"><rect height="54" width="172.171875" y="-27" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>é¿å…è¿‡å°‘å¤§åˆ†ç‰‡</p></span></div></foreignObject></g></g><g transform="translate(1281.578125, 72.5)" id="flowchart-J-7309" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å‰¯æœ¬ç­–ç•¥</p></span></div></foreignObject></g></g><g transform="translate(1281.578125, 241.5625)" id="flowchart-K-7310" class="node default"><polygon transform="translate(-59.0546875,59.0546875)" class="label-container" points="59.0546875,0 118.109375,-59.0546875 59.0546875,-118.109375 0,-59.0546875"></polygon><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ä¸šåŠ¡éœ€æ±‚</p></span></div></foreignObject></g></g><g transform="translate(1115.078125, 458.625)" id="flowchart-L-7312" class="node default"><rect height="54" width="116.5" y="-27" x="-58.25" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-28.25, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="56.5"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>2ä¸ªå‰¯æœ¬</p></span></div></foreignObject></g></g><g transform="translate(1281.578125, 458.625)" id="flowchart-M-7314" class="node default"><rect height="54" width="116.5" y="-27" x="-58.25" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-28.25, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="56.5"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>1ä¸ªå‰¯æœ¬</p></span></div></foreignObject></g></g><g transform="translate(1448.078125, 458.625)" id="flowchart-N-7316" class="node default"><rect height="54" width="116.5" y="-27" x="-58.25" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-28.25, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="56.5"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>0ä¸ªå‰¯æœ¬</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-8j71d4_30"><span class="control" id="-8j71d4_38">åˆ†ç‰‡è®¡ç®—å…¬å¼ï¼š</span></p><div class="code-block" data-lang="bash">
# åˆ†ç‰‡æ•°é‡è®¡ç®—
åˆ†ç‰‡æ•° = é¢„æœŸæ•°æ®é‡ / ç›®æ ‡åˆ†ç‰‡å¤§å°
ç›®æ ‡åˆ†ç‰‡å¤§å° = 20-40GB

# ç¤ºä¾‹è®¡ç®—
æ•°æ®é‡: 500GB
ç›®æ ‡åˆ†ç‰‡å¤§å°: 30GB
å»ºè®®åˆ†ç‰‡æ•°: 500GB / 30GB â‰ˆ 17ä¸ªåˆ†ç‰‡

# èŠ‚ç‚¹æ•°è€ƒè™‘
åˆ†ç‰‡æ•°åº”è¯¥æ˜¯èŠ‚ç‚¹æ•°çš„å€æ•°ï¼Œä¾¿äºå‡åŒ€åˆ†å¸ƒ
å¦‚æœæœ‰6ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œå¯ä»¥è®¾ç½®18ä¸ªåˆ†ç‰‡ï¼ˆæ¯ä¸ªèŠ‚ç‚¹3ä¸ªåˆ†ç‰‡ï¼‰
</div><p id="-8j71d4_32"><span class="control" id="-8j71d4_39">ç´¢å¼•æ¨¡æ¿ä¼˜åŒ–ï¼š</span></p><div class="code-block" data-lang="json">
// æ—¶é—´åºåˆ—æ•°æ®ç´¢å¼•æ¨¡æ¿
PUT _index_template/logs_template
{
  &quot;index_patterns&quot;: [&quot;logs-*&quot;],
  &quot;priority&quot;: 100,
  &quot;template&quot;: {
    &quot;settings&quot;: {
      &quot;number_of_shards&quot;: 3,
      &quot;number_of_replicas&quot;: 1,
      
      // ç”Ÿå‘½å‘¨æœŸç®¡ç†
      &quot;index.lifecycle.name&quot;: &quot;logs_policy&quot;,
      &quot;index.lifecycle.rollover_alias&quot;: &quot;logs-current&quot;,
      
      // å­˜å‚¨ä¼˜åŒ–
      &quot;codec&quot;: &quot;best_compression&quot;,      // æœ€ä½³å‹ç¼©
      &quot;index.store.type&quot;: &quot;hybridfs&quot;,   // æ··åˆæ–‡ä»¶ç³»ç»Ÿ
      
      // ç´¢å¼•æ’åºï¼ˆæé«˜å‹ç¼©ç‡ï¼‰
      &quot;index.sort.field&quot;: [&quot;timestamp&quot;, &quot;_id&quot;],
      &quot;index.sort.order&quot;: [&quot;desc&quot;, &quot;asc&quot;]
    },
    &quot;mappings&quot;: {
      &quot;properties&quot;: {
        &quot;timestamp&quot;: {
          &quot;type&quot;: &quot;date&quot;,
          &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss||epoch_millis&quot;
        },
        &quot;level&quot;: {&quot;type&quot;: &quot;keyword&quot;},
        &quot;message&quot;: {
          &quot;type&quot;: &quot;text&quot;,
          &quot;index&quot;: false,           // ä¸éœ€è¦æœç´¢çš„å­—æ®µ
          &quot;doc_values&quot;: false
        }
      }
    }
  }
}
</div><p id="-8j71d4_34"><span class="control" id="-8j71d4_40">ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆILMï¼‰ï¼š</span></p><div class="code-block" data-lang="json">
// å®Œæ•´çš„ILMç­–ç•¥
PUT /_ilm/policy/logs_policy
{
  &quot;policy&quot;: {
    &quot;phases&quot;: {
      &quot;hot&quot;: {
        &quot;actions&quot;: {
          &quot;rollover&quot;: {
            &quot;max_size&quot;: &quot;50gb&quot;,
            &quot;max_age&quot;: &quot;1d&quot;,
            &quot;max_docs&quot;: 50000000
          },
          &quot;set_priority&quot;: {
            &quot;priority&quot;: 100
          }
        }
      },
      &quot;warm&quot;: {
        &quot;min_age&quot;: &quot;1d&quot;,
        &quot;actions&quot;: {
          &quot;set_priority&quot;: {
            &quot;priority&quot;: 50
          },
          &quot;allocate&quot;: {
            &quot;number_of_replicas&quot;: 0,
            &quot;include&quot;: {
              &quot;box_type&quot;: &quot;warm&quot;
            }
          },
          &quot;forcemerge&quot;: {
            &quot;max_num_segments&quot;: 1
          }
        }
      },
      &quot;cold&quot;: {
        &quot;min_age&quot;: &quot;7d&quot;,
        &quot;actions&quot;: {
          &quot;set_priority&quot;: {
            &quot;priority&quot;: 0
          },
          &quot;allocate&quot;: {
            &quot;number_of_replicas&quot;: 0,
            &quot;include&quot;: {
              &quot;box_type&quot;: &quot;cold&quot;
            }
          }
        }
      },
      &quot;delete&quot;: {
        &quot;min_age&quot;: &quot;30d&quot;
      }
    }
  }
}
</div></section></section><section class="chapter"><h2 id="-8j71d4_6" data-toc="-8j71d4_6">ğŸ” æŸ¥è¯¢ä¼˜åŒ–</h2><section class="chapter"><h3 id="q3-es" data-toc="q3-es">Q3: å¦‚ä½•ä¼˜åŒ–ESçš„æŸ¥è¯¢æ€§èƒ½ï¼Ÿå¸¸è§çš„æŸ¥è¯¢ä¼˜åŒ–æŠ€å·§æœ‰å“ªäº›ï¼Ÿ</h3><p id="-8j71d4_43"><span class="control" id="-8j71d4_52">ç­”æ¡ˆï¼š</span></p><p id="-8j71d4_44"><span class="control" id="-8j71d4_53">æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 523.5 740"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="523.5" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="ESæŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–" class="cluster"><rect height="724" width="507.5" y="8" x="8" style=""></rect><g transform="translate(205.515625, 8)" class="cluster-label"><foreignObject height="24" width="112.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ESæŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_A1_0" d="M201.656,106L207.906,106C214.156,106,226.656,106,236.031,106C245.406,106,251.656,106,257.24,106C262.823,106,267.74,106,270.198,106L272.656,106"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M185.633,282L194.553,282C203.474,282,221.315,282,235.243,282C249.172,282,259.188,282,268.536,282C277.885,282,286.568,282,290.909,282L295.25,282"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_2" d="M185.633,458L194.553,458C203.474,458,221.315,458,234.132,458C246.948,458,254.74,458,261.865,458C268.99,458,275.448,458,278.677,458L281.906,458"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_D1_3" d="M185.633,634L194.553,634C203.474,634,221.315,634,234.059,634C246.803,634,254.451,634,261.431,634C268.411,634,274.725,634,277.882,634L281.039,634"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(123.578125, 106)" id="flowchart-A-7560" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æŸ¥è¯¢ç»“æ„ä¼˜åŒ–</p></span></div></foreignObject></g></g><g transform="translate(377.328125, 106)" id="flowchart-A1-7561" class="node default"><rect height="126" width="201.34375" y="-63" x="-100.671875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-70.671875, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="141.34375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ä½¿ç”¨filterä»£æ›¿query<br>åˆç†ä½¿ç”¨boolæŸ¥è¯¢<br>é¿å…è„šæœ¬æŸ¥è¯¢<br>ä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼</p></span></div></foreignObject></g></g><g transform="translate(123.578125, 282)" id="flowchart-B-7562" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ç¼“å­˜ç­–ç•¥</p></span></div></foreignObject></g></g><g transform="translate(377.328125, 282)" id="flowchart-B1-7563" class="node default"><rect height="126" width="156.15625" y="-63" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æŸ¥è¯¢ç¼“å­˜<br>è¯·æ±‚ç¼“å­˜<br>å­—æ®µæ•°æ®ç¼“å­˜<br>åˆ†ç‰‡è¯·æ±‚ç¼“å­˜</p></span></div></foreignObject></g></g><g transform="translate(123.578125, 458)" id="flowchart-C-7564" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>åˆ†é¡µä¼˜åŒ–</p></span></div></foreignObject></g></g><g transform="translate(377.328125, 458)" id="flowchart-C1-7565" class="node default"><rect height="126" width="182.84375" y="-63" x="-91.421875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-61.421875, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="122.84375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>é¿å…æ·±åº¦åˆ†é¡µ<br>ä½¿ç”¨scroll<br>ä½¿ç”¨search_after<br>åˆç†è®¾ç½®size</p></span></div></foreignObject></g></g><g transform="translate(123.578125, 634)" id="flowchart-D-7566" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>èšåˆä¼˜åŒ–</p></span></div></foreignObject></g></g><g transform="translate(377.328125, 634)" id="flowchart-D1-7567" class="node default"><rect height="126" width="184.578125" y="-63" x="-92.2890625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-62.2890625, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="124.578125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å…ˆè¿‡æ»¤åèšåˆ<br>ä½¿ç”¨keywordå­—æ®µ<br>å‡å°‘èšåˆå±‚æ¬¡<br>åˆç†è®¾ç½®size</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-8j71d4_46"><span class="control" id="-8j71d4_54">æŸ¥è¯¢ç»“æ„ä¼˜åŒ–ï¼š</span></p><div class="code-block" data-lang="json">
// ä¼˜åŒ–å‰ï¼šä½æ•ˆæŸ¥è¯¢
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {
          &quot;script&quot;: {
            &quot;source&quot;: &quot;doc['price'].value &gt; params.min_price&quot;,
            &quot;params&quot;: { &quot;min_price&quot;: 100 }
          }
        },
        {
          &quot;wildcard&quot;: { &quot;title&quot;: &quot;*elasticsearch*&quot; }
        }
      ]
    }
  }
}

// ä¼˜åŒ–åï¼šé«˜æ•ˆæŸ¥è¯¢
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;filter&quot;: [                    // ä½¿ç”¨filterè·å¾—ç¼“å­˜ä¼˜åŠ¿
        { &quot;range&quot;: { &quot;price&quot;: { &quot;gt&quot;: 100 } } },
        { &quot;term&quot;: { &quot;status&quot;: &quot;active&quot; } }
      ],
      &quot;must&quot;: [
        { &quot;match&quot;: { &quot;title&quot;: &quot;elasticsearch&quot; } }  // é¿å…é€šé…ç¬¦æŸ¥è¯¢
      ]
    }
  },
  &quot;_source&quot;: [&quot;title&quot;, &quot;price&quot;, &quot;status&quot;],        // åªè¿”å›éœ€è¦çš„å­—æ®µ
  &quot;size&quot;: 20,                                     // åˆç†çš„åˆ†é¡µå¤§å°
  &quot;sort&quot;: [
    { &quot;price&quot;: { &quot;order&quot;: &quot;desc&quot; } }
  ]
}
</div><p id="-8j71d4_48"><span class="control" id="-8j71d4_55">ç¼“å­˜ç­–ç•¥é…ç½®ï¼š</span></p><div class="code-block" data-lang="yaml">
# elasticsearch.yml - ç¼“å­˜é…ç½®
indices:
  # æŸ¥è¯¢ç¼“å­˜
  queries:
    cache:
      size: 20%                    # æŸ¥è¯¢ç¼“å­˜å¤§å°
  
  # è¯·æ±‚ç¼“å­˜
  requests:
    cache:
      size: 2%                     # è¯·æ±‚ç¼“å­˜å¤§å°
      expire: 60m                  # ç¼“å­˜è¿‡æœŸæ—¶é—´
  
  # å­—æ®µæ•°æ®ç¼“å­˜
  fielddata:
    cache:
      size: 40%                    # å­—æ®µæ•°æ®ç¼“å­˜å¤§å°

# èŠ‚ç‚¹çº§ç¼“å­˜è®¾ç½®
indices.fielddata.cache.size: 40%
indices.queries.cache.size: 20%
indices.requests.cache.size: 2%
</div><p id="-8j71d4_50"><span class="control" id="-8j71d4_56">åˆ†é¡µä¼˜åŒ–å®è·µï¼š</span></p><div class="code-block" data-lang="json">
// 1. ä¼ ç»Ÿåˆ†é¡µï¼ˆé¿å…æ·±åº¦åˆ†é¡µï¼‰
{
  &quot;from&quot;: 0,
  &quot;size&quot;: 20,
  &quot;query&quot;: { &quot;match_all&quot;: {} }
}
// é—®é¢˜ï¼šfrom + size &gt; 10000 ä¼šå¾ˆæ…¢

// 2. Scrollæ»šåŠ¨æŸ¥è¯¢ï¼ˆå¤§é‡æ•°æ®éå†ï¼‰
POST /my_index/_search?scroll=1m
{
  &quot;size&quot;: 1000,
  &quot;query&quot;: { &quot;match_all&quot;: {} }
}
// åç»­è¯·æ±‚
POST /_search/scroll
{
  &quot;scroll&quot;: &quot;1m&quot;,
  &quot;scroll_id&quot;: &quot;scroll_id_here&quot;
}

// 3. Search Afterï¼ˆå®æ—¶åˆ†é¡µï¼‰
{
  &quot;size&quot;: 10,
  &quot;query&quot;: { &quot;match_all&quot;: {} },
  &quot;sort&quot;: [
    { &quot;timestamp&quot;: { &quot;order&quot;: &quot;desc&quot; } },
    { &quot;_id&quot;: { &quot;order&quot;: &quot;desc&quot; } }
  ]
}
// ä¸‹ä¸€é¡µ
{
  &quot;size&quot;: 10,
  &quot;query&quot;: { &quot;match_all&quot;: {} },
  &quot;sort&quot;: [
    { &quot;timestamp&quot;: { &quot;order&quot;: &quot;desc&quot; } },
    { &quot;_id&quot;: { &quot;order&quot;: &quot;desc&quot; } }
  ],
  &quot;search_after&quot;: [&quot;2023-12-01T10:00:00&quot;, &quot;doc_123&quot;]
}

// 4. Compositeèšåˆï¼ˆèšåˆåˆ†é¡µï¼‰
{
  &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;my_buckets&quot;: {
      &quot;composite&quot;: {
        &quot;size&quot;: 100,
        &quot;sources&quot;: [
          { &quot;category&quot;: { &quot;terms&quot;: { &quot;field&quot;: &quot;category.keyword&quot; } } },
          { &quot;date&quot;: { &quot;date_histogram&quot;: { &quot;field&quot;: &quot;date&quot;, &quot;calendar_interval&quot;: &quot;day&quot; } } }
        ]
      }
    }
  }
}
</div></section><section class="chapter"><h3 id="q4-es" data-toc="q4-es">Q4: ESçš„èšåˆæŸ¥è¯¢å¦‚ä½•ä¼˜åŒ–ï¼Ÿå¤§æ•°æ®é‡èšåˆæœ‰ä»€ä¹ˆæ³¨æ„äº‹é¡¹ï¼Ÿ</h3><p id="-8j71d4_57"><span class="control" id="-8j71d4_66">ç­”æ¡ˆï¼š</span></p><p id="-8j71d4_58"><span class="control" id="-8j71d4_67">èšåˆæ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1010.71875 346"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1010.71875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="èšåˆæ€§èƒ½ä¼˜åŒ–" class="cluster"><rect height="330" width="994.71875" y="8" x="8" style=""></rect><g transform="translate(457.28125, 8)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>èšåˆæ€§èƒ½ä¼˜åŒ–</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_A1_0" d="M145.109,99.5L145.109,105.75C145.109,112,145.109,124.5,145.109,133.875C145.109,143.25,145.109,149.5,145.109,155.083C145.109,160.667,145.109,165.583,145.109,168.042L145.109,170.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M391.32,99.5L391.32,105.75C391.32,112,391.32,124.5,391.32,133.875C391.32,143.25,391.32,149.5,391.32,155.083C391.32,160.667,391.32,165.583,391.32,168.042L391.32,170.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_2" d="M634.281,99.5L634.281,105.75C634.281,112,634.281,124.5,634.281,133.875C634.281,143.25,634.281,149.5,634.281,155.083C634.281,160.667,634.281,165.583,634.281,168.042L634.281,170.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_D1_3" d="M875.43,99.5L875.43,105.75C875.43,112,875.43,124.5,875.43,133.875C875.43,143.25,875.43,149.5,875.43,155.083C875.43,160.667,875.43,165.583,875.43,168.042L875.43,170.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(145.109375, 72.5)" id="flowchart-A-7781" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ•°æ®é¢„å¤„ç†</p></span></div></foreignObject></g></g><g transform="translate(145.109375, 237.5)" id="flowchart-A1-7782" class="node default"><rect height="126" width="204.21875" y="-63" x="-102.109375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-72.109375, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="144.21875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å…ˆè¿‡æ»¤åèšåˆ<br>ä½¿ç”¨åˆé€‚çš„å­—æ®µç±»å‹<br>é¿å…è„šæœ¬èšåˆ<br>åˆç†è®¾ç½®size</p></span></div></foreignObject></g></g><g transform="translate(391.3203125, 72.5)" id="flowchart-B-7783" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>èšåˆç»“æ„ä¼˜åŒ–</p></span></div></foreignObject></g></g><g transform="translate(391.3203125, 237.5)" id="flowchart-B1-7784" class="node default"><rect height="126" width="188.203125" y="-63" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å‡å°‘èšåˆå±‚æ¬¡<br>åˆç†ä½¿ç”¨åµŒå¥—èšåˆ<br>é€‰æ‹©é«˜æ•ˆèšåˆç±»å‹<br>é¿å…é«˜åŸºæ•°èšåˆ</p></span></div></foreignObject></g></g><g transform="translate(634.28125, 72.5)" id="flowchart-C-7785" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å†…å­˜ç®¡ç†</p></span></div></foreignObject></g></g><g transform="translate(634.28125, 237.5)" id="flowchart-C1-7786" class="node default"><rect height="126" width="197.71875" y="-63" x="-98.859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-68.859375, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="137.71875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>è®¾ç½®æ–­è·¯å™¨<br>ç›‘æ§å†…å­˜ä½¿ç”¨<br>ä½¿ç”¨compositeèšåˆ<br>åˆ†æ‰¹å¤„ç†</p></span></div></foreignObject></g></g><g transform="translate(875.4296875, 72.5)" id="flowchart-D-7787" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ç´¢å¼•ä¼˜åŒ–</p></span></div></foreignObject></g></g><g transform="translate(875.4296875, 237.5)" id="flowchart-D1-7788" class="node default"><rect height="126" width="184.578125" y="-63" x="-92.2890625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-62.2890625, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="124.578125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ä½¿ç”¨keywordå­—æ®µ<br>å¯ç”¨doc_values<br>åˆç†åˆ†ç‰‡<br>é¢„è®¡ç®—ç»“æœ</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-8j71d4_60"><span class="control" id="-8j71d4_68">èšåˆä¼˜åŒ–å®ä¾‹ï¼š</span></p><div class="code-block" data-lang="json">
// ä¼˜åŒ–å‰ï¼šä½æ•ˆèšåˆ
{
  &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;categories&quot;: {
      &quot;terms&quot;: {
        &quot;script&quot;: {
          &quot;source&quot;: &quot;doc['category'].value + '-' + doc['brand'].value&quot;
        },
        &quot;size&quot;: 10000
      },
      &quot;aggs&quot;: {
        &quot;daily_sales&quot;: {
          &quot;date_histogram&quot;: {
            &quot;field&quot;: &quot;date&quot;,
            &quot;calendar_interval&quot;: &quot;day&quot;
          },
          &quot;aggs&quot;: {
            &quot;revenue&quot;: {
              &quot;sum&quot;: { &quot;field&quot;: &quot;amount&quot; }
            }
          }
        }
      }
    }
  }
}

// ä¼˜åŒ–åï¼šé«˜æ•ˆèšåˆ
{
  &quot;size&quot;: 0,
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;filter&quot;: [                          // å…ˆè¿‡æ»¤å‡å°‘æ•°æ®é‡
        { &quot;range&quot;: { &quot;date&quot;: { &quot;gte&quot;: &quot;2023-01-01&quot; } } },
        { &quot;term&quot;: { &quot;status&quot;: &quot;completed&quot; } }
      ]
    }
  },
  &quot;aggs&quot;: {
    &quot;categories&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;category.keyword&quot;,       // ä½¿ç”¨keywordå­—æ®µ
        &quot;size&quot;: 100,                       // åˆç†çš„size
        &quot;execution_hint&quot;: &quot;map&quot;            // æŒ‡å®šæ‰§è¡Œæ–¹å¼
      },
      &quot;aggs&quot;: {
        &quot;brands&quot;: {
          &quot;terms&quot;: {
            &quot;field&quot;: &quot;brand.keyword&quot;,
            &quot;size&quot;: 10
          },
          &quot;aggs&quot;: {
            &quot;total_revenue&quot;: {
              &quot;sum&quot;: { &quot;field&quot;: &quot;amount&quot; }
            }
          }
        }
      }
    }
  }
}
</div><p id="-8j71d4_62"><span class="control" id="-8j71d4_69">å¤§æ•°æ®é‡èšåˆä¼˜åŒ–ï¼š</span></p><div class="code-block" data-lang="json">
// 1. Compositeèšåˆï¼ˆé¿å…å†…å­˜é™åˆ¶ï¼‰
{
  &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;sales_composite&quot;: {
      &quot;composite&quot;: {
        &quot;size&quot;: 1000,
        &quot;sources&quot;: [
          { &quot;category&quot;: { &quot;terms&quot;: { &quot;field&quot;: &quot;category.keyword&quot; } } },
          { &quot;brand&quot;: { &quot;terms&quot;: { &quot;field&quot;: &quot;brand.keyword&quot; } } },
          { &quot;date&quot;: { &quot;date_histogram&quot;: { 
            &quot;field&quot;: &quot;date&quot;, 
            &quot;calendar_interval&quot;: &quot;month&quot; 
          }}}
        ]
      },
      &quot;aggs&quot;: {
        &quot;revenue&quot;: { &quot;sum&quot;: { &quot;field&quot;: &quot;amount&quot; } },
        &quot;count&quot;: { &quot;value_count&quot;: { &quot;field&quot;: &quot;_id&quot; } }
      }
    }
  }
}

// 2. åˆ†å±‚èšåˆä¼˜åŒ–
{
  &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;date_buckets&quot;: {
      &quot;date_histogram&quot;: {
        &quot;field&quot;: &quot;date&quot;,
        &quot;calendar_interval&quot;: &quot;month&quot;,
        &quot;min_doc_count&quot;: 1
      },
      &quot;aggs&quot;: {
        &quot;category_stats&quot;: {
          &quot;terms&quot;: {
            &quot;field&quot;: &quot;category.keyword&quot;,
            &quot;size&quot;: 50,
            &quot;min_doc_count&quot;: 10            // è¿‡æ»¤å°æ¡¶
          },
          &quot;aggs&quot;: {
            &quot;revenue&quot;: { &quot;sum&quot;: { &quot;field&quot;: &quot;amount&quot; } },
            &quot;avg_order&quot;: { &quot;avg&quot;: { &quot;field&quot;: &quot;amount&quot; } }
          }
        }
      }
    }
  }
}

// 3. é‡‡æ ·èšåˆï¼ˆå¤§æ•°æ®è¿‘ä¼¼è®¡ç®—ï¼‰
{
  &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;sample&quot;: {
      &quot;sampler&quot;: {
        &quot;shard_size&quot;: 10000              // æ¯ä¸ªåˆ†ç‰‡é‡‡æ ·æ•°é‡
      },
      &quot;aggs&quot;: {
        &quot;categories&quot;: {
          &quot;terms&quot;: {
            &quot;field&quot;: &quot;category.keyword&quot;,
            &quot;size&quot;: 100
          }
        }
      }
    }
  }
}
</div><p id="-8j71d4_64"><span class="control" id="-8j71d4_70">æ–­è·¯å™¨é…ç½®ï¼š</span></p><div class="code-block" data-lang="yaml">
# elasticsearch.yml - æ–­è·¯å™¨é…ç½®
indices.breaker.total.limit: 70%           # æ€»å†…å­˜é™åˆ¶
indices.breaker.fielddata.limit: 40%       # å­—æ®µæ•°æ®æ–­è·¯å™¨
indices.breaker.request.limit: 40%         # è¯·æ±‚æ–­è·¯å™¨  
indices.breaker.accounting.limit: 100%     # è¯·æ±‚æ–­è·¯å™¨

# åŠ¨æ€è°ƒæ•´æ–­è·¯å™¨
PUT /_cluster/settings
{
  &quot;transient&quot;: {
    &quot;indices.breaker.fielddata.limit&quot;: &quot;30%&quot;,
    &quot;indices.breaker.request.limit&quot;: &quot;30%&quot;
  }
}
</div></section></section><section class="chapter"><h2 id="-8j71d4_7" data-toc="-8j71d4_7">ğŸ–¥ï¸ ç¡¬ä»¶è°ƒä¼˜</h2><section class="chapter"><h3 id="q5-es-jvm" data-toc="q5-es-jvm">Q5: ESé›†ç¾¤çš„ç¡¬ä»¶é…ç½®æœ‰ä»€ä¹ˆå»ºè®®ï¼Ÿå¦‚ä½•è¿›è¡ŒJVMè°ƒä¼˜ï¼Ÿ</h3><p id="-8j71d4_73"><span class="control" id="-8j71d4_82">ç­”æ¡ˆï¼š</span></p><p id="-8j71d4_74"><span class="control" id="-8j71d4_83">ESç¡¬ä»¶é…ç½®å»ºè®®ï¼š</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 492.046875 740"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="492.046875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="ESç¡¬ä»¶é…ç½®æŒ‡å—" class="cluster"><rect height="724" width="476.046875" y="8" x="8" style=""></rect><g transform="translate(189.7890625, 8)" class="cluster-label"><foreignObject height="24" width="112.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ESç¡¬ä»¶é…ç½®æŒ‡å—</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_A1_0" d="M169.609,106L175.859,106C182.109,106,194.609,106,203.984,106C213.359,106,219.609,106,225.193,106C230.776,106,235.693,106,238.151,106L240.609,106"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M169.609,282L175.859,282C182.109,282,194.609,282,205.892,282C217.174,282,227.24,282,236.638,282C246.036,282,254.768,282,259.134,282L263.5,282"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_2" d="M168.055,458L174.564,458C181.073,458,194.091,458,204.965,458C215.84,458,224.57,458,232.634,458C240.698,458,248.095,458,251.794,458L255.492,458"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_D1_3" d="M169.609,634L175.859,634C182.109,634,194.609,634,205.892,634C217.174,634,227.24,634,236.638,634C246.036,634,254.768,634,259.134,634L263.5,634"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(107.5546875, 106)" id="flowchart-A-7945" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å†…å­˜é…ç½®</p></span></div></foreignObject></g></g><g transform="translate(345.578125, 106)" id="flowchart-A1-7946" class="node default"><rect height="126" width="201.9375" y="-63" x="-100.96875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-70.96875, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="141.9375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å †å†…å­˜: 30.5GBä»¥ä¸‹<br>ç³»ç»Ÿå†…å­˜: 64GB+<br>é¿å…swap<br>é¢„ç•™OSç¼“å­˜</p></span></div></foreignObject></g></g><g transform="translate(107.5546875, 282)" id="flowchart-B-7947" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å­˜å‚¨é…ç½®</p></span></div></foreignObject></g></g><g transform="translate(345.578125, 282)" id="flowchart-B1-7948" class="node default"><rect height="126" width="156.15625" y="-63" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>SSDä¼˜äºHDD<br>RAID 0æ¡å¸¦åŒ–<br>ç‹¬ç«‹æ•°æ®ç›®å½•<br>å¿«é€Ÿæ—¥å¿—å­˜å‚¨</p></span></div></foreignObject></g></g><g transform="translate(107.5546875, 458)" id="flowchart-C-7949" class="node default"><rect height="54" width="121" y="-27" x="-60.5" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-30.5, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="61"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>CPUé…ç½®</p></span></div></foreignObject></g></g><g transform="translate(345.578125, 458)" id="flowchart-C1-7950" class="node default"><rect height="126" width="172.171875" y="-63" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å¤šæ ¸CPU<br>ç°ä»£æ¶æ„<br>å……è¶³æ ¸å¿ƒæ•°<br>é¿å…è¶…çº¿ç¨‹äº‰ç”¨</p></span></div></foreignObject></g></g><g transform="translate(107.5546875, 634)" id="flowchart-D-7951" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ç½‘ç»œé…ç½®</p></span></div></foreignObject></g></g><g transform="translate(345.578125, 634)" id="flowchart-D1-7952" class="node default"><rect height="126" width="156.15625" y="-63" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ä¸‡å…†ç½‘ç»œ<br>ä½å»¶è¿Ÿ<br>ä¸“ç”¨ç½‘ç»œ<br>é¿å…ç½‘ç»œç“¶é¢ˆ</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-8j71d4_76"><span class="control" id="-8j71d4_84">JVMè°ƒä¼˜é…ç½®ï¼š</span></p><div class="code-block" data-lang="bash">
# jvm.options - ç”Ÿäº§ç¯å¢ƒJVMé…ç½®

# å †å†…å­˜è®¾ç½®ï¼ˆå…³é”®ï¼ï¼‰
-Xms30g                           # åˆå§‹å †å¤§å°
-Xmx30g                           # æœ€å¤§å †å¤§å°
# åŸåˆ™ï¼šä¸è¶…è¿‡30.5GBï¼Œä¸”ä¸è¶…è¿‡ç³»ç»Ÿå†…å­˜çš„50%

# åƒåœ¾å›æ”¶å™¨é€‰æ‹©
-XX:+UseG1GC                      # ä½¿ç”¨G1åƒåœ¾å›æ”¶å™¨
-XX:G1HeapRegionSize=32m          # G1åŒºåŸŸå¤§å°
-XX:+UnlockExperimentalVMOptions
-XX:+UseG1GC
-XX:MaxGCPauseMillis=50           # æœ€å¤§GCæš‚åœæ—¶é—´

# GCæ—¥å¿—é…ç½®
-XX:+UseGCLogFileRotation
-XX:NumberOfGCLogFiles=32
-XX:GCLogFileSize=64m
-Xloggc:/var/log/elasticsearch/gc.log
-XX:+PrintGCDetails
-XX:+PrintGCTimeStamps
-XX:+PrintGCApplicationStoppedTime

# å †å¤–å†…å­˜ä¼˜åŒ–
-XX:MaxDirectMemorySize=1g        # ç›´æ¥å†…å­˜é™åˆ¶

# JITç¼–è¯‘ä¼˜åŒ–
-XX:+UseStringDeduplication       # å­—ç¬¦ä¸²å»é‡
-XX:+UseCompressedOops           # å‹ç¼©æŒ‡é’ˆ
-XX:+UseCompressedClassPointers  # å‹ç¼©ç±»æŒ‡é’ˆ

# é”™è¯¯å¤„ç†
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=/var/lib/elasticsearch
-XX:+ExitOnOutOfMemoryError
</div><p id="-8j71d4_78"><span class="control" id="-8j71d4_85">ç³»ç»Ÿçº§ä¼˜åŒ–ï¼š</span></p><div class="code-block" data-lang="bash">
# /etc/security/limits.conf - ç³»ç»Ÿé™åˆ¶é…ç½®
elasticsearch soft nofile 65536
elasticsearch hard nofile 65536
elasticsearch soft nproc 4096
elasticsearch hard nproc 4096
elasticsearch soft memlock unlimited
elasticsearch hard memlock unlimited

# /etc/sysctl.conf - å†…æ ¸å‚æ•°ä¼˜åŒ–
vm.max_map_count=262144              # å†…å­˜æ˜ å°„åŒºåŸŸé™åˆ¶
vm.swappiness=1                      # é™ä½swapä½¿ç”¨
net.core.somaxconn=65535            # è¿æ¥é˜Ÿåˆ—å¤§å°
net.core.netdev_max_backlog=5000    # ç½‘ç»œè®¾å¤‡é˜Ÿåˆ—
net.ipv4.tcp_keepalive_time=120     # TCPä¿æ´»æ—¶é—´

# ç¦ç”¨swap
sudo swapoff -a
# æˆ–è€…åœ¨/etc/fstabä¸­æ³¨é‡Šswapè¡Œ
</div><p id="-8j71d4_80"><span class="control" id="-8j71d4_86">ç£ç›˜ä¼˜åŒ–é…ç½®ï¼š</span></p><div class="code-block" data-lang="bash">
# æ–‡ä»¶ç³»ç»ŸæŒ‚è½½é€‰é¡¹
/dev/sdb1 /var/lib/elasticsearch ext4 noatime,nodiratime,nobarrier 0 0

# SSDä¼˜åŒ–
echo deadline &gt; /sys/block/sdb/queue/scheduler
echo mq-deadline &gt; /sys/block/sdb/queue/scheduler  # å¯¹äºNVMe

# ç£ç›˜å¹¶å‘è®¾ç½®
echo 128 &gt; /sys/block/sdb/queue/nr_requests

# Elasticsearchæ•°æ®ç›®å½•é…ç½®
path.data: [&quot;/data1/elasticsearch&quot;, &quot;/data2/elasticsearch&quot;]
path.logs: &quot;/var/log/elasticsearch&quot;
</div></section><section class="chapter"><h3 id="q6-es" data-toc="q6-es">Q6: å¦‚ä½•ç›‘æ§ESé›†ç¾¤æ€§èƒ½ï¼Ÿæœ‰å“ªäº›å…³é”®çš„æ€§èƒ½æŒ‡æ ‡ï¼Ÿ</h3><p id="-8j71d4_87"><span class="control" id="-8j71d4_96">ç­”æ¡ˆï¼š</span></p><p id="-8j71d4_88"><span class="control" id="-8j71d4_97">ESæ€§èƒ½ç›‘æ§ä½“ç³»ï¼š</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 446.265625 740"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="446.265625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="ESæ€§èƒ½ç›‘æ§æŒ‡æ ‡" class="cluster"><rect height="724" width="430.265625" y="8" x="8" style=""></rect><g transform="translate(166.8984375, 8)" class="cluster-label"><foreignObject height="24" width="112.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ESæ€§èƒ½ç›‘æ§æŒ‡æ ‡</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_A1_0" d="M169.609,106L175.859,106C182.109,106,194.609,106,203.984,106C213.359,106,219.609,106,225.193,106C230.776,106,235.693,106,238.151,106L240.609,106"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_B1_1" d="M169.609,282L175.859,282C182.109,282,194.609,282,205.32,282C216.03,282,224.951,282,233.204,282C241.458,282,249.046,282,252.839,282L256.633,282"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_C1_2" d="M169.609,458L175.859,458C182.109,458,194.609,458,204.652,458C214.695,458,222.281,458,229.201,458C236.12,458,242.372,458,245.499,458L248.625,458"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_D1_3" d="M167.805,634L174.355,634C180.906,634,194.008,634,204.352,634C214.695,634,222.281,634,229.201,634C236.12,634,242.372,634,245.499,634L248.625,634"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(107.5546875, 106)" id="flowchart-A-8098" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>é›†ç¾¤æŒ‡æ ‡</p></span></div></foreignObject></g></g><g transform="translate(322.6875, 106)" id="flowchart-A1-8099" class="node default"><rect height="126" width="156.15625" y="-63" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>é›†ç¾¤å¥åº·çŠ¶æ€<br>èŠ‚ç‚¹æ•°é‡<br>åˆ†ç‰‡çŠ¶æ€<br>æ•°æ®é‡ç»Ÿè®¡</p></span></div></foreignObject></g></g><g transform="translate(107.5546875, 282)" id="flowchart-B-8100" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ€§èƒ½æŒ‡æ ‡</p></span></div></foreignObject></g></g><g transform="translate(322.6875, 282)" id="flowchart-B1-8101" class="node default"><rect height="126" width="124.109375" y="-63" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æŸ¥è¯¢QPS<br>ç´¢å¼•TPS<br>å“åº”å»¶è¿Ÿ<br>é˜Ÿåˆ—é•¿åº¦</p></span></div></foreignObject></g></g><g transform="translate(107.5546875, 458)" id="flowchart-C-8102" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>èµ„æºæŒ‡æ ‡</p></span></div></foreignObject></g></g><g transform="translate(322.6875, 458)" id="flowchart-C1-8103" class="node default"><rect height="126" width="140.125" y="-63" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>CPUä½¿ç”¨ç‡<br>å†…å­˜ä½¿ç”¨ç‡<br>ç£ç›˜IO<br>ç½‘ç»œæµé‡</p></span></div></foreignObject></g></g><g transform="translate(107.5546875, 634)" id="flowchart-D-8104" class="node default"><rect height="54" width="120.5" y="-27" x="-60.25" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-30.25, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="60.5"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>JVMæŒ‡æ ‡</p></span></div></foreignObject></g></g><g transform="translate(322.6875, 634)" id="flowchart-D1-8105" class="node default"><rect height="126" width="140.125" y="-63" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å †å†…å­˜ä½¿ç”¨<br>GCé¢‘ç‡<br>GCè€—æ—¶<br>çº¿ç¨‹æ•°é‡</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-8j71d4_90"><span class="control" id="-8j71d4_98">å…³é”®æ€§èƒ½æŒ‡æ ‡è¯¦è§£ï¼š</span></p><div class="code-block" data-lang="bash">
# 1. é›†ç¾¤å¥åº·æŒ‡æ ‡
GET /_cluster/health
{
  &quot;cluster_name&quot;: &quot;production&quot;,
  &quot;status&quot;: &quot;green&quot;,                    # green/yellow/red
  &quot;timed_out&quot;: false,
  &quot;number_of_nodes&quot;: 6,
  &quot;number_of_data_nodes&quot;: 3,
  &quot;active_primary_shards&quot;: 15,
  &quot;active_shards&quot;: 30,
  &quot;relocating_shards&quot;: 0,              # é‡å®šä½åˆ†ç‰‡æ•°
  &quot;initializing_shards&quot;: 0,            # åˆå§‹åŒ–åˆ†ç‰‡æ•°
  &quot;unassigned_shards&quot;: 0,              # æœªåˆ†é…åˆ†ç‰‡æ•°
  &quot;delayed_unassigned_shards&quot;: 0,
  &quot;number_of_pending_tasks&quot;: 0,        # å¾…å¤„ç†ä»»åŠ¡æ•°
  &quot;task_max_waiting_in_queue_millis&quot;: 0
}

# 2. æ€§èƒ½ç»Ÿè®¡æŒ‡æ ‡
GET /_stats
{
  &quot;indices&quot;: {
    &quot;count&quot;: 10,
    &quot;shards&quot;: {
      &quot;total&quot;: 30,
      &quot;primaries&quot;: 15,
      &quot;replication&quot;: 1.0
    },
    &quot;docs&quot;: {
      &quot;count&quot;: 1000000,
      &quot;deleted&quot;: 5000
    },
    &quot;store&quot;: {
      &quot;size_in_bytes&quot;: 5368709120      # å­˜å‚¨å¤§å°
    },
    &quot;indexing&quot;: {
      &quot;index_total&quot;: 500000,           # æ€»ç´¢å¼•æ–‡æ¡£æ•°
      &quot;index_time_in_millis&quot;: 120000,  # ç´¢å¼•æ€»è€—æ—¶
      &quot;index_current&quot;: 10,             # å½“å‰ç´¢å¼•æ“ä½œæ•°
      &quot;delete_total&quot;: 1000,
      &quot;delete_time_in_millis&quot;: 500
    },
    &quot;search&quot;: {
      &quot;query_total&quot;: 1000000,          # æ€»æŸ¥è¯¢æ•°
      &quot;query_time_in_millis&quot;: 300000,  # æŸ¥è¯¢æ€»è€—æ—¶
      &quot;query_current&quot;: 5,              # å½“å‰æŸ¥è¯¢æ•°
      &quot;fetch_total&quot;: 500000,
      &quot;fetch_time_in_millis&quot;: 100000
    }
  }
}

# 3. èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯
GET /_nodes/stats
{
  &quot;nodes&quot;: {
    &quot;node1&quot;: {
      &quot;jvm&quot;: {
        &quot;mem&quot;: {
          &quot;heap_used_percent&quot;: 45,      # å †å†…å­˜ä½¿ç”¨ç‡
          &quot;heap_used_in_bytes&quot;: 14495531008,
          &quot;heap_max_in_bytes&quot;: 32212254720
        },
        &quot;gc&quot;: {
          &quot;collectors&quot;: {
            &quot;young&quot;: {
              &quot;collection_count&quot;: 1000,  # GCæ¬¡æ•°
              &quot;collection_time_in_millis&quot;: 15000
            },
            &quot;old&quot;: {
              &quot;collection_count&quot;: 10,
              &quot;collection_time_in_millis&quot;: 2000
            }
          }
        }
      },
      &quot;thread_pool&quot;: {
        &quot;search&quot;: {
          &quot;threads&quot;: 13,
          &quot;queue&quot;: 0,                   # é˜Ÿåˆ—é•¿åº¦
          &quot;active&quot;: 2,                  # æ´»è·ƒçº¿ç¨‹æ•°
          &quot;rejected&quot;: 0,                # æ‹’ç»è¯·æ±‚æ•°
          &quot;largest&quot;: 13,
          &quot;completed&quot;: 1000000
        },
        &quot;write&quot;: {
          &quot;threads&quot;: 8,
          &quot;queue&quot;: 0,
          &quot;active&quot;: 1,
          &quot;rejected&quot;: 0,
          &quot;largest&quot;: 8,
          &quot;completed&quot;: 500000
        }
      }
    }
  }
}
</div><p id="-8j71d4_92"><span class="control" id="-8j71d4_99">ç›‘æ§å‘Šè­¦é…ç½®ï¼š</span></p><div class="code-block" data-lang="yaml">
# æ€§èƒ½å‘Šè­¦é˜ˆå€¼é…ç½®
alerts:
  cluster_health:
    red_status: 
      severity: critical
      action: immediate_response
    yellow_status:
      severity: warning
      action: investigate
  
  performance_metrics:
    search_latency:
      warning: 100ms      # æŸ¥è¯¢å»¶è¿Ÿå‘Šè­¦
      critical: 500ms
    indexing_latency:
      warning: 50ms       # ç´¢å¼•å»¶è¿Ÿå‘Šè­¦  
      critical: 200ms
    queue_size:
      warning: 50         # é˜Ÿåˆ—é•¿åº¦å‘Šè­¦
      critical: 100
    
  resource_usage:
    heap_memory:
      warning: 75%        # å †å†…å­˜ä½¿ç”¨å‘Šè­¦
      critical: 85%
    cpu_usage:
      warning: 80%        # CPUä½¿ç”¨å‘Šè­¦
      critical: 90%
    disk_usage:
      warning: 80%        # ç£ç›˜ä½¿ç”¨å‘Šè­¦
      critical: 90%
      
  gc_metrics:
    gc_time_ratio:
      warning: 5%         # GCæ—¶é—´å æ¯”å‘Šè­¦
      critical: 10%
    gc_frequency:
      warning: 10/min     # GCé¢‘ç‡å‘Šè­¦
      critical: 30/min
</div><p id="-8j71d4_94"><span class="control" id="-8j71d4_100">æ€§èƒ½ç›‘æ§è„šæœ¬ï¼š</span></p><div class="code-block" data-lang="bash">
#!/bin/bash
# ESæ€§èƒ½ç›‘æ§è„šæœ¬

ES_HOST=&quot;localhost:9200&quot;

# é›†ç¾¤å¥åº·æ£€æŸ¥
check_cluster_health() {
    health=$(curl -s &quot;${ES_HOST}/_cluster/health&quot; | jq -r '.status')
    echo &quot;Cluster Health: $health&quot;
    if [ &quot;$health&quot; != &quot;green&quot; ]; then
        echo &quot;WARNING: Cluster health is $health&quot;
    fi
}

# æ€§èƒ½æŒ‡æ ‡æ£€æŸ¥
check_performance() {
    stats=$(curl -s &quot;${ES_HOST}/_stats&quot;)
    
    # æŸ¥è¯¢æ€§èƒ½
    query_total=$(echo $stats | jq '.indices.search.query_total')
    query_time=$(echo $stats | jq '.indices.search.query_time_in_millis')
    avg_query_time=$((query_time / query_total))
    echo &quot;Average Query Time: ${avg_query_time}ms&quot;
    
    # ç´¢å¼•æ€§èƒ½
    index_total=$(echo $stats | jq '.indices.indexing.index_total')
    index_time=$(echo $stats | jq '.indices.indexing.index_time_in_millis')
    avg_index_time=$((index_time / index_total))
    echo &quot;Average Index Time: ${avg_index_time}ms&quot;
}

# èµ„æºä½¿ç”¨æ£€æŸ¥
check_resources() {
    nodes=$(curl -s &quot;${ES_HOST}/_nodes/stats&quot;)
    
    # JVMå †å†…å­˜ä½¿ç”¨ç‡
    heap_percent=$(echo $nodes | jq '.nodes | to_entries[0].value.jvm.mem.heap_used_percent')
    echo &quot;Heap Usage: ${heap_percent}%&quot;
    
    # æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€
    search_queue=$(echo $nodes | jq '.nodes | to_entries[0].value.thread_pool.search.queue')
    write_queue=$(echo $nodes | jq '.nodes | to_entries[0].value.thread_pool.write.queue')
    echo &quot;Search Queue: $search_queue, Write Queue: $write_queue&quot;
}

# æ‰§è¡Œæ£€æŸ¥
check_cluster_health
check_performance  
check_resources
</div></section></section><section class="chapter"><h2 id="-8j71d4_8" data-toc="-8j71d4_8">ğŸ’¡ é¢è¯•æŠ€å·§</h2><section class="chapter"><h3 id="-8j71d4_101" data-toc="-8j71d4_101">é«˜é¢‘è€ƒç‚¹</h3><ol class="list _decimal" id="-8j71d4_104" type="1"><li class="list__item" id="-8j71d4_105"><p id="-8j71d4_110"><span class="control" id="-8j71d4_111">å†™å…¥æ€§èƒ½ä¼˜åŒ–</span> ï¼šbulk APIä½¿ç”¨ã€ç´¢å¼•é…ç½®ã€ç¡¬ä»¶é€‰æ‹©</p></li><li class="list__item" id="-8j71d4_106"><p id="-8j71d4_112"><span class="control" id="-8j71d4_113">æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–</span> ï¼šæŸ¥è¯¢ç»“æ„ã€ç¼“å­˜ç­–ç•¥ã€åˆ†é¡µæ–¹æ³•</p></li><li class="list__item" id="-8j71d4_107"><p id="-8j71d4_114"><span class="control" id="-8j71d4_115">èšåˆä¼˜åŒ–</span> ï¼šå¤§æ•°æ®é‡èšåˆã€å†…å­˜ç®¡ç†ã€æ–­è·¯å™¨é…ç½®</p></li><li class="list__item" id="-8j71d4_108"><p id="-8j71d4_116"><span class="control" id="-8j71d4_117">ç¡¬ä»¶é…ç½®</span> ï¼šå†…å­˜åˆ†é…ã€JVMè°ƒä¼˜ã€ç£ç›˜ä¼˜åŒ–</p></li><li class="list__item" id="-8j71d4_109"><p id="-8j71d4_118"><span class="control" id="-8j71d4_119">æ€§èƒ½ç›‘æ§</span> ï¼šå…³é”®æŒ‡æ ‡ã€å‘Šè­¦é…ç½®ã€é—®é¢˜è¯Šæ–­</p></li></ol></section><section class="chapter"><h3 id="-8j71d4_102" data-toc="-8j71d4_102">å›ç­”ç­–ç•¥</h3><ol class="list _decimal" id="-8j71d4_120" type="1"><li class="list__item" id="-8j71d4_121"><p id="-8j71d4_125"><span class="control" id="-8j71d4_126">é‡åŒ–è¯´æ˜</span> ï¼šç”¨å…·ä½“æ•°å­—è¯´æ˜ä¼˜åŒ–æ•ˆæœ</p></li><li class="list__item" id="-8j71d4_122"><p id="-8j71d4_127"><span class="control" id="-8j71d4_128">å®æˆ˜ç»éªŒ</span> ï¼šç»“åˆå®é™…é¡¹ç›®ä¸­é‡åˆ°çš„æ€§èƒ½é—®é¢˜</p></li><li class="list__item" id="-8j71d4_123"><p id="-8j71d4_129"><span class="control" id="-8j71d4_130">åŸç†è§£é‡Š</span> ï¼šæ·±å…¥ç†è§£ESæ€§èƒ½ç“¶é¢ˆçš„æ ¹æœ¬åŸå› </p></li><li class="list__item" id="-8j71d4_124"><p id="-8j71d4_131"><span class="control" id="-8j71d4_132">æœ€ä½³å®è·µ</span> ï¼šæåŠä¸šç•Œè®¤å¯çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•</p></li></ol></section><section class="chapter"><h3 id="-8j71d4_103" data-toc="-8j71d4_103">å¸¸è§æ€§èƒ½é—®é¢˜</h3><ol class="list _decimal" id="-8j71d4_133" type="1"><li class="list__item" id="-8j71d4_136"><p id="-8j71d4_140"><span class="control" id="-8j71d4_141">å†…å­˜é—®é¢˜</span> ï¼šå †å†…å­˜æº¢å‡ºã€GCé¢‘ç¹ã€å†…å­˜æ³„æ¼</p></li><li class="list__item" id="-8j71d4_137"><p id="-8j71d4_142"><span class="control" id="-8j71d4_143">æŸ¥è¯¢ç¼“æ…¢</span> ï¼šæ·±åº¦åˆ†é¡µã€å¤æ‚èšåˆã€å¤§ç»“æœé›†</p></li><li class="list__item" id="-8j71d4_138"><p id="-8j71d4_144"><span class="control" id="-8j71d4_145">å†™å…¥æ€§èƒ½å·®</span> ï¼šé…ç½®ä¸å½“ã€ç¡¬ä»¶ç“¶é¢ˆã€ç½‘ç»œå»¶è¿Ÿ</p></li><li class="list__item" id="-8j71d4_139"><p id="-8j71d4_146"><span class="control" id="-8j71d4_147">é›†ç¾¤ä¸ç¨³å®š</span> ï¼šåˆ†ç‰‡åˆ†é…ã€èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œåˆ†åŒº</p></li></ol><p id="-8j71d4_135"><span class="control" id="-8j71d4_148">å­¦ä¹ å»ºè®®</span> ï¼šESæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦ä»å¤šä¸ªç»´åº¦ç»¼åˆè€ƒè™‘ã€‚å»ºè®®é€šè¿‡å®é™…çš„æ€§èƒ½æµ‹è¯•æ¥éªŒè¯ä¼˜åŒ–æ•ˆæœï¼Œé‡ç‚¹æŒæ¡æ€§èƒ½ç›‘æ§å’Œé—®é¢˜è¯Šæ–­çš„æ–¹æ³•ï¼ŒåŒæ—¶è¦äº†è§£ESçš„åº•å±‚å·¥ä½œåŸç†ã€‚</p></section></section><div class="last-modified">09 å…­æœˆ 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="esé›†ç¾¤ç®¡ç†qa.html" class="navigation-links__prev">ESé›†ç¾¤ç®¡ç†QA</a><a href="esé«˜çº§ç‰¹æ€§qa.html" class="navigation-links__next">ESé«˜çº§ç‰¹æ€§QA</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>