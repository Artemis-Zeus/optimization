<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-06-10T01:07:27.3870586"><title>JVM内存管理QA | 技术知识库</title><script type="application/json" id="virtual-toc-data">[{"id":"zdyvef_4","level":0,"title":"📋 知识结构","anchor":"#zdyvef_4"},{"id":"zdyvef_5","level":0,"title":"🧱 堆内存深度解析","anchor":"#zdyvef_5"},{"id":"zdyvef_6","level":0,"title":"🏛️ 方法区演进","anchor":"#zdyvef_6"},{"id":"zdyvef_7","level":0,"title":"💻 直接内存管理","anchor":"#zdyvef_7"},{"id":"zdyvef_8","level":0,"title":"🔄 内存分配算法","anchor":"#zdyvef_8"},{"id":"zdyvef_9","level":0,"title":"💡 面试技巧","anchor":"#zdyvef_9"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="JVM内存管理QA | 技术知识库"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="技术知识库 Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/jvm内存管理qa.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="JVM内存管理QA | 技术知识库"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/jvm内存管理qa.html#webpage",
    "url": "writerside-documentation/jvm内存管理qa.html",
    "name": "JVM内存管理QA | 技术知识库",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "技术知识库 Help"
}</script><!-- End Schema.org --></head><body data-id="JVM内存管理QA" data-main-title="JVM内存管理QA" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="JVM面试大纲.md|JVM面试大纲"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>技术知识库  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="JVM内存管理QA" id="JVM内存管理QA.md">JVM内存管理QA</h1><p id="zdyvef_3">本文档深入解析JVM内存管理机制，涵盖堆内存结构、方法区演进、直接内存、内存分配策略等核心内容。</p><section class="chapter"><h2 id="zdyvef_4" data-toc="zdyvef_4">📋 知识结构</h2><svg aria-roledescription="mindmap" role="graphics-document document" viewBox="5 5 731.0357666015625 401.3347473144531" style="max-width: 731.0357666015625px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g></g><g class="mindmap-edges"><path class="edge section-edge-0 edge-depth-1" d="M 530.9542170440271,156.047661286795 L 594.5897988328296,172.9247715773681 L658.2253806216321,189.80188186794118"></path><path class="edge section-edge-0 edge-depth-1" d="M 530.7975480104877,147.80866489459277 L 595.7216095400767,127.91911723273844 L660.6456710696656,108.02956957088412"></path><path class="edge section-edge-0 edge-depth-1" d="M 520.1505448230898,137.66461767474783 L 528.2817412300055,105.67358986452328 L536.4129376369212,73.68256205429871"></path><path class="edge section-edge-0 edge-depth-1" d="M 503.17054663161315,145.23739774547022 L 458.4275275274299,121.77966302313902 L413.68450842324665,98.32192830080783"></path><path class="edge section-edge-0 edge-depth-0" d="M 359.3215073568906,201.96352844623823 L 430.7384471662325,179.34722506607062 L502.1553869755744,156.73092168590296"></path><path class="edge section-edge-1 edge-depth-1" d="M 436.13509793845355,298.0231916073593 L 433.57511070676946,330.2525226680677 L431.0151234750854,362.48185372877606"></path><path class="edge section-edge-1 edge-depth-1" d="M 424.0990261963108,290.1506463451116 L 380.14059341184293,313.6871330306063 L336.1821606273751,337.2236197161009"></path><path class="edge section-edge-1 edge-depth-1" d="M 452.21858377869125,281.30506949684644 L 518.1980011148939,273.48620146255774 L584.1774184510966,265.66733342826905"></path><path class="edge section-edge-1 edge-depth-1" d="M 450.6641540386048,289.9265697867057 L 499.8954021045299,315.2271229205863 L549.126650170455,340.52767605446684"></path><path class="edge section-edge-1 edge-depth-0" d="M 356.5656093099726,216.06975105314416 L 391.17212025489016,244.78118132537253 L425.7786311998077,273.49261159760096"></path><path class="edge section-edge-2 edge-depth-1" d="M 241.31519422294565,123.89623389974597 L 183.92804798954472,121.95049775887523 L126.5409017561438,120.0047616180045"></path><path class="edge section-edge-2 edge-depth-1" d="M 245.34297465258987,114.16736739560724 L 215.13015394058567,85.95645019739064 L184.91733322858147,57.74553299917402"></path><path class="edge section-edge-2 edge-depth-1" d="M 262.2352209656087,110.6258726836272 L 275.77760259038337,79.15226167263991 L289.31998421515806,47.67865066165264"></path><path class="edge section-edge-2 edge-depth-0" d="M 334.0115647098898,196.3046852539254 L 300.6640039538196,165.4482991323751 L267.3164431977494,134.59191301082473"></path><path class="edge section-edge-3 edge-depth-1" d="M 211.01566330994314,262.4299100366514 L 197.42469820790353,234.6452777380891 L183.83373310586393,206.8606454395268"></path><path class="edge section-edge-3 edge-depth-1" d="M 216.0568721596737,290.8239851818581 L 212.72679713460008,322.881629075608 L209.39672210952645,354.93927296935783"></path><path class="edge section-edge-3 edge-depth-1" d="M 203.96867946505165,282.149618278085 L 149.8727312737464,306.92215157556257 L95.77678308244116,331.69468487304016"></path><path class="edge section-edge-3 edge-depth-1" d="M 202.79053354669298,273.5630582035542 L 137.82134898091022,263.2968170760821 L72.85216441512745,253.03057594861005"></path><path class="edge section-edge-3 edge-depth-0" d="M 331.84922609752977,213.66794382056702 L 281.31406338035146,241.1981701691493 L230.77890066317315,268.7283965177316"></path></g><g class="mindmap-nodes"><g transform="translate(288.2619256860895, 187.5920749194703)" class="mindmap-node section--1 section-root"><g transform="translate(56.75950241088867, 18.9)"><circle r="56.75950241088867" class="node-bkg node-circle" id="node-0"></circle></g><g transform="translate(56.75950241088867, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">JVM内存管理</tspan></tspan></text></g></g></g><g transform="translate(465.40746589979346, 133.30237521267088)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h92.09600067138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-1"></path><line y2="37.8" x2="102.09600067138672" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(51.04800033569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">堆内存管理</tspan></tspan></text></g></g></g><g transform="translate(386.76031241280214, 264.1702877312748)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h91.125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-6"></path><line y2="37.8" x2="101.125" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(50.5625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">方法区演进</tspan></tspan></text></g></g></g><g transform="translate(213.7705805125653, 105.50452334527984)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-11"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">直接内存</tspan></tspan></text></g></g></g><g transform="translate(159.52857366372473, 257.00426541882837)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h106.15625 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-15"></path><line y2="37.8" x2="116.15625" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(58.078125, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">内存分配算法</tspan></tspan></text></g></g></g><g transform="translate(622.1616314301724, 174.7471679420653)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h91.125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-2"></path><line y2="37.8" x2="101.125" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(50.5625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">新生代结构</tspan></tspan></text></g></g></g><g transform="translate(623.9397525089731, 84.735859252806)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h92.09600067138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-3"></path><line y2="37.8" x2="102.09600067138672" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(51.04800033569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">老年代管理</tspan></tspan></text></g></g></g><g transform="translate(495.59239122452425, 40.244804516375666)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h79.03125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-4"></path><line y2="37.8" x2="89.03125" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(44.515625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">TLAB机制</tspan></tspan></text></g></g></g><g transform="translate(341.83958744608196, 72.45695083360715)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h107.12000274658203 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-5"></path><line y2="37.8" x2="117.12000274658203" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(58.560001373291016, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">内存分配策略</tspan></tspan></text></g></g></g><g transform="translate(394.8034088328901, 358.5347576048606)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h60.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-7"></path><line y2="37.8" x2="70.04800033569336" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(35.02400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">永久代</tspan></tspan></text></g></g></g><g transform="translate(288.4193119108837, 325.4039783299378)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h59.078125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-8"></path><line y2="37.8" x2="69.078125" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(34.5390625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">元空间</tspan></tspan></text></g></g></g><g transform="translate(540.5131884436947, 245.0021151938407)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h107.12000274658203 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-9"></path><line y2="37.8" x2="117.12000274658203" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(58.560001373291016, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">运行时常量池</tspan></tspan></text></g></g></g><g transform="translate(503.9079904229667, 328.4839581098978)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h107.12000274658203 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-10"></path><line y2="37.8" x2="117.12000274658203" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(58.560001373291016, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">字符串常量池</tspan></tspan></text></g></g></g><g transform="translate(68.51351687033275, 100.59647217247061)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-12"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">堆外内存</tspan></tspan></text></g></g></g><g transform="translate(134.683071484817, 28.608377049501428)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h68.54131317138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-13"></path><line y2="37.8" x2="78.54131317138672" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(39.27065658569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">NIO操作</tspan></tspan></text></g></g></g><g transform="translate(252.71262607201004, 15)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-14"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">内存映射</tspan></tspan></text></g></g></g><g transform="translate(134.20669845398663, 174.48629005734983)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-16"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">指针碰撞</tspan></tspan></text></g></g></g><g transform="translate(164.81089630737972, 350.9589927323876)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-17"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">空闲列表</tspan></tspan></text></g></g></g><g transform="translate(39.10276458567239, 319.0400377322968)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-18"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">逃逸分析</tspan></tspan></text></g></g></g><g transform="translate(15, 231.7893687333359)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-19"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">栈上分配</tspan></tspan></text></g></g></g></g></svg></section><section class="chapter"><h2 id="zdyvef_5" data-toc="zdyvef_5">🧱 堆内存深度解析</h2><section class="chapter"><h3 id="q1" data-toc="q1">Q1: 堆内存的详细结构是怎样的？各个区域的大小如何配置？</h3><p id="zdyvef_15"><span class="control" id="zdyvef_20">答案：</span></p><p id="zdyvef_16"><span class="control" id="zdyvef_21">堆内存详细结构：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1248.21875 1219"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1248.21875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"><g data-look="classic" id="堆内存结构" class="cluster"><rect height="995" width="919.21875" y="112" x="321" style=""></rect><g transform="translate(740.546875, 112)" class="cluster-label"><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>堆内存结构</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph1" class="cluster"><rect height="128" width="235.375" y="954" x="341" style=""></rect><g transform="translate(371.6015625, 954)" class="cluster-label"><foreignObject height="24" width="174.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>老年代 (Old Generation)</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph0" class="cluster"><rect height="945" width="417.6875" y="137" x="802.53125" style=""></rect><g transform="translate(915.78125, 137)" class="cluster-label"><foreignObject height="24" width="191.1875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>新生代 (Young Generation)</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_F_A_0" d="M1011.375,62L1011.375,66.167C1011.375,70.333,1011.375,78.667,1011.375,87C1011.375,95.333,1011.375,103.667,1011.375,112C1011.375,120.333,1011.375,128.667,1011.375,134.917C1011.375,141.167,1011.375,145.333,1011.375,148.833C1011.375,152.333,1011.375,155.167,1011.375,156.583L1011.375,158"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_G_1" d="M1011.375,240L1011.375,244.167C1011.375,248.333,1011.375,256.667,945.882,264.773C880.389,272.88,749.404,280.76,619.083,288.6C488.763,296.44,359.108,304.24,294.281,308.14L229.454,312.04"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_H_2" d="M147,344L147,348.167C147,352.333,147,360.667,147,366.917C147,373.167,147,377.333,147,380.833C147,384.333,147,387.167,147,388.583L147,390"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_H_I_3" d="M147,448L147,452.167C147,456.333,147,464.667,147,470.917C147,477.167,147,481.333,147,484.833C147,488.333,147,491.167,147,492.583L147,494"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_J_4" d="M147,552L147,556.167C147,560.333,147,568.667,147.042,574.958C147.083,581.25,147.167,585.5,147.237,589.083C147.307,592.667,147.364,595.584,147.393,597.042L147.422,598.501"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_D_5" d="M236.337,791.663L273.395,812.553C310.454,833.442,384.571,875.221,421.629,902.277C458.688,929.333,458.688,941.667,458.688,949.917C458.688,958.167,458.688,962.333,458.688,965.833C458.688,969.333,458.688,972.167,458.688,973.583L458.688,975"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_B_6" d="M260.645,767.355L370.068,792.296C479.492,817.237,698.34,867.118,807.764,898.226C917.188,929.333,917.188,941.667,917.188,949.917C917.188,958.167,917.188,962.333,917.188,965.833C917.188,969.333,917.188,972.167,917.188,973.583L917.188,975"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_K_7" d="M917.188,1057L917.188,1061.167C917.188,1065.333,917.188,1073.667,917.188,1082C917.188,1090.333,917.188,1098.667,917.188,1107C917.188,1115.333,917.188,1123.667,917.188,1129.917C917.188,1136.167,917.188,1140.333,917.188,1143.833C917.188,1147.333,917.188,1150.167,917.188,1151.583L917.188,1153"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(458.6875, 917)" class="edgeLabel"><g transform="translate(-8.015625, -12)" class="label"><foreignObject height="24" width="16.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>是</p></span></div></foreignObject></g></g><g transform="translate(917.1875, 917)" class="edgeLabel"><g transform="translate(-8.015625, -12)" class="label"><foreignObject height="24" width="16.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>否</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(1011.375, 201)" id="flowchart-A-2309" class="node default"><rect height="78" width="205.828125" y="-39" x="-102.9140625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-72.9140625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="145.828125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Eden区<br>默认8/10新生代空间</p></span></div></foreignObject></g></g><g transform="translate(917.1875, 1018)" id="flowchart-B-2310" class="node default"><rect height="78" width="159.3125" y="-39" x="-79.65625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-49.65625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="99.3125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Survivor From<br>S0区 1/10</p></span></div></foreignObject></g></g><g transform="translate(1116.03125, 1018)" id="flowchart-C-2311" class="node default"><rect height="78" width="138.375" y="-39" x="-69.1875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-39.1875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="78.375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Survivor To<br>S1区 1/10</p></span></div></foreignObject></g></g><g transform="translate(458.6875, 1018)" id="flowchart-D-2312" class="node default"><rect height="78" width="165.375" y="-39" x="-82.6875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-52.6875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="105.375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Old Gen<br>默认2/3堆空间</p></span></div></foreignObject></g></g><g transform="translate(689.453125, 1018)" id="flowchart-E-2313" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>对象分配流程</p></span></div></foreignObject></g></g><g transform="translate(1011.375, 35)" id="flowchart-F-2314" class="node default"><rect height="54" width="108.078125" y="-27" x="-54.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>新对象</p></span></div></foreignObject></g></g><g transform="translate(147, 317)" id="flowchart-G-2317" class="node default"><rect height="54" width="156.921875" y="-27" x="-78.4609375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.4609375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.921875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Minor GC触发</p></span></div></foreignObject></g></g><g transform="translate(147, 421)" id="flowchart-H-2319" class="node default"><rect height="54" width="230.0625" y="-27" x="-115.03125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-85.03125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="170.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>存活对象复制到Survivor</p></span></div></foreignObject></g></g><g transform="translate(147, 525)" id="flowchart-I-2321" class="node default"><rect height="54" width="156.953125" y="-27" x="-78.4765625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.4765625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.953125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>年龄计数器+1</p></span></div></foreignObject></g></g><g transform="translate(147, 741)" id="flowchart-J-2323" class="node default"><polygon transform="translate(-139,139)" class="label-container" points="139,0 278,-139 139,-278 0,-139"></polygon><g transform="translate(-100, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>年龄 &gt;= MaxTenuringThreshold?</p></span></div></foreignObject></g></g><g transform="translate(917.1875, 1184)" id="flowchart-K-2329" class="node default"><rect height="54" width="240.90625" y="-27" x="-120.453125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-90.453125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="180.90625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>下次GC时在S0和S1间复制</p></span></div></foreignObject></g></g></g></g></g></svg><p id="zdyvef_18"><span class="control" id="zdyvef_22">内存配置参数：</span></p><div class="code-block" data-lang="bash">
# 堆内存总大小
-Xms2g -Xmx4g

# 新生代和老年代比例 (默认 1:2)
-XX:NewRatio=2

# Eden和Survivor比例 (默认 8:1:1)
-XX:SurvivorRatio=8

# 对象进入老年代的年龄阈值
-XX:MaxTenuringThreshold=15

# 新生代大小
-Xmn1g
-XX:NewSize=1g
-XX:MaxNewSize=1g
</div></section><section class="chapter"><h3 id="q2-tlab" data-toc="q2-tlab">Q2: 什么是TLAB？它是如何解决内存分配竞争问题的？</h3><p id="zdyvef_23"><span class="control" id="zdyvef_28">答案：</span></p><p id="zdyvef_24"><span class="control" id="zdyvef_29">TLAB（Thread Local Allocation Buffer）机制：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 2184.828125 420"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="2184.828125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 48.5)" class="root"><g class="clusters"><g data-look="classic" id="分配流程" class="cluster"><rect height="307" width="1501.6875" y="8" x="8" style=""></rect><g transform="translate(726.7890625, 8)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>分配流程</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_H_I_6" d="M185.625,164.5L191.875,164.5C198.125,164.5,210.625,164.5,220.042,164.542C229.458,164.583,235.792,164.667,241.458,164.741C247.125,164.816,252.125,164.882,254.625,164.914L257.125,164.947"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_J_7" d="M410.474,138.349L422.419,133.041C434.363,127.733,458.252,117.116,491.122,111.808C523.992,106.5,565.844,106.5,607.695,106.5C649.547,106.5,691.398,106.5,737.507,106.5C783.615,106.5,833.979,106.5,883.008,106.5C932.036,106.5,979.729,106.5,1008.704,106.5C1037.678,106.5,1047.935,106.5,1057.525,106.5C1067.115,106.5,1076.038,106.5,1080.499,106.5L1084.961,106.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_K_8" d="M410.474,191.651L422.419,196.792C434.363,201.934,458.252,212.217,473.989,217.358C489.727,222.5,497.313,222.5,504.232,222.5C511.151,222.5,517.404,222.5,520.53,222.5L523.656,222.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_K_L_9" d="M687.734,222.5L695.32,222.5C702.906,222.5,718.078,222.5,729.457,222.5C740.836,222.5,748.422,222.5,755.341,222.5C762.26,222.5,768.513,222.5,771.639,222.5L774.766,222.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_L_M_10" d="M989.922,222.5L996.172,222.5C1002.422,222.5,1014.922,222.5,1024.297,222.5C1033.672,222.5,1039.922,222.5,1045.505,222.5C1051.089,222.5,1056.005,222.5,1058.464,222.5L1060.922,222.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_N_11" d="M1249.039,106.5L1259.296,106.5C1269.552,106.5,1290.065,106.5,1304.756,109.083C1319.447,111.667,1328.315,116.833,1336.607,121.664C1344.9,126.495,1352.616,130.991,1356.474,133.239L1360.332,135.486"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_M_N_12" d="M1273.078,222.5L1279.328,222.5C1285.578,222.5,1298.078,222.5,1308.762,219.917C1319.447,217.333,1328.315,212.167,1336.607,207.336C1344.9,202.505,1352.616,198.009,1356.474,195.761L1360.332,193.514"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(733.25, 106.5)" class="edgeLabel"><g transform="translate(-8.015625, -12)" class="label"><foreignObject height="24" width="16.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>是</p></span></div></foreignObject></g></g><g transform="translate(482.140625, 222.5)" class="edgeLabel"><g transform="translate(-8.015625, -12)" class="label"><foreignObject height="24" width="16.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>否</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(115.5625, 164.5)" id="flowchart-H-2457" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>新对象创建</p></span></div></foreignObject></g></g><g transform="translate(348.625, 164.5)" id="flowchart-I-2458" class="node default"><polygon transform="translate(-88,88)" class="label-container" points="88,0 176,-88 88,-176 0,-88"></polygon><g transform="translate(-61, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="122"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>TLAB有足够空间?</p></span></div></foreignObject></g></g><g transform="translate(1169, 106.5)" id="flowchart-J-2460" class="node default"><rect height="78" width="160.078125" y="-39" x="-80.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-50.0390625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="100.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>在TLAB中分配<br>无需同步</p></span></div></foreignObject></g></g><g transform="translate(607.6953125, 222.5)" id="flowchart-K-2462" class="node default"><rect height="54" width="160.078125" y="-27" x="-80.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-50.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="100.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>TLAB重新分配</p></span></div></foreignObject></g></g><g transform="translate(884.34375, 222.5)" id="flowchart-L-2464" class="node default"><rect height="54" width="211.15625" y="-27" x="-105.578125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-75.578125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="151.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>在Eden区分配新TLAB</p></span></div></foreignObject></g></g><g transform="translate(1169, 222.5)" id="flowchart-M-2466" class="node default"><rect height="54" width="208.15625" y="-27" x="-104.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-74.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="148.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>在新TLAB中分配对象</p></span></div></foreignObject></g></g><g transform="translate(1410.1328125, 164.5)" id="flowchart-N-2468" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>分配成功</p></span></div></foreignObject></g></g></g></g><g transform="translate(1551.6875, 0)" class="root"><g class="clusters"><g data-look="classic" id="TLAB内存分配" class="cluster"><rect height="404" width="617.140625" y="8" x="8" style=""></rect><g transform="translate(266.53125, 8)" class="cluster-label"><foreignObject height="24" width="100.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>TLAB内存分配</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M145.969,82L152.219,82C158.469,82,170.969,82,180.344,82C189.719,82,195.969,82,201.552,82C207.135,82,212.052,82,214.51,82L216.969,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_1" d="M145.969,210L152.219,210C158.469,210,170.969,210,180.344,210C189.719,210,195.969,210,201.552,210C207.135,210,212.052,210,214.51,210L216.969,210"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_2" d="M145.969,338L152.219,338C158.469,338,170.969,338,180.344,338C189.719,338,195.969,338,201.552,338C207.135,338,212.052,338,214.51,338L216.969,338"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_G_3" d="M401.563,82L407.813,82C414.063,82,426.563,82,438.93,90.417C451.298,98.833,463.534,115.667,475.377,131.961C487.221,148.255,498.673,164.01,504.398,171.887L510.124,179.764"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_G_4" d="M401.563,210L407.813,210C414.063,210,426.563,210,435.938,210C445.313,210,451.563,210,457.146,210C462.729,210,467.646,210,470.104,210L472.563,210"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_F_G_5" d="M401.563,338L407.813,338C414.063,338,426.563,338,438.93,329.583C451.298,321.167,463.534,304.333,475.377,288.039C487.221,271.745,498.673,255.99,504.398,248.113L510.124,240.236"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(95.734375, 82)" id="flowchart-A-2445" class="node default"><rect height="54" width="100.46875" y="-27" x="-50.234375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-20.234375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="40.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>线程1</p></span></div></foreignObject></g></g><g transform="translate(311.265625, 82)" id="flowchart-B-2446" class="node default"><rect height="78" width="180.59375" y="-39" x="-90.296875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-60.296875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="120.59375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>TLAB1<br>线程1私有缓冲区</p></span></div></foreignObject></g></g><g transform="translate(95.734375, 210)" id="flowchart-C-2447" class="node default"><rect height="54" width="100.46875" y="-27" x="-50.234375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-20.234375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="40.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>线程2</p></span></div></foreignObject></g></g><g transform="translate(311.265625, 210)" id="flowchart-D-2448" class="node default"><rect height="78" width="180.59375" y="-39" x="-90.296875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-60.296875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="120.59375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>TLAB2<br>线程2私有缓冲区</p></span></div></foreignObject></g></g><g transform="translate(95.734375, 338)" id="flowchart-E-2449" class="node default"><rect height="54" width="100.46875" y="-27" x="-50.234375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-20.234375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="40.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>线程3</p></span></div></foreignObject></g></g><g transform="translate(311.265625, 338)" id="flowchart-F-2450" class="node default"><rect height="78" width="180.59375" y="-39" x="-90.296875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-60.296875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="120.59375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>TLAB3<br>线程3私有缓冲区</p></span></div></foreignObject></g></g><g transform="translate(532.1015625, 210)" id="flowchart-G-2452" class="node default"><rect height="54" width="111.078125" y="-27" x="-55.5390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-25.5390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="51.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Eden区</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="zdyvef_26"><span class="control" id="zdyvef_30">TLAB优势和配置：</span></p><ol class="list _decimal" id="zdyvef_27" type="1"><li class="list__item" id="zdyvef_31"><p id="zdyvef_34"><span class="control" id="zdyvef_36">解决的问题</span></p><ul class="list _bullet" id="zdyvef_35"><li class="list__item" id="zdyvef_37"><p id="zdyvef_40">多线程并发分配内存时的竞争</p></li><li class="list__item" id="zdyvef_38"><p id="zdyvef_41">避免在Eden区使用同步锁</p></li><li class="list__item" id="zdyvef_39"><p id="zdyvef_42">提高内存分配效率</p></li></ul></li><li class="list__item" id="zdyvef_32"><p id="zdyvef_43"><span class="control" id="zdyvef_45">工作原理</span></p><ul class="list _bullet" id="zdyvef_44"><li class="list__item" id="zdyvef_46"><p id="zdyvef_49">每个线程在Eden区都有一小块私有空间</p></li><li class="list__item" id="zdyvef_47"><p id="zdyvef_50">线程优先在自己的TLAB中分配对象</p></li><li class="list__item" id="zdyvef_48"><p id="zdyvef_51">TLAB用完后申请新的TLAB</p></li></ul></li><li class="list__item" id="zdyvef_33"><p id="zdyvef_52"><span class="control" id="zdyvef_54">相关参数</span></p><div class="code-block" data-lang="bash">
# 启用TLAB（默认开启）
-XX:+UseTLAB

# TLAB大小（默认1%的Eden空间）
-XX:TLABSize=256k

# TLAB最小大小
-XX:MinTLABSize=2k

# 打印TLAB相关信息
-XX:+PrintTLAB
</div></li></ol></section><section class="chapter"><h3 id="q3" data-toc="q3">Q3: 对象在堆内存中的分配策略是什么？什么情况下对象会直接进入老年代？</h3><p id="zdyvef_55"><span class="control" id="zdyvef_60">答案：</span></p><p id="zdyvef_56"><span class="control" id="zdyvef_61">对象分配策略：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 635.53125 1413.3125" height="1413.3125" class="flowchart" xmlns="http://www.w3.org/2000/svg" width="635.53125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M314.512,62L314.512,66.167C314.512,70.333,314.512,78.667,314.553,84.958C314.595,91.25,314.678,95.5,314.749,99.083C314.819,102.667,314.876,105.584,314.905,107.042L314.933,108.501"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M276.974,224.619L264.048,237.042C251.122,249.465,225.27,274.31,212.344,289.817C199.418,305.323,199.418,311.49,199.418,316.99C199.418,322.49,199.418,327.323,199.418,329.74L199.418,332.156"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_D_2" d="M365.269,212.399L394.632,226.859C423.994,241.318,482.72,270.237,512.083,295.363C541.445,320.49,541.445,341.823,541.445,361.156C541.445,380.49,541.445,397.823,541.445,425.246C541.445,452.669,541.445,490.182,541.445,529.695C541.445,569.208,541.445,610.721,541.445,642.145C541.445,673.568,541.445,694.901,541.445,714.234C541.445,733.568,541.445,750.901,541.445,768.234C541.445,785.568,541.445,802.901,541.445,820.234C541.445,837.568,541.445,854.901,541.445,882.074C541.445,909.247,541.445,946.26,541.445,985.273C541.445,1024.286,541.445,1065.299,541.445,1088.889C541.445,1112.479,541.445,1118.646,541.445,1124.146C541.445,1129.646,541.445,1134.479,541.445,1136.896L541.445,1139.313"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_E_3" d="M199.418,390.156L199.418,394.323C199.418,398.49,199.418,406.823,199.46,413.115C199.501,419.406,199.585,423.656,199.655,427.24C199.725,430.823,199.782,433.74,199.811,435.199L199.84,436.657"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_4" d="M155.92,571.736L142.195,585.152C128.47,598.569,101.02,625.402,87.295,649.485C73.57,673.568,73.57,694.901,73.57,714.234C73.57,733.568,73.57,750.901,73.57,768.234C73.57,785.568,73.57,802.901,73.57,820.234C73.57,837.568,73.57,854.901,73.57,882.074C73.57,909.247,73.57,946.26,73.57,985.273C73.57,1024.286,73.57,1065.299,74.245,1088.889C74.92,1112.479,76.27,1118.646,77.477,1124.161C78.684,1129.677,79.749,1134.541,80.281,1136.973L80.813,1139.405"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_G_5" d="M237.531,578.121L246.816,590.474C256.101,602.826,274.672,627.53,283.957,642.966C293.242,658.401,293.242,664.568,293.242,670.068C293.242,675.568,293.242,680.401,293.242,682.818L293.242,685.234"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_H_6" d="M293.242,743.234L293.242,747.401C293.242,751.568,293.242,759.901,293.242,766.151C293.242,772.401,293.242,776.568,293.242,780.068C293.242,783.568,293.242,786.401,293.242,787.818L293.242,789.234"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_H_I_7" d="M293.242,847.234L293.242,851.401C293.242,855.568,293.242,863.901,293.284,870.193C293.326,876.484,293.409,880.734,293.479,884.318C293.549,887.901,293.607,890.818,293.635,892.277L293.664,893.735"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_F_8" d="M252.774,1028.844L240.879,1041.756C228.983,1054.667,205.193,1080.49,188.777,1096.484C172.362,1112.479,163.322,1118.646,154.832,1124.437C146.342,1130.228,138.404,1135.643,134.434,1138.351L130.465,1141.058"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_J_9" d="M304.731,1058.824L305.819,1066.738C306.907,1074.653,309.082,1090.483,310.17,1101.481C311.258,1112.479,311.258,1118.646,311.258,1124.146C311.258,1129.646,311.258,1134.479,311.258,1136.896L311.258,1139.313"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_F_K_10" d="M87.578,1197.313L87.578,1201.479C87.578,1205.646,87.578,1213.979,87.578,1226.813C87.578,1239.646,87.578,1256.979,87.578,1274.313C87.578,1291.646,87.578,1308.979,101.318,1320.794C115.058,1332.609,142.538,1338.906,169.368,1345.054C196.198,1351.202,222.378,1357.201,235.468,1360.2L248.558,1363.2"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_L_11" d="M541.445,1197.313L541.445,1201.479C541.445,1205.646,541.445,1213.979,536.834,1220.229C532.223,1226.479,523.001,1230.646,514.386,1234.538C505.771,1238.43,497.764,1242.048,493.761,1243.857L489.757,1245.666"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_L_12" d="M311.258,1197.313L311.258,1201.479C311.258,1205.646,311.258,1213.979,315.869,1220.229C320.48,1226.479,329.702,1230.646,338.317,1234.538C346.932,1238.43,354.939,1242.048,358.943,1243.857L362.946,1245.666"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_L_K_13" d="M426.352,1301.313L426.352,1305.479C426.352,1309.646,426.352,1317.979,421.871,1324.229C417.39,1330.479,408.429,1334.646,400.072,1338.531C391.714,1342.417,383.962,1346.022,380.086,1347.824L376.21,1349.626"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(199.41796875, 299.15625)" class="edgeLabel"><g transform="translate(-24.0390625, -12)" class="label"><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>小对象</p></span></div></foreignObject></g></g><g transform="translate(541.4453125, 716.234375)" class="edgeLabel"><g transform="translate(-24.0390625, -12)" class="label"><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>大对象</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(73.5703125, 820.234375)" class="edgeLabel"><g transform="translate(-8.015625, -12)" class="label"><foreignObject height="24" width="16.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>是</p></span></div></foreignObject></g></g><g transform="translate(293.2421875, 652.234375)" class="edgeLabel"><g transform="translate(-8.015625, -12)" class="label"><foreignObject height="24" width="16.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>否</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(181.40234375, 1106.3125)" class="edgeLabel"><g transform="translate(-8.015625, -12)" class="label"><foreignObject height="24" width="16.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>是</p></span></div></foreignObject></g></g><g transform="translate(311.2578125, 1106.3125)" class="edgeLabel"><g transform="translate(-8.015625, -12)" class="label"><foreignObject height="24" width="16.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>否</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(314.51171875, 35)" id="flowchart-A-2584" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>新对象创建</p></span></div></foreignObject></g></g><g transform="translate(314.51171875, 187.078125)" id="flowchart-B-2585" class="node default"><polygon transform="translate(-75.078125,75.078125)" class="label-container" points="75.078125,0 150.15625,-75.078125 75.078125,-150.15625 0,-75.078125"></polygon><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>对象大小检查</p></span></div></foreignObject></g></g><g transform="translate(199.41796875, 363.15625)" id="flowchart-C-2587" class="node default"><rect height="54" width="191.203125" y="-27" x="-95.6015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-65.6015625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="131.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>优先在Eden区分配</p></span></div></foreignObject></g></g><g transform="translate(541.4453125, 1170.3125)" id="flowchart-D-2589" class="node default"><rect height="54" width="172.171875" y="-27" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>直接进入老年代</p></span></div></foreignObject></g></g><g transform="translate(199.41796875, 527.6953125)" id="flowchart-E-2591" class="node default"><polygon transform="translate(-87.5390625,87.5390625)" class="label-container" points="87.5390625,0 175.078125,-87.5390625 87.5390625,-175.078125 0,-87.5390625"></polygon><g transform="translate(-60.5390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="121.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Eden区空间足够?</p></span></div></foreignObject></g></g><g transform="translate(87.578125, 1170.3125)" id="flowchart-F-2593" class="node default"><rect height="54" width="159.15625" y="-27" x="-79.578125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-49.578125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="99.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>在Eden区分配</p></span></div></foreignObject></g></g><g transform="translate(293.2421875, 716.234375)" id="flowchart-G-2595" class="node default"><rect height="54" width="156.921875" y="-27" x="-78.4609375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.4609375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.921875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>触发Minor GC</p></span></div></foreignObject></g></g><g transform="translate(293.2421875, 820.234375)" id="flowchart-H-2597" class="node default"><rect height="54" width="143.125" y="-27" x="-71.5625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-41.5625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="83.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>清理Eden区</p></span></div></foreignObject></g></g><g transform="translate(293.2421875, 983.2734375)" id="flowchart-I-2599" class="node default"><polygon transform="translate(-86.0390625,86.0390625)" class="label-container" points="86.0390625,0 172.078125,-86.0390625 86.0390625,-172.078125 0,-86.0390625"></polygon><g transform="translate(-59.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="118.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>清理后空间足够?</p></span></div></foreignObject></g></g><g transform="translate(311.2578125, 1170.3125)" id="flowchart-J-2603" class="node default"><rect height="54" width="188.203125" y="-27" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>分配担保到老年代</p></span></div></foreignObject></g></g><g transform="translate(314.51171875, 1378.3125)" id="flowchart-K-2605" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>分配成功</p></span></div></foreignObject></g></g><g transform="translate(426.3515625, 1274.3125)" id="flowchart-L-2607" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>在老年代分配</p></span></div></foreignObject></g></g></g></g></g></svg><p id="zdyvef_58"><span class="control" id="zdyvef_62">直接进入老年代的情况：</span></p><ol class="list _decimal" id="zdyvef_59" type="1"><li class="list__item" id="zdyvef_63"><p id="zdyvef_67"><span class="control" id="zdyvef_70">大对象直接分配</span></p><div class="code-block" data-lang="bash">
# 大对象阈值配置
-XX:PretenureSizeThreshold=1m
</div><ul class="list _bullet" id="zdyvef_69"><li class="list__item" id="zdyvef_71"><p id="zdyvef_73">超过阈值的对象直接在老年代分配</p></li><li class="list__item" id="zdyvef_72"><p id="zdyvef_74">避免在新生代进行大量复制操作</p></li></ul></li><li class="list__item" id="zdyvef_64"><p id="zdyvef_75"><span class="control" id="zdyvef_77">长期存活对象</span></p><ul class="list _bullet" id="zdyvef_76"><li class="list__item" id="zdyvef_78"><p id="zdyvef_80">对象年龄达到阈值（默认15岁）</p></li><li class="list__item" id="zdyvef_79"><p id="zdyvef_81">在Survivor区中经历多次GC仍存活</p></li></ul></li><li class="list__item" id="zdyvef_65"><p id="zdyvef_82"><span class="control" id="zdyvef_84">动态年龄判定</span></p><ul class="list _bullet" id="zdyvef_83"><li class="list__item" id="zdyvef_85"><p id="zdyvef_87">Survivor区中年龄1+年龄2+...+年龄n的对象总和超过Survivor空间的一半</p></li><li class="list__item" id="zdyvef_86"><p id="zdyvef_88">年龄大于等于n的对象直接进入老年代</p></li></ul></li><li class="list__item" id="zdyvef_66"><p id="zdyvef_89"><span class="control" id="zdyvef_91">空间分配担保</span></p><ul class="list _bullet" id="zdyvef_90"><li class="list__item" id="zdyvef_92"><p id="zdyvef_94">Minor GC时Survivor空间不够</p></li><li class="list__item" id="zdyvef_93"><p id="zdyvef_95">直接进入老年代</p></li></ul></li></ol></section><section class="chapter"><h3 id="q4" data-toc="q4">Q4: 什么是空间分配担保？它是如何工作的？</h3><p id="zdyvef_96"><span class="control" id="zdyvef_102">答案：</span></p><p id="zdyvef_97"><span class="control" id="zdyvef_103">空间分配担保机制：</span></p><svg aria-roledescription="sequence" role="graphics-document document" viewBox="-50 -10 871 1020" style="max-width: 871px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g><rect class="actor actor-bottom" ry="3" rx="3" name="Old" height="65" width="150" stroke="#666" fill="#eaeaea" y="934" x="600"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="966.5" x="675"><tspan dy="0" x="675">老年代</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Survivor" height="65" width="150" stroke="#666" fill="#eaeaea" y="934" x="400"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="966.5" x="475"><tspan dy="0" x="475">Survivor区</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Eden" height="65" width="150" stroke="#666" fill="#eaeaea" y="934" x="200"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="966.5" x="275"><tspan dy="0" x="275">Eden区</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="App" height="65" width="150" stroke="#666" fill="#eaeaea" y="934" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="966.5" x="75"><tspan dy="0" x="75">应用程序</tspan></text></g><g><line name="Old" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="934" x2="675" y1="5" x1="675" id="actor204"></line><g id="root-204"><rect class="actor actor-top" ry="3" rx="3" name="Old" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="600"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="675"><tspan dy="0" x="675">老年代</tspan></text></g></g><g><line name="Survivor" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="934" x2="475" y1="5" x1="475" id="actor203"></line><g id="root-203"><rect class="actor actor-top" ry="3" rx="3" name="Survivor" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="400"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="475"><tspan dy="0" x="475">Survivor区</tspan></text></g></g><g><line name="Eden" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="934" x2="275" y1="5" x1="275" id="actor202"></line><g id="root-202"><rect class="actor actor-top" ry="3" rx="3" name="Eden" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="200"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="275"><tspan dy="0" x="275">Eden区</tspan></text></g></g><g><line name="App" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="934" x2="75" y1="5" x1="75" id="actor201"></line><g id="root-201"><rect class="actor actor-top" ry="3" rx="3" name="App" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="75"><tspan dy="0" x="75">应用程序</tspan></text></g></g><g></g><defs><symbol height="24" width="24" id="computer"><path d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z" transform="scale(.5)"></path></symbol></defs><defs><symbol clip-rule="evenodd" fill-rule="evenodd" id="database"><path d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z" transform="scale(.5)"></path></symbol></defs><defs><symbol height="24" width="24" id="clock"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z" transform="scale(.5)"></path></symbol></defs><defs><marker orient="auto-start-reverse" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="7.9" id="arrowhead"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker refY="4.5" refX="4" orient="auto" markerHeight="8" markerWidth="15" id="crosshead"><path style="stroke-dasharray: 0, 0;" d="M 1,2 L 6,7 M 6,2 L 1,7" stroke-width="1pt" stroke="#000000" fill="none"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="15.5" id="filled-head"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="40" markerWidth="60" refY="15" refX="15" id="sequencenumber"><circle r="6" cy="15" cx="15"></circle></marker></defs><g><rect class="note" height="39" width="165" stroke="#666" fill="#EDF2AE" y="543" x="592.5"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="548" x="675"><tspan x="675">检查老年代可用空间</tspan></text></g><g><line class="loopLine" y2="592" x2="761" y1="592" x1="591"></line><line class="loopLine" y2="904" x2="761" y1="592" x1="761"></line><line class="loopLine" y2="904" x2="761" y1="904" x1="591"></line><line class="loopLine" y2="904" x2="591" y1="592" x1="591"></line><line style="stroke-dasharray: 3, 3;" class="loopLine" y2="738" x2="761" y1="738" x1="591"></line><polygon class="labelBox" points="591,592 641,592 641,605 632.6,612 591,612"></polygon><text style="font-size: 16px; font-weight: 400;" class="labelText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="605" x="616">alt</text><text style="font-size: 16px; font-weight: 400;" class="loopText" text-anchor="middle" y="610" x="701"><tspan x="701">[老年代空间-</tspan></text><text style="font-size: 16px; font-weight: 400;" class="loopText" text-anchor="middle" y="629" x="701"><tspan x="701">足够]</tspan></text><text style="font-size: 16px; font-weight: 400;" class="loopText" text-anchor="middle" y="756" x="676">[老年代空间-</text><text style="font-size: 16px; font-weight: 400;" class="loopText" text-anchor="middle" y="775" x="676">不足]</text></g><g><line class="loopLine" y2="249" x2="771" y1="249" x1="191"></line><line class="loopLine" y2="914" x2="771" y1="249" x1="771"></line><line class="loopLine" y2="914" x2="771" y1="914" x1="191"></line><line class="loopLine" y2="914" x2="191" y1="249" x1="191"></line><line style="stroke-dasharray: 3, 3;" class="loopLine" y2="455" x2="771" y1="455" x1="191"></line><polygon class="labelBox" points="191,249 241,249 241,262 232.6,269 191,269"></polygon><text style="font-size: 16px; font-weight: 400;" class="labelText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="262" x="216">alt</text><text style="font-size: 16px; font-weight: 400;" class="loopText" text-anchor="middle" y="267" x="506"><tspan x="506">[Survivor空间足够]</tspan></text><text style="font-size: 16px; font-weight: 400;" class="loopText" text-anchor="middle" y="473" x="481">[Survivor空间不足]</text></g><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="80" x="174">对象分配请求</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="113" x2="271" y1="113" x1="76"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="128" x="276">检查空间不足</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 276,161 C 336,151 336,191 276,181"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="206" x="374">准备Minor GC</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="239" x2="471" y1="239" x1="276"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="299" x="476">接收存活对象</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 476,332 C 536,322 536,362 476,352"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="377" x="276">清空Eden区</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 276,410 C 336,400 336,440 276,430"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="500" x="574">空间分配担保</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="533" x2="671" y1="533" x1="476"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="660" x="676">接收对象</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 676,693 C 736,683 736,723 676,713"></path><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="801" x="676">触发Full GC</text><path style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" d="M 676,834 C 736,824 736,864 676,854"></path></svg><p id="zdyvef_99"><span class="control" id="zdyvef_104">分配担保检查流程：</span></p><div class="code-block" data-lang="bash">
# 相关JVM参数
-XX:+HandlePromotionFailure  # JDK6u24后默认开启
</div><ol class="list _decimal" id="zdyvef_101" type="1"><li class="list__item" id="zdyvef_105"><p id="zdyvef_107"><span class="control" id="zdyvef_109">担保检查条件</span></p><ul class="list _bullet" id="zdyvef_108"><li class="list__item" id="zdyvef_110"><p id="zdyvef_112">Minor GC前检查老年代可用空间</p></li><li class="list__item" id="zdyvef_111"><p id="zdyvef_113">是否大于新生代所有对象总空间</p></li></ul></li><li class="list__item" id="zdyvef_106"><p id="zdyvef_114"><span class="control" id="zdyvef_116">检查结果处理</span></p><ul class="list _bullet" id="zdyvef_115"><li class="list__item" id="zdyvef_117"><p id="zdyvef_120">空间足够：正常进行Minor GC</p></li><li class="list__item" id="zdyvef_118"><p id="zdyvef_121">空间不足：检查历史平均晋升大小</p></li><li class="list__item" id="zdyvef_119"><p id="zdyvef_122">仍不足：触发Full GC</p></li></ul></li></ol></section></section><section class="chapter"><h2 id="zdyvef_6" data-toc="zdyvef_6">🏛️ 方法区演进</h2><section class="chapter"><h3 id="q5-jdk8" data-toc="q5-jdk8">Q5: 永久代和元空间有什么区别？为什么JDK8要移除永久代？</h3><p id="zdyvef_125"><span class="control" id="zdyvef_132">答案：</span></p><p id="zdyvef_126"><span class="control" id="zdyvef_133">永久代 vs 元空间对比：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1136.984375 660"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1136.984375" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="subGraph1" class="cluster"><rect height="644" width="574.625" y="8" x="8" style=""></rect><g transform="translate(221.875, 8)" class="cluster-label"><foreignObject height="24" width="146.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>JDK8及之后 - 元空间</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_J_6" d="M193.742,100.664L206.686,95.553C219.63,90.443,245.518,80.221,266.926,75.111C288.335,70,305.263,70,321.525,70C337.786,70,353.382,70,361.179,70L368.977,70"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_K_7" d="M193.742,143.336L206.686,148.447C219.63,153.557,245.518,163.779,266.926,168.889C288.335,174,305.263,174,321.525,174C337.786,174,353.382,174,361.179,174L368.977,174"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_L_M_8" d="M208.087,303L218.641,298.833C229.194,294.667,250.3,286.333,268.649,282.167C286.999,278,302.591,278,317.517,278C332.443,278,346.702,278,353.831,278L360.961,278"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_N_O_9" d="M193.742,516.664L206.686,511.553C219.63,506.443,245.518,496.221,264.923,491.111C284.328,486,297.25,486,309.505,486C321.76,486,333.349,486,339.143,486L344.938,486"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_N_P_10" d="M193.742,559.336L206.686,564.447C219.63,569.557,245.518,579.779,264.923,584.889C284.328,590,297.25,590,309.505,590C321.76,590,333.349,590,339.143,590L344.938,590"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_L_Q_11" d="M208.087,357L218.641,361.167C229.194,365.333,250.3,373.667,263.978,377.833C277.656,382,283.906,382,289.49,382C295.073,382,299.99,382,302.448,382L304.906,382"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(139.703125, 122)" id="flowchart-I-2874" class="node default"><rect height="54" width="108.078125" y="-27" x="-54.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>堆内存</p></span></div></foreignObject></g></g><g transform="translate(427.015625, 70)" id="flowchart-J-2875" class="node default"><rect height="54" width="108.078125" y="-27" x="-54.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>新生代</p></span></div></foreignObject></g></g><g transform="translate(427.015625, 174)" id="flowchart-K-2877" class="node default"><rect height="54" width="108.078125" y="-27" x="-54.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>老年代</p></span></div></foreignObject></g></g><g transform="translate(139.703125, 330)" id="flowchart-L-2878" class="node default"><rect height="54" width="188.40625" y="-27" x="-94.203125" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-64.203125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="128.40625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>元空间 Metaspace</p></span></div></foreignObject></g></g><g transform="translate(427.015625, 278)" id="flowchart-M-2879" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>类元数据</p></span></div></foreignObject></g></g><g transform="translate(139.703125, 538)" id="flowchart-N-2880" class="node default"><rect height="54" width="108.078125" y="-27" x="-54.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>堆内存</p></span></div></foreignObject></g></g><g transform="translate(427.015625, 486)" id="flowchart-O-2881" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>运行时常量池</p></span></div></foreignObject></g></g><g transform="translate(427.015625, 590)" id="flowchart-P-2883" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>字符串常量池</p></span></div></foreignObject></g></g><g transform="translate(427.015625, 382)" id="flowchart-Q-2884" class="node default"><rect height="54" width="236.21875" y="-27" x="-118.109375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-88.109375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="176.21875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>本地内存 Native Memory</p></span></div></foreignObject></g></g></g></g><g transform="translate(624.625, 0)" class="root"><g class="clusters"><g data-look="classic" id="subGraph0" class="cluster"><rect height="644" width="496.359375" y="8" x="8" style=""></rect><g transform="translate(182.7421875, 8)" class="cluster-label"><foreignObject height="24" width="146.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>JDK7及之前 - 永久代</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M188.43,99.767L200.488,94.806C212.547,89.845,236.664,79.922,254.368,74.961C272.073,70,283.365,70,293.99,70C304.615,70,314.573,70,319.552,70L324.531,70"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_C_1" d="M188.43,144.233L200.488,149.194C212.547,154.155,236.664,164.078,254.368,169.039C272.073,174,283.365,174,293.99,174C304.615,174,314.573,174,319.552,174L324.531,174"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_E_2" d="M156.266,407L173.685,385.5C191.104,364,225.943,321,248.34,299.5C270.737,278,280.693,278,289.982,278C299.271,278,307.893,278,312.204,278L316.516,278"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_F_3" d="M200.017,407L210.144,402.833C220.271,398.667,240.526,390.333,254.296,386.167C268.066,382,275.352,382,281.97,382C288.589,382,294.54,382,297.516,382L300.492,382"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_G_4" d="M200.017,461L210.144,465.167C220.271,469.333,240.526,477.667,254.296,481.833C268.066,486,275.352,486,281.97,486C288.589,486,294.54,486,297.516,486L300.492,486"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_H_5" d="M156.266,461L173.685,482.5C191.104,504,225.943,547,246.487,568.5C267.031,590,273.281,590,278.865,590C284.448,590,289.365,590,291.823,590L294.281,590"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(134.390625, 122)" id="flowchart-A-2861" class="node default"><rect height="54" width="108.078125" y="-27" x="-54.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>堆内存</p></span></div></foreignObject></g></g><g transform="translate(382.5703125, 70)" id="flowchart-B-2862" class="node default"><rect height="54" width="108.078125" y="-27" x="-54.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>新生代</p></span></div></foreignObject></g></g><g transform="translate(382.5703125, 174)" id="flowchart-C-2864" class="node default"><rect height="54" width="108.078125" y="-27" x="-54.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>老年代</p></span></div></foreignObject></g></g><g transform="translate(134.390625, 434)" id="flowchart-D-2865" class="node default"><rect height="54" width="177.78125" y="-27" x="-88.890625" data-et="node" data-id="abc" style="fill:#ffcdd2 !important" class="basic label-container"></rect><g transform="translate(-58.890625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="117.78125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>永久代 PermGen</p></span></div></foreignObject></g></g><g transform="translate(382.5703125, 278)" id="flowchart-E-2866" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>类元数据</p></span></div></foreignObject></g></g><g transform="translate(382.5703125, 382)" id="flowchart-F-2868" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>运行时常量池</p></span></div></foreignObject></g></g><g transform="translate(382.5703125, 486)" id="flowchart-G-2870" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>字符串常量池</p></span></div></foreignObject></g></g><g transform="translate(382.5703125, 590)" id="flowchart-H-2871" class="node default"><rect height="54" width="168.578125" y="-27" x="-84.2890625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-54.2890625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="108.578125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>JVM堆内存限制</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="zdyvef_128"><span class="control" id="zdyvef_134">主要区别：</span></p><div class="table-wrapper"><table class="wide" id="zdyvef_129"><thead><tr class="ijRowHead" id="zdyvef_135"><th id="zdyvef_141"><p>特性</p></th><th id="zdyvef_142"><p>永久代 (PermGen)</p></th><th id="zdyvef_143"><p>元空间 (Metaspace)</p></th></tr></thead><tbody><tr id="zdyvef_136"><td id="zdyvef_144"><p><span class="control" id="zdyvef_147">内存位置</span></p></td><td id="zdyvef_145"><p>JVM堆内存</p></td><td id="zdyvef_146"><p>本地内存</p></td></tr><tr id="zdyvef_137"><td id="zdyvef_148"><p><span class="control" id="zdyvef_151">大小限制</span></p></td><td id="zdyvef_149"><p>固定大小</p></td><td id="zdyvef_150"><p>可动态扩展</p></td></tr><tr id="zdyvef_138"><td id="zdyvef_152"><p><span class="control" id="zdyvef_155">GC方式</span></p></td><td id="zdyvef_153"><p>Full GC回收</p></td><td id="zdyvef_154"><p>自动回收</p></td></tr><tr id="zdyvef_139"><td id="zdyvef_156"><p><span class="control" id="zdyvef_159">OOM异常</span></p></td><td id="zdyvef_157"><p>PermGen space</p></td><td id="zdyvef_158"><p>Metaspace</p></td></tr><tr id="zdyvef_140"><td id="zdyvef_160"><p><span class="control" id="zdyvef_163">配置参数</span></p></td><td id="zdyvef_161"><p>-XX:PermSize</p></td><td id="zdyvef_162"><p>-XX:MetaspaceSize</p></td></tr></tbody></table></div><p id="zdyvef_130"><span class="control" id="zdyvef_164">移除永久代的原因：</span></p><ol class="list _decimal" id="zdyvef_131" type="1"><li class="list__item" id="zdyvef_165"><p id="zdyvef_168"><span class="control" id="zdyvef_170">内存限制问题</span></p><ul class="list _bullet" id="zdyvef_169"><li class="list__item" id="zdyvef_171"><p id="zdyvef_173">永久代大小固定，容易OOM</p></li><li class="list__item" id="zdyvef_172"><p id="zdyvef_174">元空间使用本地内存，限制更少</p></li></ul></li><li class="list__item" id="zdyvef_166"><p id="zdyvef_175"><span class="control" id="zdyvef_177">GC效率问题</span></p><ul class="list _bullet" id="zdyvef_176"><li class="list__item" id="zdyvef_178"><p id="zdyvef_180">永久代GC效率低下</p></li><li class="list__item" id="zdyvef_179"><p id="zdyvef_181">元空间自动回收未使用的类</p></li></ul></li><li class="list__item" id="zdyvef_167"><p id="zdyvef_182"><span class="control" id="zdyvef_184">融合HotSpot和JRockit</span></p><ul class="list _bullet" id="zdyvef_183"><li class="list__item" id="zdyvef_185"><p id="zdyvef_187">JRockit没有永久代概念</p></li><li class="list__item" id="zdyvef_186"><p id="zdyvef_188">统一JVM实现</p></li></ul></li></ol></section><section class="chapter"><h3 id="q6" data-toc="q6">Q6: 运行时常量池和字符串常量池有什么区别？它们在内存中的位置如何变化？</h3><p id="zdyvef_189"><span class="control" id="zdyvef_196">答案：</span></p><p id="zdyvef_190"><span class="control" id="zdyvef_197">常量池演进历史：</span></p><svg aria-roledescription="timeline" role="graphics-document document" viewBox="0 -61 1190 630" style="max-width: 1190px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g></g><g></g><defs><marker orient="auto" markerHeight="4" markerWidth="6" refY="2" refX="5" id="arrowhead"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><g transform="translate(100, 50)"><g class="timeline-node section--1"><g><path d="M0 62.8 v-57.8 q0,-5 5,-5 h180 q5,0 5,5 v62.8 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="67.8" x2="190" y1="67.8" x1="0" class="node-line--1"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">JDK6及之前</tspan></text></g></g></g><g transform="translate(100, 167.8)" class="taskWrapper"><g class="timeline-node section--1"><g><path d="M0 62.8 v-57.8 q0,-5 5,-5 h180 q5,0 5,5 v62.8 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="67.8" x2="190" y1="67.8" x1="0" class="node-line--1"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">永久代</tspan></text></g></g></g><g class="lineWrapper"><line stroke-dasharray="5,5" marker-end="url(#arrowhead)" stroke="black" stroke-width="2" y2="519" x2="195" y1="235.60000000000002" x1="195"></line></g><g transform="translate(100, 367.8)" class="eventWrapper"><g class="timeline-node section--1"><g><path d="M0 45 v-40 q0,-5 5,-5 h180 q5,0 5,5 v45 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="50" x2="190" y1="50" x1="0" class="node-line--1"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">运行时常量池</tspan></text></g></g></g><g transform="translate(100, 427.8)" class="eventWrapper"><g class="timeline-node section--1"><g><path d="M0 45 v-40 q0,-5 5,-5 h180 q5,0 5,5 v45 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="50" x2="190" y1="50" x1="0" class="node-line--1"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">字符串常量池</tspan></text></g></g></g><g transform="translate(300, 50)"><g class="timeline-node section-0"><g><path d="M0 62.8 v-57.8 q0,-5 5,-5 h380 q5,0 5,5 v62.8 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="67.8" x2="390" y1="67.8" x1="0" class="node-line-0"></line></g><g transform="translate(195, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">JDK7</tspan></text></g></g></g><g transform="translate(300, 167.8)" class="taskWrapper"><g class="timeline-node section-0"><g><path d="M0 62.8 v-57.8 q0,-5 5,-5 h180 q5,0 5,5 v62.8 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="67.8" x2="190" y1="67.8" x1="0" class="node-line-0"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">永久代</tspan></text></g></g></g><g class="lineWrapper"><line stroke-dasharray="5,5" marker-end="url(#arrowhead)" stroke="black" stroke-width="2" y2="519" x2="395" y1="235.60000000000002" x1="395"></line></g><g transform="translate(300, 367.8)" class="eventWrapper"><g class="timeline-node section-0"><g><path d="M0 45 v-40 q0,-5 5,-5 h180 q5,0 5,5 v45 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="50" x2="190" y1="50" x1="0" class="node-line-0"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">运行时常量池</tspan></text></g></g></g><g transform="translate(500, 167.8)" class="taskWrapper"><g class="timeline-node section-0"><g><path d="M0 62.8 v-57.8 q0,-5 5,-5 h180 q5,0 5,5 v62.8 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="67.8" x2="190" y1="67.8" x1="0" class="node-line-0"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">堆内存</tspan></text></g></g></g><g class="lineWrapper"><line stroke-dasharray="5,5" marker-end="url(#arrowhead)" stroke="black" stroke-width="2" y2="519" x2="595" y1="235.60000000000002" x1="595"></line></g><g transform="translate(500, 367.8)" class="eventWrapper"><g class="timeline-node section-0"><g><path d="M0 45 v-40 q0,-5 5,-5 h180 q5,0 5,5 v45 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="50" x2="190" y1="50" x1="0" class="node-line-0"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">字符串常量池</tspan></text></g></g></g><g transform="translate(700, 50)"><g class="timeline-node section-1"><g><path d="M0 62.8 v-57.8 q0,-5 5,-5 h380 q5,0 5,5 v62.8 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="67.8" x2="390" y1="67.8" x1="0" class="node-line-1"></line></g><g transform="translate(195, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">JDK8+</tspan></text></g></g></g><g transform="translate(700, 167.8)" class="taskWrapper"><g class="timeline-node section-1"><g><path d="M0 62.8 v-57.8 q0,-5 5,-5 h180 q5,0 5,5 v62.8 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="67.8" x2="190" y1="67.8" x1="0" class="node-line-1"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">元空间</tspan></text></g></g></g><g class="lineWrapper"><line stroke-dasharray="5,5" marker-end="url(#arrowhead)" stroke="black" stroke-width="2" y2="519" x2="795" y1="235.60000000000002" x1="795"></line></g><g transform="translate(700, 367.8)" class="eventWrapper"><g class="timeline-node section-1"><g><path d="M0 45 v-40 q0,-5 5,-5 h180 q5,0 5,5 v45 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="50" x2="190" y1="50" x1="0" class="node-line-1"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0"></tspan><tspan dy="1.1em" x="0">运行时常量池(类元数据部分)</tspan></text></g></g></g><g transform="translate(900, 167.8)" class="taskWrapper"><g class="timeline-node section-1"><g><path d="M0 62.8 v-57.8 q0,-5 5,-5 h180 q5,0 5,5 v62.8 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="67.8" x2="190" y1="67.8" x1="0" class="node-line-1"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">堆内存</tspan></text></g></g></g><g class="lineWrapper"><line stroke-dasharray="5,5" marker-end="url(#arrowhead)" stroke="black" stroke-width="2" y2="519" x2="995" y1="235.60000000000002" x1="995"></line></g><g transform="translate(900, 367.8)" class="eventWrapper"><g class="timeline-node section-1"><g><path d="M0 45 v-40 q0,-5 5,-5 h180 q5,0 5,5 v45 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="50" x2="190" y1="50" x1="0" class="node-line-1"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0">字符串常量池</tspan></text></g></g></g><g transform="translate(900, 427.8)" class="eventWrapper"><g class="timeline-node section-1"><g><path d="M0 45 v-40 q0,-5 5,-5 h180 q5,0 5,5 v45 H0 Z" class="node-bkg node-undefined" id="node-undefined"></path><line y2="50" x2="190" y1="50" x1="0" class="node-line-1"></line></g><g transform="translate(95, 10)"><text text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><tspan dy="1em" x="0"></tspan><tspan dy="1.1em" x="0">运行时常量池(其他部分)</tspan></text></g></g></g><text y="20" font-weight="bold" font-size="4ex" x="445">常量池位置演进</text><g class="lineWrapper"><line marker-end="url(#arrowhead)" stroke="black" stroke-width="4" y2="285.6" x2="1140" y1="285.6" x1="50"></line></g></svg><p id="zdyvef_192"><span class="control" id="zdyvef_198">两种常量池的区别：</span></p><div class="table-wrapper"><table class="wide" id="zdyvef_193"><thead><tr class="ijRowHead" id="zdyvef_199"><th id="zdyvef_204"><p>特性</p></th><th id="zdyvef_205"><p>运行时常量池</p></th><th id="zdyvef_206"><p>字符串常量池</p></th></tr></thead><tbody><tr id="zdyvef_200"><td id="zdyvef_207"><p><span class="control" id="zdyvef_210">存储内容</span></p></td><td id="zdyvef_208"><p>类的常量信息、符号引用</p></td><td id="zdyvef_209"><p>字符串字面量</p></td></tr><tr id="zdyvef_201"><td id="zdyvef_211"><p><span class="control" id="zdyvef_214">作用范围</span></p></td><td id="zdyvef_212"><p>类级别</p></td><td id="zdyvef_213"><p>全局级别</p></td></tr><tr id="zdyvef_202"><td id="zdyvef_215"><p><span class="control" id="zdyvef_218">创建时机</span></p></td><td id="zdyvef_216"><p>类加载时</p></td><td id="zdyvef_217"><p>字符串创建时</p></td></tr><tr id="zdyvef_203"><td id="zdyvef_219"><p><span class="control" id="zdyvef_222">回收机制</span></p></td><td id="zdyvef_220"><p>随类一起回收</p></td><td id="zdyvef_221"><p>引用计数回收</p></td></tr></tbody></table></div><p id="zdyvef_194"><span class="control" id="zdyvef_223">字符串常量池示例：</span></p><div class="code-block" data-lang="java">
// 字符串常量池测试
public class StringPoolTest {
    public static void main(String[] args) {
        String s1 = &quot;hello&quot;;        // 字符串字面量，存入常量池
        String s2 = &quot;hello&quot;;        // 引用常量池中的对象
        String s3 = new String(&quot;hello&quot;); // 在堆中创建新对象
        String s4 = s3.intern();    // 获取常量池中的引用
        
        System.out.println(s1 == s2); // true
        System.out.println(s1 == s3); // false
        System.out.println(s1 == s4); // true
    }
}
</div></section></section><section class="chapter"><h2 id="zdyvef_7" data-toc="zdyvef_7">💻 直接内存管理</h2><section class="chapter"><h3 id="q7" data-toc="q7">Q7: 什么是直接内存？它与堆内存有什么区别？</h3><p id="zdyvef_226"><span class="control" id="zdyvef_233">答案：</span></p><p id="zdyvef_227"><span class="control" id="zdyvef_234">直接内存特性：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 960.7421875 742"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="960.7421875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="内存区域对比" class="cluster"><rect height="726" width="944.7421875" y="8" x="8" style=""></rect><g transform="translate(432.29296875, 8)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>内存区域对比</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M159.247,465L167.224,460.833C175.201,456.667,191.155,448.333,204.62,444.167C218.085,440,229.06,440,239.368,440C249.677,440,259.319,440,264.14,440L268.961,440"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_C_1" d="M159.247,519L167.224,523.167C175.201,527.333,191.155,535.667,203.952,539.833C216.749,544,226.388,544,235.361,544C244.333,544,252.639,544,256.792,544L260.945,544"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_E_2" d="M169.609,660L175.859,660C182.109,660,194.609,660,203.984,660C213.359,660,219.609,660,225.193,660C230.776,660,235.693,660,238.151,660L240.609,660"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_F_3" d="M381.039,440L392.014,440C402.99,440,424.94,440,451.821,440C478.702,440,510.514,440,541.66,440C572.805,440,603.283,440,618.522,440L633.762,440"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_G_4" d="M409.391,660L415.641,660C421.891,660,434.391,660,456.547,660C478.702,660,510.514,660,541.66,660C572.805,660,603.283,660,618.522,660L633.762,660"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(476.390625, 35)" class="root"><g class="clusters"><g data-look="classic" id="访问方式" class="cluster"><rect height="308" width="430.8515625" y="8" x="8" style=""></rect><g transform="translate(191.37109375, 8)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>访问方式</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_H_I_5" d="M113.063,112L113.063,120.333C113.063,128.667,113.063,145.333,113.063,157.833C113.063,170.333,113.063,178.667,113.063,186.333C113.063,194,113.063,201,113.063,204.5L113.063,208"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_K_6" d="M315.578,112L315.578,120.333C315.578,128.667,315.578,145.333,315.578,157.833C315.578,170.333,315.578,178.667,315.578,186.333C315.578,194,315.578,201,315.578,204.5L315.578,208"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(113.0625, 85)" id="flowchart-H-3218" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>堆内存访问</p></span></div></foreignObject></g></g><g transform="translate(113.0625, 239)" id="flowchart-I-3219" class="node default"><rect height="54" width="128.484375" y="-27" x="-64.2421875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-34.2421875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="68.484375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>JVM -&gt; 堆</p></span></div></foreignObject></g></g><g transform="translate(315.578125, 85)" id="flowchart-J-3220" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>直接内存访问</p></span></div></foreignObject></g></g><g transform="translate(315.578125, 239)" id="flowchart-K-3221" class="node default"><rect height="54" width="176.546875" y="-27" x="-88.2734375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-58.2734375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="116.546875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>JVM -&gt; 系统内存</p></span></div></foreignObject></g></g></g></g><g transform="translate(107.5546875, 492)" id="flowchart-A-3208" class="node default"><rect height="54" width="120.5" y="-27" x="-60.25" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-30.25, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="60.5"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>JVM内存</p></span></div></foreignObject></g></g><g transform="translate(327, 440)" id="flowchart-B-3209" class="node default"><rect height="54" width="108.078125" y="-27" x="-54.0390625" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>堆内存</p></span></div></foreignObject></g></g><g transform="translate(327, 544)" id="flowchart-C-3211" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>非堆内存</p></span></div></foreignObject></g></g><g transform="translate(107.5546875, 660)" id="flowchart-D-3212" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>系统内存</p></span></div></foreignObject></g></g><g transform="translate(327, 660)" id="flowchart-E-3213" class="node default"><rect height="78" width="164.78125" y="-39" x="-82.390625" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-52.390625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="104.78125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>直接内存<br>Direct Memory</p></span></div></foreignObject></g></g><g transform="translate(699.81640625, 440)" id="flowchart-F-3215" class="node default"><rect height="78" width="124.109375" y="-39" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>GC管理<br>自动回收</p></span></div></foreignObject></g></g><g transform="translate(699.81640625, 660)" id="flowchart-G-3217" class="node default"><rect height="78" width="124.109375" y="-39" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>手动管理<br>程序控制</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="zdyvef_229"><span class="control" id="zdyvef_235">直接内存 vs 堆内存：</span></p><div class="table-wrapper"><table class="wide" id="zdyvef_230"><thead><tr class="ijRowHead" id="zdyvef_236"><th id="zdyvef_242"><p>特性</p></th><th id="zdyvef_243"><p>堆内存</p></th><th id="zdyvef_244"><p>直接内存</p></th></tr></thead><tbody><tr id="zdyvef_237"><td id="zdyvef_245"><p><span class="control" id="zdyvef_248">管理方式</span></p></td><td id="zdyvef_246"><p>JVM自动管理</p></td><td id="zdyvef_247"><p>程序手动管理</p></td></tr><tr id="zdyvef_238"><td id="zdyvef_249"><p><span class="control" id="zdyvef_252">GC影响</span></p></td><td id="zdyvef_250"><p>受GC影响</p></td><td id="zdyvef_251"><p>不受GC影响</p></td></tr><tr id="zdyvef_239"><td id="zdyvef_253"><p><span class="control" id="zdyvef_256">访问效率</span></p></td><td id="zdyvef_254"><p>相对较慢</p></td><td id="zdyvef_255"><p>访问速度快</p></td></tr><tr id="zdyvef_240"><td id="zdyvef_257"><p><span class="control" id="zdyvef_260">内存拷贝</span></p></td><td id="zdyvef_258"><p>需要拷贝</p></td><td id="zdyvef_259"><p>可以零拷贝</p></td></tr><tr id="zdyvef_241"><td id="zdyvef_261"><p><span class="control" id="zdyvef_264">使用场景</span></p></td><td id="zdyvef_262"><p>一般对象存储</p></td><td id="zdyvef_263"><p>NIO、网络通信</p></td></tr></tbody></table></div><p id="zdyvef_231"><span class="control" id="zdyvef_265">直接内存使用示例：</span></p><div class="code-block" data-lang="java">
// DirectByteBuffer使用
ByteBuffer directBuffer = ByteBuffer.allocateDirect(1024);
ByteBuffer heapBuffer = ByteBuffer.allocate(1024);

// 文件通道操作
FileChannel channel = new FileInputStream(&quot;file.txt&quot;).getChannel();
channel.read(directBuffer); // 直接内存，减少拷贝
</div></section><section class="chapter"><h3 id="q8-nio" data-toc="q8-nio">Q8: NIO中的直接内存是如何管理的？有什么优势和风险？</h3><p id="zdyvef_266"><span class="control" id="zdyvef_274">答案：</span></p><p id="zdyvef_267"><span class="control" id="zdyvef_275">NIO直接内存管理：</span></p><svg aria-roledescription="sequence" role="graphics-document document" viewBox="-50 -10 850 749" style="max-width: 850px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g><rect class="actor actor-bottom" ry="3" rx="3" name="Disk" height="65" width="150" stroke="#666" fill="#eaeaea" y="663" x="600"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="695.5" x="675"><tspan dy="0" x="675">磁盘</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="OS" height="65" width="150" stroke="#666" fill="#eaeaea" y="663" x="400"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="695.5" x="475"><tspan dy="0" x="475">操作系统</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="JVM" height="65" width="150" stroke="#666" fill="#eaeaea" y="663" x="200"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="695.5" x="275"><tspan dy="0" x="275">JVM</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="App" height="65" width="150" stroke="#666" fill="#eaeaea" y="663" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="695.5" x="75"><tspan dy="0" x="75">应用程序</tspan></text></g><g><line name="Disk" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="663" x2="675" y1="5" x1="675" id="actor217"></line><g id="root-217"><rect class="actor actor-top" ry="3" rx="3" name="Disk" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="600"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="675"><tspan dy="0" x="675">磁盘</tspan></text></g></g><g><line name="OS" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="663" x2="475" y1="5" x1="475" id="actor216"></line><g id="root-216"><rect class="actor actor-top" ry="3" rx="3" name="OS" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="400"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="475"><tspan dy="0" x="475">操作系统</tspan></text></g></g><g><line name="JVM" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="663" x2="275" y1="5" x1="275" id="actor215"></line><g id="root-215"><rect class="actor actor-top" ry="3" rx="3" name="JVM" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="200"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="275"><tspan dy="0" x="275">JVM</tspan></text></g></g><g><line name="App" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="663" x2="75" y1="5" x1="75" id="actor214"></line><g id="root-214"><rect class="actor actor-top" ry="3" rx="3" name="App" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="75"><tspan dy="0" x="75">应用程序</tspan></text></g></g><g></g><defs><symbol height="24" width="24" id="computer"><path d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z" transform="scale(.5)"></path></symbol></defs><defs><symbol clip-rule="evenodd" fill-rule="evenodd" id="database"><path d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z" transform="scale(.5)"></path></symbol></defs><defs><symbol height="24" width="24" id="clock"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z" transform="scale(.5)"></path></symbol></defs><defs><marker orient="auto-start-reverse" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="7.9" id="arrowhead"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker refY="4.5" refX="4" orient="auto" markerHeight="8" markerWidth="15" id="crosshead"><path style="stroke-dasharray: 0, 0;" d="M 1,2 L 6,7 M 6,2 L 1,7" stroke-width="1pt" stroke="#000000" fill="none"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="15.5" id="filled-head"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="40" markerWidth="60" refY="15" refX="15" id="sequencenumber"><circle r="6" cy="15" cx="15"></circle></marker></defs><g><rect class="note" height="39" width="650" stroke="#666" fill="#EDF2AE" y="75" x="50"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="80" x="375"><tspan x="375">传统IO读取</tspan></text></g><g><rect class="note" height="39" width="650" stroke="#666" fill="#EDF2AE" y="412" x="50"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="417" x="375"><tspan x="375">直接内存读取</tspan></text></g><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="129" x="174">读取文件请求</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="162" x2="271" y1="162" x1="76"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="177" x="374">系统调用</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="210" x2="471" y1="210" x1="276"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="225" x="574">读取数据</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="258" x2="671" y1="258" x1="476"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="273" x="577">返回数据</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="306" x2="479" y1="306" x1="674"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="321" x="377">数据拷贝到JVM</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="354" x2="279" y1="354" x1="474"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="369" x="177">再次拷贝到应用</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="402" x2="79" y1="402" x1="274"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="466" x="274">直接系统调用</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="499" x2="471" y1="499" x1="76"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="514" x="574">读取数据</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="547" x2="671" y1="547" x1="476"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="562" x="577">返回数据</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="595" x2="479" y1="595" x1="674"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="610" x="277">直接访问内存</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="643" x2="79" y1="643" x1="474"></line></svg><p id="zdyvef_269"><span class="control" id="zdyvef_276">直接内存的优势：</span></p><ol class="list _decimal" id="zdyvef_270" type="1"><li class="list__item" id="zdyvef_277"><p id="zdyvef_280"><span class="control" id="zdyvef_282">零拷贝（Zero Copy）</span></p><ul class="list _bullet" id="zdyvef_281"><li class="list__item" id="zdyvef_283"><p id="zdyvef_285">减少用户态和内核态之间的数据拷贝</p></li><li class="list__item" id="zdyvef_284"><p id="zdyvef_286">提高IO操作效率</p></li></ul></li><li class="list__item" id="zdyvef_278"><p id="zdyvef_287"><span class="control" id="zdyvef_289">内存访问效率</span></p><ul class="list _bullet" id="zdyvef_288"><li class="list__item" id="zdyvef_290"><p id="zdyvef_292">避免JVM堆内存的GC影响</p></li><li class="list__item" id="zdyvef_291"><p id="zdyvef_293">更接近操作系统原生内存操作</p></li></ul></li><li class="list__item" id="zdyvef_279"><p id="zdyvef_294"><span class="control" id="zdyvef_296">大文件处理</span></p><ul class="list _bullet" id="zdyvef_295"><li class="list__item" id="zdyvef_297"><p id="zdyvef_299">不占用JVM堆空间</p></li><li class="list__item" id="zdyvef_298"><p id="zdyvef_300">适合处理大文件和网络通信</p></li></ul></li></ol><p id="zdyvef_271"><span class="control" id="zdyvef_301">直接内存的风险：</span></p><div class="code-block" data-lang="java">
// 直接内存配置和监控
-XX:MaxDirectMemorySize=512m  // 限制直接内存大小
-XX:+PrintGCDetails          // 观察Direct Memory回收
</div><ol class="list _decimal" id="zdyvef_273" type="1"><li class="list__item" id="zdyvef_302"><p id="zdyvef_305"><span class="control" id="zdyvef_307">内存泄漏风险</span></p><ul class="list _bullet" id="zdyvef_306"><li class="list__item" id="zdyvef_308"><p id="zdyvef_310">需要手动释放，容易忘记</p></li><li class="list__item" id="zdyvef_309"><p id="zdyvef_311">不受JVM GC直接管理</p></li></ul></li><li class="list__item" id="zdyvef_303"><p id="zdyvef_312"><span class="control" id="zdyvef_314">OutOfMemoryError</span></p><ul class="list _bullet" id="zdyvef_313"><li class="list__item" id="zdyvef_315"><p id="zdyvef_317">超过MaxDirectMemorySize限制</p></li><li class="list__item" id="zdyvef_316"><p id="zdyvef_318">系统总内存不足</p></li></ul></li><li class="list__item" id="zdyvef_304"><p id="zdyvef_319"><span class="control" id="zdyvef_321">调试困难</span></p><ul class="list _bullet" id="zdyvef_320"><li class="list__item" id="zdyvef_322"><p id="zdyvef_324">不在常规的堆dump中显示</p></li><li class="list__item" id="zdyvef_323"><p id="zdyvef_325">需要特殊工具监控</p></li></ul></li></ol></section></section><section class="chapter"><h2 id="zdyvef_8" data-toc="zdyvef_8">🔄 内存分配算法</h2><section class="chapter"><h3 id="q9-jvm" data-toc="q9-jvm">Q9: JVM中有哪些内存分配算法？它们的优缺点是什么？</h3><p id="zdyvef_328"><span class="control" id="zdyvef_333">答案：</span></p><p id="zdyvef_329"><span class="control" id="zdyvef_334">主要内存分配算法：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1506.0546875 450"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1506.0546875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"><g data-look="classic" id="算法选择" class="cluster"><rect height="281" width="561.90625" y="8" x="8" style=""></rect><g transform="translate(256.8984375, 8)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>算法选择</p></span></div></foreignObject></g></g><g data-look="classic" id="内存分配算法" class="cluster"><rect height="281" width="908.1484375" y="161" x="589.90625" style=""></rect><g transform="translate(995.90234375, 161)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>内存分配算法</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M703.133,264L703.133,268.167C703.133,272.333,703.133,280.667,703.133,289C703.133,297.333,703.133,305.667,703.133,311.917C703.133,318.167,703.133,322.333,703.133,325.833C703.133,329.333,703.133,332.167,703.133,333.583L703.133,335"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_1" d="M893.414,264L893.414,268.167C893.414,272.333,893.414,280.667,893.414,289C893.414,297.333,893.414,305.667,893.414,311.917C893.414,318.167,893.414,322.333,893.414,325.833C893.414,329.333,893.414,332.167,893.414,333.583L893.414,335"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_2" d="M1184.119,252L1172.085,258.167C1160.05,264.333,1135.982,276.667,1123.948,287C1111.914,297.333,1111.914,305.667,1111.914,311.917C1111.914,318.167,1111.914,322.333,1111.914,325.833C1111.914,329.333,1111.914,332.167,1111.914,333.583L1111.914,335"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_G_3" d="M1289.498,252L1301.533,258.167C1313.567,264.333,1337.635,276.667,1349.669,287C1361.703,297.333,1361.703,305.667,1361.703,311.917C1361.703,318.167,1361.703,322.333,1361.703,325.833C1361.703,329.333,1361.703,332.167,1361.703,333.583L1361.703,335"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_H_A_4" d="M301.141,111L301.141,115.167C301.141,119.333,301.141,127.667,301.141,136C301.141,144.333,301.141,152.667,328.121,161.129C355.102,169.591,409.063,178.182,462.365,186.668C515.668,195.154,568.312,203.536,594.634,207.726L620.956,211.917"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_C_5" d="M477.914,99L477.914,105.167C477.914,111.333,477.914,123.667,477.914,134C477.914,144.333,477.914,152.667,507.368,161.37C536.822,170.074,595.729,179.147,653.978,188.119C712.226,197.091,769.816,205.962,798.611,210.397L827.406,214.833"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_K_6" d="M129.086,99L129.086,105.167C129.086,111.333,129.086,123.667,129.086,134C129.086,144.333,129.086,152.667,129.086,158.917C129.086,165.167,129.086,169.333,129.086,172.833C129.086,176.333,129.086,179.167,129.086,180.583L129.086,182"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(703.1328125, 225)" id="flowchart-A-3585" class="node default"><rect height="78" width="156.453125" y="-39" x="-78.2265625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.2265625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.453125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>指针碰撞<br>Bump Pointer</p></span></div></foreignObject></g></g><g transform="translate(703.1328125, 378)" id="flowchart-B-3586" class="node default"><rect height="78" width="124.109375" y="-39" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>内存规整<br>连续分配</p></span></div></foreignObject></g></g><g transform="translate(893.4140625, 225)" id="flowchart-C-3587" class="node default"><rect height="78" width="124.109375" y="-39" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>空闲列表<br>Free List</p></span></div></foreignObject></g></g><g transform="translate(893.4140625, 378)" id="flowchart-D-3588" class="node default"><rect height="78" width="140.125" y="-39" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>内存不规整<br>记录空闲块</p></span></div></foreignObject></g></g><g transform="translate(1236.80859375, 225)" id="flowchart-E-3589" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>线程安全方案</p></span></div></foreignObject></g></g><g transform="translate(1111.9140625, 378)" id="flowchart-F-3590" class="node default"><rect height="78" width="196.875" y="-39" x="-98.4375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-68.4375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="136.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>CAS操作<br>Compare And Swap</p></span></div></foreignObject></g></g><g transform="translate(1361.703125, 378)" id="flowchart-G-3592" class="node default"><rect height="78" width="202.703125" y="-39" x="-101.3515625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-71.3515625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="142.703125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>TLAB<br>Thread Local Buffer</p></span></div></foreignObject></g></g><g transform="translate(301.140625, 72)" id="flowchart-H-3593" class="node default"><rect height="78" width="139.5625" y="-39" x="-69.78125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-39.78125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="79.5625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Serial GC<br>Parallel GC</p></span></div></foreignObject></g></g><g transform="translate(477.9140625, 72)" id="flowchart-I-3595" class="node default"><rect height="54" width="113.984375" y="-27" x="-56.9921875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-26.9921875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="53.984375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>CMS GC</p></span></div></foreignObject></g></g><g transform="translate(129.0859375, 72)" id="flowchart-J-3597" class="node default"><rect height="54" width="104.546875" y="-27" x="-52.2734375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-22.2734375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="44.546875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>G1 GC</p></span></div></foreignObject></g></g><g transform="translate(129.0859375, 225)" id="flowchart-K-3598" class="node default"><rect height="78" width="172.171875" y="-39" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>区域内指针碰撞<br>全局空闲列表</p></span></div></foreignObject></g></g></g></g></g></svg><p id="zdyvef_331"><span class="control" id="zdyvef_335">算法详细对比：</span></p><div class="table-wrapper"><table class="wide" id="zdyvef_332"><thead><tr class="ijRowHead" id="zdyvef_336"><th id="zdyvef_340"><p>算法</p></th><th id="zdyvef_341"><p>适用场景</p></th><th id="zdyvef_342"><p>优点</p></th><th id="zdyvef_343"><p>缺点</p></th></tr></thead><tbody><tr id="zdyvef_337"><td id="zdyvef_344"><p><span class="control" id="zdyvef_348">指针碰撞</span></p></td><td id="zdyvef_345"><p>内存规整的收集器</p></td><td id="zdyvef_346"><p>分配速度快，实现简单</p></td><td id="zdyvef_347"><p>需要内存整理</p></td></tr><tr id="zdyvef_338"><td id="zdyvef_349"><p><span class="control" id="zdyvef_353">空闲列表</span></p></td><td id="zdyvef_350"><p>内存不规整的收集器</p></td><td id="zdyvef_351"><p>不需要内存整理</p></td><td id="zdyvef_352"><p>分配速度慢，内存碎片</p></td></tr><tr id="zdyvef_339"><td id="zdyvef_354"><p><span class="control" id="zdyvef_358">TLAB</span></p></td><td id="zdyvef_355"><p>多线程环境</p></td><td id="zdyvef_356"><p>避免同步开销</p></td><td id="zdyvef_357"><p>内存利用率略低</p></td></tr></tbody></table></div></section><section class="chapter"><h3 id="q10" data-toc="q10">Q10: 什么是逃逸分析？它如何影响对象的内存分配？</h3><p id="zdyvef_359"><span class="control" id="zdyvef_368">答案：</span></p><p id="zdyvef_360"><span class="control" id="zdyvef_369">逃逸分析（Escape Analysis）原理：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 868.390625 636.046875" height="636.046875" class="flowchart" xmlns="http://www.w3.org/2000/svg" width="868.390625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M460.59,62L460.59,66.167C460.59,70.333,460.59,78.667,460.59,84.917C460.59,91.167,460.59,95.333,460.59,98.833C460.59,102.333,460.59,105.167,460.59,106.583L460.59,108"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M460.59,166L460.59,170.167C460.59,174.333,460.59,182.667,460.632,188.958C460.673,195.25,460.757,199.5,460.827,203.083C460.897,206.667,460.954,209.584,460.983,211.042L461.011,212.501"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_2" d="M402.02,313.477L352.033,329.405C302.047,345.333,202.074,377.19,152.088,396.202C102.102,415.214,102.102,421.38,102.102,426.88C102.102,432.38,102.102,437.214,102.102,439.63L102.102,442.047"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_E_3" d="M421.221,332.678L407.751,345.406C394.28,358.134,367.339,383.591,353.869,399.402C340.398,415.214,340.398,421.38,340.398,426.88C340.398,432.38,340.398,437.214,340.398,439.63L340.398,442.047"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_F_4" d="M500.959,332.678L514.262,345.406C527.566,358.134,554.174,383.591,567.477,399.402C580.781,415.214,580.781,421.38,580.781,426.88C580.781,432.38,580.781,437.214,580.781,439.63L580.781,442.047"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_G_5" d="M518.935,314.702L564.167,330.426C609.399,346.15,699.864,377.598,745.096,397.406C790.328,417.214,790.328,425.38,790.328,432.88C790.328,440.38,790.328,447.214,790.328,450.63L790.328,454.047"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_H_6" d="M102.102,524.047L102.102,528.214C102.102,532.38,102.102,540.714,102.102,546.964C102.102,553.214,102.102,557.38,102.102,560.88C102.102,564.38,102.102,567.214,102.102,568.63L102.102,570.047"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_I_7" d="M340.398,524.047L340.398,528.214C340.398,532.38,340.398,540.714,340.398,546.964C340.398,553.214,340.398,557.38,340.398,560.88C340.398,564.38,340.398,567.214,340.398,568.63L340.398,570.047"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_F_J_8" d="M580.781,524.047L580.781,528.214C580.781,532.38,580.781,540.714,580.781,546.964C580.781,553.214,580.781,557.38,580.781,560.88C580.781,564.38,580.781,567.214,580.781,568.63L580.781,570.047"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_K_9" d="M790.328,512.047L790.328,518.214C790.328,524.38,790.328,536.714,790.328,544.964C790.328,553.214,790.328,557.38,790.328,560.88C790.328,564.38,790.328,567.214,790.328,568.63L790.328,570.047"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(102.1015625, 409.046875)" class="edgeLabel"><g transform="translate(-35, -12)" class="label"><foreignObject height="24" width="70"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>否-方法内</p></span></div></foreignObject></g></g><g transform="translate(340.3984375, 409.046875)" class="edgeLabel"><g transform="translate(-35, -12)" class="label"><foreignObject height="24" width="70"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>否-线程内</p></span></div></foreignObject></g></g><g transform="translate(580.78125, 409.046875)" class="edgeLabel"><g transform="translate(-35, -12)" class="label"><foreignObject height="24" width="70"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>否-单线程</p></span></div></foreignObject></g></g><g transform="translate(790.328125, 409.046875)" class="edgeLabel"><g transform="translate(-8.015625, -12)" class="label"><foreignObject height="24" width="16.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>是</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(460.58984375, 35)" id="flowchart-A-3748" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>对象创建</p></span></div></foreignObject></g></g><g transform="translate(460.58984375, 139)" id="flowchart-B-3749" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>逃逸分析</p></span></div></foreignObject></g></g><g transform="translate(460.58984375, 294.0234375)" id="flowchart-C-3751" class="node default"><polygon transform="translate(-78.0234375,78.0234375)" class="label-container" points="78.0234375,0 156.046875,-78.0234375 78.0234375,-156.046875 0,-78.0234375"></polygon><g transform="translate(-51.0234375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="102.046875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>对象是否逃逸?</p></span></div></foreignObject></g></g><g transform="translate(102.1015625, 485.046875)" id="flowchart-D-3753" class="node default"><rect height="78" width="174.796875" y="-39" x="-87.3984375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-57.3984375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="114.796875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>栈上分配<br>Stack Allocation</p></span></div></foreignObject></g></g><g transform="translate(340.3984375, 485.046875)" id="flowchart-E-3755" class="node default"><rect height="78" width="201.796875" y="-39" x="-100.8984375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-70.8984375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="141.796875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>标量替换<br>Scalar Replacement</p></span></div></foreignObject></g></g><g transform="translate(580.78125, 485.046875)" id="flowchart-F-3757" class="node default"><rect height="78" width="178.96875" y="-39" x="-89.484375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-59.484375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="118.96875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>锁消除<br>Lock Elimination</p></span></div></foreignObject></g></g><g transform="translate(790.328125, 485.046875)" id="flowchart-G-3759" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>堆内存分配</p></span></div></foreignObject></g></g><g transform="translate(102.1015625, 601.046875)" id="flowchart-H-3761" class="node default"><rect height="54" width="188.203125" y="-27" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>方法结束自动回收</p></span></div></foreignObject></g></g><g transform="translate(340.3984375, 601.046875)" id="flowchart-I-3763" class="node default"><rect height="54" width="172.171875" y="-27" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>拆分为基本类型</p></span></div></foreignObject></g></g><g transform="translate(580.78125, 601.046875)" id="flowchart-J-3765" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消除同步操作</p></span></div></foreignObject></g></g><g transform="translate(790.328125, 601.046875)" id="flowchart-K-3767" class="node default"><rect height="54" width="112.5" y="-27" x="-56.25" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-26.25, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="52.5"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>GC回收</p></span></div></foreignObject></g></g></g></g></g></svg><p id="zdyvef_362"><span class="control" id="zdyvef_370">逃逸分析的优化：</span></p><ol class="list _decimal" id="zdyvef_363" type="1"><li class="list__item" id="zdyvef_371"><p id="zdyvef_374"><span class="control" id="zdyvef_376">栈上分配</span></p><div class="code-block" data-lang="java">
public void method() {
    Object obj = new Object(); // 对象不逃逸方法
    // obj只在方法内使用，可在栈上分配
} // 方法结束，栈帧销毁，对象自动回收
</div></li><li class="list__item" id="zdyvef_372"><p id="zdyvef_377"><span class="control" id="zdyvef_379">标量替换</span></p><div class="code-block" data-lang="java">
class Point {
    int x, y;
}

public void method() {
    Point p = new Point(); // 可能被替换为
    // int x, y; // 直接使用基本类型
}
</div></li><li class="list__item" id="zdyvef_373"><p id="zdyvef_380"><span class="control" id="zdyvef_382">锁消除</span></p><div class="code-block" data-lang="java">
public void method() {
    StringBuffer sb = new StringBuffer(); // 对象不逃逸
    sb.append(&quot;hello&quot;); // 同步方法可以消除锁
}
</div></li></ol><p id="zdyvef_364"><span class="control" id="zdyvef_383">逃逸分析配置：</span></p><div class="code-block" data-lang="bash">
# 启用逃逸分析（JDK8+默认开启）
-XX:+DoEscapeAnalysis

# 启用栈上分配
-XX:+EliminateAllocations

# 启用标量替换
-XX:+EliminateAutoBox

# 启用锁消除
-XX:+EliminateLocks

# 打印逃逸分析结果
-XX:+PrintEscapeAnalysis
</div><p id="zdyvef_366"><span class="control" id="zdyvef_384">逃逸情况分类：</span></p><ol class="list _decimal" id="zdyvef_367" type="1"><li class="list__item" id="zdyvef_385"><p id="zdyvef_388"><span class="control" id="zdyvef_390">不逃逸</span></p><ul class="list _bullet" id="zdyvef_389"><li class="list__item" id="zdyvef_391"><p id="zdyvef_393">对象只在方法内部使用</p></li><li class="list__item" id="zdyvef_392"><p id="zdyvef_394">对象只在线程内部使用</p></li></ul></li><li class="list__item" id="zdyvef_386"><p id="zdyvef_395"><span class="control" id="zdyvef_397">方法逃逸</span></p><ul class="list _bullet" id="zdyvef_396"><li class="list__item" id="zdyvef_398"><p id="zdyvef_400">对象作为返回值</p></li><li class="list__item" id="zdyvef_399"><p id="zdyvef_401">对象作为参数传递</p></li></ul></li><li class="list__item" id="zdyvef_387"><p id="zdyvef_402"><span class="control" id="zdyvef_404">线程逃逸</span></p><ul class="list _bullet" id="zdyvef_403"><li class="list__item" id="zdyvef_405"><p id="zdyvef_407">对象被其他线程访问</p></li><li class="list__item" id="zdyvef_406"><p id="zdyvef_408">对象赋值给静态变量</p></li></ul></li></ol></section></section><section class="chapter"><h2 id="zdyvef_9" data-toc="zdyvef_9">💡 面试技巧</h2><section class="chapter"><h3 id="zdyvef_409" data-toc="zdyvef_409">高频考点</h3><ol class="list _decimal" id="zdyvef_411" type="1"><li class="list__item" id="zdyvef_412"><p id="zdyvef_418"><span class="control" id="zdyvef_419">堆内存结构</span> ：新生代、老年代的详细划分和比例</p></li><li class="list__item" id="zdyvef_413"><p id="zdyvef_420"><span class="control" id="zdyvef_421">对象分配策略</span> ：Eden区分配、大对象处理、空间担保</p></li><li class="list__item" id="zdyvef_414"><p id="zdyvef_422"><span class="control" id="zdyvef_423">TLAB机制</span> ：解决多线程分配竞争的方案</p></li><li class="list__item" id="zdyvef_415"><p id="zdyvef_424"><span class="control" id="zdyvef_425">永久代到元空间</span> ：JDK8的重要变化</p></li><li class="list__item" id="zdyvef_416"><p id="zdyvef_426"><span class="control" id="zdyvef_427">直接内存</span> ：与堆内存的区别和使用场景</p></li><li class="list__item" id="zdyvef_417"><p id="zdyvef_428"><span class="control" id="zdyvef_429">逃逸分析</span> ：JVM的重要优化技术</p></li></ol></section><section class="chapter"><h3 id="zdyvef_410" data-toc="zdyvef_410">回答策略</h3><ol class="list _decimal" id="zdyvef_430" type="1"><li class="list__item" id="zdyvef_433"><p id="zdyvef_437"><span class="control" id="zdyvef_438">结构图解</span> ：画出内存区域的详细结构图</p></li><li class="list__item" id="zdyvef_434"><p id="zdyvef_439"><span class="control" id="zdyvef_440">参数配置</span> ：说明相关的JVM参数设置</p></li><li class="list__item" id="zdyvef_435"><p id="zdyvef_441"><span class="control" id="zdyvef_442">实际案例</span> ：结合具体代码说明内存分配过程</p></li><li class="list__item" id="zdyvef_436"><p id="zdyvef_443"><span class="control" id="zdyvef_444">性能影响</span> ：分析不同策略对性能的影响</p></li></ol><p id="zdyvef_432"><span class="control" id="zdyvef_445">学习建议</span> ：内存管理是JVM的核心功能，建议通过实际配置JVM参数、观察内存使用情况、分析GC日志来加深理解，特别要重视新特性如元空间和逃逸分析的应用。</p></section></section><div class="last-modified">09 六月 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="jvm基础概念qa.html" class="navigation-links__prev">JVM基础概念QA</a><a href="jvm垃圾回收qa.html" class="navigation-links__next">JVM垃圾回收QA</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>