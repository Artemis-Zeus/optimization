<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-06-10T01:07:27.3860591"><title>RabbitMQ应用实践QA | 技术知识库</title><script type="application/json" id="virtual-toc-data">[{"id":"-jlchwv_4","level":0,"title":"📋 知识结构","anchor":"#-jlchwv_4"},{"id":"amqp","level":0,"title":"🔌 AMQP协议与核心概念","anchor":"#amqp"},{"id":"-jlchwv_6","level":0,"title":"🛡️ 高级特性","anchor":"#-jlchwv_6"},{"id":"-jlchwv_7","level":0,"title":"💡 面试技巧","anchor":"#-jlchwv_7"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="RabbitMQ应用实践QA | 技术知识库"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="技术知识库 Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/rabbitmq应用实践qa.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="RabbitMQ应用实践QA | 技术知识库"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/rabbitmq应用实践qa.html#webpage",
    "url": "writerside-documentation/rabbitmq应用实践qa.html",
    "name": "RabbitMQ应用实践QA | 技术知识库",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "技术知识库 Help"
}</script><!-- End Schema.org --></head><body data-id="RabbitMQ应用实践QA" data-main-title="RabbitMQ应用实践QA" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="消息队列面试大纲.md|消息队列面试大纲"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>技术知识库  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="RabbitMQ应用实践QA" id="RabbitMQ应用实践QA.md">RabbitMQ应用实践QA</h1><p id="-jlchwv_3">RabbitMQ是基于AMQP协议的企业级消息队列，以其丰富的路由功能、灵活的部署方式和完善的管理界面而广受欢迎。本文档详细解析RabbitMQ的核心概念和实践应用。</p><section class="chapter"><h2 id="-jlchwv_4" data-toc="-jlchwv_4">📋 知识结构</h2><svg aria-roledescription="mindmap" role="graphics-document document" viewBox="5 5 908.3316650390625 454.918701171875" style="max-width: 908.3316650390625px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g></g><g class="mindmap-edges"><path class="edge section-edge-0 edge-depth-1" d="M 202.97848214584678,264.93109172098383 L 191.85279752207856,296.8153821872728 L180.72711289831034,328.6996726535617"></path><path class="edge section-edge-0 edge-depth-1" d="M 193.50004365073858,246.6388133636924 L 139.84025485460887,231.27158505040143 L86.18046605847917,215.9043567371104"></path><path class="edge section-edge-0 edge-depth-1" d="M 193.44185324606025,254.68938093370298 L 132.97817690872517,271.06321056055174 L72.5145005713901,287.4370401874005"></path><path class="edge section-edge-0 edge-depth-1" d="M 220.2790594156309,259.2692692372002 L 252.7770969736397,281.62250530788964 L285.27513453164846,303.9757413785791"></path><path class="edge section-edge-0 edge-depth-0" d="M 394.31527759126226,230.1266629633385 L 308.57224499837525,239.62207746857598 L222.82921240548825,249.1174919738134"></path><path class="edge section-edge-1 edge-depth-1" d="M 655.2798661982986,242.08838998260217 L 733.565553075477,264.5114912550128 L811.8512399526555,286.93459252742343"></path><path class="edge section-edge-1 edge-depth-1" d="M 644.0123430681374,252.62303566239183 L 650.8404482807878,284.38515168391245 L657.6685534934381,316.1472677054331"></path><path class="edge section-edge-1 edge-depth-1" d="M 655.657098738024,235.50090873313485 L 736.6414232641821,222.05310649320464 L817.6257477903401,208.60530425327443"></path><path class="edge section-edge-1 edge-depth-1" d="M 650.1203456695131,226.15804081966502 L 672.9966418220487,197.0086888635794 L695.8729379745843,167.8593369074938"></path><path class="edge section-edge-1 edge-depth-0" d="M 424.2115824788792,229.0891567144632 L 525.0419293848179,233.21684684046195 L625.8722762907565,237.3445369664607"></path><path class="edge section-edge-2 edge-depth-1" d="M 251.9374501633573,153.60583508012687 L 278.1076579841098,127.32286818227911 L304.27786580486224,101.03990128443135"></path><path class="edge section-edge-2 edge-depth-1" d="M 233.9224410553781,151.20537156969925 L 215.64291371675597,119.15425025194534 L197.36338637813384,87.10312893419143"></path><path class="edge section-edge-2 edge-depth-1" d="M 226.7413161799884,160.84714625566642 L 172.07214214107807,148.1713801915146 L117.40296810216776,135.49561412736278"></path><path class="edge section-edge-2 edge-depth-1" d="M 256.3321540736986,165.03841631679498 L 301.976161891042,167.48602131048605 L347.62016970838545,169.93362630417712"></path><path class="edge section-edge-2 edge-depth-0" d="M 395.21487955948874,223.11457597897893 L 325.2889047441678,196.35541460482315 L255.3629299288468,169.59625323066737"></path><path class="edge section-edge-3 edge-depth-1" d="M 475.86153888589683,117.92872225520011 L 531.5809161456708,107.9482820494708 L587.3002934054448,97.9678418437415"></path><path class="edge section-edge-3 edge-depth-1" d="M 473.1094086827526,129.5562276182991 L 504.1964161082308,152.80197547873544 L535.283423533709,176.0477233391718"></path><path class="edge section-edge-3 edge-depth-1" d="M 470.1316425670164,108.59984318537911 L 493.79786162959294,77.23671353135862 L517.4640806921694,45.87358387733812"></path><path class="edge section-edge-3 edge-depth-1" d="M 452.792460545647,108.08173149722649 L 432.5298846136676,77.6010157509443 L412.26730868168823,47.1203000046621"></path><path class="edge section-edge-3 edge-depth-0" d="M 415.72317958778183,214.95665045583198 L 435.160331907671,174.5245214623233 L454.59748422756013,134.0923924688146"></path><path class="edge section-edge-4 edge-depth-1" d="M 395.17330287055876,345.55531322936764 L 355.4461371991014,372.32770708098184 L315.718971527644,399.10010093259604"></path><path class="edge section-edge-4 edge-depth-1" d="M 410.40149504191305,351.91097311870647 L 416.49225751478264,384.09564408788583 L422.5830199876522,416.2803150570652"></path><path class="edge section-edge-4 edge-depth-1" d="M 421.4858036978323,342.875805869862 L 476.92021270010366,365.66431696713505 L532.3546217023751,388.4528280644082"></path><path class="edge section-edge-4 edge-depth-1" d="M 421.3738680259119,331.204295674697 L 468.2813156501695,310.8608902652764 L515.1887632744272,290.5174848558558"></path><path class="edge section-edge-4 edge-depth-0" d="M 409.001734423456,243.47396703034804 L 408.41823633736885,282.82409170918095 L407.8347382512817,322.17421638801386"></path></g><g class="mindmap-nodes"><g transform="translate(332.2835379432162, 209.57561586192935)" class="mindmap-node section--1 section-root"><g transform="translate(76.94059753417969, 18.9)"><circle r="76.94059753417969" class="node-bkg node-circle" id="node-0"></circle></g><g transform="translate(76.94059753417969, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">RabbitMQ核心技术</tspan></tspan></text></g></g></g><g transform="translate(160.59863439606363, 231.86853907522254)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h84.64344024658203 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-1"></path><line y2="37.8" x2="94.64344024658203" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(47.321720123291016, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">AMQP协议</tspan></tspan></text></g></g></g><g transform="translate(581.1565982922399, 219.05807781899455)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h109.40625 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-6"></path><line y2="37.8" x2="119.40625" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(59.703125, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Exchange类型</tspan></tspan></text></g></g></g><g transform="translate(199.2989865109397, 145.33521334771694)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-11"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">队列机制</tspan></tspan></text></g></g></g><g transform="translate(418.5605290398504, 101.67342706271722)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-16"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">高级特性</tspan></tspan></text></g></g></g><g transform="translate(364.57633789924614, 318.2725675564326)" class="mindmap-node section-4"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-21"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-4"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">集群部署</tspan></tspan></text></g></g></g><g transform="translate(133.23055302480248, 323.962225299323)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-2"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">消息模型</tspan></tspan></text></g></g></g><g transform="translate(36.73615502201642, 192.87463102558024)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h60.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-3"></path><line y2="37.8" x2="70.04800033569336" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(35.02400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">协议栈</tspan></tspan></text></g></g></g><g transform="translate(15, 272.457882045881)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-4"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">连接管理</tspan></tspan></text></g></g></g><g transform="translate(255.07915192792473, 293.5764715405568)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-5"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">信道机制</tspan></tspan></text></g></g></g><g transform="translate(758.1831908726302, 272.1649046910311)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h126.17638397216797 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-7"></path><line y2="37.8" x2="136.17638397216797" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(68.08819198608398, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Direct</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Exchange</tspan></tspan></text></g></g></g><g transform="translate(595.3970437832517, 311.9122255488304)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h120.84825897216797 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-8"></path><line y2="37.8" x2="130.84825897216797" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(65.42412948608398, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Topic</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Exchange</tspan></tspan></text></g></g></g><g transform="translate(761.5146187500403, 187.24813516741472)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h131.81700897216797 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-9"></path><line y2="37.8" x2="141.81700897216797" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(70.90850448608398, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Fanout</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Exchange</tspan></tspan></text></g></g></g><g transform="translate(629.8578645510762, 137.15929990816426)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h140.5513916015625 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-10"></path><line y2="37.8" x2="150.5513916015625" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(75.27569580078125, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Headers</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Exchange</tspan></tspan></text></g></g></g><g transform="translate(272.32564265918415, 71.51052301684126)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-12"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">队列属性</tspan></tspan></text></g></g></g><g transform="translate(138.88415308687888, 55.173287156173735)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h92.09600067138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-13"></path><line y2="37.8" x2="102.09600067138672" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(51.04800033569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">消息持久化</tspan></tspan></text></g></g></g><g transform="translate(62.88436027121645, 113.20754703531225)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h69.8125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-14"></path><line y2="37.8" x2="79.8125" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(39.90625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">TTL机制</tspan></tspan></text></g></g></g><g transform="translate(320.5439622711443, 151.83682927325515)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-15"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">死信队列</tspan></tspan></text></g></g></g><g transform="translate(559.0293046552998, 76.42313703622438)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-17"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">消息确认</tspan></tspan></text></g></g></g><g transform="translate(505.24161637851546, 166.13052389475365)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-18"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">事务机制</tspan></tspan></text></g></g></g><g transform="translate(475.9366949212398, 15)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h91.125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-19"></path><line y2="37.8" x2="101.125" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(50.5625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">优先级队列</tspan></tspan></text></g></g></g><g transform="translate(361.9085533893891, 15.728604439171363)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-20"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">延迟队列</tspan></tspan></text></g></g></g><g transform="translate(260.2439379027652, 388.58284660553113)" class="mindmap-node section-4"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-22"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-4"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">集群模式</tspan></tspan></text></g></g></g><g transform="translate(382.81749033222343, 412.1187206193391)" class="mindmap-node section-4"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-23"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-4"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">镜像队列</tspan></tspan></text></g></g></g><g transform="translate(503.6734007028655, 375.25606637783767)" class="mindmap-node section-4"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-24"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-4"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">分区队列</tspan></tspan></text></g></g></g><g transform="translate(486.4142948049015, 265.64921297412025)" class="mindmap-node section-4"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-25"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-4"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">故障恢复</tspan></tspan></text></g></g></g></g></svg></section><section class="chapter"><h2 id="amqp" data-toc="amqp">🔌 AMQP协议与核心概念</h2><section class="chapter"><h3 id="q1-rabbitmq-amqp" data-toc="q1-rabbitmq-amqp">Q1: RabbitMQ的AMQP协议是什么？核心组件有哪些？</h3><p id="-jlchwv_11"><span class="control" id="-jlchwv_27">答案：</span></p><p id="-jlchwv_12"><span class="control" id="-jlchwv_28">AMQP（Advanced Message Queuing Protocol）核心架构：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 2639.5625 532"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="2639.5625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="subGraph6" class="cluster"><rect height="516" width="2623.5625" y="8" x="8" style=""></rect><g transform="translate(1247.0546875, 8)" class="cluster-label"><foreignObject height="24" width="145.453125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>RabbitMQ AMQP架构</p></span></div></foreignObject></g></g><g data-look="classic" id="消费者端" class="cluster"><rect height="124" width="710.28125" y="48" x="1883.78125" style=""></rect><g transform="translate(2206.8671875, 48)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消费者端</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph4" class="cluster"><rect height="476" width="984.84375" y="28" x="823.9375" style=""></rect><g transform="translate(1256.015625, 28)" class="cluster-label"><foreignObject height="24" width="120.6875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>RabbitMQ Broker</p></span></div></foreignObject></g></g><g data-look="classic" id="生产者端" class="cluster"><rect height="124" width="703.4375" y="48" x="45.5" style=""></rect><g transform="translate(365.1640625, 48)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>生产者端</p></span></div></foreignObject></g></g><g data-look="classic" id="Binding绑定" class="cluster"><rect height="228" width="219.09375" y="48" x="1193" style=""></rect><g transform="translate(1260.1328125, 48)" class="cluster-label"><foreignObject height="24" width="84.828125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Binding绑定</p></span></div></foreignObject></g></g><g data-look="classic" id="Queue队列" class="cluster"><rect height="332" width="284.1875" y="48" x="1487.09375" style=""></rect><g transform="translate(1590.2265625, 48)" class="cluster-label"><foreignObject height="24" width="77.921875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Queue队列</p></span></div></foreignObject></g></g><g data-look="classic" id="Exchange交换器" class="cluster"><rect height="332" width="256.5625" y="48" x="861.4375" style=""></rect><g transform="translate(932.0078125, 48)" class="cluster-label"><foreignObject height="24" width="115.421875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Exchange交换器</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_P1_C1_0" d="M238.75,110L245,110C251.25,110,263.75,110,273.125,110C282.5,110,288.75,110,294.333,110C299.917,110,304.833,110,307.292,110L309.75,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C1_CH1_1" d="M486.563,110L492.813,110C499.063,110,511.563,110,520.938,110C530.313,110,536.563,110,542.146,110C547.729,110,552.646,110,555.104,110L557.563,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CH1_EX1_2" d="M711.438,110L717.688,110C723.938,110,736.438,110,748.938,110C761.438,110,773.938,110,786.438,110C798.938,110,811.438,110,823.938,110C836.438,110,848.938,110,858.547,110C868.156,110,874.875,110,880.927,110C886.979,110,892.365,110,895.057,110L897.75,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_EX1_B1_3" d="M1077.688,110L1084.406,110C1091.125,110,1104.563,110,1117.531,110C1130.5,110,1143,110,1155.5,110C1168,110,1180.5,110,1189.875,110C1199.25,110,1205.5,110,1211.083,110C1216.667,110,1221.583,110,1224.042,110L1226.5,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B1_Q1_4" d="M1374.594,110L1380.844,110C1387.094,110,1399.594,110,1412.094,110C1424.594,110,1437.094,110,1449.594,110C1462.094,110,1474.594,110,1487.677,110C1500.76,110,1514.427,110,1527.427,110C1540.427,110,1552.76,110,1558.927,110L1565.094,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Q1_CH2_5" d="M1689.281,110L1702.948,110C1716.615,110,1743.948,110,1763.865,110C1783.781,110,1796.281,110,1808.781,110C1821.281,110,1833.781,110,1846.281,110C1858.781,110,1871.281,110,1880.656,110C1890.031,110,1896.281,110,1901.865,110C1907.448,110,1912.365,110,1914.823,110L1917.281,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CH2_C2_6" d="M2071.156,110L2077.406,110C2083.656,110,2096.156,110,2105.531,110C2114.906,110,2121.156,110,2126.74,110C2132.323,110,2137.24,110,2139.698,110L2142.156,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C2_CON1_7" d="M2318.969,110L2325.219,110C2331.469,110,2343.969,110,2353.344,110C2362.719,110,2368.969,110,2374.552,110C2380.135,110,2385.052,110,2387.51,110L2389.969,110"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(2232.5625, 110)" id="flowchart-C2-2260" class="node default"><rect height="54" width="172.8125" y="-27" x="-86.40625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.40625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.8125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Connection连接</p></span></div></foreignObject></g></g><g transform="translate(160.875, 110)" id="flowchart-P1-2248" class="node default"><rect height="54" width="155.75" y="-27" x="-77.875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-47.875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="95.75"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Producer应用</p></span></div></foreignObject></g></g><g transform="translate(400.15625, 110)" id="flowchart-C1-2249" class="node default"><rect height="54" width="172.8125" y="-27" x="-86.40625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.40625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.8125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Connection连接</p></span></div></foreignObject></g></g><g transform="translate(636.5, 110)" id="flowchart-CH1-2250" class="node default"><rect height="54" width="149.875" y="-27" x="-74.9375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-44.9375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="89.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Channel信道</p></span></div></foreignObject></g></g><g transform="translate(989.71875, 110)" id="flowchart-EX1-2252" class="node default"><rect height="54" width="175.9375" y="-27" x="-87.96875" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-57.96875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="115.9375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Direct Exchange</p></span></div></foreignObject></g></g><g transform="translate(1302.546875, 110)" id="flowchart-B1-2258" class="node default"><rect height="54" width="144.09375" y="-27" x="-72.046875" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-42.046875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="84.09375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Routing Key</p></span></div></foreignObject></g></g><g transform="translate(1629.1875, 110)" id="flowchart-Q1-2255" class="node default"><rect height="54" width="120.1875" y="-27" x="-60.09375" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-30.09375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="60.1875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Queue-1</p></span></div></foreignObject></g></g><g transform="translate(1996.21875, 110)" id="flowchart-CH2-2261" class="node default"><rect height="54" width="149.875" y="-27" x="-74.9375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-44.9375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="89.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Channel信道</p></span></div></foreignObject></g></g><g transform="translate(2475.265625, 110)" id="flowchart-CON1-2262" class="node default"><rect height="54" width="162.59375" y="-27" x="-81.296875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-51.296875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="102.59375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Consumer应用</p></span></div></foreignObject></g></g><g transform="translate(1302.546875, 214)" id="flowchart-B2-2259" class="node default"><rect height="54" width="143.03125" y="-27" x="-71.515625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-41.515625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="83.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Binding Key</p></span></div></foreignObject></g></g><g transform="translate(1629.1875, 214)" id="flowchart-Q2-2256" class="node default"><rect height="54" width="120.1875" y="-27" x="-60.09375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-30.09375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="60.1875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Queue-2</p></span></div></foreignObject></g></g><g transform="translate(1629.1875, 318)" id="flowchart-Q3-2257" class="node default"><rect height="54" width="120.1875" y="-27" x="-60.09375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-30.09375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="60.1875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Queue-3</p></span></div></foreignObject></g></g><g transform="translate(989.71875, 214)" id="flowchart-EX2-2253" class="node default"><rect height="54" width="169.609375" y="-27" x="-84.8046875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-54.8046875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="109.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Topic Exchange</p></span></div></foreignObject></g></g><g transform="translate(989.71875, 318)" id="flowchart-EX3-2254" class="node default"><rect height="54" width="181.5625" y="-27" x="-90.78125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-60.78125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="121.5625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Fanout Exchange</p></span></div></foreignObject></g></g><g transform="translate(1629.1875, 442)" id="flowchart-V-2251" class="node default"><rect height="54" width="209.1875" y="-27" x="-104.59375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-74.59375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="149.1875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Virtual Host虚拟主机</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-jlchwv_14"><span class="control" id="-jlchwv_29">核心组件详解：</span></p><p id="-jlchwv_15"><span class="control" id="-jlchwv_30">1. Connection（连接）</span></p><ul class="list _bullet" id="-jlchwv_16"><li class="list__item" id="-jlchwv_31"><p id="-jlchwv_34">TCP长连接，承载多个Channel</p></li><li class="list__item" id="-jlchwv_32"><p id="-jlchwv_35">支持连接池和连接复用</p></li><li class="list__item" id="-jlchwv_33"><p id="-jlchwv_36">提供认证和安全传输</p></li></ul><p id="-jlchwv_17"><span class="control" id="-jlchwv_37">2. Channel（信道）</span></p><ul class="list _bullet" id="-jlchwv_18"><li class="list__item" id="-jlchwv_38"><p id="-jlchwv_41">轻量级的逻辑连接</p></li><li class="list__item" id="-jlchwv_39"><p id="-jlchwv_42">复用物理连接，减少资源消耗</p></li><li class="list__item" id="-jlchwv_40"><p id="-jlchwv_43">支持事务和确认机制</p></li></ul><p id="-jlchwv_19"><span class="control" id="-jlchwv_44">3. Virtual Host（虚拟主机）</span></p><ul class="list _bullet" id="-jlchwv_20"><li class="list__item" id="-jlchwv_45"><p id="-jlchwv_48">提供逻辑隔离和权限控制</p></li><li class="list__item" id="-jlchwv_46"><p id="-jlchwv_49">独立的Exchange、Queue和Binding空间</p></li><li class="list__item" id="-jlchwv_47"><p id="-jlchwv_50">支持多租户部署</p></li></ul><p id="-jlchwv_21"><span class="control" id="-jlchwv_51">4. Exchange（交换器）</span></p><ul class="list _bullet" id="-jlchwv_22"><li class="list__item" id="-jlchwv_52"><p id="-jlchwv_55">消息路由中心</p></li><li class="list__item" id="-jlchwv_53"><p id="-jlchwv_56">根据路由规则分发消息</p></li><li class="list__item" id="-jlchwv_54"><p id="-jlchwv_57">支持多种路由算法</p></li></ul><p id="-jlchwv_23"><span class="control" id="-jlchwv_58">5. Queue（队列）</span></p><ul class="list _bullet" id="-jlchwv_24"><li class="list__item" id="-jlchwv_59"><p id="-jlchwv_62">消息存储容器</p></li><li class="list__item" id="-jlchwv_60"><p id="-jlchwv_63">支持持久化和优先级</p></li><li class="list__item" id="-jlchwv_61"><p id="-jlchwv_64">提供消费确认机制</p></li></ul><p id="-jlchwv_25"><span class="control" id="-jlchwv_65">AMQP消息流转过程：</span></p><div class="code-block" data-lang="java">
// RabbitMQ基础使用示例
public class RabbitMQBasicExample {
    
    // 连接配置
    public Connection createConnection() throws IOException, TimeoutException {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost(&quot;localhost&quot;);
        factory.setPort(5672);
        factory.setUsername(&quot;guest&quot;);
        factory.setPassword(&quot;guest&quot;);
        factory.setVirtualHost(&quot;/&quot;);
        
        // 连接池配置
        factory.setConnectionTimeout(60000);
        factory.setRequestedHeartBeat(60);
        factory.setNetworkRecoveryInterval(5000);
        factory.setAutomaticRecoveryEnabled(true);
        
        return factory.newConnection();
    }
    
    // 生产者发送消息
    public void sendMessage() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 声明Exchange
            channel.exchangeDeclare(&quot;user.events&quot;, BuiltinExchangeType.TOPIC, true);
            
            // 声明Queue
            channel.queueDeclare(&quot;user.login.queue&quot;, true, false, false, null);
            
            // 绑定Queue到Exchange
            channel.queueBind(&quot;user.login.queue&quot;, &quot;user.events&quot;, &quot;user.login.*&quot;);
            
            // 发送消息
            String message = &quot;User login event&quot;;
            AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
                .deliveryMode(2) // 持久化消息
                .timestamp(new Date())
                .messageId(UUID.randomUUID().toString())
                .build();
                
            channel.basicPublish(&quot;user.events&quot;, &quot;user.login.web&quot;, properties, message.getBytes());
            
            System.out.println(&quot;消息发送成功: &quot; + message);
        }
    }
    
    // 消费者接收消息
    public void receiveMessage() throws IOException, TimeoutException {
        Connection connection = createConnection();
        Channel channel = connection.createChannel();
        
        // 声明队列
        channel.queueDeclare(&quot;user.login.queue&quot;, true, false, false, null);
        
        // 设置消费者
        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);
            System.out.println(&quot;接收到消息: &quot; + message);
            
            try {
                // 处理业务逻辑
                processMessage(message);
                
                // 手动确认消息
                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
                
            } catch (Exception e) {
                System.err.println(&quot;消息处理失败: &quot; + e.getMessage());
                // 拒绝消息并重新入队
                channel.basicNack(delivery.getEnvelope().getDeliveryTag(), false, true);
            }
        };
        
        // 开始消费
        channel.basicConsume(&quot;user.login.queue&quot;, false, deliverCallback, consumerTag -&gt; {});
    }
}
</div></section><section class="chapter"><h3 id="q2-rabbitmq-exchange" data-toc="q2-rabbitmq-exchange">Q2: RabbitMQ有哪些Exchange类型？各自的路由规则是什么？</h3><p id="-jlchwv_66"><span class="control" id="-jlchwv_77">答案：</span></p><p id="-jlchwv_67"><span class="control" id="-jlchwv_78">四种Exchange类型对比：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 614.515625 972"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="614.515625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="Exchange类型和路由规则" class="cluster"><rect height="956" width="598.515625" y="8" x="8" style=""></rect><g transform="translate(217.4921875, 8)" class="cluster-label"><foreignObject height="24" width="179.53125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Exchange类型和路由规则</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(62.6953125, 35)" class="root"><g class="clusters"><g data-look="classic" id="subGraph3" class="cluster"><rect height="178" width="473.125" y="8" x="8" style=""></rect><g transform="translate(179.40625, 8)" class="cluster-label"><foreignObject height="24" width="130.3125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Headers Exchange</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(133.4765625, 97)" id="flowchart-H1-2403" class="node default"><rect height="78" width="180.953125" y="-39" x="-90.4765625" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-60.4765625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="120.953125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>基于消息头匹配<br>x-match: all/any</p></span></div></foreignObject></g></g><g transform="translate(360.0390625, 97)" id="flowchart-H2-2404" class="node default"><rect height="54" width="172.171875" y="-27" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>键值对匹配路由</p></span></div></foreignObject></g></g></g></g><g transform="translate(73.109375, 263)" class="root"><g class="clusters"><g data-look="classic" id="subGraph2" class="cluster"><rect height="178" width="452.296875" y="8" x="8" style=""></rect><g transform="translate(173.3671875, 8)" class="cluster-label"><foreignObject height="24" width="121.5625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Fanout Exchange</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(131.0703125, 97)" id="flowchart-F1-2401" class="node default"><rect height="78" width="176.140625" y="-39" x="-88.0703125" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-58.0703125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="116.140625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>忽略Routing Key<br>广播到所有队列</p></span></div></foreignObject></g></g><g transform="translate(347.21875, 97)" id="flowchart-F2-2402" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>发布订阅模式</p></span></div></foreignObject></g></g></g></g><g transform="translate(37.5, 491)" class="root"><g class="clusters"><g data-look="classic" id="subGraph1" class="cluster"><rect height="202" width="523.515625" y="8" x="8" style=""></rect><g transform="translate(214.953125, 8)" class="cluster-label"><foreignObject height="24" width="109.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Topic Exchange</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(166.6796875, 109)" id="flowchart-T1-2399" class="node default"><rect height="78" width="247.359375" y="-39" x="-123.6796875" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-93.6796875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="187.359375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Routing Key: user.*.action<br>Queue: user-action-queue</p></span></div></foreignObject></g></g><g transform="translate(418.4375, 109)" id="flowchart-T2-2400" class="node default"><rect height="102" width="156.15625" y="-51" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>模式匹配路由<br># 匹配多个词<br>* 匹配一个词</p></span></div></foreignObject></g></g></g></g><g transform="translate(49.3671875, 743)" class="root"><g class="clusters"><g data-look="classic" id="subGraph0" class="cluster"><rect height="178" width="499.78125" y="8" x="8" style=""></rect><g transform="translate(199.921875, 8)" class="cluster-label"><foreignObject height="24" width="115.9375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Direct Exchange</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(154.8125, 97)" id="flowchart-D1-2397" class="node default"><rect height="78" width="223.625" y="-39" x="-111.8125" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-81.8125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="163.625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Routing Key: user.login<br>Queue: login-queue</p></span></div></foreignObject></g></g><g transform="translate(394.703125, 97)" id="flowchart-D2-2398" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>完全匹配路由</p></span></div></foreignObject></g></g></g></g></g></g></g></g></g></svg><p id="-jlchwv_69"><span class="control" id="-jlchwv_79">1. Direct Exchange（直连交换器）</span></p><div class="code-block" data-lang="java">
// Direct Exchange使用示例
public class DirectExchangeExample {
    
    public void setupDirectExchange() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 声明Direct Exchange
            channel.exchangeDeclare(&quot;order.direct&quot;, BuiltinExchangeType.DIRECT, true);
            
            // 创建不同优先级的队列
            channel.queueDeclare(&quot;order.high.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;order.normal.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;order.low.queue&quot;, true, false, false, null);
            
            // 绑定队列到Exchange，使用精确的routing key
            channel.queueBind(&quot;order.high.queue&quot;, &quot;order.direct&quot;, &quot;high&quot;);
            channel.queueBind(&quot;order.normal.queue&quot;, &quot;order.direct&quot;, &quot;normal&quot;);
            channel.queueBind(&quot;order.low.queue&quot;, &quot;order.direct&quot;, &quot;low&quot;);
        }
    }
    
    public void sendOrderByPriority(String priority, String orderData) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 根据优先级发送到不同队列
            channel.basicPublish(&quot;order.direct&quot;, priority, null, orderData.getBytes());
            System.out.println(&quot;订单发送到&quot; + priority + &quot;优先级队列: &quot; + orderData);
        }
    }
}
</div><p id="-jlchwv_71"><span class="control" id="-jlchwv_80">2. Topic Exchange（主题交换器）</span></p><div class="code-block" data-lang="java">
// Topic Exchange使用示例
public class TopicExchangeExample {
    
    public void setupTopicExchange() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 声明Topic Exchange
            channel.exchangeDeclare(&quot;log.topic&quot;, BuiltinExchangeType.TOPIC, true);
            
            // 创建不同级别的日志队列
            channel.queueDeclare(&quot;log.error.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;log.info.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;log.all.queue&quot;, true, false, false, null);
            
            // 使用通配符绑定
            channel.queueBind(&quot;log.error.queue&quot;, &quot;log.topic&quot;, &quot;*.error&quot;);      // 只接收error日志
            channel.queueBind(&quot;log.info.queue&quot;, &quot;log.topic&quot;, &quot;*.info&quot;);        // 只接收info日志
            channel.queueBind(&quot;log.all.queue&quot;, &quot;log.topic&quot;, &quot;#&quot;);              // 接收所有日志
            
            // 更复杂的模式匹配
            channel.queueDeclare(&quot;log.system.queue&quot;, true, false, false, null);
            channel.queueBind(&quot;log.system.queue&quot;, &quot;log.topic&quot;, &quot;system.*.error&quot;); // 只接收系统错误日志
        }
    }
    
    public void sendLogMessage(String source, String level, String message) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            String routingKey = source + &quot;.&quot; + level;
            String logMessage = String.format(&quot;[%s] %s: %s&quot;, routingKey, new Date(), message);
            
            channel.basicPublish(&quot;log.topic&quot;, routingKey, null, logMessage.getBytes());
            System.out.println(&quot;日志发送: &quot; + routingKey + &quot; -&gt; &quot; + message);
        }
    }
}
</div><p id="-jlchwv_73"><span class="control" id="-jlchwv_81">3. Fanout Exchange（扇出交换器）</span></p><div class="code-block" data-lang="java">
// Fanout Exchange使用示例
public class FanoutExchangeExample {
    
    public void setupFanoutExchange() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 声明Fanout Exchange
            channel.exchangeDeclare(&quot;notification.fanout&quot;, BuiltinExchangeType.FANOUT, true);
            
            // 创建多个通知队列
            channel.queueDeclare(&quot;notification.email.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;notification.sms.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;notification.push.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;notification.webhook.queue&quot;, true, false, false, null);
            
            // 绑定所有队列到Fanout Exchange（忽略routing key）
            channel.queueBind(&quot;notification.email.queue&quot;, &quot;notification.fanout&quot;, &quot;&quot;);
            channel.queueBind(&quot;notification.sms.queue&quot;, &quot;notification.fanout&quot;, &quot;&quot;);
            channel.queueBind(&quot;notification.push.queue&quot;, &quot;notification.fanout&quot;, &quot;&quot;);
            channel.queueBind(&quot;notification.webhook.queue&quot;, &quot;notification.fanout&quot;, &quot;&quot;);
        }
    }
    
    public void sendNotification(String eventType, String content) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            String message = String.format(&quot;{\&quot;event\&quot;:\&quot;%s\&quot;, \&quot;content\&quot;:\&quot;%s\&quot;, \&quot;timestamp\&quot;:\&quot;%s\&quot;}&quot;, 
                                         eventType, content, new Date());
            
            // 发送到Fanout Exchange，会广播到所有绑定的队列
            channel.basicPublish(&quot;notification.fanout&quot;, &quot;&quot;, null, message.getBytes());
            System.out.println(&quot;通知广播发送: &quot; + message);
        }
    }
}
</div><p id="-jlchwv_75"><span class="control" id="-jlchwv_82">4. Headers Exchange（头交换器）</span></p><div class="code-block" data-lang="java">
// Headers Exchange使用示例
public class HeadersExchangeExample {
    
    public void setupHeadersExchange() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 声明Headers Exchange
            channel.exchangeDeclare(&quot;task.headers&quot;, BuiltinExchangeType.HEADERS, true);
            
            // 创建任务队列
            channel.queueDeclare(&quot;task.image.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;task.video.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;task.urgent.queue&quot;, true, false, false, null);
            
            // 基于Headers匹配绑定
            Map&lt;String, Object&gt; imageHeaders = new HashMap&lt;&gt;();
            imageHeaders.put(&quot;x-match&quot;, &quot;all&quot;);  // 必须匹配所有条件
            imageHeaders.put(&quot;type&quot;, &quot;image&quot;);
            imageHeaders.put(&quot;format&quot;, &quot;jpg&quot;);
            channel.queueBind(&quot;task.image.queue&quot;, &quot;task.headers&quot;, &quot;&quot;, imageHeaders);
            
            Map&lt;String, Object&gt; videoHeaders = new HashMap&lt;&gt;();
            videoHeaders.put(&quot;x-match&quot;, &quot;any&quot;);  // 匹配任意条件
            videoHeaders.put(&quot;type&quot;, &quot;video&quot;);
            videoHeaders.put(&quot;format&quot;, &quot;mp4&quot;);
            channel.queueBind(&quot;task.video.queue&quot;, &quot;task.headers&quot;, &quot;&quot;, videoHeaders);
            
            Map&lt;String, Object&gt; urgentHeaders = new HashMap&lt;&gt;();
            urgentHeaders.put(&quot;x-match&quot;, &quot;all&quot;);
            urgentHeaders.put(&quot;priority&quot;, &quot;urgent&quot;);
            channel.queueBind(&quot;task.urgent.queue&quot;, &quot;task.headers&quot;, &quot;&quot;, urgentHeaders);
        }
    }
    
    public void sendTaskMessage(String taskData, Map&lt;String, Object&gt; headers) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            AMQP.BasicProperties.Builder builder = new AMQP.BasicProperties.Builder();
            builder.headers(headers);
            
            channel.basicPublish(&quot;task.headers&quot;, &quot;&quot;, builder.build(), taskData.getBytes());
            System.out.println(&quot;任务发送: &quot; + headers + &quot; -&gt; &quot; + taskData);
        }
    }
}
</div></section></section><section class="chapter"><h2 id="-jlchwv_6" data-toc="-jlchwv_6">🛡️ 高级特性</h2><section class="chapter"><h3 id="q3-rabbitmq" data-toc="q3-rabbitmq">Q3: RabbitMQ如何保证消息的可靠性？有哪些确认机制？</h3><p id="-jlchwv_85"><span class="control" id="-jlchwv_92">答案：</span></p><p id="-jlchwv_86"><span class="control" id="-jlchwv_93">RabbitMQ可靠性保证机制：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 889.3125 648"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="889.3125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="RabbitMQ可靠性机制" class="cluster"><rect height="632" width="873.3125" y="8" x="8" style=""></rect><g transform="translate(370.1875, 8)" class="cluster-label"><foreignObject height="24" width="148.9375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>RabbitMQ可靠性机制</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(37.5, 35)" class="root"><g class="clusters"><g data-look="classic" id="消费者端" class="cluster"><rect height="154" width="798.3125" y="8" x="8" style=""></rect><g transform="translate(375.1015625, 8)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消费者端</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(123, 85)" id="flowchart-C1-2562" class="node default"><rect height="54" width="160" y="-27" x="-80" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-50, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="100"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Consumer Ack</p></span></div></foreignObject></g></g><g transform="translate(338.046875, 85)" id="flowchart-C2-2563" class="node default"><rect height="54" width="170.09375" y="-27" x="-85.046875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-55.046875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="110.09375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Consumer Nack</p></span></div></foreignObject></g></g><g transform="translate(535.1484375, 85)" id="flowchart-C3-2564" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消息重试</p></span></div></foreignObject></g></g><g transform="translate(709.2578125, 85)" id="flowchart-C4-2565" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>死信队列</p></span></div></foreignObject></g></g></g></g><g transform="translate(62.421875, 239)" class="root"><g class="clusters"><g data-look="classic" id="Broker端" class="cluster"><rect height="154" width="748.46875" y="8" x="8" style=""></rect><g transform="translate(350.7109375, 8)" class="cluster-label"><foreignObject height="24" width="63.046875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Broker端</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(113.0625, 85)" id="flowchart-B1-2558" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>队列持久化</p></span></div></foreignObject></g></g><g transform="translate(303.1875, 85)" id="flowchart-B2-2559" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消息持久化</p></span></div></foreignObject></g></g><g transform="translate(485.3046875, 85)" id="flowchart-B3-2560" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>镜像队列</p></span></div></foreignObject></g></g><g transform="translate(659.4140625, 85)" id="flowchart-B4-2561" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>集群部署</p></span></div></foreignObject></g></g></g></g><g transform="translate(99.6953125, 443)" class="root"><g class="clusters"><g data-look="classic" id="生产者端" class="cluster"><rect height="154" width="673.921875" y="8" x="8" style=""></rect><g transform="translate(312.90625, 8)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>生产者端</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(140.3203125, 85)" id="flowchart-A1-2555" class="node default"><rect height="54" width="194.640625" y="-27" x="-97.3203125" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-67.3203125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="134.640625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Publisher Confirms</p></span></div></foreignObject></g></g><g transform="translate(380.2265625, 85)" id="flowchart-A2-2556" class="node default"><rect height="54" width="185.171875" y="-27" x="-92.5859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-62.5859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="125.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Publisher Returns</p></span></div></foreignObject></g></g><g transform="translate(584.8671875, 85)" id="flowchart-A3-2557" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务机制</p></span></div></foreignObject></g></g></g></g></g></g></g></g></g></svg><p id="-jlchwv_88"><span class="control" id="-jlchwv_94">1. 生产者确认机制（Publisher Confirms）</span></p><div class="code-block" data-lang="java">
// Publisher Confirms实现
public class PublisherConfirmsExample {
    
    public void sendWithConfirms() throws IOException, TimeoutException, InterruptedException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 开启发布者确认模式
            channel.confirmSelect();
            
            // 设置确认监听器
            channel.addConfirmListener(new ConfirmListener() {
                @Override
                public void handleAck(long deliveryTag, boolean multiple) throws IOException {
                    System.out.println(&quot;消息确认成功: deliveryTag=&quot; + deliveryTag + &quot;, multiple=&quot; + multiple);
                }
                
                @Override
                public void handleNack(long deliveryTag, boolean multiple) throws IOException {
                    System.err.println(&quot;消息确认失败: deliveryTag=&quot; + deliveryTag + &quot;, multiple=&quot; + multiple);
                    // 实现重发逻辑
                    handleMessageNack(deliveryTag, multiple);
                }
            });
            
            // 设置返回监听器（处理无法路由的消息）
            channel.addReturnListener(new ReturnListener() {
                @Override
                public void handleReturn(int replyCode, String replyText, String exchange,
                                       String routingKey, AMQP.BasicProperties properties, byte[] body) throws IOException {
                    System.err.println(&quot;消息无法路由: &quot; + replyText + &quot;, routingKey=&quot; + routingKey);
                    // 实现补偿逻辑
                    handleUnroutableMessage(exchange, routingKey, body);
                }
            });
            
            // 发送消息（设置mandatory=true以获取路由失败通知）
            for (int i = 0; i &lt; 1000; i++) {
                String message = &quot;Message &quot; + i;
                channel.basicPublish(&quot;test.exchange&quot;, &quot;test.routing.key&quot;, true, 
                                   MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());
            }
            
            // 等待所有确认
            if (channel.waitForConfirms(5000)) {
                System.out.println(&quot;所有消息确认成功&quot;);
            } else {
                System.err.println(&quot;部分消息确认失败&quot;);
            }
        }
    }
    
    // 批量确认实现
    public void batchConfirms() throws IOException, TimeoutException, InterruptedException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            channel.confirmSelect();
            
            int batchSize = 100;
            int messageCount = 1000;
            
            for (int i = 0; i &lt; messageCount; i++) {
                String message = &quot;Batch message &quot; + i;
                channel.basicPublish(&quot;test.exchange&quot;, &quot;test.routing.key&quot;, 
                                   MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());
                
                // 每批确认一次
                if ((i + 1) % batchSize == 0) {
                    if (channel.waitForConfirms(1000)) {
                        System.out.println(&quot;批次 &quot; + ((i + 1) / batchSize) + &quot; 确认成功&quot;);
                    } else {
                        System.err.println(&quot;批次 &quot; + ((i + 1) / batchSize) + &quot; 确认失败&quot;);
                    }
                }
            }
        }
    }
}
</div><p id="-jlchwv_90"><span class="control" id="-jlchwv_95">2. 消费者确认机制</span></p><div class="code-block" data-lang="java">
// 消费者确认机制实现
public class ConsumerAckExample {
    
    public void setupConsumerWithAck() throws IOException, TimeoutException {
        Connection connection = createConnection();
        Channel channel = connection.createChannel();
        
        // 队列声明
        channel.queueDeclare(&quot;order.processing.queue&quot;, true, false, false, null);
        
        // 设置QoS（限制未确认消息数量）
        channel.basicQos(10); // 最多10条未确认消息
        
        // 手动确认消费者
        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);
            long deliveryTag = delivery.getEnvelope().getDeliveryTag();
            
            try {
                // 处理业务逻辑
                processOrder(message);
                
                // 确认消息
                channel.basicAck(deliveryTag, false);
                System.out.println(&quot;订单处理成功: &quot; + message);
                
            } catch (BusinessException e) {
                // 业务异常，拒绝消息不重新入队
                channel.basicNack(deliveryTag, false, false);
                System.err.println(&quot;业务处理失败，消息丢弃: &quot; + e.getMessage());
                
            } catch (SystemException e) {
                // 系统异常，拒绝消息并重新入队
                channel.basicNack(deliveryTag, false, true);
                System.err.println(&quot;系统异常，消息重新入队: &quot; + e.getMessage());
                
            } catch (Exception e) {
                // 未知异常，重新入队并限制重试次数
                handleRetryLogic(channel, delivery, e);
            }
        };
        
        // 开始消费（autoAck=false表示手动确认）
        channel.basicConsume(&quot;order.processing.queue&quot;, false, deliverCallback, consumerTag -&gt; {});
    }
    
    // 重试逻辑实现
    private void handleRetryLogic(Channel channel, Delivery delivery, Exception e) throws IOException {
        long deliveryTag = delivery.getEnvelope().getDeliveryTag();
        Map&lt;String, Object&gt; headers = delivery.getProperties().getHeaders();
        
        // 获取重试次数
        int retryCount = 0;
        if (headers != null &amp;&amp; headers.containsKey(&quot;x-retry-count&quot;)) {
            retryCount = (Integer) headers.get(&quot;x-retry-count&quot;);
        }
        
        if (retryCount &lt; 3) {
            // 增加重试次数并重新发布
            Map&lt;String, Object&gt; newHeaders = new HashMap&lt;&gt;(headers != null ? headers : new HashMap&lt;&gt;());
            newHeaders.put(&quot;x-retry-count&quot;, retryCount + 1);
            
            AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
                .headers(newHeaders)
                .deliveryMode(2)
                .build();
            
            // 重新发布到原队列
            channel.basicPublish(&quot;&quot;, delivery.getEnvelope().getRoutingKey(), properties, delivery.getBody());
            
            // 确认原消息
            channel.basicAck(deliveryTag, false);
            
            System.out.println(&quot;消息重试第&quot; + (retryCount + 1) + &quot;次&quot;);
        } else {
            // 超过重试次数，发送到死信队列
            channel.basicNack(deliveryTag, false, false);
            System.err.println(&quot;消息超过重试次数，进入死信队列&quot;);
        }
    }
}
</div></section><section class="chapter"><h3 id="q4-rabbitmq" data-toc="q4-rabbitmq">Q4: 如何实现RabbitMQ的死信队列和延迟队列？</h3><p id="-jlchwv_96"><span class="control" id="-jlchwv_103">答案：</span></p><p id="-jlchwv_97"><span class="control" id="-jlchwv_104">死信队列（DLX - Dead Letter Exchange）机制：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 307.046875 934"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="307.046875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="死信队列架构" class="cluster"><rect height="918" width="291.046875" y="8" x="8" style=""></rect><g transform="translate(105.4453125, 8)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>死信队列架构</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M153.523,123.5L153.523,129.75C153.523,136,153.523,148.5,153.523,157.875C153.523,167.25,153.523,173.5,153.523,179.083C153.523,184.667,153.523,189.583,153.523,192.042L153.523,194.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M153.523,252.5L153.523,258.75C153.523,265,153.523,277.5,153.523,286.875C153.523,296.25,153.523,302.5,153.523,308.083C153.523,313.667,153.523,318.583,153.523,321.042L153.523,323.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_2" d="M153.523,405.5L153.523,411.75C153.523,418,153.523,430.5,153.523,439.875C153.523,449.25,153.523,455.5,153.523,461.083C153.523,466.667,153.523,471.583,153.523,474.042L153.523,476.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_E_3" d="M153.523,558.5L153.523,564.75C153.523,571,153.523,583.5,153.523,592.875C153.523,602.25,153.523,608.5,153.523,614.083C153.523,619.667,153.523,624.583,153.523,627.042L153.523,629.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_4" d="M153.523,711.5L153.523,717.75C153.523,724,153.523,736.5,153.523,745.875C153.523,755.25,153.523,761.5,153.523,767.083C153.523,772.667,153.523,777.583,153.523,780.042L153.523,782.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(153.5234375, 84.5)" id="flowchart-A-2713" class="node default"><rect height="78" width="162.28125" y="-39" x="-81.140625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-51.140625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="102.28125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Normal Queue<br>正常队列</p></span></div></foreignObject></g></g><g transform="translate(153.5234375, 225.5)" id="flowchart-B-2714" class="node default"><rect height="54" width="221.046875" y="-27" x="-110.5234375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-80.5234375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="161.046875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>消息过期/拒绝/队列满</p></span></div></foreignObject></g></g><g transform="translate(153.5234375, 366.5)" id="flowchart-C-2716" class="node default"><rect height="78" width="217.609375" y="-39" x="-108.8046875" data-et="node" data-id="abc" style="fill:#ffcdd2 !important" class="basic label-container"></rect><g transform="translate(-78.8046875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="157.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Dead Letter Exchange<br>死信交换器</p></span></div></foreignObject></g></g><g transform="translate(153.5234375, 519.5)" id="flowchart-D-2718" class="node default"><rect height="78" width="196.125" y="-39" x="-98.0625" data-et="node" data-id="abc" style="fill:#ffcdd2 !important" class="basic label-container"></rect><g transform="translate(-68.0625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="136.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Dead Letter Queue<br>死信队列</p></span></div></foreignObject></g></g><g transform="translate(153.5234375, 672.5)" id="flowchart-E-2720" class="node default"><rect height="78" width="220.796875" y="-39" x="-110.3984375" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-80.3984375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="160.796875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Dead Letter Consumer<br>死信消费者</p></span></div></foreignObject></g></g><g transform="translate(153.5234375, 837.5)" id="flowchart-F-2721" class="node default"><rect height="102" width="124.109375" y="-51" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>重试逻辑<br>补偿处理<br>人工介入</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-jlchwv_99"><span class="control" id="-jlchwv_105">死信队列实现：</span></p><div class="code-block" data-lang="java">
// 死信队列完整实现
public class DeadLetterQueueExample {
    
    public void setupDeadLetterQueue() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 1. 声明死信交换器和死信队列
            channel.exchangeDeclare(&quot;dlx.exchange&quot;, BuiltinExchangeType.DIRECT, true);
            channel.queueDeclare(&quot;dlx.queue&quot;, true, false, false, null);
            channel.queueBind(&quot;dlx.queue&quot;, &quot;dlx.exchange&quot;, &quot;failed&quot;);
            
            // 2. 声明正常业务交换器
            channel.exchangeDeclare(&quot;business.exchange&quot;, BuiltinExchangeType.DIRECT, true);
            
            // 3. 声明业务队列，配置死信参数
            Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;();
            arguments.put(&quot;x-dead-letter-exchange&quot;, &quot;dlx.exchange&quot;);    // 死信交换器
            arguments.put(&quot;x-dead-letter-routing-key&quot;, &quot;failed&quot;);       // 死信路由键
            arguments.put(&quot;x-message-ttl&quot;, 30000);                      // 消息TTL 30秒
            arguments.put(&quot;x-max-length&quot;, 1000);                        // 队列最大长度
            
            channel.queueDeclare(&quot;business.queue&quot;, true, false, false, arguments);
            channel.queueBind(&quot;business.queue&quot;, &quot;business.exchange&quot;, &quot;process&quot;);
            
            System.out.println(&quot;死信队列配置完成&quot;);
        }
    }
    
    // 业务消费者（会产生死信）
    public void startBusinessConsumer() throws IOException, TimeoutException {
        Connection connection = createConnection();
        Channel channel = connection.createChannel();
        
        channel.basicQos(1);
        
        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);
            System.out.println(&quot;处理业务消息: &quot; + message);
            
            try {
                // 模拟业务处理
                processBusinessMessage(message);
                
                // 模拟部分消息处理失败
                if (message.contains(&quot;error&quot;)) {
                    throw new RuntimeException(&quot;业务处理失败&quot;);
                }
                
                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
                
            } catch (Exception e) {
                System.err.println(&quot;业务处理异常: &quot; + e.getMessage());
                // 拒绝消息，不重新入队，触发死信
                channel.basicNack(delivery.getEnvelope().getDeliveryTag(), false, false);
            }
        };
        
        channel.basicConsume(&quot;business.queue&quot;, false, deliverCallback, consumerTag -&gt; {});
    }
    
    // 死信消费者（处理失败消息）
    public void startDeadLetterConsumer() throws IOException, TimeoutException {
        Connection connection = createConnection();
        Channel channel = connection.createChannel();
        
        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);
            Map&lt;String, Object&gt; headers = delivery.getProperties().getHeaders();
            
            System.out.println(&quot;处理死信消息: &quot; + message);
            System.out.println(&quot;死信原因: &quot; + headers);
            
            // 分析死信原因
            String deathReason = getDeathReason(headers);
            
            switch (deathReason) {
                case &quot;rejected&quot;:
                    handleRejectedMessage(message, headers);
                    break;
                case &quot;expired&quot;:
                    handleExpiredMessage(message, headers);
                    break;
                case &quot;maxlen&quot;:
                    handleMaxLengthMessage(message, headers);
                    break;
                default:
                    handleUnknownDeathReason(message, headers);
            }
            
            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
        };
        
        channel.basicConsume(&quot;dlx.queue&quot;, false, deliverCallback, consumerTag -&gt; {});
    }
    
    private String getDeathReason(Map&lt;String, Object&gt; headers) {
        if (headers != null &amp;&amp; headers.containsKey(&quot;x-death&quot;)) {
            @SuppressWarnings(&quot;unchecked&quot;)
            List&lt;Map&lt;String, Object&gt;&gt; deaths = (List&lt;Map&lt;String, Object&gt;&gt;) headers.get(&quot;x-death&quot;);
            if (!deaths.isEmpty()) {
                return (String) deaths.get(0).get(&quot;reason&quot;);
            }
        }
        return &quot;unknown&quot;;
    }
}
</div><p id="-jlchwv_101"><span class="control" id="-jlchwv_106">延迟队列实现：</span></p><div class="code-block" data-lang="java">
// 延迟队列实现
public class DelayedQueueExample {
    
    // 方法1: 基于TTL + 死信队列实现延迟
    public void setupTTLDelayQueue() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 延迟交换器和最终处理队列
            channel.exchangeDeclare(&quot;delayed.exchange&quot;, BuiltinExchangeType.DIRECT, true);
            channel.queueDeclare(&quot;delayed.queue&quot;, true, false, false, null);
            channel.queueBind(&quot;delayed.queue&quot;, &quot;delayed.exchange&quot;, &quot;process&quot;);
            
            // TTL延迟队列（不设置消费者，消息过期后进入死信队列）
            Map&lt;String, Object&gt; delayArguments = new HashMap&lt;&gt;();
            delayArguments.put(&quot;x-dead-letter-exchange&quot;, &quot;delayed.exchange&quot;);
            delayArguments.put(&quot;x-dead-letter-routing-key&quot;, &quot;process&quot;);
            delayArguments.put(&quot;x-message-ttl&quot;, 60000); // 60秒延迟
            
            channel.queueDeclare(&quot;delay.60s.queue&quot;, true, false, false, delayArguments);
            channel.exchangeDeclare(&quot;delay.exchange&quot;, BuiltinExchangeType.DIRECT, true);
            channel.queueBind(&quot;delay.60s.queue&quot;, &quot;delay.exchange&quot;, &quot;60s&quot;);
            
            System.out.println(&quot;TTL延迟队列配置完成&quot;);
        }
    }
    
    // 发送延迟消息
    public void sendDelayedMessage(String message, int delaySeconds) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 根据延迟时间选择不同的延迟队列
            String delayQueue = &quot;delay.&quot; + delaySeconds + &quot;s.queue&quot;;
            String routingKey = delaySeconds + &quot;s&quot;;
            
            // 动态创建延迟队列
            Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;();
            arguments.put(&quot;x-dead-letter-exchange&quot;, &quot;delayed.exchange&quot;);
            arguments.put(&quot;x-dead-letter-routing-key&quot;, &quot;process&quot;);
            arguments.put(&quot;x-message-ttl&quot;, delaySeconds * 1000);
            
            channel.queueDeclare(delayQueue, true, false, false, arguments);
            channel.queueBind(delayQueue, &quot;delay.exchange&quot;, routingKey);
            
            // 发送消息到延迟队列
            AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
                .timestamp(new Date())
                .build();
                
            channel.basicPublish(&quot;delay.exchange&quot;, routingKey, properties, message.getBytes());
            
            System.out.println(&quot;延迟消息发送: &quot; + delaySeconds + &quot;秒后处理 -&gt; &quot; + message);
        }
    }
    
    // 方法2: 基于RabbitMQ延迟插件
    public void setupPluginDelayQueue() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 声明延迟交换器（需要安装rabbitmq-delayed-message-exchange插件）
            Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;();
            arguments.put(&quot;x-delayed-type&quot;, &quot;direct&quot;);
            
            channel.exchangeDeclare(&quot;delayed.plugin.exchange&quot;, &quot;x-delayed-message&quot;, true, false, arguments);
            
            // 声明目标队列
            channel.queueDeclare(&quot;delayed.target.queue&quot;, true, false, false, null);
            channel.queueBind(&quot;delayed.target.queue&quot;, &quot;delayed.plugin.exchange&quot;, &quot;delayed&quot;);
            
            System.out.println(&quot;插件延迟队列配置完成&quot;);
        }
    }
    
    // 使用插件发送延迟消息
    public void sendPluginDelayedMessage(String message, int delaySeconds) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 设置延迟时间（毫秒）
            Map&lt;String, Object&gt; headers = new HashMap&lt;&gt;();
            headers.put(&quot;x-delay&quot;, delaySeconds * 1000);
            
            AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
                .headers(headers)
                .timestamp(new Date())
                .build();
            
            channel.basicPublish(&quot;delayed.plugin.exchange&quot;, &quot;delayed&quot;, properties, message.getBytes());
            
            System.out.println(&quot;插件延迟消息发送: &quot; + delaySeconds + &quot;秒后处理 -&gt; &quot; + message);
        }
    }
    
    // 延迟消息消费者
    public void startDelayedConsumer() throws IOException, TimeoutException {
        Connection connection = createConnection();
        Channel channel = connection.createChannel();
        
        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);
            Date timestamp = delivery.getProperties().getTimestamp();
            
            System.out.println(&quot;处理延迟消息: &quot; + message);
            System.out.println(&quot;发送时间: &quot; + timestamp);
            System.out.println(&quot;处理时间: &quot; + new Date());
            
            // 处理延迟任务
            processDelayedTask(message);
            
            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
        };
        
        channel.basicConsume(&quot;delayed.queue&quot;, false, deliverCallback, consumerTag -&gt; {});
    }
}
</div></section></section><section class="chapter"><h2 id="-jlchwv_7" data-toc="-jlchwv_7">💡 面试技巧</h2><section class="chapter"><h3 id="-jlchwv_107" data-toc="-jlchwv_107">高频考点</h3><ol class="list _decimal" id="-jlchwv_109" type="1"><li class="list__item" id="-jlchwv_110"><p id="-jlchwv_115"><span class="control" id="-jlchwv_116">AMQP协议</span>: 理解AMQP协议和RabbitMQ架构</p></li><li class="list__item" id="-jlchwv_111"><p id="-jlchwv_117"><span class="control" id="-jlchwv_118">Exchange类型</span>: 掌握四种Exchange的路由规则</p></li><li class="list__item" id="-jlchwv_112"><p id="-jlchwv_119"><span class="control" id="-jlchwv_120">可靠性机制</span>: Publisher Confirms和Consumer Ack</p></li><li class="list__item" id="-jlchwv_113"><p id="-jlchwv_121"><span class="control" id="-jlchwv_122">死信队列</span>: 死信产生原因和处理机制</p></li><li class="list__item" id="-jlchwv_114"><p id="-jlchwv_123"><span class="control" id="-jlchwv_124">延迟队列</span>: 两种延迟队列实现方案</p></li></ol></section><section class="chapter"><h3 id="-jlchwv_108" data-toc="-jlchwv_108">回答策略</h3><ol class="list _decimal" id="-jlchwv_125" type="1"><li class="list__item" id="-jlchwv_128"><p id="-jlchwv_132"><span class="control" id="-jlchwv_133">协议理解</span>: 先说AMQP协议特点，再讲RabbitMQ实现</p></li><li class="list__item" id="-jlchwv_129"><p id="-jlchwv_134"><span class="control" id="-jlchwv_135">场景对比</span>: 不同Exchange类型的适用场景</p></li><li class="list__item" id="-jlchwv_130"><p id="-jlchwv_136"><span class="control" id="-jlchwv_137">可靠性保证</span>: 从生产者到消费者的全链路可靠性</p></li><li class="list__item" id="-jlchwv_131"><p id="-jlchwv_138"><span class="control" id="-jlchwv_139">实际应用</span>: 结合具体业务场景说明技术选择</p></li></ol><p id="-jlchwv_127"><span class="control" id="-jlchwv_140">学习建议</span>: RabbitMQ的灵活性很强，重点要理解其路由机制和可靠性保证。建议通过管理界面观察消息流转过程，加深对Exchange和Queue绑定关系的理解。</p></section></section><div class="last-modified">09 六月 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="kafka深入解析qa.html" class="navigation-links__prev">Kafka深入解析QA</a><a href="rocketmq企业级应用qa.html" class="navigation-links__next">RocketMQ企业级应用QA</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>