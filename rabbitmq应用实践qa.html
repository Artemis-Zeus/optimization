<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-06-10T01:07:27.3860591"><title>RabbitMQåº”ç”¨å®è·µQA | æŠ€æœ¯çŸ¥è¯†åº“</title><script type="application/json" id="virtual-toc-data">[{"id":"-jlchwv_4","level":0,"title":"ğŸ“‹ çŸ¥è¯†ç»“æ„","anchor":"#-jlchwv_4"},{"id":"amqp","level":0,"title":"ğŸ”Œ AMQPåè®®ä¸æ ¸å¿ƒæ¦‚å¿µ","anchor":"#amqp"},{"id":"-jlchwv_6","level":0,"title":"ğŸ›¡ï¸ é«˜çº§ç‰¹æ€§","anchor":"#-jlchwv_6"},{"id":"-jlchwv_7","level":0,"title":"ğŸ’¡ é¢è¯•æŠ€å·§","anchor":"#-jlchwv_7"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="RabbitMQåº”ç”¨å®è·µQA | æŠ€æœ¯çŸ¥è¯†åº“"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="æŠ€æœ¯çŸ¥è¯†åº“ Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/rabbitmqåº”ç”¨å®è·µqa.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="RabbitMQåº”ç”¨å®è·µQA | æŠ€æœ¯çŸ¥è¯†åº“"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/rabbitmqåº”ç”¨å®è·µqa.html#webpage",
    "url": "writerside-documentation/rabbitmqåº”ç”¨å®è·µqa.html",
    "name": "RabbitMQåº”ç”¨å®è·µQA | æŠ€æœ¯çŸ¥è¯†åº“",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "æŠ€æœ¯çŸ¥è¯†åº“ Help"
}</script><!-- End Schema.org --></head><body data-id="RabbitMQåº”ç”¨å®è·µQA" data-main-title="RabbitMQåº”ç”¨å®è·µQA" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="æ¶ˆæ¯é˜Ÿåˆ—é¢è¯•å¤§çº².md|æ¶ˆæ¯é˜Ÿåˆ—é¢è¯•å¤§çº²"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>æŠ€æœ¯çŸ¥è¯†åº“  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="RabbitMQåº”ç”¨å®è·µQA" id="RabbitMQåº”ç”¨å®è·µQA.md">RabbitMQåº”ç”¨å®è·µQA</h1><p id="-jlchwv_3">RabbitMQæ˜¯åŸºäºAMQPåè®®çš„ä¼ä¸šçº§æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä»¥å…¶ä¸°å¯Œçš„è·¯ç”±åŠŸèƒ½ã€çµæ´»çš„éƒ¨ç½²æ–¹å¼å’Œå®Œå–„çš„ç®¡ç†ç•Œé¢è€Œå¹¿å—æ¬¢è¿ã€‚æœ¬æ–‡æ¡£è¯¦ç»†è§£æRabbitMQçš„æ ¸å¿ƒæ¦‚å¿µå’Œå®è·µåº”ç”¨ã€‚</p><section class="chapter"><h2 id="-jlchwv_4" data-toc="-jlchwv_4">ğŸ“‹ çŸ¥è¯†ç»“æ„</h2><svg aria-roledescription="mindmap" role="graphics-document document" viewBox="5 5 908.3316650390625 454.918701171875" style="max-width: 908.3316650390625px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g></g><g class="mindmap-edges"><path class="edge section-edge-0 edge-depth-1" d="M 202.97848214584678,264.93109172098383 L 191.85279752207856,296.8153821872728 L180.72711289831034,328.6996726535617"></path><path class="edge section-edge-0 edge-depth-1" d="M 193.50004365073858,246.6388133636924 L 139.84025485460887,231.27158505040143 L86.18046605847917,215.9043567371104"></path><path class="edge section-edge-0 edge-depth-1" d="M 193.44185324606025,254.68938093370298 L 132.97817690872517,271.06321056055174 L72.5145005713901,287.4370401874005"></path><path class="edge section-edge-0 edge-depth-1" d="M 220.2790594156309,259.2692692372002 L 252.7770969736397,281.62250530788964 L285.27513453164846,303.9757413785791"></path><path class="edge section-edge-0 edge-depth-0" d="M 394.31527759126226,230.1266629633385 L 308.57224499837525,239.62207746857598 L222.82921240548825,249.1174919738134"></path><path class="edge section-edge-1 edge-depth-1" d="M 655.2798661982986,242.08838998260217 L 733.565553075477,264.5114912550128 L811.8512399526555,286.93459252742343"></path><path class="edge section-edge-1 edge-depth-1" d="M 644.0123430681374,252.62303566239183 L 650.8404482807878,284.38515168391245 L657.6685534934381,316.1472677054331"></path><path class="edge section-edge-1 edge-depth-1" d="M 655.657098738024,235.50090873313485 L 736.6414232641821,222.05310649320464 L817.6257477903401,208.60530425327443"></path><path class="edge section-edge-1 edge-depth-1" d="M 650.1203456695131,226.15804081966502 L 672.9966418220487,197.0086888635794 L695.8729379745843,167.8593369074938"></path><path class="edge section-edge-1 edge-depth-0" d="M 424.2115824788792,229.0891567144632 L 525.0419293848179,233.21684684046195 L625.8722762907565,237.3445369664607"></path><path class="edge section-edge-2 edge-depth-1" d="M 251.9374501633573,153.60583508012687 L 278.1076579841098,127.32286818227911 L304.27786580486224,101.03990128443135"></path><path class="edge section-edge-2 edge-depth-1" d="M 233.9224410553781,151.20537156969925 L 215.64291371675597,119.15425025194534 L197.36338637813384,87.10312893419143"></path><path class="edge section-edge-2 edge-depth-1" d="M 226.7413161799884,160.84714625566642 L 172.07214214107807,148.1713801915146 L117.40296810216776,135.49561412736278"></path><path class="edge section-edge-2 edge-depth-1" d="M 256.3321540736986,165.03841631679498 L 301.976161891042,167.48602131048605 L347.62016970838545,169.93362630417712"></path><path class="edge section-edge-2 edge-depth-0" d="M 395.21487955948874,223.11457597897893 L 325.2889047441678,196.35541460482315 L255.3629299288468,169.59625323066737"></path><path class="edge section-edge-3 edge-depth-1" d="M 475.86153888589683,117.92872225520011 L 531.5809161456708,107.9482820494708 L587.3002934054448,97.9678418437415"></path><path class="edge section-edge-3 edge-depth-1" d="M 473.1094086827526,129.5562276182991 L 504.1964161082308,152.80197547873544 L535.283423533709,176.0477233391718"></path><path class="edge section-edge-3 edge-depth-1" d="M 470.1316425670164,108.59984318537911 L 493.79786162959294,77.23671353135862 L517.4640806921694,45.87358387733812"></path><path class="edge section-edge-3 edge-depth-1" d="M 452.792460545647,108.08173149722649 L 432.5298846136676,77.6010157509443 L412.26730868168823,47.1203000046621"></path><path class="edge section-edge-3 edge-depth-0" d="M 415.72317958778183,214.95665045583198 L 435.160331907671,174.5245214623233 L454.59748422756013,134.0923924688146"></path><path class="edge section-edge-4 edge-depth-1" d="M 395.17330287055876,345.55531322936764 L 355.4461371991014,372.32770708098184 L315.718971527644,399.10010093259604"></path><path class="edge section-edge-4 edge-depth-1" d="M 410.40149504191305,351.91097311870647 L 416.49225751478264,384.09564408788583 L422.5830199876522,416.2803150570652"></path><path class="edge section-edge-4 edge-depth-1" d="M 421.4858036978323,342.875805869862 L 476.92021270010366,365.66431696713505 L532.3546217023751,388.4528280644082"></path><path class="edge section-edge-4 edge-depth-1" d="M 421.3738680259119,331.204295674697 L 468.2813156501695,310.8608902652764 L515.1887632744272,290.5174848558558"></path><path class="edge section-edge-4 edge-depth-0" d="M 409.001734423456,243.47396703034804 L 408.41823633736885,282.82409170918095 L407.8347382512817,322.17421638801386"></path></g><g class="mindmap-nodes"><g transform="translate(332.2835379432162, 209.57561586192935)" class="mindmap-node section--1 section-root"><g transform="translate(76.94059753417969, 18.9)"><circle r="76.94059753417969" class="node-bkg node-circle" id="node-0"></circle></g><g transform="translate(76.94059753417969, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">RabbitMQæ ¸å¿ƒæŠ€æœ¯</tspan></tspan></text></g></g></g><g transform="translate(160.59863439606363, 231.86853907522254)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h84.64344024658203 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-1"></path><line y2="37.8" x2="94.64344024658203" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(47.321720123291016, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">AMQPåè®®</tspan></tspan></text></g></g></g><g transform="translate(581.1565982922399, 219.05807781899455)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h109.40625 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-6"></path><line y2="37.8" x2="119.40625" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(59.703125, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Exchangeç±»å‹</tspan></tspan></text></g></g></g><g transform="translate(199.2989865109397, 145.33521334771694)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-11"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">é˜Ÿåˆ—æœºåˆ¶</tspan></tspan></text></g></g></g><g transform="translate(418.5605290398504, 101.67342706271722)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-16"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">é«˜çº§ç‰¹æ€§</tspan></tspan></text></g></g></g><g transform="translate(364.57633789924614, 318.2725675564326)" class="mindmap-node section-4"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-21"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-4"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">é›†ç¾¤éƒ¨ç½²</tspan></tspan></text></g></g></g><g transform="translate(133.23055302480248, 323.962225299323)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-2"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">æ¶ˆæ¯æ¨¡å‹</tspan></tspan></text></g></g></g><g transform="translate(36.73615502201642, 192.87463102558024)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h60.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-3"></path><line y2="37.8" x2="70.04800033569336" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(35.02400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">åè®®æ ˆ</tspan></tspan></text></g></g></g><g transform="translate(15, 272.457882045881)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-4"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">è¿æ¥ç®¡ç†</tspan></tspan></text></g></g></g><g transform="translate(255.07915192792473, 293.5764715405568)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-5"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ä¿¡é“æœºåˆ¶</tspan></tspan></text></g></g></g><g transform="translate(758.1831908726302, 272.1649046910311)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h126.17638397216797 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-7"></path><line y2="37.8" x2="136.17638397216797" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(68.08819198608398, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Direct</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Exchange</tspan></tspan></text></g></g></g><g transform="translate(595.3970437832517, 311.9122255488304)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h120.84825897216797 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-8"></path><line y2="37.8" x2="130.84825897216797" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(65.42412948608398, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Topic</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Exchange</tspan></tspan></text></g></g></g><g transform="translate(761.5146187500403, 187.24813516741472)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h131.81700897216797 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-9"></path><line y2="37.8" x2="141.81700897216797" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(70.90850448608398, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Fanout</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Exchange</tspan></tspan></text></g></g></g><g transform="translate(629.8578645510762, 137.15929990816426)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h140.5513916015625 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-10"></path><line y2="37.8" x2="150.5513916015625" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(75.27569580078125, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Headers</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> Exchange</tspan></tspan></text></g></g></g><g transform="translate(272.32564265918415, 71.51052301684126)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-12"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">é˜Ÿåˆ—å±æ€§</tspan></tspan></text></g></g></g><g transform="translate(138.88415308687888, 55.173287156173735)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h92.09600067138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-13"></path><line y2="37.8" x2="102.09600067138672" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(51.04800033569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">æ¶ˆæ¯æŒä¹…åŒ–</tspan></tspan></text></g></g></g><g transform="translate(62.88436027121645, 113.20754703531225)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h69.8125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-14"></path><line y2="37.8" x2="79.8125" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(39.90625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">TTLæœºåˆ¶</tspan></tspan></text></g></g></g><g transform="translate(320.5439622711443, 151.83682927325515)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-15"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">æ­»ä¿¡é˜Ÿåˆ—</tspan></tspan></text></g></g></g><g transform="translate(559.0293046552998, 76.42313703622438)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-17"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">æ¶ˆæ¯ç¡®è®¤</tspan></tspan></text></g></g></g><g transform="translate(505.24161637851546, 166.13052389475365)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-18"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">äº‹åŠ¡æœºåˆ¶</tspan></tspan></text></g></g></g><g transform="translate(475.9366949212398, 15)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h91.125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-19"></path><line y2="37.8" x2="101.125" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(50.5625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ä¼˜å…ˆçº§é˜Ÿåˆ—</tspan></tspan></text></g></g></g><g transform="translate(361.9085533893891, 15.728604439171363)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-20"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">å»¶è¿Ÿé˜Ÿåˆ—</tspan></tspan></text></g></g></g><g transform="translate(260.2439379027652, 388.58284660553113)" class="mindmap-node section-4"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-22"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-4"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">é›†ç¾¤æ¨¡å¼</tspan></tspan></text></g></g></g><g transform="translate(382.81749033222343, 412.1187206193391)" class="mindmap-node section-4"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-23"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-4"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">é•œåƒé˜Ÿåˆ—</tspan></tspan></text></g></g></g><g transform="translate(503.6734007028655, 375.25606637783767)" class="mindmap-node section-4"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-24"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-4"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">åˆ†åŒºé˜Ÿåˆ—</tspan></tspan></text></g></g></g><g transform="translate(486.4142948049015, 265.64921297412025)" class="mindmap-node section-4"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-25"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-4"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">æ•…éšœæ¢å¤</tspan></tspan></text></g></g></g></g></svg></section><section class="chapter"><h2 id="amqp" data-toc="amqp">ğŸ”Œ AMQPåè®®ä¸æ ¸å¿ƒæ¦‚å¿µ</h2><section class="chapter"><h3 id="q1-rabbitmq-amqp" data-toc="q1-rabbitmq-amqp">Q1: RabbitMQçš„AMQPåè®®æ˜¯ä»€ä¹ˆï¼Ÿæ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ</h3><p id="-jlchwv_11"><span class="control" id="-jlchwv_27">ç­”æ¡ˆï¼š</span></p><p id="-jlchwv_12"><span class="control" id="-jlchwv_28">AMQPï¼ˆAdvanced Message Queuing Protocolï¼‰æ ¸å¿ƒæ¶æ„ï¼š</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 2639.5625 532"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="2639.5625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="subGraph6" class="cluster"><rect height="516" width="2623.5625" y="8" x="8" style=""></rect><g transform="translate(1247.0546875, 8)" class="cluster-label"><foreignObject height="24" width="145.453125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>RabbitMQ AMQPæ¶æ„</p></span></div></foreignObject></g></g><g data-look="classic" id="æ¶ˆè´¹è€…ç«¯" class="cluster"><rect height="124" width="710.28125" y="48" x="1883.78125" style=""></rect><g transform="translate(2206.8671875, 48)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ¶ˆè´¹è€…ç«¯</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph4" class="cluster"><rect height="476" width="984.84375" y="28" x="823.9375" style=""></rect><g transform="translate(1256.015625, 28)" class="cluster-label"><foreignObject height="24" width="120.6875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>RabbitMQ Broker</p></span></div></foreignObject></g></g><g data-look="classic" id="ç”Ÿäº§è€…ç«¯" class="cluster"><rect height="124" width="703.4375" y="48" x="45.5" style=""></rect><g transform="translate(365.1640625, 48)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ç”Ÿäº§è€…ç«¯</p></span></div></foreignObject></g></g><g data-look="classic" id="Bindingç»‘å®š" class="cluster"><rect height="228" width="219.09375" y="48" x="1193" style=""></rect><g transform="translate(1260.1328125, 48)" class="cluster-label"><foreignObject height="24" width="84.828125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Bindingç»‘å®š</p></span></div></foreignObject></g></g><g data-look="classic" id="Queueé˜Ÿåˆ—" class="cluster"><rect height="332" width="284.1875" y="48" x="1487.09375" style=""></rect><g transform="translate(1590.2265625, 48)" class="cluster-label"><foreignObject height="24" width="77.921875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Queueé˜Ÿåˆ—</p></span></div></foreignObject></g></g><g data-look="classic" id="Exchangeäº¤æ¢å™¨" class="cluster"><rect height="332" width="256.5625" y="48" x="861.4375" style=""></rect><g transform="translate(932.0078125, 48)" class="cluster-label"><foreignObject height="24" width="115.421875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Exchangeäº¤æ¢å™¨</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_P1_C1_0" d="M238.75,110L245,110C251.25,110,263.75,110,273.125,110C282.5,110,288.75,110,294.333,110C299.917,110,304.833,110,307.292,110L309.75,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C1_CH1_1" d="M486.563,110L492.813,110C499.063,110,511.563,110,520.938,110C530.313,110,536.563,110,542.146,110C547.729,110,552.646,110,555.104,110L557.563,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CH1_EX1_2" d="M711.438,110L717.688,110C723.938,110,736.438,110,748.938,110C761.438,110,773.938,110,786.438,110C798.938,110,811.438,110,823.938,110C836.438,110,848.938,110,858.547,110C868.156,110,874.875,110,880.927,110C886.979,110,892.365,110,895.057,110L897.75,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_EX1_B1_3" d="M1077.688,110L1084.406,110C1091.125,110,1104.563,110,1117.531,110C1130.5,110,1143,110,1155.5,110C1168,110,1180.5,110,1189.875,110C1199.25,110,1205.5,110,1211.083,110C1216.667,110,1221.583,110,1224.042,110L1226.5,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B1_Q1_4" d="M1374.594,110L1380.844,110C1387.094,110,1399.594,110,1412.094,110C1424.594,110,1437.094,110,1449.594,110C1462.094,110,1474.594,110,1487.677,110C1500.76,110,1514.427,110,1527.427,110C1540.427,110,1552.76,110,1558.927,110L1565.094,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Q1_CH2_5" d="M1689.281,110L1702.948,110C1716.615,110,1743.948,110,1763.865,110C1783.781,110,1796.281,110,1808.781,110C1821.281,110,1833.781,110,1846.281,110C1858.781,110,1871.281,110,1880.656,110C1890.031,110,1896.281,110,1901.865,110C1907.448,110,1912.365,110,1914.823,110L1917.281,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CH2_C2_6" d="M2071.156,110L2077.406,110C2083.656,110,2096.156,110,2105.531,110C2114.906,110,2121.156,110,2126.74,110C2132.323,110,2137.24,110,2139.698,110L2142.156,110"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C2_CON1_7" d="M2318.969,110L2325.219,110C2331.469,110,2343.969,110,2353.344,110C2362.719,110,2368.969,110,2374.552,110C2380.135,110,2385.052,110,2387.51,110L2389.969,110"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(2232.5625, 110)" id="flowchart-C2-2260" class="node default"><rect height="54" width="172.8125" y="-27" x="-86.40625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.40625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.8125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Connectionè¿æ¥</p></span></div></foreignObject></g></g><g transform="translate(160.875, 110)" id="flowchart-P1-2248" class="node default"><rect height="54" width="155.75" y="-27" x="-77.875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-47.875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="95.75"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Produceråº”ç”¨</p></span></div></foreignObject></g></g><g transform="translate(400.15625, 110)" id="flowchart-C1-2249" class="node default"><rect height="54" width="172.8125" y="-27" x="-86.40625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.40625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.8125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Connectionè¿æ¥</p></span></div></foreignObject></g></g><g transform="translate(636.5, 110)" id="flowchart-CH1-2250" class="node default"><rect height="54" width="149.875" y="-27" x="-74.9375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-44.9375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="89.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Channelä¿¡é“</p></span></div></foreignObject></g></g><g transform="translate(989.71875, 110)" id="flowchart-EX1-2252" class="node default"><rect height="54" width="175.9375" y="-27" x="-87.96875" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-57.96875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="115.9375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Direct Exchange</p></span></div></foreignObject></g></g><g transform="translate(1302.546875, 110)" id="flowchart-B1-2258" class="node default"><rect height="54" width="144.09375" y="-27" x="-72.046875" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-42.046875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="84.09375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Routing Key</p></span></div></foreignObject></g></g><g transform="translate(1629.1875, 110)" id="flowchart-Q1-2255" class="node default"><rect height="54" width="120.1875" y="-27" x="-60.09375" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-30.09375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="60.1875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Queue-1</p></span></div></foreignObject></g></g><g transform="translate(1996.21875, 110)" id="flowchart-CH2-2261" class="node default"><rect height="54" width="149.875" y="-27" x="-74.9375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-44.9375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="89.875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Channelä¿¡é“</p></span></div></foreignObject></g></g><g transform="translate(2475.265625, 110)" id="flowchart-CON1-2262" class="node default"><rect height="54" width="162.59375" y="-27" x="-81.296875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-51.296875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="102.59375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Consumeråº”ç”¨</p></span></div></foreignObject></g></g><g transform="translate(1302.546875, 214)" id="flowchart-B2-2259" class="node default"><rect height="54" width="143.03125" y="-27" x="-71.515625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-41.515625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="83.03125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Binding Key</p></span></div></foreignObject></g></g><g transform="translate(1629.1875, 214)" id="flowchart-Q2-2256" class="node default"><rect height="54" width="120.1875" y="-27" x="-60.09375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-30.09375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="60.1875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Queue-2</p></span></div></foreignObject></g></g><g transform="translate(1629.1875, 318)" id="flowchart-Q3-2257" class="node default"><rect height="54" width="120.1875" y="-27" x="-60.09375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-30.09375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="60.1875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Queue-3</p></span></div></foreignObject></g></g><g transform="translate(989.71875, 214)" id="flowchart-EX2-2253" class="node default"><rect height="54" width="169.609375" y="-27" x="-84.8046875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-54.8046875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="109.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Topic Exchange</p></span></div></foreignObject></g></g><g transform="translate(989.71875, 318)" id="flowchart-EX3-2254" class="node default"><rect height="54" width="181.5625" y="-27" x="-90.78125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-60.78125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="121.5625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Fanout Exchange</p></span></div></foreignObject></g></g><g transform="translate(1629.1875, 442)" id="flowchart-V-2251" class="node default"><rect height="54" width="209.1875" y="-27" x="-104.59375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-74.59375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="149.1875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Virtual Hostè™šæ‹Ÿä¸»æœº</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-jlchwv_14"><span class="control" id="-jlchwv_29">æ ¸å¿ƒç»„ä»¶è¯¦è§£ï¼š</span></p><p id="-jlchwv_15"><span class="control" id="-jlchwv_30">1. Connectionï¼ˆè¿æ¥ï¼‰</span></p><ul class="list _bullet" id="-jlchwv_16"><li class="list__item" id="-jlchwv_31"><p id="-jlchwv_34">TCPé•¿è¿æ¥ï¼Œæ‰¿è½½å¤šä¸ªChannel</p></li><li class="list__item" id="-jlchwv_32"><p id="-jlchwv_35">æ”¯æŒè¿æ¥æ± å’Œè¿æ¥å¤ç”¨</p></li><li class="list__item" id="-jlchwv_33"><p id="-jlchwv_36">æä¾›è®¤è¯å’Œå®‰å…¨ä¼ è¾“</p></li></ul><p id="-jlchwv_17"><span class="control" id="-jlchwv_37">2. Channelï¼ˆä¿¡é“ï¼‰</span></p><ul class="list _bullet" id="-jlchwv_18"><li class="list__item" id="-jlchwv_38"><p id="-jlchwv_41">è½»é‡çº§çš„é€»è¾‘è¿æ¥</p></li><li class="list__item" id="-jlchwv_39"><p id="-jlchwv_42">å¤ç”¨ç‰©ç†è¿æ¥ï¼Œå‡å°‘èµ„æºæ¶ˆè€—</p></li><li class="list__item" id="-jlchwv_40"><p id="-jlchwv_43">æ”¯æŒäº‹åŠ¡å’Œç¡®è®¤æœºåˆ¶</p></li></ul><p id="-jlchwv_19"><span class="control" id="-jlchwv_44">3. Virtual Hostï¼ˆè™šæ‹Ÿä¸»æœºï¼‰</span></p><ul class="list _bullet" id="-jlchwv_20"><li class="list__item" id="-jlchwv_45"><p id="-jlchwv_48">æä¾›é€»è¾‘éš”ç¦»å’Œæƒé™æ§åˆ¶</p></li><li class="list__item" id="-jlchwv_46"><p id="-jlchwv_49">ç‹¬ç«‹çš„Exchangeã€Queueå’ŒBindingç©ºé—´</p></li><li class="list__item" id="-jlchwv_47"><p id="-jlchwv_50">æ”¯æŒå¤šç§Ÿæˆ·éƒ¨ç½²</p></li></ul><p id="-jlchwv_21"><span class="control" id="-jlchwv_51">4. Exchangeï¼ˆäº¤æ¢å™¨ï¼‰</span></p><ul class="list _bullet" id="-jlchwv_22"><li class="list__item" id="-jlchwv_52"><p id="-jlchwv_55">æ¶ˆæ¯è·¯ç”±ä¸­å¿ƒ</p></li><li class="list__item" id="-jlchwv_53"><p id="-jlchwv_56">æ ¹æ®è·¯ç”±è§„åˆ™åˆ†å‘æ¶ˆæ¯</p></li><li class="list__item" id="-jlchwv_54"><p id="-jlchwv_57">æ”¯æŒå¤šç§è·¯ç”±ç®—æ³•</p></li></ul><p id="-jlchwv_23"><span class="control" id="-jlchwv_58">5. Queueï¼ˆé˜Ÿåˆ—ï¼‰</span></p><ul class="list _bullet" id="-jlchwv_24"><li class="list__item" id="-jlchwv_59"><p id="-jlchwv_62">æ¶ˆæ¯å­˜å‚¨å®¹å™¨</p></li><li class="list__item" id="-jlchwv_60"><p id="-jlchwv_63">æ”¯æŒæŒä¹…åŒ–å’Œä¼˜å…ˆçº§</p></li><li class="list__item" id="-jlchwv_61"><p id="-jlchwv_64">æä¾›æ¶ˆè´¹ç¡®è®¤æœºåˆ¶</p></li></ul><p id="-jlchwv_25"><span class="control" id="-jlchwv_65">AMQPæ¶ˆæ¯æµè½¬è¿‡ç¨‹ï¼š</span></p><div class="code-block" data-lang="java">
// RabbitMQåŸºç¡€ä½¿ç”¨ç¤ºä¾‹
public class RabbitMQBasicExample {
    
    // è¿æ¥é…ç½®
    public Connection createConnection() throws IOException, TimeoutException {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost(&quot;localhost&quot;);
        factory.setPort(5672);
        factory.setUsername(&quot;guest&quot;);
        factory.setPassword(&quot;guest&quot;);
        factory.setVirtualHost(&quot;/&quot;);
        
        // è¿æ¥æ± é…ç½®
        factory.setConnectionTimeout(60000);
        factory.setRequestedHeartBeat(60);
        factory.setNetworkRecoveryInterval(5000);
        factory.setAutomaticRecoveryEnabled(true);
        
        return factory.newConnection();
    }
    
    // ç”Ÿäº§è€…å‘é€æ¶ˆæ¯
    public void sendMessage() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // å£°æ˜Exchange
            channel.exchangeDeclare(&quot;user.events&quot;, BuiltinExchangeType.TOPIC, true);
            
            // å£°æ˜Queue
            channel.queueDeclare(&quot;user.login.queue&quot;, true, false, false, null);
            
            // ç»‘å®šQueueåˆ°Exchange
            channel.queueBind(&quot;user.login.queue&quot;, &quot;user.events&quot;, &quot;user.login.*&quot;);
            
            // å‘é€æ¶ˆæ¯
            String message = &quot;User login event&quot;;
            AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
                .deliveryMode(2) // æŒä¹…åŒ–æ¶ˆæ¯
                .timestamp(new Date())
                .messageId(UUID.randomUUID().toString())
                .build();
                
            channel.basicPublish(&quot;user.events&quot;, &quot;user.login.web&quot;, properties, message.getBytes());
            
            System.out.println(&quot;æ¶ˆæ¯å‘é€æˆåŠŸ: &quot; + message);
        }
    }
    
    // æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯
    public void receiveMessage() throws IOException, TimeoutException {
        Connection connection = createConnection();
        Channel channel = connection.createChannel();
        
        // å£°æ˜é˜Ÿåˆ—
        channel.queueDeclare(&quot;user.login.queue&quot;, true, false, false, null);
        
        // è®¾ç½®æ¶ˆè´¹è€…
        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);
            System.out.println(&quot;æ¥æ”¶åˆ°æ¶ˆæ¯: &quot; + message);
            
            try {
                // å¤„ç†ä¸šåŠ¡é€»è¾‘
                processMessage(message);
                
                // æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯
                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
                
            } catch (Exception e) {
                System.err.println(&quot;æ¶ˆæ¯å¤„ç†å¤±è´¥: &quot; + e.getMessage());
                // æ‹’ç»æ¶ˆæ¯å¹¶é‡æ–°å…¥é˜Ÿ
                channel.basicNack(delivery.getEnvelope().getDeliveryTag(), false, true);
            }
        };
        
        // å¼€å§‹æ¶ˆè´¹
        channel.basicConsume(&quot;user.login.queue&quot;, false, deliverCallback, consumerTag -&gt; {});
    }
}
</div></section><section class="chapter"><h3 id="q2-rabbitmq-exchange" data-toc="q2-rabbitmq-exchange">Q2: RabbitMQæœ‰å“ªäº›Exchangeç±»å‹ï¼Ÿå„è‡ªçš„è·¯ç”±è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p id="-jlchwv_66"><span class="control" id="-jlchwv_77">ç­”æ¡ˆï¼š</span></p><p id="-jlchwv_67"><span class="control" id="-jlchwv_78">å››ç§Exchangeç±»å‹å¯¹æ¯”ï¼š</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 614.515625 972"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="614.515625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="Exchangeç±»å‹å’Œè·¯ç”±è§„åˆ™" class="cluster"><rect height="956" width="598.515625" y="8" x="8" style=""></rect><g transform="translate(217.4921875, 8)" class="cluster-label"><foreignObject height="24" width="179.53125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Exchangeç±»å‹å’Œè·¯ç”±è§„åˆ™</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(62.6953125, 35)" class="root"><g class="clusters"><g data-look="classic" id="subGraph3" class="cluster"><rect height="178" width="473.125" y="8" x="8" style=""></rect><g transform="translate(179.40625, 8)" class="cluster-label"><foreignObject height="24" width="130.3125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Headers Exchange</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(133.4765625, 97)" id="flowchart-H1-2403" class="node default"><rect height="78" width="180.953125" y="-39" x="-90.4765625" data-et="node" data-id="abc" style="fill:#f3e5f5 !important" class="basic label-container"></rect><g transform="translate(-60.4765625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="120.953125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>åŸºäºæ¶ˆæ¯å¤´åŒ¹é…<br>x-match: all/any</p></span></div></foreignObject></g></g><g transform="translate(360.0390625, 97)" id="flowchart-H2-2404" class="node default"><rect height="54" width="172.171875" y="-27" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>é”®å€¼å¯¹åŒ¹é…è·¯ç”±</p></span></div></foreignObject></g></g></g></g><g transform="translate(73.109375, 263)" class="root"><g class="clusters"><g data-look="classic" id="subGraph2" class="cluster"><rect height="178" width="452.296875" y="8" x="8" style=""></rect><g transform="translate(173.3671875, 8)" class="cluster-label"><foreignObject height="24" width="121.5625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Fanout Exchange</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(131.0703125, 97)" id="flowchart-F1-2401" class="node default"><rect height="78" width="176.140625" y="-39" x="-88.0703125" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-58.0703125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="116.140625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å¿½ç•¥Routing Key<br>å¹¿æ’­åˆ°æ‰€æœ‰é˜Ÿåˆ—</p></span></div></foreignObject></g></g><g transform="translate(347.21875, 97)" id="flowchart-F2-2402" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å‘å¸ƒè®¢é˜…æ¨¡å¼</p></span></div></foreignObject></g></g></g></g><g transform="translate(37.5, 491)" class="root"><g class="clusters"><g data-look="classic" id="subGraph1" class="cluster"><rect height="202" width="523.515625" y="8" x="8" style=""></rect><g transform="translate(214.953125, 8)" class="cluster-label"><foreignObject height="24" width="109.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Topic Exchange</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(166.6796875, 109)" id="flowchart-T1-2399" class="node default"><rect height="78" width="247.359375" y="-39" x="-123.6796875" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-93.6796875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="187.359375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Routing Key: user.*.action<br>Queue: user-action-queue</p></span></div></foreignObject></g></g><g transform="translate(418.4375, 109)" id="flowchart-T2-2400" class="node default"><rect height="102" width="156.15625" y="-51" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ¨¡å¼åŒ¹é…è·¯ç”±<br># åŒ¹é…å¤šä¸ªè¯<br>* åŒ¹é…ä¸€ä¸ªè¯</p></span></div></foreignObject></g></g></g></g><g transform="translate(49.3671875, 743)" class="root"><g class="clusters"><g data-look="classic" id="subGraph0" class="cluster"><rect height="178" width="499.78125" y="8" x="8" style=""></rect><g transform="translate(199.921875, 8)" class="cluster-label"><foreignObject height="24" width="115.9375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Direct Exchange</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(154.8125, 97)" id="flowchart-D1-2397" class="node default"><rect height="78" width="223.625" y="-39" x="-111.8125" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-81.8125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="163.625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Routing Key: user.login<br>Queue: login-queue</p></span></div></foreignObject></g></g><g transform="translate(394.703125, 97)" id="flowchart-D2-2398" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>å®Œå…¨åŒ¹é…è·¯ç”±</p></span></div></foreignObject></g></g></g></g></g></g></g></g></g></svg><p id="-jlchwv_69"><span class="control" id="-jlchwv_79">1. Direct Exchangeï¼ˆç›´è¿äº¤æ¢å™¨ï¼‰</span></p><div class="code-block" data-lang="java">
// Direct Exchangeä½¿ç”¨ç¤ºä¾‹
public class DirectExchangeExample {
    
    public void setupDirectExchange() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // å£°æ˜Direct Exchange
            channel.exchangeDeclare(&quot;order.direct&quot;, BuiltinExchangeType.DIRECT, true);
            
            // åˆ›å»ºä¸åŒä¼˜å…ˆçº§çš„é˜Ÿåˆ—
            channel.queueDeclare(&quot;order.high.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;order.normal.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;order.low.queue&quot;, true, false, false, null);
            
            // ç»‘å®šé˜Ÿåˆ—åˆ°Exchangeï¼Œä½¿ç”¨ç²¾ç¡®çš„routing key
            channel.queueBind(&quot;order.high.queue&quot;, &quot;order.direct&quot;, &quot;high&quot;);
            channel.queueBind(&quot;order.normal.queue&quot;, &quot;order.direct&quot;, &quot;normal&quot;);
            channel.queueBind(&quot;order.low.queue&quot;, &quot;order.direct&quot;, &quot;low&quot;);
        }
    }
    
    public void sendOrderByPriority(String priority, String orderData) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // æ ¹æ®ä¼˜å…ˆçº§å‘é€åˆ°ä¸åŒé˜Ÿåˆ—
            channel.basicPublish(&quot;order.direct&quot;, priority, null, orderData.getBytes());
            System.out.println(&quot;è®¢å•å‘é€åˆ°&quot; + priority + &quot;ä¼˜å…ˆçº§é˜Ÿåˆ—: &quot; + orderData);
        }
    }
}
</div><p id="-jlchwv_71"><span class="control" id="-jlchwv_80">2. Topic Exchangeï¼ˆä¸»é¢˜äº¤æ¢å™¨ï¼‰</span></p><div class="code-block" data-lang="java">
// Topic Exchangeä½¿ç”¨ç¤ºä¾‹
public class TopicExchangeExample {
    
    public void setupTopicExchange() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // å£°æ˜Topic Exchange
            channel.exchangeDeclare(&quot;log.topic&quot;, BuiltinExchangeType.TOPIC, true);
            
            // åˆ›å»ºä¸åŒçº§åˆ«çš„æ—¥å¿—é˜Ÿåˆ—
            channel.queueDeclare(&quot;log.error.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;log.info.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;log.all.queue&quot;, true, false, false, null);
            
            // ä½¿ç”¨é€šé…ç¬¦ç»‘å®š
            channel.queueBind(&quot;log.error.queue&quot;, &quot;log.topic&quot;, &quot;*.error&quot;);      // åªæ¥æ”¶erroræ—¥å¿—
            channel.queueBind(&quot;log.info.queue&quot;, &quot;log.topic&quot;, &quot;*.info&quot;);        // åªæ¥æ”¶infoæ—¥å¿—
            channel.queueBind(&quot;log.all.queue&quot;, &quot;log.topic&quot;, &quot;#&quot;);              // æ¥æ”¶æ‰€æœ‰æ—¥å¿—
            
            // æ›´å¤æ‚çš„æ¨¡å¼åŒ¹é…
            channel.queueDeclare(&quot;log.system.queue&quot;, true, false, false, null);
            channel.queueBind(&quot;log.system.queue&quot;, &quot;log.topic&quot;, &quot;system.*.error&quot;); // åªæ¥æ”¶ç³»ç»Ÿé”™è¯¯æ—¥å¿—
        }
    }
    
    public void sendLogMessage(String source, String level, String message) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            String routingKey = source + &quot;.&quot; + level;
            String logMessage = String.format(&quot;[%s] %s: %s&quot;, routingKey, new Date(), message);
            
            channel.basicPublish(&quot;log.topic&quot;, routingKey, null, logMessage.getBytes());
            System.out.println(&quot;æ—¥å¿—å‘é€: &quot; + routingKey + &quot; -&gt; &quot; + message);
        }
    }
}
</div><p id="-jlchwv_73"><span class="control" id="-jlchwv_81">3. Fanout Exchangeï¼ˆæ‰‡å‡ºäº¤æ¢å™¨ï¼‰</span></p><div class="code-block" data-lang="java">
// Fanout Exchangeä½¿ç”¨ç¤ºä¾‹
public class FanoutExchangeExample {
    
    public void setupFanoutExchange() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // å£°æ˜Fanout Exchange
            channel.exchangeDeclare(&quot;notification.fanout&quot;, BuiltinExchangeType.FANOUT, true);
            
            // åˆ›å»ºå¤šä¸ªé€šçŸ¥é˜Ÿåˆ—
            channel.queueDeclare(&quot;notification.email.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;notification.sms.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;notification.push.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;notification.webhook.queue&quot;, true, false, false, null);
            
            // ç»‘å®šæ‰€æœ‰é˜Ÿåˆ—åˆ°Fanout Exchangeï¼ˆå¿½ç•¥routing keyï¼‰
            channel.queueBind(&quot;notification.email.queue&quot;, &quot;notification.fanout&quot;, &quot;&quot;);
            channel.queueBind(&quot;notification.sms.queue&quot;, &quot;notification.fanout&quot;, &quot;&quot;);
            channel.queueBind(&quot;notification.push.queue&quot;, &quot;notification.fanout&quot;, &quot;&quot;);
            channel.queueBind(&quot;notification.webhook.queue&quot;, &quot;notification.fanout&quot;, &quot;&quot;);
        }
    }
    
    public void sendNotification(String eventType, String content) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            String message = String.format(&quot;{\&quot;event\&quot;:\&quot;%s\&quot;, \&quot;content\&quot;:\&quot;%s\&quot;, \&quot;timestamp\&quot;:\&quot;%s\&quot;}&quot;, 
                                         eventType, content, new Date());
            
            // å‘é€åˆ°Fanout Exchangeï¼Œä¼šå¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—
            channel.basicPublish(&quot;notification.fanout&quot;, &quot;&quot;, null, message.getBytes());
            System.out.println(&quot;é€šçŸ¥å¹¿æ’­å‘é€: &quot; + message);
        }
    }
}
</div><p id="-jlchwv_75"><span class="control" id="-jlchwv_82">4. Headers Exchangeï¼ˆå¤´äº¤æ¢å™¨ï¼‰</span></p><div class="code-block" data-lang="java">
// Headers Exchangeä½¿ç”¨ç¤ºä¾‹
public class HeadersExchangeExample {
    
    public void setupHeadersExchange() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // å£°æ˜Headers Exchange
            channel.exchangeDeclare(&quot;task.headers&quot;, BuiltinExchangeType.HEADERS, true);
            
            // åˆ›å»ºä»»åŠ¡é˜Ÿåˆ—
            channel.queueDeclare(&quot;task.image.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;task.video.queue&quot;, true, false, false, null);
            channel.queueDeclare(&quot;task.urgent.queue&quot;, true, false, false, null);
            
            // åŸºäºHeadersåŒ¹é…ç»‘å®š
            Map&lt;String, Object&gt; imageHeaders = new HashMap&lt;&gt;();
            imageHeaders.put(&quot;x-match&quot;, &quot;all&quot;);  // å¿…é¡»åŒ¹é…æ‰€æœ‰æ¡ä»¶
            imageHeaders.put(&quot;type&quot;, &quot;image&quot;);
            imageHeaders.put(&quot;format&quot;, &quot;jpg&quot;);
            channel.queueBind(&quot;task.image.queue&quot;, &quot;task.headers&quot;, &quot;&quot;, imageHeaders);
            
            Map&lt;String, Object&gt; videoHeaders = new HashMap&lt;&gt;();
            videoHeaders.put(&quot;x-match&quot;, &quot;any&quot;);  // åŒ¹é…ä»»æ„æ¡ä»¶
            videoHeaders.put(&quot;type&quot;, &quot;video&quot;);
            videoHeaders.put(&quot;format&quot;, &quot;mp4&quot;);
            channel.queueBind(&quot;task.video.queue&quot;, &quot;task.headers&quot;, &quot;&quot;, videoHeaders);
            
            Map&lt;String, Object&gt; urgentHeaders = new HashMap&lt;&gt;();
            urgentHeaders.put(&quot;x-match&quot;, &quot;all&quot;);
            urgentHeaders.put(&quot;priority&quot;, &quot;urgent&quot;);
            channel.queueBind(&quot;task.urgent.queue&quot;, &quot;task.headers&quot;, &quot;&quot;, urgentHeaders);
        }
    }
    
    public void sendTaskMessage(String taskData, Map&lt;String, Object&gt; headers) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            AMQP.BasicProperties.Builder builder = new AMQP.BasicProperties.Builder();
            builder.headers(headers);
            
            channel.basicPublish(&quot;task.headers&quot;, &quot;&quot;, builder.build(), taskData.getBytes());
            System.out.println(&quot;ä»»åŠ¡å‘é€: &quot; + headers + &quot; -&gt; &quot; + taskData);
        }
    }
}
</div></section></section><section class="chapter"><h2 id="-jlchwv_6" data-toc="-jlchwv_6">ğŸ›¡ï¸ é«˜çº§ç‰¹æ€§</h2><section class="chapter"><h3 id="q3-rabbitmq" data-toc="q3-rabbitmq">Q3: RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿæœ‰å“ªäº›ç¡®è®¤æœºåˆ¶ï¼Ÿ</h3><p id="-jlchwv_85"><span class="control" id="-jlchwv_92">ç­”æ¡ˆï¼š</span></p><p id="-jlchwv_86"><span class="control" id="-jlchwv_93">RabbitMQå¯é æ€§ä¿è¯æœºåˆ¶ï¼š</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 889.3125 648"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="889.3125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="RabbitMQå¯é æ€§æœºåˆ¶" class="cluster"><rect height="632" width="873.3125" y="8" x="8" style=""></rect><g transform="translate(370.1875, 8)" class="cluster-label"><foreignObject height="24" width="148.9375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>RabbitMQå¯é æ€§æœºåˆ¶</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(37.5, 35)" class="root"><g class="clusters"><g data-look="classic" id="æ¶ˆè´¹è€…ç«¯" class="cluster"><rect height="154" width="798.3125" y="8" x="8" style=""></rect><g transform="translate(375.1015625, 8)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ¶ˆè´¹è€…ç«¯</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(123, 85)" id="flowchart-C1-2562" class="node default"><rect height="54" width="160" y="-27" x="-80" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-50, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="100"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Consumer Ack</p></span></div></foreignObject></g></g><g transform="translate(338.046875, 85)" id="flowchart-C2-2563" class="node default"><rect height="54" width="170.09375" y="-27" x="-85.046875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-55.046875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="110.09375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Consumer Nack</p></span></div></foreignObject></g></g><g transform="translate(535.1484375, 85)" id="flowchart-C3-2564" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ¶ˆæ¯é‡è¯•</p></span></div></foreignObject></g></g><g transform="translate(709.2578125, 85)" id="flowchart-C4-2565" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ­»ä¿¡é˜Ÿåˆ—</p></span></div></foreignObject></g></g></g></g><g transform="translate(62.421875, 239)" class="root"><g class="clusters"><g data-look="classic" id="Brokerç«¯" class="cluster"><rect height="154" width="748.46875" y="8" x="8" style=""></rect><g transform="translate(350.7109375, 8)" class="cluster-label"><foreignObject height="24" width="63.046875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Brokerç«¯</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(113.0625, 85)" id="flowchart-B1-2558" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>é˜Ÿåˆ—æŒä¹…åŒ–</p></span></div></foreignObject></g></g><g transform="translate(303.1875, 85)" id="flowchart-B2-2559" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ¶ˆæ¯æŒä¹…åŒ–</p></span></div></foreignObject></g></g><g transform="translate(485.3046875, 85)" id="flowchart-B3-2560" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>é•œåƒé˜Ÿåˆ—</p></span></div></foreignObject></g></g><g transform="translate(659.4140625, 85)" id="flowchart-B4-2561" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>é›†ç¾¤éƒ¨ç½²</p></span></div></foreignObject></g></g></g></g><g transform="translate(99.6953125, 443)" class="root"><g class="clusters"><g data-look="classic" id="ç”Ÿäº§è€…ç«¯" class="cluster"><rect height="154" width="673.921875" y="8" x="8" style=""></rect><g transform="translate(312.90625, 8)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ç”Ÿäº§è€…ç«¯</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(140.3203125, 85)" id="flowchart-A1-2555" class="node default"><rect height="54" width="194.640625" y="-27" x="-97.3203125" data-et="node" data-id="abc" style="fill:#e1f5fe !important" class="basic label-container"></rect><g transform="translate(-67.3203125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="134.640625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Publisher Confirms</p></span></div></foreignObject></g></g><g transform="translate(380.2265625, 85)" id="flowchart-A2-2556" class="node default"><rect height="54" width="185.171875" y="-27" x="-92.5859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-62.5859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="125.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Publisher Returns</p></span></div></foreignObject></g></g><g transform="translate(584.8671875, 85)" id="flowchart-A3-2557" class="node default"><rect height="54" width="124.109375" y="-27" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>äº‹åŠ¡æœºåˆ¶</p></span></div></foreignObject></g></g></g></g></g></g></g></g></g></svg><p id="-jlchwv_88"><span class="control" id="-jlchwv_94">1. ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ï¼ˆPublisher Confirmsï¼‰</span></p><div class="code-block" data-lang="java">
// Publisher Confirmså®ç°
public class PublisherConfirmsExample {
    
    public void sendWithConfirms() throws IOException, TimeoutException, InterruptedException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // å¼€å¯å‘å¸ƒè€…ç¡®è®¤æ¨¡å¼
            channel.confirmSelect();
            
            // è®¾ç½®ç¡®è®¤ç›‘å¬å™¨
            channel.addConfirmListener(new ConfirmListener() {
                @Override
                public void handleAck(long deliveryTag, boolean multiple) throws IOException {
                    System.out.println(&quot;æ¶ˆæ¯ç¡®è®¤æˆåŠŸ: deliveryTag=&quot; + deliveryTag + &quot;, multiple=&quot; + multiple);
                }
                
                @Override
                public void handleNack(long deliveryTag, boolean multiple) throws IOException {
                    System.err.println(&quot;æ¶ˆæ¯ç¡®è®¤å¤±è´¥: deliveryTag=&quot; + deliveryTag + &quot;, multiple=&quot; + multiple);
                    // å®ç°é‡å‘é€»è¾‘
                    handleMessageNack(deliveryTag, multiple);
                }
            });
            
            // è®¾ç½®è¿”å›ç›‘å¬å™¨ï¼ˆå¤„ç†æ— æ³•è·¯ç”±çš„æ¶ˆæ¯ï¼‰
            channel.addReturnListener(new ReturnListener() {
                @Override
                public void handleReturn(int replyCode, String replyText, String exchange,
                                       String routingKey, AMQP.BasicProperties properties, byte[] body) throws IOException {
                    System.err.println(&quot;æ¶ˆæ¯æ— æ³•è·¯ç”±: &quot; + replyText + &quot;, routingKey=&quot; + routingKey);
                    // å®ç°è¡¥å¿é€»è¾‘
                    handleUnroutableMessage(exchange, routingKey, body);
                }
            });
            
            // å‘é€æ¶ˆæ¯ï¼ˆè®¾ç½®mandatory=trueä»¥è·å–è·¯ç”±å¤±è´¥é€šçŸ¥ï¼‰
            for (int i = 0; i &lt; 1000; i++) {
                String message = &quot;Message &quot; + i;
                channel.basicPublish(&quot;test.exchange&quot;, &quot;test.routing.key&quot;, true, 
                                   MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());
            }
            
            // ç­‰å¾…æ‰€æœ‰ç¡®è®¤
            if (channel.waitForConfirms(5000)) {
                System.out.println(&quot;æ‰€æœ‰æ¶ˆæ¯ç¡®è®¤æˆåŠŸ&quot;);
            } else {
                System.err.println(&quot;éƒ¨åˆ†æ¶ˆæ¯ç¡®è®¤å¤±è´¥&quot;);
            }
        }
    }
    
    // æ‰¹é‡ç¡®è®¤å®ç°
    public void batchConfirms() throws IOException, TimeoutException, InterruptedException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            channel.confirmSelect();
            
            int batchSize = 100;
            int messageCount = 1000;
            
            for (int i = 0; i &lt; messageCount; i++) {
                String message = &quot;Batch message &quot; + i;
                channel.basicPublish(&quot;test.exchange&quot;, &quot;test.routing.key&quot;, 
                                   MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());
                
                // æ¯æ‰¹ç¡®è®¤ä¸€æ¬¡
                if ((i + 1) % batchSize == 0) {
                    if (channel.waitForConfirms(1000)) {
                        System.out.println(&quot;æ‰¹æ¬¡ &quot; + ((i + 1) / batchSize) + &quot; ç¡®è®¤æˆåŠŸ&quot;);
                    } else {
                        System.err.println(&quot;æ‰¹æ¬¡ &quot; + ((i + 1) / batchSize) + &quot; ç¡®è®¤å¤±è´¥&quot;);
                    }
                }
            }
        }
    }
}
</div><p id="-jlchwv_90"><span class="control" id="-jlchwv_95">2. æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶</span></p><div class="code-block" data-lang="java">
// æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶å®ç°
public class ConsumerAckExample {
    
    public void setupConsumerWithAck() throws IOException, TimeoutException {
        Connection connection = createConnection();
        Channel channel = connection.createChannel();
        
        // é˜Ÿåˆ—å£°æ˜
        channel.queueDeclare(&quot;order.processing.queue&quot;, true, false, false, null);
        
        // è®¾ç½®QoSï¼ˆé™åˆ¶æœªç¡®è®¤æ¶ˆæ¯æ•°é‡ï¼‰
        channel.basicQos(10); // æœ€å¤š10æ¡æœªç¡®è®¤æ¶ˆæ¯
        
        // æ‰‹åŠ¨ç¡®è®¤æ¶ˆè´¹è€…
        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);
            long deliveryTag = delivery.getEnvelope().getDeliveryTag();
            
            try {
                // å¤„ç†ä¸šåŠ¡é€»è¾‘
                processOrder(message);
                
                // ç¡®è®¤æ¶ˆæ¯
                channel.basicAck(deliveryTag, false);
                System.out.println(&quot;è®¢å•å¤„ç†æˆåŠŸ: &quot; + message);
                
            } catch (BusinessException e) {
                // ä¸šåŠ¡å¼‚å¸¸ï¼Œæ‹’ç»æ¶ˆæ¯ä¸é‡æ–°å…¥é˜Ÿ
                channel.basicNack(deliveryTag, false, false);
                System.err.println(&quot;ä¸šåŠ¡å¤„ç†å¤±è´¥ï¼Œæ¶ˆæ¯ä¸¢å¼ƒ: &quot; + e.getMessage());
                
            } catch (SystemException e) {
                // ç³»ç»Ÿå¼‚å¸¸ï¼Œæ‹’ç»æ¶ˆæ¯å¹¶é‡æ–°å…¥é˜Ÿ
                channel.basicNack(deliveryTag, false, true);
                System.err.println(&quot;ç³»ç»Ÿå¼‚å¸¸ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ: &quot; + e.getMessage());
                
            } catch (Exception e) {
                // æœªçŸ¥å¼‚å¸¸ï¼Œé‡æ–°å…¥é˜Ÿå¹¶é™åˆ¶é‡è¯•æ¬¡æ•°
                handleRetryLogic(channel, delivery, e);
            }
        };
        
        // å¼€å§‹æ¶ˆè´¹ï¼ˆautoAck=falseè¡¨ç¤ºæ‰‹åŠ¨ç¡®è®¤ï¼‰
        channel.basicConsume(&quot;order.processing.queue&quot;, false, deliverCallback, consumerTag -&gt; {});
    }
    
    // é‡è¯•é€»è¾‘å®ç°
    private void handleRetryLogic(Channel channel, Delivery delivery, Exception e) throws IOException {
        long deliveryTag = delivery.getEnvelope().getDeliveryTag();
        Map&lt;String, Object&gt; headers = delivery.getProperties().getHeaders();
        
        // è·å–é‡è¯•æ¬¡æ•°
        int retryCount = 0;
        if (headers != null &amp;&amp; headers.containsKey(&quot;x-retry-count&quot;)) {
            retryCount = (Integer) headers.get(&quot;x-retry-count&quot;);
        }
        
        if (retryCount &lt; 3) {
            // å¢åŠ é‡è¯•æ¬¡æ•°å¹¶é‡æ–°å‘å¸ƒ
            Map&lt;String, Object&gt; newHeaders = new HashMap&lt;&gt;(headers != null ? headers : new HashMap&lt;&gt;());
            newHeaders.put(&quot;x-retry-count&quot;, retryCount + 1);
            
            AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
                .headers(newHeaders)
                .deliveryMode(2)
                .build();
            
            // é‡æ–°å‘å¸ƒåˆ°åŸé˜Ÿåˆ—
            channel.basicPublish(&quot;&quot;, delivery.getEnvelope().getRoutingKey(), properties, delivery.getBody());
            
            // ç¡®è®¤åŸæ¶ˆæ¯
            channel.basicAck(deliveryTag, false);
            
            System.out.println(&quot;æ¶ˆæ¯é‡è¯•ç¬¬&quot; + (retryCount + 1) + &quot;æ¬¡&quot;);
        } else {
            // è¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œå‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—
            channel.basicNack(deliveryTag, false, false);
            System.err.println(&quot;æ¶ˆæ¯è¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—&quot;);
        }
    }
}
</div></section><section class="chapter"><h3 id="q4-rabbitmq" data-toc="q4-rabbitmq">Q4: å¦‚ä½•å®ç°RabbitMQçš„æ­»ä¿¡é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—ï¼Ÿ</h3><p id="-jlchwv_96"><span class="control" id="-jlchwv_103">ç­”æ¡ˆï¼š</span></p><p id="-jlchwv_97"><span class="control" id="-jlchwv_104">æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLX - Dead Letter Exchangeï¼‰æœºåˆ¶ï¼š</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 307.046875 934"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="307.046875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="æ­»ä¿¡é˜Ÿåˆ—æ¶æ„" class="cluster"><rect height="918" width="291.046875" y="8" x="8" style=""></rect><g transform="translate(105.4453125, 8)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ­»ä¿¡é˜Ÿåˆ—æ¶æ„</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M153.523,123.5L153.523,129.75C153.523,136,153.523,148.5,153.523,157.875C153.523,167.25,153.523,173.5,153.523,179.083C153.523,184.667,153.523,189.583,153.523,192.042L153.523,194.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M153.523,252.5L153.523,258.75C153.523,265,153.523,277.5,153.523,286.875C153.523,296.25,153.523,302.5,153.523,308.083C153.523,313.667,153.523,318.583,153.523,321.042L153.523,323.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_2" d="M153.523,405.5L153.523,411.75C153.523,418,153.523,430.5,153.523,439.875C153.523,449.25,153.523,455.5,153.523,461.083C153.523,466.667,153.523,471.583,153.523,474.042L153.523,476.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_E_3" d="M153.523,558.5L153.523,564.75C153.523,571,153.523,583.5,153.523,592.875C153.523,602.25,153.523,608.5,153.523,614.083C153.523,619.667,153.523,624.583,153.523,627.042L153.523,629.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_4" d="M153.523,711.5L153.523,717.75C153.523,724,153.523,736.5,153.523,745.875C153.523,755.25,153.523,761.5,153.523,767.083C153.523,772.667,153.523,777.583,153.523,780.042L153.523,782.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(153.5234375, 84.5)" id="flowchart-A-2713" class="node default"><rect height="78" width="162.28125" y="-39" x="-81.140625" data-et="node" data-id="abc" style="fill:#c8e6c9 !important" class="basic label-container"></rect><g transform="translate(-51.140625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="102.28125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Normal Queue<br>æ­£å¸¸é˜Ÿåˆ—</p></span></div></foreignObject></g></g><g transform="translate(153.5234375, 225.5)" id="flowchart-B-2714" class="node default"><rect height="54" width="221.046875" y="-27" x="-110.5234375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-80.5234375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="161.046875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>æ¶ˆæ¯è¿‡æœŸ/æ‹’ç»/é˜Ÿåˆ—æ»¡</p></span></div></foreignObject></g></g><g transform="translate(153.5234375, 366.5)" id="flowchart-C-2716" class="node default"><rect height="78" width="217.609375" y="-39" x="-108.8046875" data-et="node" data-id="abc" style="fill:#ffcdd2 !important" class="basic label-container"></rect><g transform="translate(-78.8046875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="157.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Dead Letter Exchange<br>æ­»ä¿¡äº¤æ¢å™¨</p></span></div></foreignObject></g></g><g transform="translate(153.5234375, 519.5)" id="flowchart-D-2718" class="node default"><rect height="78" width="196.125" y="-39" x="-98.0625" data-et="node" data-id="abc" style="fill:#ffcdd2 !important" class="basic label-container"></rect><g transform="translate(-68.0625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="136.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Dead Letter Queue<br>æ­»ä¿¡é˜Ÿåˆ—</p></span></div></foreignObject></g></g><g transform="translate(153.5234375, 672.5)" id="flowchart-E-2720" class="node default"><rect height="78" width="220.796875" y="-39" x="-110.3984375" data-et="node" data-id="abc" style="fill:#fff3e0 !important" class="basic label-container"></rect><g transform="translate(-80.3984375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="160.796875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Dead Letter Consumer<br>æ­»ä¿¡æ¶ˆè´¹è€…</p></span></div></foreignObject></g></g><g transform="translate(153.5234375, 837.5)" id="flowchart-F-2721" class="node default"><rect height="102" width="124.109375" y="-51" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>é‡è¯•é€»è¾‘<br>è¡¥å¿å¤„ç†<br>äººå·¥ä»‹å…¥</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="-jlchwv_99"><span class="control" id="-jlchwv_105">æ­»ä¿¡é˜Ÿåˆ—å®ç°ï¼š</span></p><div class="code-block" data-lang="java">
// æ­»ä¿¡é˜Ÿåˆ—å®Œæ•´å®ç°
public class DeadLetterQueueExample {
    
    public void setupDeadLetterQueue() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // 1. å£°æ˜æ­»ä¿¡äº¤æ¢å™¨å’Œæ­»ä¿¡é˜Ÿåˆ—
            channel.exchangeDeclare(&quot;dlx.exchange&quot;, BuiltinExchangeType.DIRECT, true);
            channel.queueDeclare(&quot;dlx.queue&quot;, true, false, false, null);
            channel.queueBind(&quot;dlx.queue&quot;, &quot;dlx.exchange&quot;, &quot;failed&quot;);
            
            // 2. å£°æ˜æ­£å¸¸ä¸šåŠ¡äº¤æ¢å™¨
            channel.exchangeDeclare(&quot;business.exchange&quot;, BuiltinExchangeType.DIRECT, true);
            
            // 3. å£°æ˜ä¸šåŠ¡é˜Ÿåˆ—ï¼Œé…ç½®æ­»ä¿¡å‚æ•°
            Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;();
            arguments.put(&quot;x-dead-letter-exchange&quot;, &quot;dlx.exchange&quot;);    // æ­»ä¿¡äº¤æ¢å™¨
            arguments.put(&quot;x-dead-letter-routing-key&quot;, &quot;failed&quot;);       // æ­»ä¿¡è·¯ç”±é”®
            arguments.put(&quot;x-message-ttl&quot;, 30000);                      // æ¶ˆæ¯TTL 30ç§’
            arguments.put(&quot;x-max-length&quot;, 1000);                        // é˜Ÿåˆ—æœ€å¤§é•¿åº¦
            
            channel.queueDeclare(&quot;business.queue&quot;, true, false, false, arguments);
            channel.queueBind(&quot;business.queue&quot;, &quot;business.exchange&quot;, &quot;process&quot;);
            
            System.out.println(&quot;æ­»ä¿¡é˜Ÿåˆ—é…ç½®å®Œæˆ&quot;);
        }
    }
    
    // ä¸šåŠ¡æ¶ˆè´¹è€…ï¼ˆä¼šäº§ç”Ÿæ­»ä¿¡ï¼‰
    public void startBusinessConsumer() throws IOException, TimeoutException {
        Connection connection = createConnection();
        Channel channel = connection.createChannel();
        
        channel.basicQos(1);
        
        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);
            System.out.println(&quot;å¤„ç†ä¸šåŠ¡æ¶ˆæ¯: &quot; + message);
            
            try {
                // æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
                processBusinessMessage(message);
                
                // æ¨¡æ‹Ÿéƒ¨åˆ†æ¶ˆæ¯å¤„ç†å¤±è´¥
                if (message.contains(&quot;error&quot;)) {
                    throw new RuntimeException(&quot;ä¸šåŠ¡å¤„ç†å¤±è´¥&quot;);
                }
                
                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
                
            } catch (Exception e) {
                System.err.println(&quot;ä¸šåŠ¡å¤„ç†å¼‚å¸¸: &quot; + e.getMessage());
                // æ‹’ç»æ¶ˆæ¯ï¼Œä¸é‡æ–°å…¥é˜Ÿï¼Œè§¦å‘æ­»ä¿¡
                channel.basicNack(delivery.getEnvelope().getDeliveryTag(), false, false);
            }
        };
        
        channel.basicConsume(&quot;business.queue&quot;, false, deliverCallback, consumerTag -&gt; {});
    }
    
    // æ­»ä¿¡æ¶ˆè´¹è€…ï¼ˆå¤„ç†å¤±è´¥æ¶ˆæ¯ï¼‰
    public void startDeadLetterConsumer() throws IOException, TimeoutException {
        Connection connection = createConnection();
        Channel channel = connection.createChannel();
        
        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);
            Map&lt;String, Object&gt; headers = delivery.getProperties().getHeaders();
            
            System.out.println(&quot;å¤„ç†æ­»ä¿¡æ¶ˆæ¯: &quot; + message);
            System.out.println(&quot;æ­»ä¿¡åŸå› : &quot; + headers);
            
            // åˆ†ææ­»ä¿¡åŸå› 
            String deathReason = getDeathReason(headers);
            
            switch (deathReason) {
                case &quot;rejected&quot;:
                    handleRejectedMessage(message, headers);
                    break;
                case &quot;expired&quot;:
                    handleExpiredMessage(message, headers);
                    break;
                case &quot;maxlen&quot;:
                    handleMaxLengthMessage(message, headers);
                    break;
                default:
                    handleUnknownDeathReason(message, headers);
            }
            
            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
        };
        
        channel.basicConsume(&quot;dlx.queue&quot;, false, deliverCallback, consumerTag -&gt; {});
    }
    
    private String getDeathReason(Map&lt;String, Object&gt; headers) {
        if (headers != null &amp;&amp; headers.containsKey(&quot;x-death&quot;)) {
            @SuppressWarnings(&quot;unchecked&quot;)
            List&lt;Map&lt;String, Object&gt;&gt; deaths = (List&lt;Map&lt;String, Object&gt;&gt;) headers.get(&quot;x-death&quot;);
            if (!deaths.isEmpty()) {
                return (String) deaths.get(0).get(&quot;reason&quot;);
            }
        }
        return &quot;unknown&quot;;
    }
}
</div><p id="-jlchwv_101"><span class="control" id="-jlchwv_106">å»¶è¿Ÿé˜Ÿåˆ—å®ç°ï¼š</span></p><div class="code-block" data-lang="java">
// å»¶è¿Ÿé˜Ÿåˆ—å®ç°
public class DelayedQueueExample {
    
    // æ–¹æ³•1: åŸºäºTTL + æ­»ä¿¡é˜Ÿåˆ—å®ç°å»¶è¿Ÿ
    public void setupTTLDelayQueue() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // å»¶è¿Ÿäº¤æ¢å™¨å’Œæœ€ç»ˆå¤„ç†é˜Ÿåˆ—
            channel.exchangeDeclare(&quot;delayed.exchange&quot;, BuiltinExchangeType.DIRECT, true);
            channel.queueDeclare(&quot;delayed.queue&quot;, true, false, false, null);
            channel.queueBind(&quot;delayed.queue&quot;, &quot;delayed.exchange&quot;, &quot;process&quot;);
            
            // TTLå»¶è¿Ÿé˜Ÿåˆ—ï¼ˆä¸è®¾ç½®æ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯è¿‡æœŸåè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼‰
            Map&lt;String, Object&gt; delayArguments = new HashMap&lt;&gt;();
            delayArguments.put(&quot;x-dead-letter-exchange&quot;, &quot;delayed.exchange&quot;);
            delayArguments.put(&quot;x-dead-letter-routing-key&quot;, &quot;process&quot;);
            delayArguments.put(&quot;x-message-ttl&quot;, 60000); // 60ç§’å»¶è¿Ÿ
            
            channel.queueDeclare(&quot;delay.60s.queue&quot;, true, false, false, delayArguments);
            channel.exchangeDeclare(&quot;delay.exchange&quot;, BuiltinExchangeType.DIRECT, true);
            channel.queueBind(&quot;delay.60s.queue&quot;, &quot;delay.exchange&quot;, &quot;60s&quot;);
            
            System.out.println(&quot;TTLå»¶è¿Ÿé˜Ÿåˆ—é…ç½®å®Œæˆ&quot;);
        }
    }
    
    // å‘é€å»¶è¿Ÿæ¶ˆæ¯
    public void sendDelayedMessage(String message, int delaySeconds) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // æ ¹æ®å»¶è¿Ÿæ—¶é—´é€‰æ‹©ä¸åŒçš„å»¶è¿Ÿé˜Ÿåˆ—
            String delayQueue = &quot;delay.&quot; + delaySeconds + &quot;s.queue&quot;;
            String routingKey = delaySeconds + &quot;s&quot;;
            
            // åŠ¨æ€åˆ›å»ºå»¶è¿Ÿé˜Ÿåˆ—
            Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;();
            arguments.put(&quot;x-dead-letter-exchange&quot;, &quot;delayed.exchange&quot;);
            arguments.put(&quot;x-dead-letter-routing-key&quot;, &quot;process&quot;);
            arguments.put(&quot;x-message-ttl&quot;, delaySeconds * 1000);
            
            channel.queueDeclare(delayQueue, true, false, false, arguments);
            channel.queueBind(delayQueue, &quot;delay.exchange&quot;, routingKey);
            
            // å‘é€æ¶ˆæ¯åˆ°å»¶è¿Ÿé˜Ÿåˆ—
            AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
                .timestamp(new Date())
                .build();
                
            channel.basicPublish(&quot;delay.exchange&quot;, routingKey, properties, message.getBytes());
            
            System.out.println(&quot;å»¶è¿Ÿæ¶ˆæ¯å‘é€: &quot; + delaySeconds + &quot;ç§’åå¤„ç† -&gt; &quot; + message);
        }
    }
    
    // æ–¹æ³•2: åŸºäºRabbitMQå»¶è¿Ÿæ’ä»¶
    public void setupPluginDelayQueue() throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // å£°æ˜å»¶è¿Ÿäº¤æ¢å™¨ï¼ˆéœ€è¦å®‰è£…rabbitmq-delayed-message-exchangeæ’ä»¶ï¼‰
            Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;();
            arguments.put(&quot;x-delayed-type&quot;, &quot;direct&quot;);
            
            channel.exchangeDeclare(&quot;delayed.plugin.exchange&quot;, &quot;x-delayed-message&quot;, true, false, arguments);
            
            // å£°æ˜ç›®æ ‡é˜Ÿåˆ—
            channel.queueDeclare(&quot;delayed.target.queue&quot;, true, false, false, null);
            channel.queueBind(&quot;delayed.target.queue&quot;, &quot;delayed.plugin.exchange&quot;, &quot;delayed&quot;);
            
            System.out.println(&quot;æ’ä»¶å»¶è¿Ÿé˜Ÿåˆ—é…ç½®å®Œæˆ&quot;);
        }
    }
    
    // ä½¿ç”¨æ’ä»¶å‘é€å»¶è¿Ÿæ¶ˆæ¯
    public void sendPluginDelayedMessage(String message, int delaySeconds) throws IOException, TimeoutException {
        try (Connection connection = createConnection();
             Channel channel = connection.createChannel()) {
            
            // è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
            Map&lt;String, Object&gt; headers = new HashMap&lt;&gt;();
            headers.put(&quot;x-delay&quot;, delaySeconds * 1000);
            
            AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
                .headers(headers)
                .timestamp(new Date())
                .build();
            
            channel.basicPublish(&quot;delayed.plugin.exchange&quot;, &quot;delayed&quot;, properties, message.getBytes());
            
            System.out.println(&quot;æ’ä»¶å»¶è¿Ÿæ¶ˆæ¯å‘é€: &quot; + delaySeconds + &quot;ç§’åå¤„ç† -&gt; &quot; + message);
        }
    }
    
    // å»¶è¿Ÿæ¶ˆæ¯æ¶ˆè´¹è€…
    public void startDelayedConsumer() throws IOException, TimeoutException {
        Connection connection = createConnection();
        Channel channel = connection.createChannel();
        
        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);
            Date timestamp = delivery.getProperties().getTimestamp();
            
            System.out.println(&quot;å¤„ç†å»¶è¿Ÿæ¶ˆæ¯: &quot; + message);
            System.out.println(&quot;å‘é€æ—¶é—´: &quot; + timestamp);
            System.out.println(&quot;å¤„ç†æ—¶é—´: &quot; + new Date());
            
            // å¤„ç†å»¶è¿Ÿä»»åŠ¡
            processDelayedTask(message);
            
            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
        };
        
        channel.basicConsume(&quot;delayed.queue&quot;, false, deliverCallback, consumerTag -&gt; {});
    }
}
</div></section></section><section class="chapter"><h2 id="-jlchwv_7" data-toc="-jlchwv_7">ğŸ’¡ é¢è¯•æŠ€å·§</h2><section class="chapter"><h3 id="-jlchwv_107" data-toc="-jlchwv_107">é«˜é¢‘è€ƒç‚¹</h3><ol class="list _decimal" id="-jlchwv_109" type="1"><li class="list__item" id="-jlchwv_110"><p id="-jlchwv_115"><span class="control" id="-jlchwv_116">AMQPåè®®</span>: ç†è§£AMQPåè®®å’ŒRabbitMQæ¶æ„</p></li><li class="list__item" id="-jlchwv_111"><p id="-jlchwv_117"><span class="control" id="-jlchwv_118">Exchangeç±»å‹</span>: æŒæ¡å››ç§Exchangeçš„è·¯ç”±è§„åˆ™</p></li><li class="list__item" id="-jlchwv_112"><p id="-jlchwv_119"><span class="control" id="-jlchwv_120">å¯é æ€§æœºåˆ¶</span>: Publisher Confirmså’ŒConsumer Ack</p></li><li class="list__item" id="-jlchwv_113"><p id="-jlchwv_121"><span class="control" id="-jlchwv_122">æ­»ä¿¡é˜Ÿåˆ—</span>: æ­»ä¿¡äº§ç”ŸåŸå› å’Œå¤„ç†æœºåˆ¶</p></li><li class="list__item" id="-jlchwv_114"><p id="-jlchwv_123"><span class="control" id="-jlchwv_124">å»¶è¿Ÿé˜Ÿåˆ—</span>: ä¸¤ç§å»¶è¿Ÿé˜Ÿåˆ—å®ç°æ–¹æ¡ˆ</p></li></ol></section><section class="chapter"><h3 id="-jlchwv_108" data-toc="-jlchwv_108">å›ç­”ç­–ç•¥</h3><ol class="list _decimal" id="-jlchwv_125" type="1"><li class="list__item" id="-jlchwv_128"><p id="-jlchwv_132"><span class="control" id="-jlchwv_133">åè®®ç†è§£</span>: å…ˆè¯´AMQPåè®®ç‰¹ç‚¹ï¼Œå†è®²RabbitMQå®ç°</p></li><li class="list__item" id="-jlchwv_129"><p id="-jlchwv_134"><span class="control" id="-jlchwv_135">åœºæ™¯å¯¹æ¯”</span>: ä¸åŒExchangeç±»å‹çš„é€‚ç”¨åœºæ™¯</p></li><li class="list__item" id="-jlchwv_130"><p id="-jlchwv_136"><span class="control" id="-jlchwv_137">å¯é æ€§ä¿è¯</span>: ä»ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…çš„å…¨é“¾è·¯å¯é æ€§</p></li><li class="list__item" id="-jlchwv_131"><p id="-jlchwv_138"><span class="control" id="-jlchwv_139">å®é™…åº”ç”¨</span>: ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯è¯´æ˜æŠ€æœ¯é€‰æ‹©</p></li></ol><p id="-jlchwv_127"><span class="control" id="-jlchwv_140">å­¦ä¹ å»ºè®®</span>: RabbitMQçš„çµæ´»æ€§å¾ˆå¼ºï¼Œé‡ç‚¹è¦ç†è§£å…¶è·¯ç”±æœºåˆ¶å’Œå¯é æ€§ä¿è¯ã€‚å»ºè®®é€šè¿‡ç®¡ç†ç•Œé¢è§‚å¯Ÿæ¶ˆæ¯æµè½¬è¿‡ç¨‹ï¼ŒåŠ æ·±å¯¹Exchangeå’ŒQueueç»‘å®šå…³ç³»çš„ç†è§£ã€‚</p></section></section><div class="last-modified">09 å…­æœˆ 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="kafkaæ·±å…¥è§£æqa.html" class="navigation-links__prev">Kafkaæ·±å…¥è§£æQA</a><a href="rocketmqä¼ä¸šçº§åº”ç”¨qa.html" class="navigation-links__next">RocketMQä¼ä¸šçº§åº”ç”¨QA</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>