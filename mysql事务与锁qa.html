<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-06-10T01:18:28.0142155"><title>MySQL事务与锁QA | 技术知识库</title><script type="application/json" id="virtual-toc-data">[{"id":"t65ycl_4","level":0,"title":"📋 知识结构","anchor":"#t65ycl_4"},{"id":"t65ycl_5","level":0,"title":"🔐 事务基础概念","anchor":"#t65ycl_5"},{"id":"t65ycl_6","level":0,"title":"🔒 事务隔离级别","anchor":"#t65ycl_6"},{"id":"t65ycl_7","level":0,"title":"🔐 锁机制详解","anchor":"#t65ycl_7"},{"id":"t65ycl_8","level":0,"title":"⚠️ 死锁问题","anchor":"#t65ycl_8"},{"id":"mvcc","level":0,"title":"🎯 MVCC机制","anchor":"#mvcc"},{"id":"t65ycl_10","level":0,"title":"💡 锁优化策略","anchor":"#t65ycl_10"},{"id":"t65ycl_11","level":0,"title":"💡 面试技巧","anchor":"#t65ycl_11"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="MySQL事务与锁QA | 技术知识库"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="技术知识库 Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/mysql事务与锁qa.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="MySQL事务与锁QA | 技术知识库"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/mysql事务与锁qa.html#webpage",
    "url": "writerside-documentation/mysql事务与锁qa.html",
    "name": "MySQL事务与锁QA | 技术知识库",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "技术知识库 Help"
}</script><!-- End Schema.org --></head><body data-id="MySQL事务与锁QA" data-main-title="MySQL事务与锁QA" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="MySQL面试大纲.md|MySQL面试大纲"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>技术知识库  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="MySQL事务与锁QA" id="MySQL事务与锁QA.md">MySQL事务与锁QA</h1><p id="t65ycl_3">本文档深入解析MySQL事务和锁机制，涵盖ACID特性、隔离级别、锁类型、死锁处理等核心概念。</p><section class="chapter"><h2 id="t65ycl_4" data-toc="t65ycl_4">📋 知识结构</h2><svg aria-roledescription="mindmap" role="graphics-document document" viewBox="5 5 656.8936767578125 415.41546630859375" style="max-width: 656.8936767578125px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g></g><g class="mindmap-edges"><path class="edge section-edge-0 edge-depth-1" d="M 410.27857687993594,113.07601045744087 L 414.8025344325488,80.91488817496892 L419.3264919851616,48.75376589249696"></path><path class="edge section-edge-0 edge-depth-1" d="M 422.89447633438243,130.8884654231824 L 475.96570200290046,141.56632596471198 L529.0369276714185,152.24418650624156"></path><path class="edge section-edge-0 edge-depth-1" d="M 395.1814669463556,120.45985188804916 L 353.28332589267416,96.39902812903622 L311.3851848389927,72.33820437002329"></path><path class="edge section-edge-0 edge-depth-1" d="M 421.9505198175851,121.96109687997236 L 478.0271801965399,97.63909991312423 L534.1038405754947,73.3171029462761"></path><path class="edge section-edge-0 edge-depth-0" d="M 324.0527258297287,194.90841577366623 L 360.25320258644854,166.09024042008443 L396.4536793431684,137.27206506650262"></path><path class="edge section-edge-1 edge-depth-1" d="M 470.2160176066872,257.2016250689272 L 419.6607791245848,266.7206533510928 L369.10554064248237,276.2396816332583"></path><path class="edge section-edge-1 edge-depth-1" d="M 483.1887562843721,269.32146691416557 L 479.43854028892633,300.91293126935096 L475.68832429348055,332.50439562453636"></path><path class="edge section-edge-1 edge-depth-1" d="M 498.07032426952173,261.70893725491175 L 544.2095428093198,287.3337345406503 L590.3487613491179,312.9585318263888"></path><path class="edge section-edge-1 edge-depth-1" d="M 499.66316094922735,251.47165478958593 L 551.1633573888897,241.12551768098845 L602.663553828552,230.77938057239098"></path><path class="edge section-edge-1 edge-depth-0" d="M 326.721222930478,208.43702252718907 L 398.6371135548758,229.3383787118331 L470.55300417927356,250.2397348964771"></path><path class="edge section-edge-2 edge-depth-1" d="M 223.96249889458667,304.15278139779184 L 181.20357040263173,330.83986492298845 L138.44464191067678,357.52694844818507"></path><path class="edge section-edge-2 edge-depth-1" d="M 248.83405007118603,305.011915960097 L 286.0741660473192,331.995251032541 L323.31428202345234,358.97858610498497"></path><path class="edge section-edge-2 edge-depth-1" d="M 235.76468601928667,311.1823595851126 L 233.75042256666245,343.86312737875903 L231.73615911403823,376.5438951724055"></path><path class="edge section-edge-2 edge-depth-1" d="M 221.72129373344058,295.20375267413664 L 168.86409156200028,291.64718841379647 L116.00688939055998,288.0906241534563"></path><path class="edge section-edge-2 edge-depth-0" d="M 302.7892921644407,215.83596328359204 L 274.50234609365475,250.23073713151734 L246.21540002286878,284.62551097944265"></path><path class="edge section-edge-3 edge-depth-1" d="M 173.18946811682716,137.3380113728557 L 118.83174291527399,152.47746128896043 L64.47401771372083,167.61691120506515"></path><path class="edge section-edge-3 edge-depth-1" d="M 185.07043450316542,118.53510083346399 L 179.4698196623022,86.31779295412608 L173.86920482143898,54.10048507478817"></path><path class="edge section-edge-3 edge-depth-1" d="M 173.57966858865677,128.08646116774747 L 119.41685196911357,107.9504154504273 L65.25403534957037,87.81436973310713"></path><path class="edge section-edge-3 edge-depth-1" d="M 183.90470562235532,147.84107140852268 L 176.6055911395792,176.23328696031095 L169.30647665680306,204.62550251209922"></path><path class="edge section-edge-3 edge-depth-0" d="M 299.2797774002598,196.83284870998867 L 249.97836253573905,168.78208353897602 L200.67694767121833,140.73131836796338"></path></g><g class="mindmap-nodes"><g transform="translate(246.29545748739008, 185.350704490231)" class="mindmap-node section--1 section-root"><g transform="translate(66.02178192138672, 18.9)"><circle r="66.02178192138672" class="node-bkg node-circle" id="node-0"></circle></g><g transform="translate(66.02178192138672, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">MySQL事务与锁</tspan></tspan></text></g></g></g><g transform="translate(366.1344782641203, 109.02977634993783)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-1"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">事务基础</tspan></tspan></text></g></g></g><g transform="translate(442.90230020097476, 235.52605293343515)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-6"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">隔离级别</tspan></tspan></text></g></g></g><g transform="translate(202.1483902785327, 277.3107697728037)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h59.078125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-11"></path><line y2="37.8" x2="69.078125" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(34.5390625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">锁机制</tspan></tspan></text></g></g></g><g transform="translate(141.1160481627013, 114.41346258772103)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h83.046875 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-16"></path><line y2="37.8" x2="93.046875" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(46.5234375, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">MVCC机制</tspan></tspan></text></g></g></g><g transform="translate(377.7191829776863, 15)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h77.39344024658203 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-2"></path><line y2="37.8" x2="87.39344024658203" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(43.696720123291016, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">ACID特性</tspan></tspan></text></g></g></g><g transform="translate(501.20623894358494, 136.3028755794861)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-3"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">事务操作</tspan></tspan></text></g></g></g><g transform="translate(255.84148672313233, 45.96827990813461)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-4"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">事务状态</tspan></tspan></text></g></g></g><g transform="translate(504.82919533086385, 48.448423476310616)" class="mindmap-node section-0"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h76.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-5"></path><line y2="37.8" x2="86.0719985961914" y1="37.8" x1="0" class="node-line-0"></line></g><g transform="translate(43.0359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">并发问题</tspan></tspan></text></g></g></g><g transform="translate(311.8098830481948, 260.11525376875034)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-7"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">读未提交</tspan></tspan></text></g></g></g><g transform="translate(431.3654053768779, 328.4998096052668)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-8"></path><line y2="37.8" x2="85.109375" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(42.5546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">读已提交</tspan></tspan></text></g></g></g><g transform="translate(561.4074104176649, 301.3414161478654)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h74.109375 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-9"></path><line y2="37.8" x2="84.109375" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(42.0546875, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">可重复读</tspan></tspan></text></g></g></g><g transform="translate(582.845726908958, 208.92498242854174)" class="mindmap-node section-1"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h59.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-10"></path><line y2="37.8" x2="69.04800033569336" y1="37.8" x1="0" class="node-line-1"></line></g><g transform="translate(34.52400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">串行化</tspan></tspan></text></g></g></g><g transform="translate(91.18062552673075, 346.56896007317323)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h59.078125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-12"></path><line y2="37.8" x2="69.078125" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(34.5390625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">锁类型</tspan></tspan></text></g></g></g><g transform="translate(300.92181681610566, 348.8797322922783)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h59.078125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-13"></path><line y2="37.8" x2="69.078125" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(34.5390625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">锁粒度</tspan></tspan></text></g></g></g><g transform="translate(195.78939218694552, 372.6154849847144)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h60.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-14"></path><line y2="37.8" x2="70.04800033569336" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(35.02400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">锁模式</tspan></tspan></text></g></g></g><g transform="translate(58.50473104737216, 268.18360705478926)" class="mindmap-node section-2"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h75.0719985961914 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-15"></path><line y2="37.8" x2="85.0719985961914" y1="37.8" x1="0" class="node-line-2"></line></g><g transform="translate(42.5359992980957, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">死锁处理</tspan></tspan></text></g></g></g><g transform="translate(15, 152.74145999019981)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h60.04800033569336 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-17"></path><line y2="37.8" x2="70.04800033569336" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(35.02400016784668, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">版本链</tspan></tspan></text></g></g></g><g transform="translate(123.73652832620974, 20.422123320531114)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h85.12725067138672 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-18"></path><line y2="37.8" x2="95.12725067138672" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(47.56362533569336, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">Read</tspan><tspan font-weight="normal" class="text-inner-tspan" font-style="normal"> View</tspan></tspan></text></g></g></g><g transform="translate(16.655155775525827, 63.68736831313357)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h59.078125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-19"></path><line y2="37.8" x2="69.078125" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(34.5390625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">快照读</tspan></tspan></text></g></g></g><g transform="translate(131.53263411645707, 200.25311133290086)" class="mindmap-node section-3"><g><path d="M0 32.8 v-27.799999999999997 q0,-5 5,-5 h58.078125 q5,0 5,5 v32.8 H0 Z" class="node-bkg node-no-border" id="node-20"></path><line y2="37.8" x2="68.078125" y1="37.8" x1="0" class="node-line-3"></line></g><g transform="translate(34.0390625, 5)" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" dy="1em"><g><rect style="stroke: none" class="background"></rect><text style="" y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0" class="text-outer-tspan"><tspan font-weight="normal" class="text-inner-tspan" font-style="normal">当前读</tspan></tspan></text></g></g></g></g></svg></section><section class="chapter"><h2 id="t65ycl_5" data-toc="t65ycl_5">🔐 事务基础概念</h2><section class="chapter"><h3 id="q1-mysql-acid" data-toc="q1-mysql-acid">Q1: 什么是事务？MySQL事务的ACID特性是什么？</h3><p id="t65ycl_15"><span class="control" id="t65ycl_20">答案：</span> 事务是数据库操作的基本单元，是一组操作的集合，这些操作要么全部成功，要么全部失败。</p><p id="t65ycl_16"><span class="control" id="t65ycl_21">ACID特性详解：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 972.65625 426"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="972.65625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"><g data-look="classic" id="实现机制" class="cluster"><rect height="128" width="897.5703125" y="290" x="45.4765625" style=""></rect><g transform="translate(462.20703125, 290)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>实现机制</p></span></div></foreignObject></g></g><g data-look="classic" id="ACID特性" class="cluster"><rect height="232" width="956.65625" y="8" x="8" style=""></rect><g transform="translate(453.6171875, 8)" class="cluster-label"><foreignObject height="24" width="65.421875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ACID特性</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M428.781,69.123L379.656,76.269C330.531,83.415,232.281,97.708,183.156,106.937C134.031,116.167,134.031,120.333,134.031,123.833C134.031,127.333,134.031,130.167,134.031,131.583L134.031,133"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_C_1" d="M430.32,87L420.88,91.167C411.44,95.333,392.56,103.667,383.12,109.917C373.68,116.167,373.68,120.333,373.68,123.833C373.68,127.333,373.68,130.167,373.68,131.583L373.68,133"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_D_2" d="M552.664,87L562.104,91.167C571.544,95.333,590.424,103.667,599.865,109.917C609.305,116.167,609.305,120.333,609.305,123.833C609.305,127.333,609.305,130.167,609.305,131.583L609.305,133"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_E_3" d="M554.203,69.411L601.5,76.509C648.797,83.608,743.391,97.804,790.688,106.985C837.984,116.167,837.984,120.333,837.984,123.833C837.984,127.333,837.984,130.167,837.984,131.583L837.984,133"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_F_4" d="M134.031,215L134.031,219.167C134.031,223.333,134.031,231.667,134.031,240C134.031,248.333,134.031,256.667,134.031,265C134.031,273.333,134.031,281.667,137.932,287.917C141.832,294.167,149.633,298.333,156.846,302.186C164.059,306.038,170.684,309.577,173.997,311.346L177.309,313.115"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_F_5" d="M373.68,215L373.68,219.167C373.68,223.333,373.68,231.667,373.68,240C373.68,248.333,373.68,256.667,373.68,265C373.68,273.333,373.68,281.667,369.779,287.917C365.879,294.167,358.078,298.333,350.865,302.186C343.652,306.038,337.027,309.577,333.714,311.346L330.402,313.115"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_G_6" d="M609.305,215L609.305,219.167C609.305,223.333,609.305,231.667,609.305,240C609.305,248.333,609.305,256.667,609.305,265C609.305,273.333,609.305,281.667,609.305,287.917C609.305,294.167,609.305,298.333,609.305,301.833C609.305,305.333,609.305,308.167,609.305,309.583L609.305,311"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_H_7" d="M837.984,215L837.984,219.167C837.984,223.333,837.984,231.667,837.984,240C837.984,248.333,837.984,256.667,837.984,265C837.984,273.333,837.984,281.667,837.984,287.917C837.984,294.167,837.984,298.333,837.984,301.833C837.984,305.333,837.984,308.167,837.984,309.583L837.984,311"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(491.4921875, 60)" id="flowchart-A-11112" class="node default"><rect height="54" width="125.421875" y="-27" x="-62.7109375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.7109375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="65.421875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ACID特性</p></span></div></foreignObject></g></g><g transform="translate(134.03125, 176)" id="flowchart-B-11113" class="node default"><rect height="78" width="182.0625" y="-39" x="-91.03125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-61.03125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="122.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>原子性 Atomicity<br>事务不可分割</p></span></div></foreignObject></g></g><g transform="translate(373.6796875, 176)" id="flowchart-C-11115" class="node default"><rect height="78" width="197.234375" y="-39" x="-98.6171875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-68.6171875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="137.234375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>一致性 Consistency<br>数据完整性约束</p></span></div></foreignObject></g></g><g transform="translate(609.3046875, 176)" id="flowchart-D-11117" class="node default"><rect height="78" width="174.015625" y="-39" x="-87.0078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-57.0078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="114.015625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>隔离性 Isolation<br>并发事务隔离</p></span></div></foreignObject></g></g><g transform="translate(837.984375, 176)" id="flowchart-E-11119" class="node default"><rect height="78" width="183.34375" y="-39" x="-91.671875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-61.671875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="123.34375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>持久性 Durability<br>提交后永久保存</p></span></div></foreignObject></g></g><g transform="translate(253.85546875, 354)" id="flowchart-F-11120" class="node default"><rect height="78" width="204.21875" y="-39" x="-102.109375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-72.109375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="144.21875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Undo Log<br>实现原子性和一致性</p></span></div></foreignObject></g></g><g transform="translate(609.3046875, 354)" id="flowchart-G-11121" class="node default"><rect height="78" width="156.484375" y="-39" x="-78.2421875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.2421875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.484375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>锁机制+MVCC<br>实现隔离性</p></span></div></foreignObject></g></g><g transform="translate(837.984375, 354)" id="flowchart-H-11122" class="node default"><rect height="78" width="140.125" y="-39" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Redo Log<br>实现持久性</p></span></div></foreignObject></g></g></g></g></g></svg><p id="t65ycl_18"><span class="control" id="t65ycl_22">各特性详细说明：</span></p><ol class="list _decimal" id="t65ycl_19" type="1"><li class="list__item" id="t65ycl_23"><p id="t65ycl_27"><span class="control" id="t65ycl_29">原子性（Atomicity）</span></p><ul class="list _bullet" id="t65ycl_28"><li class="list__item" id="t65ycl_30"><p id="t65ycl_32">事务中的所有操作要么全部完成，要么全部不执行</p></li><li class="list__item" id="t65ycl_31"><p id="t65ycl_33">通过Undo Log实现回滚功能</p></li></ul></li><li class="list__item" id="t65ycl_24"><p id="t65ycl_34"><span class="control" id="t65ycl_36">一致性（Consistency）</span></p><ul class="list _bullet" id="t65ycl_35"><li class="list__item" id="t65ycl_37"><p id="t65ycl_39">事务执行前后，数据库都处于一致状态</p></li><li class="list__item" id="t65ycl_38"><p id="t65ycl_40">满足所有完整性约束</p></li></ul></li><li class="list__item" id="t65ycl_25"><p id="t65ycl_41"><span class="control" id="t65ycl_43">隔离性（Isolation）</span></p><ul class="list _bullet" id="t65ycl_42"><li class="list__item" id="t65ycl_44"><p id="t65ycl_46">并发执行的事务互不影响</p></li><li class="list__item" id="t65ycl_45"><p id="t65ycl_47">通过锁机制和MVCC实现</p></li></ul></li><li class="list__item" id="t65ycl_26"><p id="t65ycl_48"><span class="control" id="t65ycl_50">持久性（Durability）</span></p><ul class="list _bullet" id="t65ycl_49"><li class="list__item" id="t65ycl_51"><p id="t65ycl_53">事务提交后，修改永久保存</p></li><li class="list__item" id="t65ycl_52"><p id="t65ycl_54">通过Redo Log保证数据持久化</p></li></ul></li></ol></section><section class="chapter"><h3 id="q2" data-toc="q2">Q2: 事务的基本操作有哪些？如何控制事务？</h3><p id="t65ycl_55"><span class="control" id="t65ycl_62">答案：</span></p><p id="t65ycl_56"><span class="control" id="t65ycl_63">事务控制语句：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1202.75 222"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1202.75" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M266.797,111L270.964,111C275.13,111,283.464,111,289.714,111C295.964,111,300.13,111,303.63,111C307.13,111,309.964,111,311.38,111L312.797,111"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M550.703,111L554.87,111C559.036,111,567.37,111,573.661,111.042C579.953,111.083,584.203,111.167,587.787,111.237C591.37,111.307,594.287,111.364,595.745,111.393L597.204,111.422"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_2" d="M729.971,84.221L741.273,78.018C752.575,71.814,775.178,59.407,790.301,53.204C805.424,47,813.068,47,820.044,47C827.021,47,833.331,47,836.486,47L839.641,47"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_E_3" d="M729.971,138.779L741.273,144.816C752.575,150.852,775.178,162.926,789.899,168.963C804.62,175,811.458,175,817.63,175C823.802,175,829.307,175,832.06,175L834.813,175"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_F_4" d="M967.75,47L972.721,47C977.693,47,987.635,47,995.357,47C1003.079,47,1008.581,47,1013.415,47C1018.25,47,1022.418,47,1024.502,47L1026.586,47"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_G_5" d="M972.578,175L976.745,175C980.911,175,989.245,175,995.495,175C1001.745,175,1005.911,175,1009.411,175C1012.911,175,1015.745,175,1017.161,175L1018.578,175"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(797.78125, 47)" class="edgeLabel"><g transform="translate(-16.03125, -12)" class="label"><foreignObject height="24" width="32.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>成功</p></span></div></foreignObject></g></g><g transform="translate(797.78125, 175)" class="edgeLabel"><g transform="translate(-16.03125, -12)" class="label"><foreignObject height="24" width="32.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>失败</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(137.3984375, 111)" id="flowchart-A-11183" class="node default"><rect height="78" width="258.796875" y="-39" x="-129.3984375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-99.3984375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="198.796875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>BEGIN/START TRANSACTION<br>开始事务</p></span></div></foreignObject></g></g><g transform="translate(433.75, 111)" id="flowchart-B-11184" class="node default"><rect height="78" width="233.90625" y="-39" x="-116.953125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-86.953125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="173.90625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>DML操作<br>INSERT/UPDATE/DELETE</p></span></div></foreignObject></g></g><g transform="translate(678.7265625, 111)" id="flowchart-C-11186" class="node default"><polygon transform="translate(-78.0234375,78.0234375)" class="label-container" points="78.0234375,0 156.046875,-78.0234375 78.0234375,-156.046875 0,-78.0234375"></polygon><g transform="translate(-51.0234375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="102.046875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>操作是否成功?</p></span></div></foreignObject></g></g><g transform="translate(905.6953125, 47)" id="flowchart-D-11188" class="node default"><rect height="78" width="124.109375" y="-39" x="-62.0546875" data-et="node" data-id="abc" style="fill:#90EE90 !important" class="basic label-container"></rect><g transform="translate(-32.0546875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>COMMIT<br>提交事务</p></span></div></foreignObject></g></g><g transform="translate(905.6953125, 175)" id="flowchart-E-11190" class="node default"><rect height="78" width="133.765625" y="-39" x="-66.8828125" data-et="node" data-id="abc" style="fill:#FFB6C1 !important" class="basic label-container"></rect><g transform="translate(-36.8828125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="73.765625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ROLLBACK<br>回滚事务</p></span></div></foreignObject></g></g><g transform="translate(1108.6640625, 47)" id="flowchart-F-11192" class="node default"><rect height="78" width="156.15625" y="-39" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务成功结束<br>数据持久化</p></span></div></foreignObject></g></g><g transform="translate(1108.6640625, 175)" id="flowchart-G-11194" class="node default"><rect height="78" width="172.171875" y="-39" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务回滚<br>恢复到初始状态</p></span></div></foreignObject></g></g></g></g></g></svg><p id="t65ycl_58"><span class="control" id="t65ycl_64">实际使用示例：</span></p><div class="code-block" data-lang="sql">
-- 开始事务
START TRANSACTION;

-- 执行业务操作
UPDATE account SET balance = balance - 100 WHERE user_id = 1;
UPDATE account SET balance = balance + 100 WHERE user_id = 2;

-- 检查操作结果
IF 操作成功 THEN
    COMMIT;    -- 提交事务
ELSE
    ROLLBACK;  -- 回滚事务
END IF;
</div><p id="t65ycl_60"><span class="control" id="t65ycl_65">保存点（Savepoint）使用：</span></p><div class="code-block" data-lang="sql">
START TRANSACTION;

INSERT INTO orders (user_id, amount) VALUES (1, 100);
SAVEPOINT sp1;  -- 设置保存点

UPDATE inventory SET stock = stock - 1 WHERE product_id = 1;
-- 如果库存不足，回滚到保存点
ROLLBACK TO sp1;

COMMIT;
</div></section></section><section class="chapter"><h2 id="t65ycl_6" data-toc="t65ycl_6">🔒 事务隔离级别</h2><section class="chapter"><h3 id="q3-mysql" data-toc="q3-mysql">Q3: MySQL支持哪些事务隔离级别？各有什么特点？</h3><p id="t65ycl_68"><span class="control" id="t65ycl_75">答案：</span></p><p id="t65ycl_69">MySQL支持SQL标准定义的四种隔离级别：</p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1010.703125 548"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1010.703125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 88)" class="root"><g class="clusters"><g data-look="classic" id="并发问题说明" class="cluster"><rect height="356" width="335" y="8" x="8" style=""></rect><g transform="translate(127.421875, 8)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>并发问题说明</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(175.5, 70)" id="flowchart-I-11242" class="node default"><rect height="54" width="236.265625" y="-27" x="-118.1328125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-88.1328125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="176.265625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>脏读：读取未提交的数据</p></span></div></foreignObject></g></g><g transform="translate(175.5, 186)" id="flowchart-J-11243" class="node default"><rect height="78" width="260" y="-39" x="-130" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-100, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>不可重复读：两次读取结果不同</p></span></div></foreignObject></g></g><g transform="translate(175.5, 302)" id="flowchart-K-11244" class="node default"><rect height="54" width="252.296875" y="-27" x="-126.1484375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-96.1484375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="192.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>幻读：读取到新插入的数据</p></span></div></foreignObject></g></g></g></g><g transform="translate(385, 0)" class="root"><g class="clusters"><g data-look="classic" id="隔离级别从低到高" class="cluster"><rect height="532" width="609.703125" y="8" x="8" style=""></rect><g transform="translate(248.75, 8)" class="cluster-label"><foreignObject height="24" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>隔离级别从低到高</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M252.906,82L259.156,82C265.406,82,277.906,82,287.949,82C297.992,82,305.578,82,312.497,82C319.417,82,325.669,82,328.796,82L331.922,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_1" d="M242.586,210L250.556,210C258.526,210,274.466,210,285.561,210C296.656,210,302.906,210,308.49,210C314.073,210,318.99,210,321.448,210L323.906,210"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_2" d="M243.445,338L251.272,338C259.099,338,274.753,338,287.04,338C299.327,338,308.247,338,316.501,338C324.755,338,332.342,338,336.136,338L339.93,338"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_H_3" d="M227.344,466L237.854,466C248.365,466,269.385,466,285.691,466C301.997,466,313.589,466,324.513,466C335.438,466,345.695,466,350.824,466L355.953,466"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(149.203125, 82)" id="flowchart-A-11234" class="node default"><rect height="78" width="207.40625" y="-39" x="-103.703125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-73.703125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="147.40625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>读未提交<br>READ UNCOMMITTED</p></span></div></foreignObject></g></g><g transform="translate(454.0546875, 82)" id="flowchart-B-11235" class="node default"><rect height="78" width="236.265625" y="-39" x="-118.1328125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-88.1328125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="176.265625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>脏读、不可重复读、幻读<br>都可能发生</p></span></div></foreignObject></g></g><g transform="translate(149.203125, 210)" id="flowchart-C-11236" class="node default"><rect height="78" width="186.765625" y="-39" x="-93.3828125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-63.3828125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="126.765625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>读已提交<br>READ COMMITTED</p></span></div></foreignObject></g></g><g transform="translate(454.0546875, 210)" id="flowchart-D-11237" class="node default"><rect height="78" width="252.296875" y="-39" x="-126.1484375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-96.1484375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="192.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>避免脏读<br>可能发生不可重复读、幻读</p></span></div></foreignObject></g></g><g transform="translate(149.203125, 338)" id="flowchart-E-11238" class="node default"><rect height="78" width="188.484375" y="-39" x="-94.2421875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.2421875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="128.484375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>可重复读<br>REPEATABLE READ</p></span></div></foreignObject></g></g><g transform="translate(454.0546875, 338)" id="flowchart-F-11239" class="node default"><rect height="78" width="220.25" y="-39" x="-110.125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-80.125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="160.25"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>避免脏读、不可重复读<br>可能发生幻读</p></span></div></foreignObject></g></g><g transform="translate(149.203125, 466)" id="flowchart-G-11240" class="node default"><rect height="78" width="156.28125" y="-39" x="-78.140625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.140625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.28125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>串行化<br>SERIALIZABLE</p></span></div></foreignObject></g></g><g transform="translate(454.0546875, 466)" id="flowchart-H-11241" class="node default"><rect height="78" width="188.203125" y="-39" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>避免所有并发问题<br>完全隔离</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="t65ycl_71"><span class="control" id="t65ycl_76">隔离级别对比表：</span></p><div class="table-wrapper"><table class="wide" id="t65ycl_72"><thead><tr class="ijRowHead" id="t65ycl_77"><th id="t65ycl_82"><p>隔离级别</p></th><th id="t65ycl_83"><p>脏读</p></th><th id="t65ycl_84"><p>不可重复读</p></th><th id="t65ycl_85"><p>幻读</p></th><th id="t65ycl_86"><p>加锁情况</p></th></tr></thead><tbody><tr id="t65ycl_78"><td id="t65ycl_87"><p><span class="control" id="t65ycl_92">READ UNCOMMITTED</span></p></td><td id="t65ycl_88"><p>✅</p></td><td id="t65ycl_89"><p>✅</p></td><td id="t65ycl_90"><p>✅</p></td><td id="t65ycl_91"><p>几乎不加锁</p></td></tr><tr id="t65ycl_79"><td id="t65ycl_93"><p><span class="control" id="t65ycl_98">READ COMMITTED</span></p></td><td id="t65ycl_94"><p>❌</p></td><td id="t65ycl_95"><p>✅</p></td><td id="t65ycl_96"><p>✅</p></td><td id="t65ycl_97"><p>读加共享锁，读完释放</p></td></tr><tr id="t65ycl_80"><td id="t65ycl_99"><p><span class="control" id="t65ycl_104">REPEATABLE READ</span></p></td><td id="t65ycl_100"><p>❌</p></td><td id="t65ycl_101"><p>❌</p></td><td id="t65ycl_102"><p>✅</p></td><td id="t65ycl_103"><p>读加共享锁，事务结束释放</p></td></tr><tr id="t65ycl_81"><td id="t65ycl_105"><p><span class="control" id="t65ycl_110">SERIALIZABLE</span></p></td><td id="t65ycl_106"><p>❌</p></td><td id="t65ycl_107"><p>❌</p></td><td id="t65ycl_108"><p>❌</p></td><td id="t65ycl_109"><p>串行化执行</p></td></tr></tbody></table></div><p id="t65ycl_73"><span class="control" id="t65ycl_111">默认隔离级别：</span></p><ul class="list _bullet" id="t65ycl_74"><li class="list__item" id="t65ycl_112"><p id="t65ycl_114">MySQL InnoDB默认： <span class="control" id="t65ycl_115">REPEATABLE READ</span></p></li><li class="list__item" id="t65ycl_113"><p id="t65ycl_116">Oracle、SQL Server默认： <span class="control" id="t65ycl_117">READ COMMITTED</span></p></li></ul></section><section class="chapter"><h3 id="q4" data-toc="q4">Q4: 什么是脏读、不可重复读、幻读？如何解决？</h3><p id="t65ycl_118"><span class="control" id="t65ycl_125">答案：</span></p><p id="t65ycl_119"><span class="control" id="t65ycl_126">并发问题详解：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 2384.65625 164"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="2384.65625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="subGraph2" class="cluster"><rect height="148" width="771.09375" y="8" x="8" style=""></rect><g transform="translate(324.046875, 8)" class="cluster-label"><foreignObject height="24" width="139"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>幻读 Phantom Read</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_H_4" d="M243.156,82L249.406,82C255.656,82,268.156,82,277.531,82C286.906,82,293.156,82,298.74,82C304.323,82,309.24,82,311.698,82L314.156,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_H_I_5" d="M499.406,82L505.656,82C511.906,82,524.406,82,533.781,82C543.156,82,549.406,82,554.99,82C560.573,82,565.49,82,567.948,82L570.406,82"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(144.328125, 82)" id="flowchart-G-11325" class="node default"><rect height="78" width="197.65625" y="-39" x="-98.828125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-68.828125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="137.65625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务A查询满足条件<br>的记录数为N</p></span></div></foreignObject></g></g><g transform="translate(408.78125, 82)" id="flowchart-H-11326" class="node default"><rect height="78" width="181.25" y="-39" x="-90.625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-60.625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="121.25"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务B插入新记录<br>满足条件</p></span></div></foreignObject></g></g><g transform="translate(658, 82)" id="flowchart-I-11328" class="node default"><rect height="78" width="167.1875" y="-39" x="-83.59375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-53.59375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="107.1875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务A再次查询<br>记录数变成N+1</p></span></div></foreignObject></g></g></g></g><g transform="translate(821.09375, 0)" class="root"><g class="clusters"><g data-look="classic" id="subGraph1" class="cluster"><rect height="148" width="753.515625" y="8" x="8" style=""></rect><g transform="translate(284.7578125, 8)" class="cluster-label"><foreignObject height="48" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>不可重复读 Non-repeatable Read</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_E_2" d="M227.141,82L233.391,82C239.641,82,252.141,82,261.516,82C270.891,82,277.141,82,282.724,82C288.307,82,293.224,82,295.682,82L298.141,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_3" d="M467.375,82L473.625,82C479.875,82,492.375,82,501.75,82C511.125,82,517.375,82,522.958,82C528.542,82,533.458,82,535.917,82L538.375,82"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(136.3203125, 82)" id="flowchart-D-11321" class="node default"><rect height="78" width="181.640625" y="-39" x="-90.8203125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-60.8203125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="121.640625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务A第一次读取<br>数据为X</p></span></div></foreignObject></g></g><g transform="translate(384.7578125, 82)" id="flowchart-E-11322" class="node default"><rect height="78" width="165.234375" y="-39" x="-82.6171875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-52.6171875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="105.234375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务B修改数据<br>并提交</p></span></div></foreignObject></g></g><g transform="translate(633.1953125, 82)" id="flowchart-F-11324" class="node default"><rect height="78" width="181.640625" y="-39" x="-90.8203125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-60.8203125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="121.640625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务A第二次读取<br>数据变成Y</p></span></div></foreignObject></g></g></g></g><g transform="translate(1624.609375, 0)" class="root"><g class="clusters"><g data-look="classic" id="subGraph0" class="cluster"><rect height="148" width="744.046875" y="8" x="8" style=""></rect><g transform="translate(324.2734375, 8)" class="cluster-label"><foreignObject height="24" width="111.5"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>脏读 Dirty Read</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M211.109,82L217.359,82C223.609,82,236.109,82,245.484,82C254.859,82,261.109,82,266.693,82C272.276,82,277.193,82,279.651,82L282.109,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M442.266,82L448.516,82C454.766,82,467.266,82,476.641,82C486.016,82,492.266,82,497.849,82C503.432,82,508.349,82,510.807,82L513.266,82"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(128.3046875, 82)" id="flowchart-A-11317" class="node default"><rect height="78" width="165.609375" y="-39" x="-82.8046875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-52.8046875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="105.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务A修改数据<br>但未提交</p></span></div></foreignObject></g></g><g transform="translate(364.1875, 82)" id="flowchart-B-11318" class="node default"><rect height="78" width="156.15625" y="-39" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务B读取了<br>未提交的数据</p></span></div></foreignObject></g></g><g transform="translate(615.90625, 82)" id="flowchart-C-11320" class="node default"><rect height="78" width="197.28125" y="-39" x="-98.640625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-68.640625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="137.28125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务A回滚<br>事务B读到错误数据</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="t65ycl_121"><span class="control" id="t65ycl_127">解决方案：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 830.109375 298"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="830.109375" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="解决并发问题" class="cluster"><rect height="282" width="814.109375" y="8" x="8" style=""></rect><g transform="translate(366.9765625, 8)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>解决并发问题</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M160.422,99.5L160.422,105.75C160.422,112,160.422,124.5,160.422,134.875C160.422,145.25,160.422,153.5,160.422,161.083C160.422,168.667,160.422,175.583,160.422,179.042L160.422,182.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_1" d="M454.336,99.5L454.336,105.75C454.336,112,454.336,124.5,454.336,133.875C454.336,143.25,454.336,149.5,454.336,155.083C454.336,160.667,454.336,165.583,454.336,168.042L454.336,170.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_2" d="M708.969,99.5L708.969,105.75C708.969,112,708.969,124.5,708.969,133.875C708.969,143.25,708.969,149.5,708.969,155.083C708.969,160.667,708.969,165.583,708.969,168.042L708.969,170.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(160.421875, 72.5)" id="flowchart-A-11344" class="node default"><rect height="54" width="92.0625" y="-27" x="-46.03125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-16.03125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="32.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>脏读</p></span></div></foreignObject></g></g><g transform="translate(160.421875, 213.5)" id="flowchart-B-11345" class="node default"><rect height="54" width="234.84375" y="-27" x="-117.421875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-87.421875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="174.84375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>READ COMMITTED及以上</p></span></div></foreignObject></g></g><g transform="translate(454.3359375, 72.5)" id="flowchart-C-11346" class="node default"><rect height="54" width="140.125" y="-27" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>不可重复读</p></span></div></foreignObject></g></g><g transform="translate(454.3359375, 213.5)" id="flowchart-D-11347" class="node default"><rect height="78" width="252.984375" y="-39" x="-126.4921875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-96.4921875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="192.984375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>REPEATABLE READ及以上<br>或使用SELECT FOR UPDATE</p></span></div></foreignObject></g></g><g transform="translate(708.96875, 72.5)" id="flowchart-E-11348" class="node default"><rect height="54" width="92.0625" y="-27" x="-46.03125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-16.03125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="32.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>幻读</p></span></div></foreignObject></g></g><g transform="translate(708.96875, 213.5)" id="flowchart-F-11349" class="node default"><rect height="78" width="156.28125" y="-39" x="-78.140625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.140625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.28125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>SERIALIZABLE<br>或使用间隙锁</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="t65ycl_123"><span class="control" id="t65ycl_128">实际案例演示：</span></p><div class="code-block" data-lang="sql">
-- 设置隔离级别
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;

-- 事务A
START TRANSACTION;
SELECT balance FROM account WHERE user_id = 1;  -- 第一次读取：100
-- 此时事务B修改了数据
SELECT balance FROM account WHERE user_id = 1;  -- 第二次读取：仍为100（可重复读）
COMMIT;

-- 事务B
START TRANSACTION;
UPDATE account SET balance = 200 WHERE user_id = 1;
COMMIT;
</div></section></section><section class="chapter"><h2 id="t65ycl_7" data-toc="t65ycl_7">🔐 锁机制详解</h2><section class="chapter"><h3 id="q5-mysql" data-toc="q5-mysql">Q5: MySQL中有哪些类型的锁？分别有什么作用？</h3><p id="t65ycl_131"><span class="control" id="t65ycl_136">答案：</span></p><p id="t65ycl_132"><span class="control" id="t65ycl_137">锁的分类体系：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1365.40625 420"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1365.40625" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="按锁模式分类" class="cluster"><rect height="404" width="596.34375" y="8" x="8" style=""></rect><g transform="translate(258.09375, 8)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>按锁模式分类</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_H_I_6" d="M221.656,82L230.888,82C240.12,82,258.583,82,272.943,82C287.303,82,297.56,82,307.15,82C316.74,82,325.663,82,330.124,82L334.586,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_J_K_7" d="M224.234,210L233.036,210C241.839,210,259.443,210,274.04,210C288.638,210,300.229,210,311.154,210C322.078,210,332.336,210,337.465,210L342.594,210"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_L_M_8" d="M239.547,338L245.797,338C252.047,338,264.547,338,273.922,338C283.297,338,289.547,338,295.13,338C300.714,338,305.63,338,308.089,338L310.547,338"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(142.5234375, 82)" id="flowchart-H-11388" class="node default"><rect height="78" width="158.265625" y="-39" x="-79.1328125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-49.1328125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="98.265625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>共享锁 S Lock<br>Share Lock</p></span></div></foreignObject></g></g><g transform="translate(440.6953125, 82)" id="flowchart-I-11389" class="node default"><rect height="78" width="204.21875" y="-39" x="-102.109375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-72.109375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="144.21875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>允许读，不允许写<br>多个事务可同时持有</p></span></div></foreignObject></g></g><g transform="translate(142.5234375, 210)" id="flowchart-J-11390" class="node default"><rect height="78" width="163.421875" y="-39" x="-81.7109375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-51.7109375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="103.421875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>排他锁 X Lock<br>Exclusive Lock</p></span></div></foreignObject></g></g><g transform="translate(440.6953125, 210)" id="flowchart-K-11391" class="node default"><rect height="78" width="188.203125" y="-39" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>不允许读写<br>只能一个事务持有</p></span></div></foreignObject></g></g><g transform="translate(142.5234375, 338)" id="flowchart-L-11392" class="node default"><rect height="54" width="194.046875" y="-27" x="-97.0234375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-67.0234375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="134.046875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>意向锁 Intent Lock</p></span></div></foreignObject></g></g><g transform="translate(440.6953125, 338)" id="flowchart-M-11393" class="node default"><rect height="78" width="252.296875" y="-39" x="-126.1484375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-96.1484375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="192.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>表示事务准备在某级别加锁<br>提高锁管理效率</p></span></div></foreignObject></g></g></g></g><g transform="translate(646.34375, 0)" class="root"><g class="clusters"><g data-look="classic" id="按锁粒度分类" class="cluster"><rect height="404" width="703.0625" y="8" x="8" style=""></rect><g transform="translate(311.453125, 8)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>按锁粒度分类</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M146.681,183L161.742,166.167C176.803,149.333,206.925,115.667,225.111,98.833C243.297,82,249.547,82,255.13,82C260.714,82,265.63,82,268.089,82L270.547,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_C_1" d="M199.547,210L205.797,210C212.047,210,224.547,210,234.295,210C244.043,210,251.039,210,257.368,210C263.698,210,269.361,210,272.192,210L275.023,210"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_D_2" d="M146.681,237L161.742,253.833C176.803,270.667,206.925,304.333,225.309,321.167C243.693,338,250.339,338,256.318,338C262.297,338,267.609,338,270.266,338L272.922,338"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_E_3" d="M410.359,82L416.609,82C422.859,82,435.359,82,444.734,82C454.109,82,460.359,82,465.943,82C471.526,82,476.443,82,478.901,82L481.359,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_F_4" d="M405.883,210L412.879,210C419.875,210,433.867,210,443.988,210C454.109,210,460.359,210,465.943,210C471.526,210,476.443,210,478.901,210L481.359,210"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_G_5" d="M407.984,338L414.63,338C421.276,338,434.568,338,445.094,338C455.62,338,463.38,338,470.474,338C477.568,338,483.995,338,487.208,338L490.422,338"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(122.5234375, 210)" id="flowchart-A-11376" class="node default"><rect height="54" width="154.046875" y="-27" x="-77.0234375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-47.0234375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="94.046875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>MySQL锁机制</p></span></div></foreignObject></g></g><g transform="translate(342.453125, 82)" id="flowchart-B-11377" class="node default"><rect height="78" width="135.8125" y="-39" x="-67.90625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-37.90625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="75.8125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>表级锁<br>Table Lock</p></span></div></foreignObject></g></g><g transform="translate(342.453125, 210)" id="flowchart-C-11379" class="node default"><rect height="78" width="126.859375" y="-39" x="-63.4296875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-33.4296875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="66.859375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>行级锁<br>Row Lock</p></span></div></foreignObject></g></g><g transform="translate(342.453125, 338)" id="flowchart-D-11381" class="node default"><rect height="78" width="131.0625" y="-39" x="-65.53125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-35.53125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="71.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>页级锁<br>Page Lock</p></span></div></foreignObject></g></g><g transform="translate(579.4609375, 82)" id="flowchart-E-11383" class="node default"><rect height="78" width="188.203125" y="-39" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>锁定整个表<br>开销小，并发度低</p></span></div></foreignObject></g></g><g transform="translate(579.4609375, 210)" id="flowchart-F-11385" class="node default"><rect height="78" width="188.203125" y="-39" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>锁定具体行<br>开销大，并发度高</p></span></div></foreignObject></g></g><g transform="translate(579.4609375, 338)" id="flowchart-G-11387" class="node default"><rect height="78" width="170.078125" y="-39" x="-85.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-55.0390625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="110.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>锁定数据页<br>MySQL较少使用</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="t65ycl_134"><span class="control" id="t65ycl_138">InnoDB锁类型详解：</span></p><div class="table-wrapper"><table class="wide" id="t65ycl_135"><thead><tr class="ijRowHead" id="t65ycl_139"><th id="t65ycl_144"><p>锁类型</p></th><th id="t65ycl_145"><p>作用范围</p></th><th id="t65ycl_146"><p>兼容性</p></th><th id="t65ycl_147"><p>使用场景</p></th></tr></thead><tbody><tr id="t65ycl_140"><td id="t65ycl_148"><p><span class="control" id="t65ycl_152">共享锁（S）</span></p></td><td id="t65ycl_149"><p>行/表</p></td><td id="t65ycl_150"><p>S锁兼容，X锁不兼容</p></td><td id="t65ycl_151"><p>SELECT ... LOCK IN SHARE MODE</p></td></tr><tr id="t65ycl_141"><td id="t65ycl_153"><p><span class="control" id="t65ycl_157">排他锁（X）</span></p></td><td id="t65ycl_154"><p>行/表</p></td><td id="t65ycl_155"><p>都不兼容</p></td><td id="t65ycl_156"><p>INSERT、UPDATE、DELETE</p></td></tr><tr id="t65ycl_142"><td id="t65ycl_158"><p><span class="control" id="t65ycl_162">意向共享锁（IS）</span></p></td><td id="t65ycl_159"><p>表</p></td><td id="t65ycl_160"><p>与IS、IX、S兼容</p></td><td id="t65ycl_161"><p>准备在行上加S锁</p></td></tr><tr id="t65ycl_143"><td id="t65ycl_163"><p><span class="control" id="t65ycl_167">意向排他锁（IX）</span></p></td><td id="t65ycl_164"><p>表</p></td><td id="t65ycl_165"><p>与IS、IX兼容</p></td><td id="t65ycl_166"><p>准备在行上加X锁</p></td></tr></tbody></table></div></section><section class="chapter"><h3 id="q6" data-toc="q6">Q6: 什么是间隙锁和临键锁？如何防止幻读？</h3><p id="t65ycl_168"><span class="control" id="t65ycl_175">答案：</span></p><p id="t65ycl_169"><span class="control" id="t65ycl_176">InnoDB特殊锁机制：</span></p><p id="t65ycl_171"><span class="control" id="t65ycl_177">间隙锁示例：</span></p><div class="code-block" data-lang="sql">
-- 假设表中有记录：id = 1, 5, 10, 15, 20

-- 事务A执行范围查询
SELECT * FROM table WHERE id BETWEEN 8 AND 12 FOR UPDATE;

-- 这会产生以下锁：
-- Record Lock: id=10 (锁定记录)
-- Gap Lock: (5,10) (防止插入6,7,8,9)
-- Gap Lock: (10,15) (防止插入11,12,13,14)

-- 事务B尝试插入会被阻塞
INSERT INTO table (id) VALUES (9);  -- 被阻塞
INSERT INTO table (id) VALUES (11); -- 被阻塞
</div><p id="t65ycl_173"><span class="control" id="t65ycl_178">临键锁的作用：</span></p><ul class="list _bullet" id="t65ycl_174"><li class="list__item" id="t65ycl_179"><p id="t65ycl_182"><span class="control" id="t65ycl_183">REPEATABLE READ</span>级别下默认使用</p></li><li class="list__item" id="t65ycl_180"><p id="t65ycl_184">解决幻读问题</p></li><li class="list__item" id="t65ycl_181"><p id="t65ycl_185">锁定查询范围内的记录和间隙</p></li></ul></section></section><section class="chapter"><h2 id="t65ycl_8" data-toc="t65ycl_8">⚠️ 死锁问题</h2><section class="chapter"><h3 id="q7" data-toc="q7">Q7: 什么是死锁？如何检测和避免死锁？</h3><p id="t65ycl_187"><span class="control" id="t65ycl_196">答案：</span></p><p id="t65ycl_188"><span class="control" id="t65ycl_197">死锁产生原理：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 499.921875 580"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="499.921875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="死锁场景" class="cluster"><rect height="564" width="483.921875" y="8" x="8" style=""></rect><g transform="translate(217.90625, 8)" class="cluster-label"><foreignObject height="24" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>死锁场景</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M133.883,123.5L133.883,129.75C133.883,136,133.883,148.5,133.883,157.875C133.883,167.25,133.883,173.5,133.883,179.083C133.883,184.667,133.883,189.583,133.883,192.042L133.883,194.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_1" d="M365.844,123.5L365.844,129.75C365.844,136,365.844,148.5,365.844,157.875C365.844,167.25,365.844,173.5,365.844,179.083C365.844,184.667,365.844,189.583,365.844,192.042L365.844,194.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-dotted edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_E_2" d="M133.883,252.5L133.883,258.75C133.883,265,133.883,277.5,133.883,286.875C133.883,296.25,133.883,302.5,133.883,308.083C133.883,313.667,133.883,318.583,133.883,321.042L133.883,323.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-dotted edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_F_3" d="M365.844,252.5L365.844,258.75C365.844,265,365.844,277.5,365.844,286.875C365.844,296.25,365.844,302.5,365.844,308.083C365.844,313.667,365.844,318.583,365.844,321.042L365.844,323.5"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-dotted edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_G_4" d="M133.883,381.5L133.883,387.75C133.883,394,133.883,406.5,138.621,415.875C143.358,425.25,152.834,431.5,161.753,437.383C170.672,443.266,179.034,448.782,183.216,451.54L187.397,454.298"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-dotted edge-thickness-normal edge-pattern-solid flowchart-link" id="L_F_G_5" d="M365.844,381.5L365.844,387.75C365.844,394,365.844,406.5,361.106,415.875C356.368,425.25,346.893,431.5,337.974,437.383C329.055,443.266,320.692,448.782,316.511,451.54L312.33,454.298"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(133.8828125, 84.5)" id="flowchart-A-11470" class="node default"><rect height="78" width="124.625" y="-39" x="-62.3125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.3125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="64.625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务A<br>持有锁L1</p></span></div></foreignObject></g></g><g transform="translate(133.8828125, 225.5)" id="flowchart-B-11471" class="node default"><rect height="54" width="124.625" y="-27" x="-62.3125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.3125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>请求锁L2</p></span></div></foreignObject></g></g><g transform="translate(365.84375, 84.5)" id="flowchart-C-11472" class="node default"><rect height="78" width="124.625" y="-39" x="-62.3125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.3125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="64.625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务B<br>持有锁L2</p></span></div></foreignObject></g></g><g transform="translate(365.84375, 225.5)" id="flowchart-D-11473" class="node default"><rect height="54" width="124.625" y="-27" x="-62.3125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.3125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="64.625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>请求锁L1</p></span></div></foreignObject></g></g><g transform="translate(133.8828125, 354.5)" id="flowchart-E-11475" class="node default"><rect height="54" width="181.765625" y="-27" x="-90.8828125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-60.8828125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="121.765625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>等待事务B释放L2</p></span></div></foreignObject></g></g><g transform="translate(365.84375, 354.5)" id="flowchart-F-11477" class="node default"><rect height="54" width="182.15625" y="-27" x="-91.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-61.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="122.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>等待事务A释放L1</p></span></div></foreignObject></g></g><g transform="translate(249.86328125, 495.5)" id="flowchart-G-11479" class="node default"><rect height="78" width="156.15625" y="-39" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>形成循环等待<br>产生死锁</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="t65ycl_190"><span class="control" id="t65ycl_198">死锁示例：</span></p><div class="code-block" data-lang="sql">
-- 事务A
START TRANSACTION;
UPDATE account SET balance = balance - 100 WHERE user_id = 1;
-- 等待事务B...
UPDATE account SET balance = balance + 100 WHERE user_id = 2;
COMMIT;

-- 事务B（同时执行）
START TRANSACTION;
UPDATE account SET balance = balance - 50 WHERE user_id = 2;
-- 等待事务A...
UPDATE account SET balance = balance + 50 WHERE user_id = 1;
COMMIT;
</div><p id="t65ycl_192"><span class="control" id="t65ycl_199">死锁检测与处理：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1629.171875 452"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1629.171875" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="避免死锁策略" class="cluster"><rect height="436" width="295.25" y="8" x="8" style=""></rect><g transform="translate(107.546875, 8)" class="cluster-label"><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>避免死锁策略</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(155.625, 70)" id="flowchart-F-11531" class="node default"><rect height="54" width="204.21875" y="-27" x="-102.109375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-72.109375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="144.21875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>按相同顺序访问资源</p></span></div></foreignObject></g></g><g transform="translate(155.625, 174)" id="flowchart-G-11532" class="node default"><rect height="54" width="188.203125" y="-27" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>缩短事务执行时间</p></span></div></foreignObject></g></g><g transform="translate(155.625, 278)" id="flowchart-H-11533" class="node default"><rect height="54" width="188.203125" y="-27" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>降低事务隔离级别</p></span></div></foreignObject></g></g><g transform="translate(155.625, 382)" id="flowchart-I-11534" class="node default"><rect height="54" width="220.25" y="-27" x="-110.125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-80.125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="160.25"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>使用乐观锁替代悲观锁</p></span></div></foreignObject></g></g></g></g><g transform="translate(345.25, 144)" class="root"><g class="clusters"><g data-look="classic" id="MySQL死锁处理机制" class="cluster"><rect height="148" width="1267.921875" y="8" x="8" style=""></rect><g transform="translate(570.8984375, 8)" class="cluster-label"><foreignObject height="24" width="142.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>MySQL死锁处理机制</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M217.672,82L223.922,82C230.172,82,242.672,82,252.047,82C261.422,82,267.672,82,273.255,82C278.839,82,283.755,82,286.214,82L288.672,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M448.828,82L455.078,82C461.328,82,473.828,82,483.203,82C492.578,82,498.828,82,504.411,82C509.995,82,514.911,82,517.37,82L519.828,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_2" d="M728.047,82L734.297,82C740.547,82,753.047,82,762.422,82C771.797,82,778.047,82,783.63,82C789.214,82,794.13,82,796.589,82L799.047,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_E_3" d="M975.219,82L981.469,82C987.719,82,1000.219,82,1009.594,82C1018.969,82,1025.219,82,1030.802,82C1036.385,82,1041.302,82,1043.76,82L1046.219,82"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(131.5859375, 82)" id="flowchart-A-11523" class="node default"><rect height="78" width="172.171875" y="-39" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>死锁检测器<br>定期扫描等待图</p></span></div></foreignObject></g></g><g transform="translate(370.75, 82)" id="flowchart-B-11524" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>发现死锁循环</p></span></div></foreignObject></g></g><g transform="translate(625.9375, 82)" id="flowchart-C-11526" class="node default"><rect height="54" width="204.21875" y="-27" x="-102.109375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-72.109375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="144.21875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>选择代价最小的事务</p></span></div></foreignObject></g></g><g transform="translate(889.1328125, 82)" id="flowchart-D-11528" class="node default"><rect height="78" width="172.171875" y="-39" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>回滚选中的事务<br>释放持有的锁</p></span></div></foreignObject></g></g><g transform="translate(1144.3203125, 82)" id="flowchart-E-11530" class="node default"><rect height="54" width="188.203125" y="-27" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>其他事务继续执行</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="t65ycl_194"><span class="control" id="t65ycl_200">死锁避免最佳实践：</span></p><ol class="list _decimal" id="t65ycl_195" type="1"><li class="list__item" id="t65ycl_201"><p id="t65ycl_204"><span class="control" id="t65ycl_206">统一资源访问顺序</span></p><div class="code-block" data-lang="sql">
-- 统一按user_id升序访问
UPDATE account SET balance = balance - 100 
WHERE user_id = LEAST(@user1, @user2);

UPDATE account SET balance = balance + 100 
WHERE user_id = GREATEST(@user1, @user2);
</div></li><li class="list__item" id="t65ycl_202"><p id="t65ycl_207"><span class="control" id="t65ycl_209">减小事务粒度</span></p><div class="code-block" data-lang="sql">
-- 避免长事务
START TRANSACTION;
-- 尽量减少锁持有时间
UPDATE table SET field = value WHERE condition;
COMMIT;
</div></li><li class="list__item" id="t65ycl_203"><p id="t65ycl_210"><span class="control" id="t65ycl_212">使用合理的隔离级别</span></p><div class="code-block" data-lang="sql">
-- 根据业务需求选择合适的隔离级别
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
</div></li></ol></section></section><section class="chapter"><h2 id="mvcc" data-toc="mvcc">🎯 MVCC机制</h2><section class="chapter"><h3 id="q8-mvcc" data-toc="q8-mvcc">Q8: 什么是MVCC？它是如何实现的？</h3><p id="t65ycl_215"><span class="control" id="t65ycl_221">答案：</span></p><p id="t65ycl_216">MVCC（Multi-Version Concurrency Control）多版本并发控制，是InnoDB实现高并发的核心机制。</p><p id="t65ycl_217"><span class="control" id="t65ycl_222">MVCC实现原理：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1436.203125 420"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="1436.203125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 128)" class="root"><g class="clusters"><g data-look="classic" id="版本链结构" class="cluster"><rect height="148" width="870.625" y="8" x="8" style=""></rect><g transform="translate(403.25, 8)" class="cluster-label"><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>版本链结构</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_H_3" d="M181.75,82L188,82C194.25,82,206.75,82,216.125,82C225.5,82,231.75,82,237.333,82C242.917,82,247.833,82,250.292,82L252.75,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_H_I_4" d="M384.594,82L390.844,82C397.094,82,409.594,82,418.969,82C428.344,82,434.594,82,440.177,82C445.76,82,450.677,82,453.135,82L455.594,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_I_J_5" d="M587.438,82L593.688,82C599.938,82,612.438,82,621.813,82C631.188,82,637.438,82,643.021,82C648.604,82,653.521,82,655.979,82L658.438,82"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(113.625, 82)" id="flowchart-G-11582" class="node default"><rect height="78" width="136.25" y="-39" x="-68.125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-38.125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="76.25"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>最新版本<br>trx_id=100</p></span></div></foreignObject></g></g><g transform="translate(320.671875, 82)" id="flowchart-H-11583" class="node default"><rect height="78" width="127.84375" y="-39" x="-63.921875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-33.921875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="67.84375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>历史版本<br>trx_id=90</p></span></div></foreignObject></g></g><g transform="translate(523.515625, 82)" id="flowchart-I-11585" class="node default"><rect height="78" width="127.84375" y="-39" x="-63.921875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-33.921875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="67.84375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>更早版本<br>trx_id=80</p></span></div></foreignObject></g></g><g transform="translate(751.78125, 82)" id="flowchart-J-11587" class="node default"><rect height="54" width="178.6875" y="-27" x="-89.34375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-59.34375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="118.6875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>... 更多历史版本</p></span></div></foreignObject></g></g></g></g><g transform="translate(920.625, 0)" class="root"><g class="clusters"><g data-look="classic" id="MVCC核心组件" class="cluster"><rect height="404" width="499.578125" y="8" x="8" style=""></rect><g transform="translate(205.7421875, 8)" class="cluster-label"><foreignObject height="24" width="104.09375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>MVCC核心组件</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M197.375,82L205.208,82C213.042,82,228.708,82,239.667,82C250.625,82,256.875,82,262.458,82C268.042,82,272.958,82,275.417,82L277.875,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_1" d="M193.219,210L201.745,210C210.271,210,227.323,210,239.642,210C251.961,210,259.547,210,266.466,210C273.385,210,279.638,210,282.764,210L285.891,210"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_2" d="M206.875,338L213.125,338C219.375,338,231.875,338,242.585,338C253.296,338,262.216,338,270.47,338C278.724,338,286.311,338,290.105,338L293.898,338"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(126.1875, 82)" id="flowchart-A-11576" class="node default"><rect height="78" width="142.375" y="-39" x="-71.1875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-41.1875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="82.375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>版本链<br>Undo Log链</p></span></div></foreignObject></g></g><g transform="translate(375.9765625, 82)" id="flowchart-B-11577" class="node default"><rect height="54" width="188.203125" y="-27" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>每行记录多个版本</p></span></div></foreignObject></g></g><g transform="translate(126.1875, 210)" id="flowchart-C-11578" class="node default"><rect height="78" width="134.0625" y="-39" x="-67.03125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-37.03125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="74.0625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Read View<br>读视图</p></span></div></foreignObject></g></g><g transform="translate(375.9765625, 210)" id="flowchart-D-11579" class="node default"><rect height="54" width="172.171875" y="-27" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>判断版本可见性</p></span></div></foreignObject></g></g><g transform="translate(126.1875, 338)" id="flowchart-E-11580" class="node default"><rect height="78" width="161.375" y="-39" x="-80.6875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-50.6875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="101.375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务ID<br>Transaction ID</p></span></div></foreignObject></g></g><g transform="translate(375.9765625, 338)" id="flowchart-F-11581" class="node default"><rect height="54" width="156.15625" y="-27" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>标识事务版本</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="t65ycl_219"><span class="control" id="t65ycl_223">Read View结构：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 918.34375 396"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="918.34375" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="可见性判断规则" class="cluster"><rect height="177" width="902.34375" y="8" x="8" style=""></rect><g transform="translate(403.0859375, 8)" class="cluster-label"><foreignObject height="24" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>可见性判断规则</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(158.203125, 96.5)" id="flowchart-E-11629" class="node default"><rect height="78" width="230.40625" y="-39" x="-115.203125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-85.203125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="170.40625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>版本trx_id &lt; min_trx_id<br>✅ 可见</p></span></div></foreignObject></g></g><g transform="translate(444.375, 96.5)" id="flowchart-F-11630" class="node default"><rect height="78" width="241.9375" y="-39" x="-120.96875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-90.96875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="181.9375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>版本trx_id &gt;= max_trx_id<br>❌ 不可见</p></span></div></foreignObject></g></g><g transform="translate(745.34375, 96.5)" id="flowchart-G-11631" class="node default"><rect height="102" width="260" y="-51" x="-130" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-100, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>min_trx_id ≤ 版本trx_id &lt; max_trx_id<br>检查是否在活跃列表中</p></span></div></foreignObject></g></g></g></g><g transform="translate(11.6796875, 227)" class="root"><g class="clusters"><g data-look="classic" id="subGraph0" class="cluster"><rect height="153" width="878.984375" y="8" x="8" style=""></rect><g transform="translate(394.4375, 8)" class="cluster-label"><foreignObject height="24" width="106.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Read View内容</p></span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(128.234375, 84.5)" id="flowchart-A-11625" class="node default"><rect height="78" width="170.46875" y="-39" x="-85.234375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-55.234375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="110.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>m_ids<br>活跃事务ID列表</p></span></div></foreignObject></g></g><g transform="translate(348.703125, 84.5)" id="flowchart-B-11626" class="node default"><rect height="78" width="170.46875" y="-39" x="-85.234375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-55.234375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="110.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>min_trx_id<br>最小活跃事务ID</p></span></div></foreignObject></g></g><g transform="translate(561.15625, 84.5)" id="flowchart-C-11627" class="node default"><rect height="78" width="154.4375" y="-39" x="-77.21875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-47.21875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="94.4375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>max_trx_id<br>下一个事务ID</p></span></div></foreignObject></g></g><g transform="translate(770.1796875, 84.5)" id="flowchart-D-11628" class="node default"><rect height="78" width="163.609375" y="-39" x="-81.8046875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-51.8046875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="103.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>creator_trx_id<br>创建者事务ID</p></span></div></foreignObject></g></g></g></g></g></g></g></svg></section><section class="chapter"><h3 id="q9" data-toc="q9">Q9: 快照读和当前读的区别是什么？</h3><p id="t65ycl_224"><span class="control" id="t65ycl_231">答案：</span></p><p id="t65ycl_225"><span class="control" id="t65ycl_232">读取方式对比：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 2000.859375 212"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="2000.859375" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="subGraph1" class="cluster"><rect height="196" width="1028.46875" y="8" x="8" style=""></rect><g transform="translate(448.578125, 8)" class="cluster-label"><foreignObject height="24" width="147.3125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>当前读 Current Read</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_F_3" d="M305.5,106L311.75,106C318,106,330.5,106,339.875,106C349.25,106,355.5,106,361.083,106C366.667,106,371.583,106,374.042,106L376.5,106"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_F_G_4" d="M536.656,106L542.906,106C549.156,106,561.656,106,571.031,106C580.406,106,586.656,106,592.24,106C597.823,106,602.74,106,605.198,106L607.656,106"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_G_H_5" d="M767.813,106L774.063,106C780.313,106,792.813,106,802.188,106C811.563,106,817.813,106,823.396,106C828.979,106,833.896,106,836.354,106L838.813,106"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(175.5, 106)" id="flowchart-E-11670" class="node default"><rect height="126" width="260" y="-63" x="-130" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-100, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>SELECT ... FOR UPDATE<br>SELECT ... LOCK IN SHARE MODE<br>INSERT/UPDATE/DELETE</p></span></div></foreignObject></g></g><g transform="translate(458.578125, 106)" id="flowchart-F-11671" class="node default"><rect height="78" width="156.15625" y="-39" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>读取最新版本<br>加锁访问</p></span></div></foreignObject></g></g><g transform="translate(689.734375, 106)" id="flowchart-G-11673" class="node default"><rect height="78" width="156.15625" y="-39" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>加锁操作<br>阻塞其他事务</p></span></div></foreignObject></g></g><g transform="translate(920.890625, 106)" id="flowchart-H-11675" class="node default"><rect height="78" width="156.15625" y="-39" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>读取最新数据<br>实时一致性</p></span></div></foreignObject></g></g></g></g><g transform="translate(1078.46875, 24)" class="root"><g class="clusters"><g data-look="classic" id="subGraph0" class="cluster"><rect height="148" width="906.390625" y="8" x="8" style=""></rect><g transform="translate(382.859375, 8)" class="cluster-label"><foreignObject height="24" width="156.671875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>快照读 Snapshot Read</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M189.5,82L195.75,82C202,82,214.5,82,223.875,82C233.25,82,239.5,82,245.083,82C250.667,82,255.583,82,258.042,82L260.5,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_C_1" d="M430.609,82L436.859,82C443.109,82,455.609,82,464.984,82C474.359,82,480.609,82,486.193,82C491.776,82,496.693,82,499.151,82L501.609,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_D_2" d="M629.719,82L635.969,82C642.219,82,654.719,82,664.094,82C673.469,82,679.719,82,685.302,82C690.885,82,695.802,82,698.26,82L700.719,82"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(117.5, 82)" id="flowchart-A-11664" class="node default"><rect height="54" width="144" y="-27" x="-72" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-42, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="84"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>普通SELECT</p></span></div></foreignObject></g></g><g transform="translate(347.5546875, 82)" id="flowchart-B-11665" class="node default"><rect height="78" width="166.109375" y="-39" x="-83.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-53.0546875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="106.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>读取历史版本<br>基于Read View</p></span></div></foreignObject></g></g><g transform="translate(567.6640625, 82)" id="flowchart-C-11667" class="node default"><rect height="78" width="124.109375" y="-39" x="-62.0546875" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-32.0546875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="64.109375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>不加锁<br>并发性高</p></span></div></foreignObject></g></g><g transform="translate(790.8046875, 82)" id="flowchart-D-11669" class="node default"><rect height="78" width="172.171875" y="-39" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>可能读到旧数据<br>一致性快照</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="t65ycl_227"><span class="control" id="t65ycl_233">具体示例：</span></p><div class="code-block" data-lang="sql">
-- 事务隔离级别：REPEATABLE READ

-- 事务A
START TRANSACTION;
SELECT balance FROM account WHERE user_id = 1;  -- 快照读，结果：100

-- 事务B（并发执行）
START TRANSACTION;
UPDATE account SET balance = 200 WHERE user_id = 1;
COMMIT;

-- 事务A继续
SELECT balance FROM account WHERE user_id = 1;                    -- 快照读，结果：100
SELECT balance FROM account WHERE user_id = 1 FOR UPDATE;        -- 当前读，结果：200
COMMIT;
</div><p id="t65ycl_229"><span class="control" id="t65ycl_234">使用场景：</span></p><div class="table-wrapper"><table class="wide" id="t65ycl_230"><thead><tr class="ijRowHead" id="t65ycl_235"><th id="t65ycl_238"><p>读取方式</p></th><th id="t65ycl_239"><p>使用场景</p></th><th id="t65ycl_240"><p>特点</p></th><th id="t65ycl_241"><p>SQL语句</p></th></tr></thead><tbody><tr id="t65ycl_236"><td id="t65ycl_242"><p><span class="control" id="t65ycl_246">快照读</span></p></td><td id="t65ycl_243"><p>一般查询、报表统计</p></td><td id="t65ycl_244"><p>高并发、一致性快照</p></td><td id="t65ycl_245"><p>SELECT</p></td></tr><tr id="t65ycl_237"><td id="t65ycl_247"><p><span class="control" id="t65ycl_251">当前读</span></p></td><td id="t65ycl_248"><p>业务逻辑判断、数据修改</p></td><td id="t65ycl_249"><p>实时数据、加锁保护</p></td><td id="t65ycl_250"><p>SELECT FOR UPDATE</p></td></tr></tbody></table></div></section></section><section class="chapter"><h2 id="t65ycl_10" data-toc="t65ycl_10">💡 锁优化策略</h2><section class="chapter"><h3 id="q10" data-toc="q10">Q10: 如何优化锁的使用，提高并发性能？</h3><p id="t65ycl_253"><span class="control" id="t65ycl_258">答案：</span></p><p id="t65ycl_254"><span class="control" id="t65ycl_259">锁优化策略：</span></p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 709.453125 548"  class="flowchart" xmlns="http://www.w3.org/2000/svg" width="709.453125" id="mermaid"><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(0, 0)" class="root"><g class="clusters"><g data-look="classic" id="锁优化策略" class="cluster"><rect height="532" width="693.453125" y="8" x="8" style=""></rect><g transform="translate(314.6640625, 8)" class="cluster-label"><foreignObject height="24" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>锁优化策略</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M112.412,247L125.523,219.5C138.634,192,164.856,137,182.427,109.5C199.999,82,208.919,82,217.173,82C225.427,82,233.014,82,236.808,82L240.602,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_C_1" d="M138.157,247L146.977,240.833C155.797,234.667,173.438,222.333,185.383,216.167C197.328,210,203.578,210,209.161,210C214.745,210,219.661,210,222.12,210L224.578,210"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_D_2" d="M138.157,301L146.977,307.167C155.797,313.333,173.438,325.667,186.718,331.833C199.999,338,208.919,338,217.173,338C225.427,338,233.014,338,236.808,338L240.602,338"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_E_3" d="M112.412,301L125.523,328.5C138.634,356,164.856,411,182.427,438.5C199.999,466,208.919,466,217.173,466C225.427,466,233.014,466,236.808,466L240.602,466"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_F_4" d="M384.727,82L393.647,82C402.568,82,420.409,82,433.79,82C447.171,82,456.091,82,464.345,82C472.599,82,480.186,82,483.98,82L487.773,82"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_C_G_5" d="M400.75,210L407,210C413.25,210,425.75,210,436.46,210C447.171,210,456.091,210,464.345,210C472.599,210,480.186,210,483.98,210L487.773,210"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_D_H_6" d="M384.727,338L393.647,338C402.568,338,420.409,338,432.454,338C444.5,338,450.75,338,456.333,338C461.917,338,466.833,338,469.292,338L471.75,338"></path><path marker-end="url(#mermaid_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_E_I_7" d="M384.727,466L393.647,466C402.568,466,420.409,466,433.122,466C445.836,466,453.422,466,460.341,466C467.26,466,473.513,466,476.639,466L479.766,466"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(99.5390625, 274)" id="flowchart-A-11694" class="node default"><rect height="54" width="108.078125" y="-27" x="-54.0390625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-24.0390625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="48.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>锁优化</p></span></div></foreignObject></g></g><g transform="translate(314.6640625, 82)" id="flowchart-B-11695" class="node default"><rect height="78" width="140.125" y="-39" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>减少锁粒度<br>使用行级锁</p></span></div></foreignObject></g></g><g transform="translate(314.6640625, 210)" id="flowchart-C-11697" class="node default"><rect height="78" width="172.171875" y="-39" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>缩短锁持有时间<br>快速提交</p></span></div></foreignObject></g></g><g transform="translate(314.6640625, 338)" id="flowchart-D-11699" class="node default"><rect height="78" width="140.125" y="-39" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>避免锁升级<br>控制锁范围</p></span></div></foreignObject></g></g><g transform="translate(314.6640625, 466)" id="flowchart-E-11701" class="node default"><rect height="78" width="140.125" y="-39" x="-70.0625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-40.0625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="80.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>使用乐观锁<br>减少阻塞</p></span></div></foreignObject></g></g><g transform="translate(569.8515625, 82)" id="flowchart-F-11703" class="node default"><rect height="78" width="156.15625" y="-39" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>合理设计索引<br>精确定位数据</p></span></div></foreignObject></g></g><g transform="translate(569.8515625, 210)" id="flowchart-G-11705" class="node default"><rect height="78" width="156.15625" y="-39" x="-78.078125" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-48.078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="96.15625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>事务尽量简短<br>减少业务逻辑</p></span></div></foreignObject></g></g><g transform="translate(569.8515625, 338)" id="flowchart-H-11707" class="node default"><rect height="78" width="188.203125" y="-39" x="-94.1015625" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-64.1015625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="128.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>批量操作分批处理<br>避免大范围锁</p></span></div></foreignObject></g></g><g transform="translate(569.8515625, 466)" id="flowchart-I-11709" class="node default"><rect height="78" width="172.171875" y="-39" x="-86.0859375" data-et="node" data-id="abc" style="" class="basic label-container"></rect><g transform="translate(-56.0859375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="112.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>使用版本号机制<br>CAS操作</p></span></div></foreignObject></g></g></g></g></g></g></g></svg><p id="t65ycl_256"><span class="control" id="t65ycl_260">具体优化技巧：</span></p><ol class="list _decimal" id="t65ycl_257" type="1"><li class="list__item" id="t65ycl_261"><p id="t65ycl_265"><span class="control" id="t65ycl_267">索引优化减少锁范围</span></p><div class="code-block" data-lang="sql">
-- 不良设计：全表扫描，锁范围大
SELECT * FROM orders WHERE status = 1 FOR UPDATE;

-- 优化：使用索引精确定位
CREATE INDEX idx_status ON orders(status);
SELECT * FROM orders WHERE status = 1 AND id = 12345 FOR UPDATE;
</div></li><li class="list__item" id="t65ycl_262"><p id="t65ycl_268"><span class="control" id="t65ycl_270">批量操作优化</span></p><div class="code-block" data-lang="sql">
-- 避免：一次性锁定大量记录
UPDATE orders SET status = 2 WHERE create_time &lt; '2023-01-01';

-- 优化：分批处理
UPDATE orders SET status = 2 
WHERE create_time &lt; '2023-01-01' 
LIMIT 1000;
</div></li><li class="list__item" id="t65ycl_263"><p id="t65ycl_271"><span class="control" id="t65ycl_273">乐观锁机制</span></p><div class="code-block" data-lang="sql">
-- 使用版本号实现乐观锁
UPDATE account 
SET balance = balance - 100, version = version + 1
WHERE user_id = 1 AND version = @old_version;

-- 检查affected_rows确认更新成功
</div></li><li class="list__item" id="t65ycl_264"><p id="t65ycl_274"><span class="control" id="t65ycl_276">事务设计优化</span></p><div class="code-block" data-lang="sql">
-- 避免：事务中包含业务逻辑
START TRANSACTION;
SELECT balance FROM account WHERE user_id = 1 FOR UPDATE;
-- 复杂业务计算...
UPDATE account SET balance = @new_balance WHERE user_id = 1;
COMMIT;

-- 优化：先计算再开启事务
-- 业务计算...
START TRANSACTION;
UPDATE account SET balance = @new_balance WHERE user_id = 1;
COMMIT;
</div></li></ol></section></section><section class="chapter"><h2 id="t65ycl_11" data-toc="t65ycl_11">💡 面试技巧</h2><section class="chapter"><h3 id="t65ycl_277" data-toc="t65ycl_277">高频考点</h3><ol class="list _decimal" id="t65ycl_279" type="1"><li class="list__item" id="t65ycl_280"><p id="t65ycl_285"><span class="control" id="t65ycl_286">ACID特性</span> ：详细解释每个特性的含义和实现</p></li><li class="list__item" id="t65ycl_281"><p id="t65ycl_287"><span class="control" id="t65ycl_288">隔离级别</span> ：四种级别的区别和并发问题</p></li><li class="list__item" id="t65ycl_282"><p id="t65ycl_289"><span class="control" id="t65ycl_290">锁机制</span> ：锁的分类和使用场景</p></li><li class="list__item" id="t65ycl_283"><p id="t65ycl_291"><span class="control" id="t65ycl_292">死锁处理</span> ：死锁产生原因和预防策略</p></li><li class="list__item" id="t65ycl_284"><p id="t65ycl_293"><span class="control" id="t65ycl_294">MVCC原理</span> ：多版本并发控制的实现机制</p></li></ol></section><section class="chapter"><h3 id="t65ycl_278" data-toc="t65ycl_278">回答策略</h3><ol class="list _decimal" id="t65ycl_295" type="1"><li class="list__item" id="t65ycl_298"><p id="t65ycl_302"><span class="control" id="t65ycl_303">理论结合实践</span> ：用具体案例说明抽象概念</p></li><li class="list__item" id="t65ycl_299"><p id="t65ycl_304"><span class="control" id="t65ycl_305">对比分析</span> ：比较不同隔离级别和锁类型的优缺点</p></li><li class="list__item" id="t65ycl_300"><p id="t65ycl_306"><span class="control" id="t65ycl_307">问题解决</span> ：展示分析和解决死锁问题的能力</p></li><li class="list__item" id="t65ycl_301"><p id="t65ycl_308"><span class="control" id="t65ycl_309">性能考虑</span> ：从性能角度分析锁的使用策略</p></li></ol><p id="t65ycl_297"><span class="control" id="t65ycl_310">学习建议</span> ：事务和锁是MySQL的核心机制，建议通过实际操作和案例分析来深入理解，特别要掌握死锁分析和MVCC原理。</p></section></section><div class="last-modified">09 六月 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="mysql索引优化qa.html" class="navigation-links__prev">MySQL索引优化QA</a><a href="mysql性能优化qa.html" class="navigation-links__next">MySQL性能优化QA</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>